var no=Object.defineProperty,ao=Object.defineProperties;var io=Object.getOwnPropertyDescriptors;var at=Object.getOwnPropertySymbols;var Mt=Object.prototype.hasOwnProperty,Rt=Object.prototype.propertyIsEnumerable;var mt=(s,e,o)=>e in s?no(s,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):s[e]=o,me=(s,e)=>{for(var o in e||(e={}))Mt.call(e,o)&&mt(s,o,e[o]);if(at)for(var o of at(e))Rt.call(e,o)&&mt(s,o,e[o]);return s},De=(s,e)=>ao(s,io(e));var kt=(s,e)=>{var o={};for(var r in s)Mt.call(s,r)&&e.indexOf(r)<0&&(o[r]=s[r]);if(s!=null&&at)for(var r of at(s))e.indexOf(r)<0&&Rt.call(s,r)&&(o[r]=s[r]);return o};var U=(s,e,o)=>(mt(s,typeof e!="symbol"?e+"":e,o),o);var xt=(s,e,o)=>new Promise((r,a)=>{var n=i=>{try{c(o.next(i))}catch(d){a(d)}},l=i=>{try{c(o.throw(i))}catch(d){a(d)}},c=i=>i.done?r(i.value):Promise.resolve(i.value).then(n,l);c((o=o.apply(s,e)).next())});import{r as m,a as lo,R as Ft}from"./vendor-1.1.0-1f763956.js";import{W as co,q as uo}from"./helmet-1.1.0-341783ac.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const n of a)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function o(a){const n={};return a.integrity&&(n.integrity=a.integrity),a.referrerPolicy&&(n.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?n.credentials="include":a.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(a){if(a.ep)return;a.ep=!0;const n=o(a);fetch(a.href,n)}})();var Wt={exports:{}},lt={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fo=m,ho=Symbol.for("react.element"),go=Symbol.for("react.fragment"),mo=Object.prototype.hasOwnProperty,po=fo.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,yo={key:!0,ref:!0,__self:!0,__source:!0};function Ht(s,e,o){var r,a={},n=null,l=null;o!==void 0&&(n=""+o),e.key!==void 0&&(n=""+e.key),e.ref!==void 0&&(l=e.ref);for(r in e)mo.call(e,r)&&!yo.hasOwnProperty(r)&&(a[r]=e[r]);if(s&&s.defaultProps)for(r in e=s.defaultProps,e)a[r]===void 0&&(a[r]=e[r]);return{$$typeof:ho,type:s,key:n,ref:l,props:a,_owner:po.current}}lt.Fragment=go;lt.jsx=Ht;lt.jsxs=Ht;Wt.exports=lt;var f=Wt.exports,St={},Et=lo;St.createRoot=Et.createRoot,St.hydrateRoot=Et.hydrateRoot;const bo="modulepreload",wo=function(s){return"/ChipPuzzleGame/"+s},At={},He=function(e,o,r){if(!o||o.length===0)return e();const a=document.getElementsByTagName("link");return Promise.all(o.map(n=>{if(n=wo(n),n in At)return;At[n]=!0;const l=n.endsWith(".css"),c=l?'[rel="stylesheet"]':"";if(!!r)for(let h=a.length-1;h>=0;h--){const b=a[h];if(b.href===n&&(!l||b.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${n}"]${c}`))return;const d=document.createElement("link");if(d.rel=l?"stylesheet":bo,l||(d.as="script",d.crossOrigin=""),d.href=n,document.head.appendChild(d),l)return new Promise((h,b)=>{d.addEventListener("load",h),d.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${n}`)))})})).then(()=>e()).catch(n=>{const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=n,window.dispatchEvent(l),!l.defaultPrevented)throw n})};class So{constructor(){U(this,"isDevelopment",!1);U(this,"logHistory",[]);U(this,"maxHistorySize",100)}createLogEntry(e,o,r){return{level:e,message:o,data:r,timestamp:new Date().toISOString(),userAgent:typeof navigator!="undefined"?navigator.userAgent:void 0,url:typeof window!="undefined"?window.location.href:void 0}}addToHistory(e){this.logHistory.push(e),this.logHistory.length>this.maxHistorySize&&this.logHistory.shift()}log(e,o,r){const a=this.createLogEntry(e,o,r);if(this.addToHistory(a),this.isDevelopment){const n=console[e]||console.log;r?n(`[${e.toUpperCase()}] ${o}`,r):n(`[${e.toUpperCase()}] ${o}`)}e==="error"&&this.handleError(a)}handleError(e){try{const o=JSON.parse(localStorage.getItem("chipPuzzleGame_errorLogs")||"[]");o.push(e),o.length>50&&o.shift(),localStorage.setItem("chipPuzzleGame_errorLogs",JSON.stringify(o))}catch(o){this.isDevelopment}}debug(e,o){this.log("debug",e,o)}info(e,o){this.log("info",e,o)}warn(e,o){this.log("warn",e,o)}error(e,o){this.log("error",e,o)}getHistory(){return[...this.logHistory]}clearHistory(){this.logHistory=[]}getErrorLogs(){try{return JSON.parse(localStorage.getItem("chipPuzzleGame_errorLogs")||"[]")}catch(e){return[]}}clearErrorLogs(){try{localStorage.removeItem("chipPuzzleGame_errorLogs")}catch(e){}}}const v=new So;class vo extends m.Component{constructor(){super(...arguments);U(this,"state",{hasError:!1,error:null,errorInfo:null});U(this,"handleReload",()=>{window.location.reload()});U(this,"handleReset",()=>{this.setState({hasError:!1,error:null,errorInfo:null})})}static getDerivedStateFromError(o){return{hasError:!0,error:o}}componentDidCatch(o,r){v.error("ErrorBoundary caught an error",{error:{message:o.message,stack:o.stack,name:o.name},errorInfo:{componentStack:r.componentStack},timestamp:new Date().toISOString()}),this.setState({errorInfo:r})}render(){return this.state.hasError?this.props.fallback?this.props.fallback:f.jsx("div",{className:"error-boundary",role:"alert","aria-live":"assertive",children:f.jsxs("div",{className:"error-boundary-content",children:[f.jsx("div",{className:"error-boundary-icon",children:"‚ö†Ô∏è"}),f.jsx("h2",{className:"error-boundary-title",children:this.getLocalizedText("error.title")}),f.jsx("p",{className:"error-boundary-message",children:this.state.error?this.getLocalizedText("error.messageWithDetails",{error:this.state.error.message||this.state.error.name||"Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò"}):this.getLocalizedText("error.message")}),!1,f.jsxs("div",{className:"error-boundary-actions",children:[f.jsx("button",{className:"error-boundary-button error-boundary-button-primary",onClick:this.handleReload,"aria-label":this.getLocalizedText("error.reload"),children:this.getLocalizedText("error.reload")}),!1]})]})}):this.props.children}getLocalizedText(o,r){var c;let a="ko";try{a=localStorage.getItem("language")||"ko"}catch(i){}const n={ko:{"error.title":"Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§","error.message":"Í≤åÏûÑÏùÑ ÏÉàÎ°úÍ≥†Ïπ®Ìï¥Ï£ºÏÑ∏Ïöî.","error.messageWithDetails":"Îã§Ïùå Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: {error}. Í≤åÏûÑÏùÑ ÏÉàÎ°úÍ≥†Ïπ®Ìï¥Ï£ºÏÑ∏Ïöî.","error.details":"ÏóêÎü¨ ÏÉÅÏÑ∏ Ï†ïÎ≥¥","error.reload":"ÏÉàÎ°úÍ≥†Ïπ®","error.reset":"Îã§Ïãú ÏãúÎèÑ"},en:{"error.title":"An Error Occurred","error.message":"Please refresh the game.","error.details":"Error Details","error.reload":"Reload","error.reset":"Try Again"},zh:{"error.title":"ÂèëÁîüÈîôËØØ","error.message":"ËØ∑Âà∑Êñ∞Ê∏∏Êàè„ÄÇ","error.details":"ÈîôËØØËØ¶ÊÉÖ","error.reload":"ÈáçÊñ∞Âä†ËΩΩ","error.reset":"ÈáçËØï"},ja:{"error.title":"„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü","error.message":"„Ç≤„Éº„É†„Çí„É™„Éï„É¨„ÉÉ„Ç∑„É•„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ","error.details":"„Ç®„É©„ÉºË©≥Á¥∞","error.reload":"„É™„É≠„Éº„Éâ","error.reset":"ÂÜçË©¶Ë°å"}};let l=((c=n[a])==null?void 0:c[o])||n.ko[o]||o;if(r)for(const[i,d]of Object.entries(r))l=l.replace(`{${i}}`,d);return l}}const Co=(s,e)=>{const o=s[e];return o?typeof o=="function"?o():Promise.resolve(o):new Promise((r,a)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(a.bind(null,new Error("Unknown variable dynamic import: "+e)))})},Vt=["en","ko","zh","ja"],Po="en",To={en:"English",ko:"ÌïúÍµ≠Ïñ¥",zh:"‰∏≠Êñá",ja:"Êó•Êú¨Ë™û"};class Gt{constructor(){U(this,"supportedLanguages",Vt);U(this,"defaultLanguage",Po)}detectBrowserLanguage(){const e=navigator.language.split("-")[0];return this.supportedLanguages.includes(e)?e:this.defaultLanguage}getStoredLanguage(){try{return localStorage.getItem("language")}catch(e){return v.error("Failed to get stored language",{error:e}),null}}setLanguage(e){if(this.supportedLanguages.includes(e))try{localStorage.setItem("language",e),window.dispatchEvent(new CustomEvent("languageChanged",{detail:e})),v.debug("Language changed",{language:e})}catch(o){v.error("Failed to set language",{error:o,language:e})}}getCurrentLanguage(){const e=this.getStoredLanguage();return e&&this.supportedLanguages.includes(e)?e:this.detectBrowserLanguage()}}const pt={},Je=()=>{const[s,e]=m.useState(()=>new Gt().getCurrentLanguage()),[o,r]=m.useState(null),[a,n]=m.useState(!0);return m.useEffect(()=>{(()=>xt(void 0,null,function*(){n(!0);try{if(pt[s]){r(pt[s]),n(!1);return}const h=yield Co(Object.assign({"../locales/en.json":()=>He(()=>import("./en-1.1.0-aedb5f40.js"),[]),"../locales/ja.json":()=>He(()=>import("./ja-1.1.0-d5cad617.js"),[]),"../locales/ko.json":()=>He(()=>import("./ko-1.1.0-711aeae3.js"),[]),"../locales/zh.json":()=>He(()=>import("./zh-1.1.0-f769481c.js"),[])}),`../locales/${s}.json`);pt[s]=h.default,r(h.default),v.debug("Translations loaded",{language:s})}catch(h){v.error("Failed to load translations",{language:s,error:h});try{const b=yield He(()=>import("./en-1.1.0-aedb5f40.js"),[]);r(b.default),v.info("Fallback translations loaded",{language:"en"})}catch(b){v.error("Failed to load fallback translations",{error:b})}}finally{n(!1)}}))();const d=h=>{e(h.detail)};return window.addEventListener("languageChanged",d),()=>{window.removeEventListener("languageChanged",d)}},[s]),{language:s,setLanguage:i=>{new Gt().setLanguage(i)},t:i=>{if(a||!o)return i;const d=i.split(".");let h=o;for(const b of d)if(h=h==null?void 0:h[b],h===void 0)break;return h||i},isLoading:a}};function yt(s){const e="/ChipPuzzleGame/",o=e.endsWith("/")?e:`${e}/`,r=s.startsWith("/")?s.slice(1):s;return`${o}${r}`}const Ut=Ft.memo(h=>{var b=h,{src:s,alt:e,width:o,height:r,loading:a="lazy",className:n,style:l,onClick:c,onError:i}=b,d=kt(b,["src","alt","width","height","loading","className","style","onClick","onError"]);const[p,y]=m.useState(()=>yt(s)),[T,D]=m.useState(!0),E=m.useCallback(X=>{if(p.includes(".webp")&&!T){D(!0),y(yt(s));return}if(!p.includes(".svg")&&s.includes(".png")&&T){const ie=s.replace(/\.png$/i,".svg");y(yt(ie));return}i&&i(X)},[p,s,i,T]);return f.jsx("img",me({src:p,alt:e,width:o,height:r,loading:a,className:n,style:l,onClick:c,onError:E},d))});Ut.displayName="OptimizedImage";const Xt=()=>{const{language:s,setLanguage:e}=Je();return f.jsx("select",{value:s,onChange:o=>e(o.target.value),className:"language-selector","aria-label":"Language selector",children:Vt.map(o=>f.jsx("option",{value:o,children:To[o]},o))})};class Mo{constructor(){U(this,"storage",new Map)}get(e){try{const o=this.storage.get(e);return o===void 0?null:JSON.parse(o)}catch(o){return v.warn("Failed to parse memory storage",{key:e,error:o}),null}}set(e,o){try{const r=JSON.stringify(o);return this.storage.set(e,r),!0}catch(r){return v.error("Failed to set item to memory storage",{key:e,error:r}),!1}}remove(e){return this.storage.delete(e)}clear(){this.storage.clear()}keys(){return Array.from(this.storage.keys())}}const jt=new Mo;function Lt(s){if(!s||typeof s!="object")return!1;const e=s;if(typeof e.version!="string"||!e.version||!e.progress||typeof e.progress!="object")return!1;const o=e.progress;if(typeof o.highestStage!="number"||o.highestStage<1||!o.stageRecords||typeof o.stageRecords!="object")return!1;const r=o.stageRecords;for(const a in r){const n=r[a];if(!n||typeof n!="object")return!1;const l=n;if(typeof l.stageNumber!="number"||l.stageNumber<1)return!1}if(e.settings!==void 0){if(typeof e.settings!="object"||e.settings===null)return!1;const a=e.settings;if(a.language!==void 0&&typeof a.language!="string"||a.soundEnabled!==void 0&&typeof a.soundEnabled!="boolean")return!1}return!0}function Bt(s){if(!s||typeof s!="object")return!1;const e=s;return!(typeof e.highestStage!="number"||e.highestStage<1||e.highestStage>1e3||!e.stageRecords||typeof e.stageRecords!="object")}function Ro(s){if(typeof s!="string")return null;const e=[/<script[^>]*>.*?<\/script>/gi,/javascript:/gi,/on\w+\s*=/gi,/<iframe[^>]*>/gi,/<object[^>]*>/gi,/<embed[^>]*>/gi];let o=s;for(const r of e)o=o.replace(r,"");return o.length>10*1024?null:o}class ko{constructor(){U(this,"useMemoryStorage",!1)}isAvailable(){try{const e="__storage_test__";return localStorage.setItem(e,e),localStorage.removeItem(e),this.useMemoryStorage=!1,!0}catch(e){return this.useMemoryStorage=!0,v.warn("LocalStorage is not available, using memory storage"),!1}}get(e,o={}){var a,n,l,c,i,d,h,b;const r=this.isAvailable();if(!r&&this.useMemoryStorage){const p=jt.get(e);return p!==null?p:(a=o.fallback)!=null?a:null}if(!r)return o.silent||v.warn("LocalStorage is not available",{key:e}),(n=o.fallback)!=null?n:null;try{const p=localStorage.getItem(e);if(p===null)return(l=o.fallback)!=null?l:null;let y;try{y=JSON.parse(p)}catch(T){if(typeof p=="string"&&p.startsWith('"')&&p.endsWith('"'))y=JSON.parse(p);else return typeof o.fallback=="string"?p:(localStorage.removeItem(e),o.silent||v.warn("Removed invalid storage data",{key:e,value:p}),(c=o.fallback)!=null?c:null)}if(e.startsWith("chipPuzzleGame_")){if(e==="chipPuzzleGame_progress"){if(!Bt(y))return v.warn("Invalid game progress data, removing",{key:e}),localStorage.removeItem(e),(i=o.fallback)!=null?i:null}else if(e==="chipPuzzleGame_data"&&!Lt(y))return v.warn("Invalid storage data, removing",{key:e}),localStorage.removeItem(e),(d=o.fallback)!=null?d:null}return y}catch(p){return p instanceof SyntaxError&&o.silent?(h=o.fallback)!=null?h:null:(o.silent||v.error("Failed to get item from LocalStorage",{key:e,error:p}),(b=o.fallback)!=null?b:null)}}set(e,o,r={}){const a=this.isAvailable();if(!a&&this.useMemoryStorage){const n=jt.set(e,o);return!n&&!r.silent&&v.warn("Failed to save to memory storage",{key:e}),n}if(!a)return r.silent||v.warn("LocalStorage is not available",{key:e}),!1;try{if(e.startsWith("chipPuzzleGame_")){if(e==="chipPuzzleGame_progress"){if(!Bt(o))return v.error("Invalid game progress data, not saving",{key:e,value:o}),!1}else if(e==="chipPuzzleGame_data"&&!Lt(o))return v.error("Invalid storage data, not saving",{key:e,value:o}),!1}if(typeof o=="string"){const c=Ro(o);if(c===null)return v.error("String value failed sanitization",{key:e}),!1;o=c}const n=JSON.stringify(o),l=5*1024*1024;return n.length>l?(v.error("Storage size exceeds limit",{key:e,size:n.length,maxSize:l}),!1):(localStorage.setItem(e,n),!0)}catch(n){return v.error("Failed to set item to LocalStorage",{key:e,error:n}),!1}}remove(e,o={}){if(!this.isAvailable())return o.silent||v.warn("LocalStorage is not available",{key:e}),!1;try{return localStorage.removeItem(e),!0}catch(r){return v.error("Failed to remove item from LocalStorage",{key:e,error:r}),!1}}clearGameData(){if(!this.isAvailable())return!1;try{const o=Object.keys(localStorage).filter(r=>r.startsWith("chipPuzzleGame_"));return o.forEach(r=>localStorage.removeItem(r)),v.info("Game data cleared",{count:o.length}),!0}catch(e){return v.error("Failed to clear game data",{error:e}),!1}}available(){return this.isAvailable()}}const Fe=new ko,it="chipPuzzleGame_theme",xo=()=>{if(typeof window=="undefined")return"dark";try{return window.matchMedia("(prefers-color-scheme: light)").matches?"light":"dark"}catch(s){return"dark"}},bt=s=>{if(typeof document=="undefined")return;document.documentElement.setAttribute("data-theme",s);const o=document.querySelector('meta[name="theme-color"]');o&&o.setAttribute("content",s==="light"?"#f5f5f5":"#0f0f1e")},Yt=()=>{const[s,e]=m.useState(()=>{const a=Fe.get(it,{fallback:null,silent:!0});return a==="light"||a==="dark"?a:xo()}),o=m.useCallback(()=>{e(a=>{const n=a==="light"?"dark":"light";return Fe.set(it,n,{silent:!0}),bt(n),v.debug("Theme changed",{theme:n}),n})},[]),r=m.useCallback(a=>{e(a),Fe.set(it,a,{silent:!0}),bt(a),v.debug("Theme set",{theme:a})},[]);return m.useEffect(()=>{bt(s)},[s]),m.useEffect(()=>{if(typeof window=="undefined")return;const a=window.matchMedia("(prefers-color-scheme: light)");if(!Fe.get(it,{fallback:null,silent:!0})){const l=c=>{const i=c.matches?"light":"dark";r(i)};return a.addEventListener?(a.addEventListener("change",l),()=>{a.removeEventListener("change",l)}):(a.addListener(l),()=>{a.removeListener(l)})}},[r]),{theme:s,toggleTheme:o,setTheme:r,isLight:s==="light",isDark:s==="dark"}};const qt=m.memo(()=>{const{toggleTheme:s,isLight:e}=Yt(),{t:o}=Je();return f.jsx("button",{className:"theme-toggle",onClick:s,title:o(e?"header.darkMode":"header.lightMode"),"aria-label":o(e?"header.darkMode":"header.lightMode"),children:e?"üåô":"‚òÄÔ∏è"})});qt.displayName="ThemeToggle";class Eo{constructor(){U(this,"audioCtx",null);U(this,"enabled",!0)}getContext(){if(!this.enabled)return null;try{if(!this.audioCtx){const e=window.AudioContext||window.webkitAudioContext;if(!e)return v.warn("Web Audio API is not supported in this browser"),this.enabled=!1,null;try{this.audioCtx=new e,this.audioCtx.state==="suspended"&&this.audioCtx.resume().catch(o=>{v.warn("Failed to resume AudioContext",{error:o})})}catch(o){return v.warn("Failed to create AudioContext",{error:o}),this.enabled=!1,null}}return this.audioCtx}catch(e){return v.warn("Failed to initialize AudioContext",{error:e}),this.enabled=!1,null}}setEnabled(e){this.enabled=e}playTone(e,o,r="sine",a=.2){const n=this.getContext();if(!n)return;const l=n.createOscillator(),c=n.createGain();l.type=r,l.frequency.value=e,c.gain.value=a,l.connect(c),c.connect(n.destination);const i=n.currentTime;l.start(i),l.stop(i+o),c.gain.setValueAtTime(a,i),c.gain.linearRampToValueAtTime(0,i+o)}playClick(){this.playTone(440,.08,"square",.15)}playMatch(){this.playTone(660,.12,"triangle",.2)}playSpecial(){this.playTone(880,.16,"sawtooth",.22)}playStageClear(){this.getContext()&&(this.playTone(880,.15,"triangle",.22),setTimeout(()=>{this.playTone(1046.5,.18,"triangle",.22)},120))}playGameOver(){const e=this.getContext();if(!e)return;const o=440,r=220,a=.4,n=e.createOscillator(),l=e.createGain();n.type="sawtooth",n.frequency.setValueAtTime(o,e.currentTime),n.frequency.exponentialRampToValueAtTime(r,e.currentTime+a),l.gain.value=.22,l.gain.setValueAtTime(.22,e.currentTime),l.gain.linearRampToValueAtTime(0,e.currentTime+a),n.connect(l),l.connect(e.destination),n.start(e.currentTime),n.stop(e.currentTime+a)}}const Se=new Eo;const Jt=m.memo(({onNavigate:s,currentScreen:e})=>{const{t:o}=Je(),[r,a]=m.useState(()=>{var b;return(b=Fe.get("chipPuzzleGame_soundEnabled",{fallback:!0,silent:!0}))!=null?b:!0}),[n,l]=m.useState(!1);m.useEffect(()=>{Se.setEnabled(r),Fe.set("chipPuzzleGame_soundEnabled",r,{silent:!0})},[r]),m.useEffect(()=>(n?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[n]),m.useEffect(()=>{const b=p=>{const y=p.target;n&&!y.closest(".header-nav")&&!y.closest(".header-hamburger")&&l(!1)};if(n)return document.addEventListener("click",b),()=>{document.removeEventListener("click",b)}},[n]);const c=b=>{s&&s(b),l(!1)},i=()=>{a(!r),r||Se.playClick()},d=()=>{l(!n),r&&Se.playClick()},h=!1;return f.jsx("header",{className:"header",children:f.jsxs("div",{className:"header-content",children:[f.jsxs("div",{className:"header-left",children:[h,f.jsxs("div",{className:"header-logo",onClick:()=>c("stageSelect"),style:{cursor:"pointer",display:"flex",alignItems:"center",gap:"12px"},children:[f.jsx(Ut,{src:"ChipGames_Logo.png",alt:o("header.gameTitle")+" - CHIP GAMES Î°úÍ≥†",style:{height:"40px",width:"auto"},loading:"eager",width:"120",height:"40"}),f.jsx("span",{className:"header-game-title",children:o("header.gameTitle")})]})]}),f.jsxs("nav",{className:`header-nav ${n?"mobile-open":""}`,children:[f.jsx("button",{className:"header-nav-button",onClick:()=>c("stageSelect"),children:o("header.playGame")}),f.jsx("button",{className:"header-nav-button",onClick:()=>c("guide"),children:o("header.guide")}),f.jsx("button",{className:"header-nav-button",onClick:()=>c("help"),children:o("header.help")}),f.jsx("button",{className:"header-nav-button",onClick:()=>c("about"),children:o("header.about")})]}),f.jsxs("div",{className:"header-right",children:[f.jsx(qt,{}),f.jsx("button",{className:"header-sound-button",onClick:i,title:o(r?"header.soundOff":"header.soundOn"),children:r?"üîä":"üîá"}),f.jsx(Xt,{}),f.jsxs("button",{className:"header-hamburger",onClick:d,"aria-label":"Î©îÎâ¥","aria-expanded":n,children:[f.jsx("span",{className:`hamburger-line ${n?"active":""}`}),f.jsx("span",{className:`hamburger-line ${n?"active":""}`}),f.jsx("span",{className:`hamburger-line ${n?"active":""}`})]})]})]})})});Jt.displayName="Header";const Ao="1.1.0",Kt=m.memo(()=>{const{t:s}=Je(),[e,o]=m.useState(!1),[r,a]=m.useState(!1),n=i=>{i.preventDefault(),o(!0),Se.playClick(),v.info("Privacy policy modal opened")},l=i=>{i.preventDefault(),a(!0),Se.playClick(),v.info("Contact modal opened")},c=()=>{o(!1),a(!1),Se.playClick()};return m.useEffect(()=>{const i=d=>{d.key==="Escape"&&(e||r)&&c()};return(e||r)&&(document.addEventListener("keydown",i),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",i),document.body.style.overflow=""}},[e,r]),f.jsxs(f.Fragment,{children:[f.jsx("footer",{className:"footer",role:"contentinfo",children:f.jsxs("div",{className:"footer-content",children:[f.jsxs("nav",{className:"footer-links","aria-label":s("footer.navigation"),children:[f.jsx("a",{href:"#privacy",onClick:n,"aria-label":s("footer.privacyPolicy"),className:"footer-link",children:s("footer.privacyPolicy")}),f.jsx("a",{href:"#contact",onClick:l,"aria-label":s("footer.contactUs"),className:"footer-link",children:s("footer.contactUs")})]}),f.jsx("div",{className:"footer-center",children:f.jsx(Xt,{})}),f.jsxs("div",{className:"footer-copyright","aria-label":s("footer.copyright"),children:[s("footer.copyright")," | v",Ao]})]})}),e&&f.jsx("div",{className:"footer-modal-overlay",onClick:c,role:"dialog","aria-modal":"true","aria-labelledby":"privacy-modal-title",children:f.jsxs("div",{className:"footer-modal",onClick:i=>i.stopPropagation(),children:[f.jsxs("div",{className:"footer-modal-header",children:[f.jsx("h2",{id:"privacy-modal-title",children:s("footer.privacyPolicy")}),f.jsx("button",{className:"footer-modal-close",onClick:c,"aria-label":s("common.close"),children:"√ó"})]}),f.jsxs("div",{className:"footer-modal-content",children:[f.jsxs("div",{className:"footer-modal-section",children:[f.jsx("h3",{children:s("footer.privacySection1Title")}),f.jsx("p",{children:s("footer.privacySection1Content")})]}),f.jsxs("div",{className:"footer-modal-section",children:[f.jsx("h3",{children:s("footer.privacySection2Title")}),f.jsx("p",{children:s("footer.privacySection2Content")})]}),f.jsxs("div",{className:"footer-modal-section",children:[f.jsx("h3",{children:s("footer.privacySection3Title")}),f.jsx("p",{children:s("footer.privacySection3Content")})]}),f.jsxs("div",{className:"footer-modal-section",children:[f.jsx("h3",{children:s("footer.privacySection4Title")}),f.jsx("p",{children:s("footer.privacySection4Content")})]}),f.jsxs("div",{className:"footer-modal-section",children:[f.jsx("h3",{children:s("footer.privacySection5Title")}),f.jsx("p",{children:s("footer.privacySection5Content")})]}),f.jsxs("div",{className:"footer-modal-section",children:[f.jsx("h3",{children:s("footer.privacySection6Title")}),f.jsx("p",{children:s("footer.privacySection6Content")})]})]})]})}),r&&f.jsx("div",{className:"footer-modal-overlay",onClick:c,role:"dialog","aria-modal":"true","aria-labelledby":"contact-modal-title",children:f.jsxs("div",{className:"footer-modal",onClick:i=>i.stopPropagation(),children:[f.jsxs("div",{className:"footer-modal-header",children:[f.jsx("h2",{id:"contact-modal-title",children:s("footer.contactUs")}),f.jsx("button",{className:"footer-modal-close",onClick:c,"aria-label":s("common.close"),children:"√ó"})]}),f.jsxs("div",{className:"footer-modal-content",children:[f.jsxs("div",{className:"footer-modal-section",children:[f.jsx("h3",{children:s("footer.contactSection1Title")}),f.jsx("p",{children:s("footer.contactSection1Content")})]}),f.jsxs("div",{className:"footer-modal-section",children:[f.jsx("h3",{children:s("footer.contactSection2Title")}),f.jsx("p",{children:s("footer.contactSection2Content")})]}),f.jsxs("div",{className:"footer-modal-section",children:[f.jsx("h3",{children:s("footer.contactSection3Title")}),f.jsx("p",{children:s("footer.contactSection3Content")})]}),f.jsxs("div",{className:"footer-modal-section",children:[f.jsx("h3",{children:s("footer.contactSection4Title")}),f.jsx("p",{children:s("footer.contactSection4Content")})]})]})]})})]})});Kt.displayName="Footer";const Go=({children:s})=>f.jsx("div",{className:"game-container",children:s}),Qt={aspectRatio:16/9,gridRows:9,gridCols:9,pixelRatio:window.devicePixelRatio||1};const jo=({config:s,onReady:e,onResize:o})=>{const r=m.useRef(null),a=m.useRef(null),n=m.useRef(e),l=m.useRef(o),c=m.useRef(!1),[i,d]=m.useState(null),{t:h}=Je();return m.useEffect(()=>{n.current=e},[e]),m.useEffect(()=>{l.current=o},[o]),m.useEffect(()=>{const b=r.current,p=a.current;if(!b||!p)return;const y=b.getContext("2d");if(!y){const E="Canvas 2D context is not supported";v.error(E),d(E);return}i&&d(null);const T=()=>{const E=window.devicePixelRatio||1,X=p.clientWidth,ie=p.clientHeight,W=s.aspectRatio||Qt.aspectRatio||16/9,N=1200,J=675;let te,fe;const Ee=Math.min(X,N),he=Math.min(ie,J);Ee/he>W?(fe=he,te=fe*W):(te=Ee,fe=te/W),b.width=te*E,b.height=fe*E,y.scale(E,E),b.style.width=`${te}px`,b.style.height=`${fe}px`,b.style.display="block",b.style.maxWidth="100%",b.style.maxHeight="100%",!c.current&&n.current&&(c.current=!0,n.current(b,y)),c.current&&l.current&&setTimeout(()=>{l.current&&l.current(b,y)},0)};T();const D=new ResizeObserver(()=>{T()});return D.observe(p),()=>{D.disconnect(),c.current=!1}},[s]),i?f.jsx("div",{className:"game-canvas-error",role:"alert",children:f.jsxs("div",{className:"game-canvas-error-content",children:[f.jsx("div",{className:"game-canvas-error-icon",children:"‚ö†Ô∏è"}),f.jsx("h3",{children:h("error.canvasNotSupported")}),f.jsx("p",{children:h("error.canvasFallbackMessage")}),f.jsx("button",{onClick:()=>{d(null),window.location.reload()},className:"game-canvas-error-button",children:h("error.reload")})]})}):f.jsx("div",{ref:a,className:"game-canvas-wrapper",children:f.jsx("canvas",{ref:r,className:"game-canvas",tabIndex:0,role:"application","aria-label":"Îß§Ïπ≠ ÌçºÏ¶ê Í≤åÏûÑ Î≥¥Îìú","aria-live":"polite","aria-atomic":"true"})})},ot=["red","yellow","blue","green","purple","orange"],nt={red:{light:"#e74c3c",dark:"#c0392b"},yellow:{light:"#f1c40f",dark:"#f39c12"},blue:{light:"#3498db",dark:"#2980b9"},green:{light:"#2ecc71",dark:"#27ae60"},purple:{light:"#9b59b6",dark:"#8e44ad"},orange:{light:"#e67e22",dark:"#d35400"}};class Lo{constructor(e,o){U(this,"ctx");U(this,"cellSize");this.ctx=e,this.cellSize=o}render(e,o=1){this.ctx.save();const r=e.x+this.cellSize/2,a=e.y+this.cellSize/2,n=e.scale||1,l=e.rotation||0;switch(n===1&&l===0?this.ctx.translate(r,a):(this.ctx.translate(r,a),this.ctx.scale(n,n),this.ctx.rotate(l)),o<1&&(this.ctx.globalAlpha=o),e.type){case"normal":this.renderNormalGem(e);break;case"striped":this.renderStripedGem(e);break;case"wrapped":this.renderWrappedGem(e);break;case"colorBomb":this.renderColorBomb(e);break}this.ctx.restore()}renderNormalGem(e){const o=nt[e.color],r=this.cellSize*.85,a=-r/2;this.ctx.fillStyle="rgba(0, 0, 0, 0.2)",this.roundRect(a+2,a+2,r,r,r*.2),this.ctx.fill();const n=this.ctx.createLinearGradient(a,a,a+r,a+r);n.addColorStop(0,o.light),n.addColorStop(1,o.dark),this.ctx.fillStyle=n,this.roundRect(a,a,r,r,r*.2),this.ctx.fill(),this.renderColorPattern(e.color,a,r),this.ctx.fillStyle="rgba(255, 255, 255, 0.3)",this.roundRect(a,a,r,r*.4,r*.2),this.ctx.fill(),this.ctx.strokeStyle=this.getBorderColor(e.color),this.ctx.lineWidth=r*.06,this.roundRect(a,a,r,r,r*.2),this.ctx.stroke()}getBorderColor(e){return{red:"rgba(231, 76, 60, 0.9)",yellow:"rgba(241, 196, 15, 0.9)",blue:"rgba(52, 152, 219, 0.9)",green:"rgba(46, 204, 113, 0.9)",purple:"rgba(155, 89, 182, 0.9)",orange:"rgba(230, 126, 34, 0.9)"}[e]}renderColorPattern(e,o,r){switch(this.ctx.save(),this.ctx.globalAlpha=.5,e){case"red":this.ctx.fillStyle="rgba(255, 255, 255, 0.6)",this.ctx.beginPath(),this.ctx.arc(0,0,r*.18,0,Math.PI*2),this.ctx.fill(),this.ctx.fillStyle="rgba(192, 57, 43, 0.5)",this.ctx.beginPath(),this.ctx.arc(0,0,r*.1,0,Math.PI*2),this.ctx.fill();break;case"yellow":this.ctx.fillStyle="rgba(255, 255, 255, 0.7)",this.drawStar(0,0,r*.1,r*.18,5),this.ctx.fill();break;case"blue":this.ctx.fillStyle="rgba(255, 255, 255, 0.6)",this.ctx.beginPath(),this.ctx.moveTo(0,-r*.18),this.ctx.lineTo(r*.18,0),this.ctx.lineTo(0,r*.18),this.ctx.lineTo(-r*.18,0),this.ctx.closePath(),this.ctx.fill();break;case"green":this.ctx.fillStyle="rgba(255, 255, 255, 0.6)",this.ctx.beginPath(),this.ctx.moveTo(0,-r*.18),this.ctx.lineTo(-r*.15,r*.12),this.ctx.lineTo(r*.15,r*.12),this.ctx.closePath(),this.ctx.fill();break;case"purple":this.ctx.fillStyle="rgba(255, 255, 255, 0.6)",this.ctx.fillRect(-r*.12,-r*.12,r*.24,r*.24);break;case"orange":this.ctx.fillStyle="rgba(255, 255, 255, 0.6)",this.ctx.beginPath();for(let a=0;a<6;a++){const n=Math.PI/3*a,l=Math.cos(n)*r*.15,c=Math.sin(n)*r*.15;a===0?this.ctx.moveTo(l,c):this.ctx.lineTo(l,c)}this.ctx.closePath(),this.ctx.fill(),this.ctx.fillStyle="rgba(211, 84, 0, 0.5)",this.ctx.beginPath(),this.ctx.arc(0,0,r*.08,0,Math.PI*2),this.ctx.fill();break}this.ctx.restore()}renderStripedGem(e){const o=nt[e.color],r=this.cellSize*.85,a=-r/2,n=this.ctx.createLinearGradient(a,a,a+r,a+r);if(n.addColorStop(0,o.light),n.addColorStop(1,o.dark),this.ctx.fillStyle=n,this.roundRect(a,a,r,r,r*.2),this.ctx.fill(),this.ctx.strokeStyle="rgba(255, 255, 255, 0.6)",this.ctx.lineWidth=r*.1,this.ctx.lineCap="round",e.stripedDirection==="horizontal")for(let l=0;l<3;l++){const c=a+r/4*(l+1);this.ctx.beginPath(),this.ctx.moveTo(a,c),this.ctx.lineTo(a+r,c),this.ctx.stroke()}else for(let l=0;l<3;l++){const c=a+r/4*(l+1);this.ctx.beginPath(),this.ctx.moveTo(c,a),this.ctx.lineTo(c,a+r),this.ctx.stroke()}}renderWrappedGem(e){const o=nt[e.color],r=this.cellSize*.85,a=-r/2,n=this.ctx.createLinearGradient(a,a,a+r,a+r);n.addColorStop(0,o.light),n.addColorStop(1,o.dark),this.ctx.fillStyle=n,this.roundRect(a,a,r,r,r*.2),this.ctx.fill(),this.ctx.strokeStyle="rgba(255, 255, 255, 0.8)",this.ctx.lineWidth=r*.08,this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.moveTo(a,a),this.ctx.lineTo(a+r,a+r),this.ctx.moveTo(a+r,a),this.ctx.lineTo(a,a+r),this.ctx.stroke()}renderColorBomb(e){const o=this.cellSize*.85,r=-o/2,a=this.ctx.createLinearGradient(r,r,r+o,r+o);a.addColorStop(0,"#ff6b6b"),a.addColorStop(.2,"#ffd93d"),a.addColorStop(.4,"#4ecdc4"),a.addColorStop(.6,"#95e1d3"),a.addColorStop(.8,"#a29bfe"),a.addColorStop(1,"#fd79a8"),this.ctx.fillStyle=a,this.roundRect(r,r,o,o,o*.2),this.ctx.fill(),this.ctx.fillStyle="rgba(255, 255, 255, 0.9)",this.drawStar(0,0,o*.3,o*.6,5),this.ctx.fill()}roundRect(e,o,r,a,n){this.ctx.beginPath(),this.ctx.moveTo(e+n,o),this.ctx.lineTo(e+r-n,o),this.ctx.quadraticCurveTo(e+r,o,e+r,o+n),this.ctx.lineTo(e+r,o+a-n),this.ctx.quadraticCurveTo(e+r,o+a,e+r-n,o+a),this.ctx.lineTo(e+n,o+a),this.ctx.quadraticCurveTo(e,o+a,e,o+a-n),this.ctx.lineTo(e,o+n),this.ctx.quadraticCurveTo(e,o,e+n,o),this.ctx.closePath()}drawStar(e,o,r,a,n){this.ctx.beginPath();for(let l=0;l<n*2;l++){const c=Math.PI*l/n,i=l%2===0?a:r,d=e+Math.cos(c)*i,h=o+Math.sin(c)*i;l===0?this.ctx.moveTo(d,h):this.ctx.lineTo(d,h)}this.ctx.closePath()}}const zt={rows:9,cols:9};function qe(s){var r,a;const e=[],o=new Set;for(let n=0;n<s.length;n++){let l=1,c=(r=s[n][0])==null?void 0:r.color,i=0;for(let d=1;d<=s[n].length;d++){const h=s[n][d];if(h&&h.color===c&&c)l++;else{if(l>=3&&c){const b=[];for(let p=0;p<l;p++){const y={row:n,col:i+p},T=`${y.row},${y.col}`;o.has(T)||(b.push(y),o.add(T))}b.length>0&&e.push({type:"horizontal",positions:b})}h?(l=1,c=h.color,i=d):(l=0,c=void 0)}}}if(s.length>0)for(let n=0;n<s[0].length;n++){let l=1,c=(a=s[0][n])==null?void 0:a.color,i=0;for(let d=1;d<=s.length;d++){const h=d<s.length?s[d][n]:null;if(h&&h.color===c&&c)l++;else{if(l>=3&&c){const b=[];for(let p=0;p<l;p++){const y={row:i+p,col:n},T=`${y.row},${y.col}`;o.has(T)||(b.push(y),o.add(T))}b.length>0&&e.push({type:"vertical",positions:b})}h?(l=1,c=h.color,i=d):(l=0,c=void 0)}}}return e}class Bo{constructor(e){U(this,"seed");this.seed=e}next(){return this.seed=(this.seed*9301+49297)%233280,this.seed/233280}}function Ot(s){const e=new Bo(s),o=zo(s),r=Oo(s),a=_o(s),n=Io(o.rows,o.cols,e);return{stageNumber:s,gridSize:o,targetScore:r,maxMoves:a,goals:[{type:"score",target:r,current:0}],initialBoard:n}}function zo(s){return s<=100?{rows:9,cols:9}:s<=300?{rows:8,cols:8}:s<=600?{rows:7,cols:7}:{rows:6,cols:6}}function Oo(s){const r=Math.floor(s/100)*500;return 1e3+s*50+r}function _o(s){const o=Math.floor(s/20),r=20;return s>500?Math.max(r,50-o-Math.floor((s-500)/10)):Math.max(r,50-o)}function Io(s,e,o){const r=[];for(let a=0;a<s;a++){r[a]=[];for(let n=0;n<e;n++){const l=ot[Math.floor(o.next()*ot.length)];r[a][n]={id:`${a}-${n}-${Date.now()}`,color:l,type:"normal",position:{row:a,col:n},x:0,y:0,targetX:void 0,targetY:void 0,scale:1,rotation:0}}}return $o(r,o)}function $o(s,e){var n,l,c,i,d;let r=0;const a=e?()=>e.next():()=>Math.random();try{for(;r<100;){const h=qe(s);if(h.length===0)return s;for(const b of h)for(const p of b.positions){const y=(n=s[p.row])==null?void 0:n[p.col];if(y){const T=ot.indexOf(y.color),D=ot.filter((ie,W)=>W!==T);if(D.length===0)continue;let E=y.color,X=0;for(;X<10&&E===y.color;){const ie=Math.floor(a()*D.length),W=D[ie];[(l=s[p.row-1])==null?void 0:l[p.col],(c=s[p.row+1])==null?void 0:c[p.col],(i=s[p.row])==null?void 0:i[p.col-1],(d=s[p.row])==null?void 0:d[p.col+1]].filter(Boolean).some(te=>(te==null?void 0:te.color)===W)?X++:E=W}E===y.color&&D.length>0&&(E=D[0]),y.color=E}}r++}}catch(h){v.error("Error in ensureNoInitialMatches",{error:h})}return s}function _t(s,e=50){var n;const o=s.map(l=>[...l]),r=o.length,a=((n=o[0])==null?void 0:n.length)||0;for(let l=0;l<a;l++){let c=r-1;for(let i=r-1;i>=0;i--)if(o[i][l]!==null){if(c!==i){const d=o[i][l];o[c][l]=d,(d.y===void 0||d.y===0)&&(d.y=i*e),d.targetY=c,d.position.row=c,o[i][l]=null}c--}for(let i=c;i>=0;i--){const d=No(i,l);d.y=-e*(c-i+1),d.targetY=i,o[i][l]=d}}return o}function No(s,e){const o=ot[Math.floor(Math.random()*ot.length)];return{id:`${Date.now()}-${s}-${e}-${Math.random()}`,color:o,type:"normal",position:{row:s,col:e},x:0,y:0,targetX:void 0,targetY:void 0,scale:1,rotation:0}}function Do(s){const e=[];for(const o of s){const r=o.positions.length;if(r===4){const a=Math.floor(r/2),n=o.positions[a];e.push({position:n,type:"striped",stripedDirection:o.type==="horizontal"?"horizontal":"vertical"})}else if(r>=5){const a=Math.floor(r/2),n=o.positions[a];e.push({position:n,type:"colorBomb"})}}return e}function Fo(s){const e=[],o=s.filter(a=>a.type==="horizontal"),r=s.filter(a=>a.type==="vertical");for(const a of o)for(const n of r){const l=a.positions.find(c=>n.positions.some(i=>c.row===i.row&&c.col===i.col));l&&e.push({position:l,type:"wrapped"})}return e}function Wo(s){const e=Fo(s),o=s.filter(n=>!e.some(l=>{var c,i;return l.position.row===((c=n.positions[0])==null?void 0:c.row)&&l.position.col===((i=n.positions[0])==null?void 0:i.col)})),r=[];r.push(...e);const a=Do(o);for(const n of a)e.some(c=>c.position.row===n.position.row&&c.position.col===n.position.col)||r.push(n);return r}function Ho(s,e,o){var l,c,i;const r=[],{row:a,col:n}=s.position;if(o==="horizontal")for(let d=0;d<((l=e[0])==null?void 0:l.length);d++)(c=e[a])!=null&&c[d]&&r.push({row:a,col:d});else for(let d=0;d<e.length;d++)(i=e[d])!=null&&i[n]&&r.push({row:d,col:n});return{positionsToRemove:r,score:r.length*20}}function Vo(s,e){var n,l;const o=[],{row:r,col:a}=s.position;for(let c=r-1;c<=r+1;c++)for(let i=a-1;i<=a+1;i++)c>=0&&c<e.length&&i>=0&&i<(((n=e[0])==null?void 0:n.length)||0)&&((l=e[c])!=null&&l[i])&&o.push({row:c,col:i});return{positionsToRemove:o,score:o.length*30}}function Uo(s,e){var a,n;const o=[],r=s.color;for(let l=0;l<e.length;l++)for(let c=0;c<(((a=e[l])==null?void 0:a.length)||0);c++){const i=(n=e[l])==null?void 0:n[c];i&&i.color===r&&o.push({row:l,col:c})}return{positionsToRemove:o,score:o.length*50}}function Xo(s,e,o){var c,i,d;const r=[],{row:a,col:n}=s.position;for(let h=0;h<((c=o[0])==null?void 0:c.length);h++)(i=o[a])!=null&&i[h]&&r.push({row:a,col:h});for(let h=0;h<o.length;h++)(d=o[h])!=null&&d[n]&&r.push({row:h,col:n});const l=Array.from(new Set(r.map(h=>`${h.row},${h.col}`))).map(h=>{const[b,p]=h.split(",").map(Number);return{row:b,col:p}});return{positionsToRemove:l,score:l.length*30}}function Yo(s,e,o){var d,h,b,p;const r=[],a=s.type==="striped"?s:e,n=s.type==="wrapped"?s:e,l=a.stripedDirection||"horizontal",{row:c,col:i}=n.position;if(l==="horizontal"){for(let y=c-1;y<=c+1;y++)if(y>=0&&y<o.length)for(let T=0;T<((d=o[0])==null?void 0:d.length);T++)(h=o[y])!=null&&h[T]&&r.push({row:y,col:T})}else for(let y=i-1;y<=i+1;y++)if(y>=0&&y<(((b=o[0])==null?void 0:b.length)||0))for(let T=0;T<o.length;T++)(p=o[T])!=null&&p[y]&&r.push({row:T,col:y});return{positionsToRemove:r,score:r.length*40}}function qo(s,e,o){var c,i,d,h;const r=[],a=s.type==="striped"?s:e,n=a.color;if((a.stripedDirection||"horizontal")==="horizontal")for(let b=0;b<o.length;b++)for(let p=0;p<(((c=o[b])==null?void 0:c.length)||0);p++){const y=(i=o[b])==null?void 0:i[p];y&&y.color===n&&r.push({row:b,col:p})}else for(let b=0;b<(((d=o[0])==null?void 0:d.length)||0);b++)for(let p=0;p<o.length;p++){const y=(h=o[p])==null?void 0:h[b];y&&y.color===n&&r.push({row:p,col:b})}return{positionsToRemove:r,score:r.length*60}}function Jo(s,e,o){var l,c;const r=[],{row:a,col:n}=s.position;for(let i=a-2;i<=a+2;i++)for(let d=n-2;d<=n+2;d++)i>=0&&i<o.length&&d>=0&&d<(((l=o[0])==null?void 0:l.length)||0)&&((c=o[i])!=null&&c[d])&&r.push({row:i,col:d});return{positionsToRemove:r,score:r.length*50}}function Ko(s,e,o){var l,c;const r=[],n=(s.type==="wrapped"?s:e).color;for(let i=0;i<o.length;i++)for(let d=0;d<(((l=o[i])==null?void 0:l.length)||0);d++){const h=(c=o[i])==null?void 0:c[d];h&&h.color===n&&r.push({row:i,col:d})}return{positionsToRemove:r,score:r.length*70}}function Qo(s,e,o){var a,n;const r=[];for(let l=0;l<o.length;l++)for(let c=0;c<(((a=o[l])==null?void 0:a.length)||0);c++)(n=o[l])!=null&&n[c]&&r.push({row:l,col:c});return{positionsToRemove:r,score:r.length*100}}function Zo(s,e,o){switch([s.type,e.type].sort().join("+")){case"striped+striped":return Xo(s,e,o);case"striped+wrapped":return Yo(s,e,o);case"colorBomb+striped":return qo(s,e,o);case"wrapped+wrapped":return Jo(s,e,o);case"colorBomb+wrapped":return Ko(s,e,o);case"colorBomb+colorBomb":return Qo(s,e,o);default:return null}}function er(s,e){switch(s.type){case"striped":return Ho(s,e,s.stripedDirection||"horizontal");case"wrapped":return Vo(s,e);case"colorBomb":return Uo(s,e);default:return{positionsToRemove:[],score:0}}}const tr=s=>{const[e,o]=m.useState(()=>{const i=Ot(s);return{board:i.initialBoard||[],score:0,moves:i.maxMoves,goals:i.goals,isGameOver:!1,isPaused:!1,currentStage:s,isAnimating:!1,selectedGem:null,comboCount:0}});m.useEffect(()=>{const i=Ot(s);o({board:i.initialBoard||[],score:0,moves:i.maxMoves,goals:i.goals,isGameOver:!1,isPaused:!1,currentStage:s,isAnimating:!1,selectedGem:null,comboCount:0})},[s]);const r=m.useRef(null),a=m.useCallback((i,d)=>{o(h=>{var p,y;if(h.isGameOver)return h;const b=((p=h.selectedGem)==null?void 0:p.row)===i&&((y=h.selectedGem)==null?void 0:y.col)===d?null:{row:i,col:d};return r.current=b,De(me({},h),{selectedGem:b})})},[]),n=m.useCallback((i,d)=>{o(h=>{var W;if(h.isGameOver||h.moves<=0)return h;const b=Math.abs(i.row-d.row),p=Math.abs(i.col-d.col);if(!(b===1&&p===0||b===0&&p===1))return h;const y=h.board.map(N=>N.map(J=>J?me({},J):null)),T=y[i.row][i.col],D=y[d.row][d.col];if(T&&D&&T.type!=="normal"&&D.type!=="normal"){const N=Zo(T,D,y);if(N){const J=new Set;for(const j of N.positionsToRemove)J.add(`${j.row},${j.col}`);for(const j of J){const[L,le]=j.split(","),A=Number(L),ve=Number(le);!Number.isNaN(A)&&!Number.isNaN(ve)&&y[A]&&(y[A][ve]=null)}const te=_t(y,50),fe=h.score+N.score,Ee=h.goals.map(j=>j.type==="score"?De(me({},j),{current:Math.min(j.current+N.score,j.target)}):j),ue=qe(te).length>0,H=Ee.every(j=>j.current>=j.target),Ae=h.moves<=0&&!H;return De(me({},h),{board:te,score:fe,goals:Ee,moves:h.moves-1,isAnimating:ue&&!H&&!Ae,selectedGem:null,comboCount:0,isGameOver:Ae||h.isGameOver})}}const E=y[i.row][i.col];y[i.row][i.col]=y[d.row][d.col],y[d.row][d.col]=E,y[i.row][i.col]&&(y[i.row][i.col].position=me({},i)),y[d.row][d.col]&&(y[d.row][d.col].position=me({},d));const X=qe(y);if(X.length===0)return h;const ie=Wo(X);for(const N of ie){const J=(W=y[N.position.row])==null?void 0:W[N.position.col];J&&(J.type=N.type,N.stripedDirection&&(J.stripedDirection=N.stripedDirection))}return De(me({},h),{board:y,moves:h.moves-1,isAnimating:!0,selectedGem:null,comboCount:0})})},[]),l=m.useCallback(()=>{o(i=>{var H,Ae;if(!i.isAnimating)return i;const d=qe(i.board);if(d.length===0)return De(me({},i),{isAnimating:!1});const h=i.board.map(j=>j.map(L=>L?me({},L):null)),b=new Set;let p=0;const y=new Set;for(const j of d)for(const L of j.positions){const le=(H=h[L.row])==null?void 0:H[L.col];le&&le.type!=="normal"&&y.add(`${L.row},${L.col}`)}for(const j of y){const[L,le]=j.split(","),A=Number(L),ve=Number(le);if(!Number.isNaN(A)&&!Number.isNaN(ve)&&((Ae=h[A])!=null&&Ae[ve])){const g=h[A][ve],Ke=er(g,h);for(const Qe of Ke.positionsToRemove)b.add(`${Qe.row},${Qe.col}`);p+=Ke.score}}for(const j of d)for(const L of j.positions)b.add(`${L.row},${L.col}`);for(const j of b){const[L,le]=j.split(","),A=Number(L),ve=Number(le);!Number.isNaN(A)&&!Number.isNaN(ve)&&h[A]&&(h[A][ve]=null)}const T=_t(h,50),E=qe(T).length>0,X=E?i.comboCount+1:0,ie=1+Math.min(X,5)*.15,W=d.reduce((j,L)=>{const le=L.positions.length;let A=10;return le>=6?A=80:le>=5?A=40:le>=4&&(A=20),j+le*A},0),N=W+p,J=Math.floor(N*(ie-1)),te=i.score+N+J,fe=W+p+J,Ee=i.goals.map(j=>j.type==="score"?De(me({},j),{current:Math.min(j.current+fe,j.target)}):j),he=Ee.every(j=>j.current>=j.target),ue=i.moves<=0&&!he;return De(me({},i),{board:T,score:te,goals:Ee,isGameOver:ue||i.isGameOver,isAnimating:E&&!he&&!ue,comboCount:X})})},[]),c=m.useCallback(()=>{o(i=>De(me({},i),{isPaused:!i.isPaused}))},[]);return{gameState:e,selectGem:a,swapGems:n,processMatches:l,togglePause:c}};function It(s){const{score:e,goals:o,moves:r,currentStage:a}=s;if(o.length===0)return 0;const n=o[0];if(n.current<n.target)return 0;const l=n.current/n.target,c=Math.max(20,50-Math.floor(a/20)),i=r/c,d=Math.min(e/(n.target*1.5),1);let h=0;return l>=1&&(h=1,(l>=1.2||i>=.4)&&(h=2),l>=1.5&&i>=.5&&d>=.8&&(h=3)),Math.min(h,3)}class or{constructor(e){U(this,"particles",[]);U(this,"ctx");this.ctx=e}emit(e,o,r,a=20){const n=nt[r];for(let l=0;l<a;l++){const c=Math.PI*2*l/a+Math.random()*.5,i=2+Math.random()*3;this.particles.push({x:e,y:o,vx:Math.cos(c)*i,vy:Math.sin(c)*i,life:1,maxLife:1,color:Math.random()>.5?n.light:n.dark,size:3+Math.random()*4,rotation:Math.random()*Math.PI*2,rotationSpeed:(Math.random()-.5)*.2})}}emitExplosion(e,o,r,a=50,n=30){const l=nt[r];for(let c=0;c<n;c++){const i=Math.random()*Math.PI*2,d=Math.random()*a,h=1+Math.random()*2;this.particles.push({x:e+Math.cos(i)*d*.3,y:o+Math.sin(i)*d*.3,vx:Math.cos(i)*h,vy:Math.sin(i)*h,life:1,maxLife:1,color:Math.random()>.5?l.light:l.dark,size:4+Math.random()*6,rotation:Math.random()*Math.PI*2,rotationSpeed:(Math.random()-.5)*.3})}}update(e=16){for(let o=this.particles.length-1;o>=0;o--){const r=this.particles[o];r.x+=r.vx,r.y+=r.vy,r.vy+=.1,r.vx*=.98,r.vy*=.98,r.rotation+=r.rotationSpeed,r.life-=e/1e3,r.life<=0&&this.particles.splice(o,1)}}render(){this.ctx.save();for(const e of this.particles){const o=e.life/e.maxLife,r=e.size*o;this.ctx.globalAlpha=o,this.ctx.fillStyle=e.color,this.ctx.translate(e.x,e.y),this.ctx.rotate(e.rotation),this.ctx.fillRect(-r/2,-r/2,r,r),this.ctx.setTransform(1,0,0,1,0,0)}this.ctx.globalAlpha=1,this.ctx.restore()}clear(){this.particles=[]}get count(){return this.particles.length}}function wt(s){var n,l,c,i;const e=s.length,o=((n=s[0])==null?void 0:n.length)||0,r=[],a=[];for(let d=0;d<e;d++)for(let h=0;h<o;h++){const b=(l=s[d])==null?void 0:l[h];if(b){if(h<o-1){const p=(c=s[d])==null?void 0:c[h+1];if(p&&p.color!==b.color){const y=$t(s,d,h,d,h+1),T=qe(y);if(T.length>0){const D=T.some(X=>X.positions.length>=4),E={from:{row:d,col:h},to:{row:d,col:h+1}};D?r.push(E):a.push(E)}}}if(d<e-1){const p=(i=s[d+1])==null?void 0:i[h];if(p&&p.color!==b.color){const y=$t(s,d,h,d+1,h),T=qe(y);if(T.length>0){const D=T.some(X=>X.positions.length>=4),E={from:{row:d,col:h},to:{row:d+1,col:h}};D?r.push(E):a.push(E)}}}}}return r.length>0?r[0]:a.length>0?a[0]:null}function $t(s,e,o,r,a){const n=s.map(c=>c.map(i=>i?me({},i):null)),l=n[e][o];return n[e][o]=n[r][a],n[r][a]=l,n}class rr{constructor(){U(this,"data",{webVitals:[],gamePerformance:[],startTime:performance.now(),lastUpdate:performance.now()});U(this,"maxDataSize",100)}addWebVital(e){this.data.webVitals.push(e),this.data.webVitals.length>this.maxDataSize&&this.data.webVitals.shift(),this.data.lastUpdate=performance.now(),e.rating==="poor"&&v.warn(`Poor Web Vital detected: ${e.name}`,{value:e.value,rating:e.rating,threshold:this.getThreshold(e.name)})}addGamePerformance(e){this.data.gamePerformance.push(e),this.data.gamePerformance.length>this.maxDataSize&&this.data.gamePerformance.shift(),this.data.lastUpdate=performance.now()}getWebVitals(e){return e?this.data.webVitals.filter(o=>o.name===e):[...this.data.webVitals]}getGamePerformance(){return[...this.data.gamePerformance]}getAverageWebVital(e){const o=this.getWebVitals(e);return o.length===0?null:o.reduce((a,n)=>a+n.value,0)/o.length}getLatestWebVital(e){const o=this.getWebVitals(e);return o.length===0?null:o[o.length-1]}generateReport(){var a,n;const e={webVitals:{},gamePerformance:{averageFPS:0,averageFrameTime:0,minFPS:1/0,maxFPS:0,sampleCount:0},sessionDuration:performance.now()-this.data.startTime},o=["LCP","FID","CLS","FCP","TTFB"];for(const l of o){const c=this.getLatestWebVital(l),i=this.getAverageWebVital(l),d=this.getWebVitals(l);e.webVitals[l]={latest:(a=c==null?void 0:c.value)!=null?a:null,average:i,rating:(n=c==null?void 0:c.rating)!=null?n:"unknown",count:d.length}}const r=this.getGamePerformance();if(r.length>0){const l=r.map(i=>i.fps),c=r.map(i=>i.frameTime);e.gamePerformance={averageFPS:l.reduce((i,d)=>i+d,0)/l.length,averageFrameTime:c.reduce((i,d)=>i+d,0)/c.length,minFPS:Math.min(...l),maxFPS:Math.max(...l),sampleCount:r.length}}return e}logReport(){const e=this.generateReport();v.info("Performance Report",e)}getThreshold(e){var r;return(r={LCP:{good:2500,needsImprovement:4e3},FID:{good:100,needsImprovement:300},CLS:{good:.1,needsImprovement:.25},FCP:{good:1800,needsImprovement:3e3},TTFB:{good:800,needsImprovement:1800}}[e])!=null?r:{good:0,needsImprovement:0}}reset(){this.data={webVitals:[],gamePerformance:[],startTime:performance.now(),lastUpdate:performance.now()}}getAllData(){return{webVitals:[...this.data.webVitals],gamePerformance:[...this.data.gamePerformance],startTime:this.data.startTime,lastUpdate:this.data.lastUpdate}}}const Ct=new rr,sr=Object.freeze(Object.defineProperty({__proto__:null,performanceAnalytics:Ct},Symbol.toStringTag,{value:"Module"}));class nr{constructor(){U(this,"fpsHistory",[]);U(this,"frameTimeHistory",[]);U(this,"lastFrameTime",performance.now());U(this,"frameCount",0);U(this,"fpsUpdateInterval",1e3);U(this,"lastFpsUpdate",performance.now());U(this,"currentFps",60);U(this,"currentFrameTime",16.67);U(this,"maxHistorySize",60);U(this,"callbacks",new Set)}update(){const e=performance.now(),o=e-this.lastFrameTime;if(this.lastFrameTime=e,this.frameTimeHistory.push(o),this.frameTimeHistory.length>this.maxHistorySize&&this.frameTimeHistory.shift(),this.frameCount++,e-this.lastFpsUpdate>=this.fpsUpdateInterval){this.currentFps=this.frameCount,this.currentFrameTime=1e3/this.currentFps,this.fpsHistory.push(this.currentFps),this.fpsHistory.length>this.maxHistorySize&&this.fpsHistory.shift();const r=this.frameTimeHistory.reduce((n,l)=>n+l,0)/this.frameTimeHistory.length,a=this.getMetrics(r);this.callbacks.forEach(n=>n(a));try{Ct.addGamePerformance(a)}catch(n){}this.currentFps<30&&this.handlePerformanceDegradation(),this.frameCount=0,this.lastFpsUpdate=e}}getMetrics(e){const o={fps:this.currentFps,frameTime:e,timestamp:performance.now()};if(performance.memory&&typeof performance.memory=="object"){const r=performance.memory;o.memoryUsage={usedJSHeapSize:r.usedJSHeapSize,totalJSHeapSize:r.totalJSHeapSize,jsHeapSizeLimit:r.jsHeapSizeLimit}}return o}handlePerformanceDegradation(){}subscribe(e){return this.callbacks.add(e),()=>{this.callbacks.delete(e)}}getFPS(){return this.currentFps}getAverageFPS(){return this.fpsHistory.length===0?60:this.fpsHistory.reduce((o,r)=>o+r,0)/this.fpsHistory.length}getFrameTime(){return this.currentFrameTime}getFPSHistory(){return[...this.fpsHistory]}getMemoryUsage(){if(performance.memory&&typeof performance.memory=="object"){const e=performance.memory;return{usedJSHeapSize:e.usedJSHeapSize,totalJSHeapSize:e.totalJSHeapSize,jsHeapSizeLimit:e.jsHeapSizeLimit}}return null}reset(){this.fpsHistory=[],this.frameTimeHistory=[],this.frameCount=0,this.currentFps=60,this.currentFrameTime=16.67,this.lastFrameTime=performance.now(),this.lastFpsUpdate=performance.now()}}const Nt=new nr,ke=(s,e="")=>{if(typeof window=="undefined"||typeof document=="undefined")return e;const o=document.documentElement;return getComputedStyle(o).getPropertyValue(s).trim()||e},xe=()=>({bgPrimary:ke("--bg-primary","#1a1a2e"),bgSecondary:ke("--bg-secondary","#2a2a3e"),bgTertiary:ke("--bg-tertiary","#3a3a4e"),bgCard:ke("--bg-card","rgba(42, 42, 62, 0.9)"),bgOverlayDark:ke("--bg-overlay-dark","rgba(26, 26, 46, 0.9)"),textPrimary:ke("--text-primary","#ffffff"),textSecondary:ke("--text-secondary","rgba(255, 255, 255, 0.85)"),textTertiary:ke("--text-tertiary","rgba(255, 255, 255, 0.65)"),accentPrimary:ke("--accent-primary","#a8b5ff"),accentSecondary:ke("--accent-secondary","#c5a3ff"),accentSuccess:ke("--accent-success","#7fdfd4"),accentWarning:ke("--accent-warning","#ffd89b"),accentDanger:ke("--accent-danger","#ff9f9f"),borderColor:ke("--border-color","rgba(255, 255, 255, 0.15)"),canvasBg:ke("--canvas-bg","#1a1a1a")}),we=(s,e=1)=>{const o=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(s);if(!o)return`rgba(255, 255, 255, ${e})`;const r=parseInt(o[1],16),a=parseInt(o[2],16),n=parseInt(o[3],16);return`rgba(${r}, ${a}, ${n}, ${e})`};const ar=({stageNumber:s=1,currentScreen:e="stageSelect",onNavigate:o,onStartStage:r})=>{const a=m.useRef(!1),n=m.useRef(null),l=m.useRef(null),c=m.useRef(null),i=m.useRef(null),d=m.useRef(null),h=m.useRef(null),b=m.useRef(new Map),p=m.useRef(null),y=m.useRef(!1),T=m.useRef(null),D=m.useRef(""),E=m.useRef(!1),X=m.useRef(null),ie=m.useRef(null),W=m.useRef(null),N=m.useRef(null),J=m.useRef(!1),te=m.useRef(!1),fe=m.useRef(!1),Ee=m.useRef(!1),[he,ue]=m.useState(!1),{t:H}=Je(),[Ae,j]=m.useState(1),[L,le]=m.useState(1),[A,ve]=m.useState(null),{gameState:g,selectGem:Ke,swapGems:Qe,processMatches:ct,togglePause:st}=tr(s),[ce,eo]=m.useState(()=>{const S=zt.cols,B=zt.rows;return{aspectRatio:Qt.aspectRatio,cellSize:70,gridRows:B,gridCols:S,pixelRatio:window.devicePixelRatio||1,logicalWidth:0,logicalHeight:0}});m.useEffect(()=>{var t;if(e==="game"&&g.board.length>0){const S=g.board.length,B=((t=g.board[0])==null?void 0:t.length)||9;eo(P=>De(me({},P),{gridRows:S,gridCols:B}))}},[e,g.board,s]),m.useEffect(()=>{try{const t=Fe.get("chipPuzzleGame_progress",{fallback:null,silent:!0});t&&(j(Math.max(1,t.highestStage||1)),v.info("Game progress loaded",{highestStage:t.highestStage||1}))}catch(t){v.warn("Failed to recover game state",{error:t}),j(1)}},[]);const Pt=m.useCallback((t,S,B)=>{const u=S/1200,{canvasBg:K,textPrimary:x,accentPrimary:oe,accentSecondary:Ge,bgTertiary:_e}=xe(),C=document.documentElement.getAttribute("data-theme")==="light";t.fillStyle=K,t.fillRect(0,0,S,B),t.fillStyle=x;const Te=Math.max(16,32*u);t.font=`bold ${Te}px Arial`,t.textAlign="center",t.fillText(H("stageSelect.title"),S/2,50*u);const M=75,ge=20,Y=M*u,Ce=ge*u,pe=1e3,q=50,re=Math.ceil(pe/q),ye=(L-1)*q+1,je=Math.min(ye+q-1,pe);let Pe=je-ye+1===50?10:8;const Ie=(S-(Pe*Y+(Pe-1)*Ce))/2,Me=100*u;for(let se=0;se<q&&ye+se<=je;se++){const Q=ye+se,ze=Math.floor(se/Pe),Z=se%Pe,ne=Ie+Z*(Y+Ce),ee=Me+ze*(Y+Ce),be=Q<=Ae;if(be){const Ne=t.createLinearGradient(ne,ee,ne+Y,ee+Y);Ne.addColorStop(0,oe),Ne.addColorStop(1,Ge),t.fillStyle=Ne}else t.fillStyle=_e||(C?"#e0e0e5":"#1a1a1a");if(t.fillRect(ne,ee,Y,Y),t.strokeStyle=be?oe:C?"#cccccc":"#444",t.lineWidth=Math.max(1,2*u),t.strokeRect(ne,ee,Y,Y),be){t.fillStyle=x;const Ne=Math.max(12,20*u);t.font=`bold ${Ne}px Arial`,t.textAlign="center",t.textBaseline="middle",t.fillText(Q.toString(),ne+Y/2,ee+Y/2)}else{t.fillStyle="#ffa500";const Ne=Math.max(16,24*u);t.font=`${Ne}px Arial`,t.textAlign="center",t.textBaseline="middle",t.fillText("üîí",ne+Y/2,ee+Y/2-8*u),t.fillStyle=x;const Ye=Math.max(10,14*u);t.font=`bold ${Ye}px Arial`,t.textAlign="center",t.textBaseline="middle",t.fillText(Q.toString(),ne+Y/2,ee+Y/2+12*u)}}const ae=40*u,Le=90*u,Re=B-60*u,We=15*u,$e=10*u,Xe=C?"rgba(255, 255, 255, 0.5)":"rgba(255, 255, 255, 0.3)",Be=C?.2:.4,{textTertiary:R}=xe(),z=`${H("stageSelect.page")} ${L} / ${re}`;t.font=`bold ${Math.max(12,18*u)}px Arial`;const G=t.measureText(z).width,F=Le+We+G+We+Le,I=(S-F)/2,_=L<=1,O=L>=re,$=t.createLinearGradient(I,Re,I,Re+ae);_?($.addColorStop(0,C?"#cccccc":"#444"),$.addColorStop(1,C?"#bbbbbb":"#333")):($.addColorStop(0,oe),$.addColorStop(1,Ge)),t.save(),t.globalAlpha=_?.4:1,t.beginPath(),t.roundRect(I,Re,Le,ae,$e),t.fillStyle=$,t.fill(),t.strokeStyle=_?C?"#aaaaaa":"#555":Xe,t.lineWidth=Math.max(1,1.5*u),t.stroke(),t.restore(),_?(t.shadowColor="transparent",t.shadowBlur=0):(t.shadowColor=we(oe,Be),t.shadowBlur=6*u,t.shadowOffsetX=0,t.shadowOffsetY=2*u),t.fillStyle=_?R:x,t.font=`600 ${Math.max(12,16*u)}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,t.textAlign="center",t.textBaseline="middle",t.fillText("¬´",I+Le/2,Re+ae/2),t.shadowColor="transparent",t.shadowBlur=0;const de=I+Le+We;t.fillStyle=x,t.font=`bold ${Math.max(12,18*u)}px Arial`,t.textAlign="left",t.fillText(z,de,Re+ae/2+4*u);const k=de+G+We,V=t.createLinearGradient(k,Re,k,Re+ae);O?(V.addColorStop(0,C?"#cccccc":"#444"),V.addColorStop(1,C?"#bbbbbb":"#333")):(V.addColorStop(0,oe),V.addColorStop(1,Ge)),t.save(),t.globalAlpha=O?.4:1,t.beginPath(),t.roundRect(k,Re,Le,ae,$e),t.fillStyle=V,t.fill(),t.strokeStyle=O?C?"#aaaaaa":"#555":Xe,t.lineWidth=Math.max(1,1.5*u),t.stroke(),t.restore(),O?(t.shadowColor="transparent",t.shadowBlur=0):(t.shadowColor=we(oe,Be),t.shadowBlur=6*u,t.shadowOffsetX=0,t.shadowOffsetY=2*u),t.fillStyle=O?R:x,t.font=`600 ${Math.max(12,16*u)}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,t.textAlign="center",t.textBaseline="middle",t.fillText("¬ª",k+Le/2,Re+ae/2),t.shadowColor="transparent",t.shadowBlur=0},[Ae,H,L]),Tt=m.useCallback((t,S,B)=>{const u=S/1200,{canvasBg:K,textPrimary:x,accentPrimary:oe,accentSecondary:Ge,accentSuccess:_e}=xe(),C=document.documentElement.getAttribute("data-theme")==="light";t.fillStyle=K,t.fillRect(0,0,S,B);const M=(ce.cellSize||70)*u,ge=ce.gridCols||9,Y=ce.gridRows||9,Ce=M*ge,pe=M*Y,q=(S-Ce)/2,re=(B-pe)/2;(!c.current||i.current!==M)&&(c.current=new Lo(t,M),i.current=M),d.current||(d.current=new or(t));const{bgTertiary:ye}=xe();t.save(),t.globalAlpha=.9,t.fillStyle=C?we(ye,.6):"rgba(22, 22, 46, 0.8)",t.beginPath(),t.roundRect(q,re,Ce,pe,8*u),t.fill(),t.restore(),t.strokeStyle=C?"rgba(0, 0, 0, 0.08)":"rgba(255, 255, 255, 0.08)",t.lineWidth=Math.max(.5,1*u);for(let R=0;R<=Y;R++){const z=re+R*M;t.beginPath(),t.moveTo(q,z),t.lineTo(q+Ce,z),t.stroke()}for(let R=0;R<=ge;R++){const z=q+R*M;t.beginPath(),t.moveTo(z,re),t.lineTo(z,re+pe),t.stroke()}const je=Math.max(10,20*u),Oe=24*u,Pe=24*u,Ie=je+8*u,Me=Pe,ae=16*u,Le=16*u,{bgCard:Ue,borderColor:Re}=xe(),We=280*u,$e=Ie*4+ae*2;t.save(),t.globalAlpha=.9,t.fillStyle=Ue,t.beginPath(),t.roundRect(Oe-ae,Pe-ae,We,$e,Le),t.fill(),t.strokeStyle=Re,t.lineWidth=1*u,t.stroke(),t.restore(),t.textAlign="left",t.textBaseline="top",t.shadowColor=C?"rgba(0, 0, 0, 0.1)":"rgba(0, 0, 0, 0.5)",t.shadowBlur=4*u,t.shadowOffsetX=0,t.shadowOffsetY=2*u,t.font=`700 ${Math.max(14,je*1.1)}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,t.fillStyle=oe,t.fillText(`${H("game.stage")} ${s}`,Oe,Me),t.font=`600 ${je}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,t.fillStyle=x,t.fillText(`${H("game.score")}: ${g.score.toLocaleString()}`,Oe,Me+Ie);const{textSecondary:Xe}=xe();if(t.fillStyle=Xe,t.fillText(`${H("game.moves")}: ${g.moves}`,Oe,Me+Ie*2),g.goals.length>0){const R=g.goals[0],z=R.current/R.target,{accentSuccess:G}=xe();t.fillStyle=z>=1?G:x,t.fillText(`${H("game.goal")}: ${R.current.toLocaleString()}/${R.target.toLocaleString()}`,Oe,Me+Ie*3)}if(g.comboCount>0){const{accentWarning:R}=xe();t.shadowColor=we(R,C?.4:.6),t.shadowBlur=12*u,t.font=`700 ${Math.max(14,24*u)}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,t.fillStyle=R,t.textAlign="left",t.fillText(`${H("game.combo")} x${g.comboCount}!`,Oe,Me+Ie*4),t.shadowColor=C?"rgba(0, 0, 0, 0.1)":"rgba(0, 0, 0, 0.5)",t.shadowBlur=4*u}if(t.shadowColor="transparent",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0,!g.isGameOver&&!g.isAnimating){const G=20*u,F=10*u,w=120*u,I=40*u,_=120*u,O=40*u,$=S-w-G,de=G,k=12*u,V=t.createLinearGradient($,de,$,de+I);he?(V.addColorStop(0,_e),V.addColorStop(1,_e)):(V.addColorStop(0,oe),V.addColorStop(1,Ge)),t.save(),t.beginPath(),t.roundRect($,de,w,I,k),t.fillStyle=V,t.fill();const se=C?"rgba(255, 255, 255, 0.5)":"rgba(255, 255, 255, 0.3)";t.strokeStyle=se,t.lineWidth=Math.max(1,1.5*u),t.stroke(),t.restore();const Q=C?.2:.4;t.shadowColor=we(he?_e:oe,Q),t.shadowBlur=8*u,t.shadowOffsetX=0,t.shadowOffsetY=2*u,t.fillStyle=x;const ze=16*u;t.font=`600 ${ze}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,t.textAlign="center",t.textBaseline="middle",t.fillText(H("game.hint"),$+w/2,de+I/2),t.shadowColor="transparent",t.shadowBlur=0;const Z=$-_-F,ne=G,ee=t.createLinearGradient(Z,ne,Z,ne+O);if(g.isPaused){const{accentDanger:Ye}=xe();ee.addColorStop(0,Ye),ee.addColorStop(1,Ye)}else ee.addColorStop(0,oe),ee.addColorStop(1,Ge);t.save(),t.beginPath(),t.roundRect(Z,ne,_,O,k),t.fillStyle=ee,t.fill(),t.strokeStyle=se,t.lineWidth=Math.max(1,1.5*u),t.stroke(),t.restore();const{accentDanger:be}=xe();t.shadowColor=g.isPaused?we(be,Q):we(oe,Q),t.shadowBlur=8*u,t.shadowOffsetX=0,t.shadowOffsetY=2*u,t.fillStyle=x;const Ne=16*u;t.font=`600 ${Ne}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,t.textAlign="center",t.textBaseline="middle",t.fillText(g.isPaused?H("game.resume"):H("game.pause"),Z+_/2,ne+O/2),t.shadowColor="transparent",t.shadowBlur=0}if(g.isGameOver){const{bgOverlayDark:R,bgCard:z,accentDanger:G}=xe(),F=C?"rgba(255, 255, 255, 0.5)":"rgba(255, 255, 255, 0.3)",w=C?.2:.4;t.fillStyle=R,t.fillRect(0,0,S,B);const I=450*u,_=300*u,O=(S-I)/2,$=(B-_)/2,de=24*u;t.save(),t.globalAlpha=.95,t.fillStyle=z,t.beginPath(),t.roundRect(O,$,I,_,de),t.fill(),t.strokeStyle=we(G,.3),t.lineWidth=2*u,t.stroke(),t.restore(),t.shadowColor=we(G,C?.3:.5),t.shadowBlur=12*u,t.fillStyle=G,t.font=`700 ${Math.max(28,56*u)}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,t.textAlign="center",t.textBaseline="middle",t.fillText(H("game.gameOver"),S/2,$+60*u),t.shadowColor="transparent",t.shadowBlur=0,t.fillStyle=x,t.font=`600 ${Math.max(16,24*u)}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,t.fillText(`${H("game.finalScore")}: ${g.score.toLocaleString()}`,S/2,$+120*u);const k=S/2-110*u,V=$+180*u,se=220*u,Q=56*u,ze=14*u,Z=t.createLinearGradient(k,V,k,V+Q);Z.addColorStop(0,G),Z.addColorStop(1,G),t.save(),t.beginPath(),t.roundRect(k,V,se,Q,ze),t.fillStyle=Z,t.fill(),t.strokeStyle=F,t.lineWidth=2*u,t.stroke(),t.restore(),t.shadowColor=we(G,w),t.shadowBlur=8*u,t.shadowOffsetX=0,t.shadowOffsetY=2*u,t.fillStyle=x,t.font=`600 ${Math.max(16,22*u)}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,t.textAlign="center",t.textBaseline="middle",t.fillText(H("game.retry"),S/2,V+Q/2),t.shadowColor="transparent",t.shadowBlur=0}const Be=g.goals.every(R=>R.current>=R.target);if(A&&!g.isPaused&&!g.isGameOver){const R=q+A.col*M,z=re+A.row*M,G=Date.now()%1e3,F=.4+Math.sin(G/1e3*Math.PI*2)*.3;t.save(),t.strokeStyle="#667eea",t.lineWidth=Math.max(3,4*u),t.setLineDash([5*u,5*u]),t.strokeRect(R,z,M,M),t.fillStyle=`rgba(102, 126, 234, ${F*.3})`,t.fillRect(R,z,M,M),t.restore()}if(g.isAnimating){const R=qe(g.board),z=new Set;for(const G of R)for(const F of G.positions)z.add(`${F.row},${F.col}`);z.forEach(G=>{const[F,w]=G.split(","),I=Number(F),_=Number(w);if(!Number.isNaN(I)&&!Number.isNaN(_)&&I>=0&&I<Y&&_>=0&&_<ge){const O=q+_*M,$=re+I*M,de=Date.now()%1e3,k=.3+Math.sin(de/1e3*Math.PI*2)*.2;t.fillStyle=`rgba(255, 215, 61, ${k})`,t.strokeStyle="#ffd93d",t.lineWidth=Math.max(2,3*u),t.strokeRect(O,$,M,M),t.fillRect(O,$,M,M)}})}if(g.board&&g.board.length>0&&c.current){let R=!1;g.board.forEach((G,F)=>{G&&G.forEach((w,I)=>{if(w){const _=q+I*M,O=re+F*M;if(J.current&&X.current&&W.current&&ie.current){const k=X.current,V=W.current,se=ie.current;if(F===k.row&&I===k.col)if(N.current){const Q=N.current.x-se.x,ze=N.current.y-se.y,Z=M,ne=Math.max(-Z,Math.min(Z,Q)),ee=Math.max(-Z,Math.min(Z,ze));w.x=_+ne,w.y=O+ee}else w.x=_,w.y=O;else if(F===V.row&&I===V.col)if(N.current){const Q=N.current.x-se.x,ze=N.current.y-se.y,Z=M,ne=Math.max(-Z,Math.min(Z,-Q)),ee=Math.max(-Z,Math.min(Z,-ze));w.x=_+ne,w.y=O+ee}else w.x=_,w.y=O;else w.x=_,w.y=O}else if(w.targetY!==void 0){R=!0;let k;w.targetY<100?k=re+w.targetY*M:k=w.targetY,(w.y===void 0||w.y===0)&&(w.y=O);const V=k-w.y,se=.15;Math.abs(V)>1?(w.y+=V*se,V>0&&(w.y+=1)):(w.y=k,w.targetY=void 0),w.x=_}else if(w.targetX!==void 0){const k=w.targetX-w.x,V=.2;Math.abs(k)>.1?w.x+=k*V:(w.x=w.targetX,w.targetX=void 0),w.y=O}else(w.x===0&&w.y===0&&w.targetX===void 0&&w.targetY===void 0||w.x!==_||w.y!==O)&&(w.x=_,w.y=O);g.selectedGem&&g.selectedGem.row===F&&g.selectedGem.col===I&&(t.fillStyle="rgba(255, 255, 255, 0.3)",t.strokeStyle="rgba(255, 255, 255, 0.8)",t.lineWidth=Math.max(2,3*u),t.strokeRect(_,O,M,M),t.fillRect(_,O,M,M)),he&&p.current&&(p.current.from.row===F&&p.current.from.col===I||p.current.to.row===F&&p.current.to.col===I)&&(t.fillStyle="rgba(255, 215, 61, 0.4)",t.strokeStyle="#ffd93d",t.lineWidth=Math.max(3,4*u),t.strokeRect(_,O,M,M),t.fillRect(_,O,M,M));let $=1,de=w.scale||1;if(w.isRemoving){let k=b.current.get(w.id);k||(k={alpha:1,scale:1},b.current.set(w.id,k)),k.alpha=Math.max(0,k.alpha-.08),k.scale=Math.max(0,k.scale-.08),$=k.alpha,de=k.scale,w.alpha=$,w.scale=de,b.current.set(w.id,k)}else w.alpha=1,w.scale=1;if($>0){const k=Be&&!g.isAnimating?$*.3:$;c.current.render(w,k)}if(w.isRemoving&&$>.8&&$<.9&&d.current){const k=w.x+M/2,V=w.y+M/2;d.current.emit(k,V,w.color,15)}}})});const z=y.current;y.current=R,z&&!R&&g.isAnimating&&e==="game"&&!g.isGameOver&&!E.current&&setTimeout(()=>{g.isAnimating&&e==="game"&&!g.isGameOver&&!E.current&&(E.current=!0,ct(),setTimeout(()=>{E.current=!1,D.current=""},200))},100)}if(d.current&&(d.current.update(16),d.current.render()),g.isPaused&&!g.isGameOver){const{bgOverlayDark:R,bgCard:z,accentPrimary:G,textSecondary:F}=xe();t.fillStyle=R,t.fillRect(0,0,S,B);const w=400*u,I=200*u,_=(S-w)/2,O=(B-I)/2,$=24*u;t.save(),t.globalAlpha=.95,t.fillStyle=z,t.beginPath(),t.roundRect(_,O,w,I,$),t.fill(),t.strokeStyle=we(G,C?.2:.3),t.lineWidth=2*u,t.stroke(),t.restore(),t.shadowColor=we(G,C?.3:.5),t.shadowBlur=12*u,t.shadowOffsetX=0,t.shadowOffsetY=0,t.fillStyle=x,t.font=`700 ${Math.max(28,56*u)}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,t.textAlign="center",t.textBaseline="middle",t.fillText(H("game.pause"),S/2,O+I/2-30*u),t.shadowColor="transparent",t.shadowBlur=0,t.fillStyle=F,t.font=`500 ${Math.max(14,20*u)}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,t.fillText(H("game.resume"),S/2,O+I/2+20*u)}if(Be&&!g.isAnimating&&!g.isGameOver){const R=It(g),{bgOverlayDark:z,bgCard:G,accentSuccess:F,textTertiary:w}=xe(),I=C?"rgba(255, 255, 255, 0.5)":"rgba(255, 255, 255, 0.3)",_=C?.2:.4;t.fillStyle=z,t.fillRect(0,0,S,B);const O=500*u,$=400*u,de=(S-O)/2,k=(B-$)/2,V=28*u;t.save(),t.globalAlpha=.96,t.fillStyle=G,t.beginPath(),t.roundRect(de,k,O,$,V),t.fill(),t.strokeStyle=we(F,C?.3:.4),t.lineWidth=2*u,t.stroke(),t.restore(),t.shadowColor=we(F,C?.3:.5),t.shadowBlur=12*u,t.shadowOffsetX=0,t.shadowOffsetY=0,t.fillStyle=F,t.font=`700 ${Math.max(32,64*u)}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,t.textAlign="center",t.textBaseline="middle",t.fillText(H("game.stageCleared"),S/2,k+80*u);const{accentWarning:se}=xe(),Q=Math.max(24,48*u),ze=Q*1.8,Z=S/2-ze,ne=k+160*u;for(let et=0;et<3;et++){const so=Z+et*ze;t.shadowColor=et<R?we(se,C?.4:.6):"transparent",t.shadowBlur=et<R?12*u:0,t.fillStyle=et<R?se:w,t.font=`${Q}px Arial`,t.textAlign="center",t.textBaseline="middle",t.fillText("‚òÖ",so,ne)}t.shadowColor="transparent",t.shadowBlur=0,t.fillStyle=x,t.font=`600 ${Math.max(18,28*u)}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,t.fillText(`${H("game.score")}: ${g.score.toLocaleString()}`,S/2,k+220*u);const ee=S/2-120*u,be=k+280*u,Ne=240*u,Ye=60*u,ro=16*u,gt=t.createLinearGradient(ee,be,ee,be+Ye);gt.addColorStop(0,oe),gt.addColorStop(1,Ge),t.save(),t.beginPath(),t.roundRect(ee,be,Ne,Ye,ro),t.fillStyle=gt,t.fill(),t.strokeStyle=I,t.lineWidth=2*u,t.stroke(),t.restore(),t.shadowColor=we(oe,_),t.shadowBlur=8*u,t.shadowOffsetX=0,t.shadowOffsetY=2*u,t.fillStyle=x,t.font=`600 ${Math.max(16,22*u)}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,t.textAlign="center",t.textBaseline="middle",t.fillText(H("game.nextStage"),S/2,be+Ye/2),t.shadowColor="transparent",t.shadowBlur=0}},[ce,g,he,H]),Ve=m.useCallback(()=>{const t=n.current,S=l.current;if(!t||!S)return;const B=window.devicePixelRatio||1,P=t.width/B,u=t.height/B;if(!(P===0||u===0))if(e==="stageSelect")Pt(S,P,u);else if(e==="game")Tt(S,P,u);else{const{canvasBg:K}=xe();S.fillStyle=K,S.fillRect(0,0,P,u)}},[e,Pt,Tt,s]);m.useEffect(()=>{let t=0;const B=1e3/60,P=Nt.subscribe(K=>{}),u=()=>{const K=x=>{x-t>=B&&(Ve(),Nt.update(),t=x),h.current=requestAnimationFrame(K)};h.current=requestAnimationFrame(K)};return n.current&&l.current&&(u(),v.info("GameBoard render loop started",{stage:s,screen:e})),()=>{h.current!==null&&(cancelAnimationFrame(h.current),h.current=null),P(),v.debug("GameBoard render loop stopped")}},[Ve,s,e]);const to=m.useCallback((t,S)=>{a.current||(a.current=!0,n.current=t,l.current=S,Ve())},[Ve]),oo=m.useCallback((t,S)=>{n.current=t,l.current=S,Ve()},[Ve]);m.useEffect(()=>{if(n.current&&l.current){const t=setTimeout(()=>{Ve()},10);return()=>clearTimeout(t)}},[Ve,e,Ae,s,g]),m.useEffect(()=>{if(g.isAnimating&&e==="game"&&!g.isGameOver&&!E.current){const t=JSON.stringify(g.board);if(t!==D.current)return E.current=!0,D.current=t,T.current&&clearTimeout(T.current),T.current=setTimeout(()=>{const B=()=>{y.current?setTimeout(B,50):(ct(),setTimeout(()=>{E.current=!1,D.current=""},200))};B()},300),()=>{T.current&&(clearTimeout(T.current),T.current=null)}}else g.isAnimating||(D.current="",E.current=!1)},[g.isAnimating,g.board,ct,e,g.isGameOver]),m.useEffect(()=>{if(e!=="game"){fe.current=!1,Ee.current=!1;return}const t=g.goals.every(S=>S.current>=S.target);if(!fe.current&&g.isGameOver&&(v.info("Game Over",{stage:g.currentStage,score:g.score,moves:g.moves}),Se.playGameOver()),!Ee.current&&t&&!g.isGameOver){const S=It(g);v.info("Stage Cleared",{stage:g.currentStage,score:g.score,moves:g.moves,stars:S}),Se.playStageClear();const P=Fe.get("chipPuzzleGame_progress",{fallback:null})||{highestStage:1,stageRecords:{}},u=g.currentStage;u>=P.highestStage&&(P.highestStage=u+1),P.stageRecords||(P.stageRecords={});const K=u.toString(),x=P.stageRecords[K];!x||g.score>x.bestScore?P.stageRecords[K]={stageNumber:u,stars:Math.max((x==null?void 0:x.stars)||0,S),score:g.score,bestScore:g.score,completedAt:new Date().toISOString(),attempts:((x==null?void 0:x.attempts)||0)+1}:P.stageRecords[K]=De(me({},x),{stars:Math.max(x.stars,S),attempts:x.attempts+1}),Fe.set("chipPuzzleGame_progress",P)||v.error("Failed to save progress",{stage:g.currentStage})}fe.current=g.isGameOver,Ee.current=t},[g.isGameOver,g.goals,g.score,g.currentStage,e]);const dt=m.useCallback(t=>{if(te.current){te.current=!1;return}const S=n.current;if(!S)return;const B=S.getBoundingClientRect(),P=t.clientX-B.left,u=t.clientY-B.top,K=window.devicePixelRatio||1,x=S.width/K,oe=S.height/K,Ge=S.getContext("2d");if(Ge){if(e==="stageSelect"){if(!r)return;const C=x/1200,Te=1e3,M=50,ge=120,Y=40,Ce=20*C,pe=ge*C,q=Y*C,re=x-pe-Ce,ye=Ce;if(P>=re&&P<=re+pe&&u>=ye&&u<=ye+q){if(he)ue(!1),p.current=null;else{const be=wt(g.board);be&&(p.current=be,ue(!0),setTimeout(()=>{ue(!1),p.current=null},3e3))}return}const je=Math.ceil(Te/M),Oe=40*C,Pe=90*C,Me=oe-60*C,ae=15*C,Le=`${H("stageSelect.page")} ${L} / ${je}`;Ge.font=`bold ${Math.max(12,18*C)}px Arial`;const Ue=Ge.measureText(Le).width,Re=Pe+ae+Ue+ae+Pe,$e=(x-Re)/2,Xe=L<=1,Be=$e+Pe,R=Me+Oe;if(!Xe&&P>=$e&&P<=Be&&u>=Me&&u<=R){v.debug("Ïù¥Ï†Ñ ÌéòÏù¥ÏßÄ Î≤ÑÌäº ÌÅ¥Î¶≠",{x:P,y:u,prevButtonX:$e,prevButtonRight:Be,buttonY:Me,prevButtonBottom:R,currentPage:L}),le(L-1),Se.playClick();return}const G=$e+Pe+ae+Ue+ae,F=L>=je,w=G+Pe,I=Me+Oe;if(!F&&P>=G&&P<=w&&u>=Me&&u<=I){v.debug("Îã§Ïùå ÌéòÏù¥ÏßÄ Î≤ÑÌäº ÌÅ¥Î¶≠",{x:P,y:u,nextButtonX:G,nextButtonRight:w,buttonY:Me,nextButtonBottom:I,currentPage:L,totalPages:je}),le(L+1),Se.playClick();return}const _=75,O=20,$=_*C,de=O*C,k=(L-1)*M+1,Q=Math.min(k+M-1,Te)-k+1===50?10:8,ze=(x-(Q*$+(Q-1)*de))/2,Z=100*C,ne=Math.floor((P-ze)/($+de)),ee=Math.floor((u-Z)/($+de));if(ne>=0&&ne<Q&&ee>=0){const be=k+ee*Q+ne;be<=Ae&&be<=Te&&r(be)}}else if(e==="game"){const C=x/1200;if(g.goals.every(z=>z.current>=z.target)&&!g.isAnimating&&!g.isGameOver){const z=x/2-100*C,G=oe/2+80*C,F=200*C,w=50*C;if(P>=z&&P<=z+F&&u>=G&&u<=G+w){if(r){const I=s+1;r(I)}Se.playClick();return}return}if(g.isGameOver){const z=x/2-100*C,G=oe/2+100*C,F=200*C,w=50*C;if(P>=z&&P<=z+F&&u>=G&&u<=G+w){r&&r(s),Se.playClick();return}return}if(g.isPaused){st(),Se.playClick();return}const M=120,ge=40,Y=20*C,Ce=10*C,pe=M*C,q=ge*C,re=M*C,ye=ge*C,je=x-pe-Y,Oe=Y,Pe=je-re-Ce,Ie=Y;if(P>=Pe&&P<=Pe+re&&u>=Ie&&u<=Ie+ye){st(),Se.playClick();return}if(P>=je&&P<=je+pe&&u>=Oe&&u<=Oe+q){if(he)ue(!1),p.current=null;else{const z=wt(g.board);z&&(p.current=z,ue(!0),setTimeout(()=>{ue(!1),p.current=null},3e3))}Se.playClick();return}if(g.isPaused)return;const ae=(ce.cellSize||70)*C,Le=ce.gridCols||9,Ue=ce.gridRows||9,Re=ae*Le,We=ae*Ue,$e=(x-Re)/2,Xe=(oe-We)/2,Be=Math.floor((P-$e)/ae),R=Math.floor((u-Xe)/ae);Be>=0&&Be<Le&&R>=0&&R<Ue&&g.board[R]&&g.board[R][Be]&&(g.selectedGem?Qe(g.selectedGem,{row:R,col:Be}):Ke(R,Be),Se.playClick())}}},[e,r,Ae,ce,g,Ke,Qe,he,st,L,H]),ut=m.useCallback(t=>{const S=n.current;if(!S||e!=="game"||g.isPaused)return;const B=S.getBoundingClientRect(),P=t.clientX-B.left,u=t.clientY-B.top,K=window.devicePixelRatio||1,x=S.width/K,oe=S.height/K,_e=x/1200,Te=(ce.cellSize||50)*_e,M=ce.gridCols||9,ge=ce.gridRows||9,Y=Te*M,Ce=Te*ge,pe=(x-Y)/2,q=(oe-Ce)/2,re=Math.floor((P-pe)/Te),ye=Math.floor((u-q)/Te);re>=0&&re<M&&ye>=0&&ye<ge&&g.board[ye]&&g.board[ye][re]&&(X.current={row:ye,col:re},ie.current={x:P,y:u},J.current=!0)},[e,ce,g.board,g.isPaused]),ft=m.useCallback(t=>{const S=n.current;if(!S||e!=="game"||g.isPaused||!J.current||!X.current||!ie.current)return;const B=S.getBoundingClientRect(),P=t.clientX-B.left,u=t.clientY-B.top,K=window.devicePixelRatio||1,Ge=S.width/K/1200,_e=ce.gridCols||9,C=ce.gridRows||9,Te=ie.current,M=P-Te.x,ge=u-Te.y,Y=Math.sqrt(M*M+ge*ge),Ce=10*Ge;if(Y<Ce){N.current={x:P,y:u},W.current=null;return}const pe=X.current;let q={row:pe.row,col:pe.col};if(Math.abs(M)>Math.abs(ge)?M>0?q.col+=1:q.col-=1:ge>0?q.row+=1:q.row-=1,q.col<0||q.col>=_e||q.row<0||q.row>=C){J.current=!1,X.current=null,ie.current=null,W.current=null,N.current=null;return}N.current={x:P,y:u},W.current=q},[e,ce,g.isPaused]),Ze=m.useCallback(()=>{if(J.current&&X.current&&W.current){const t=X.current,S=W.current,B=Math.abs(t.row-S.row),P=Math.abs(t.col-S.col);(B===1&&P===0||B===0&&P===1)&&(Qe(t,S),Se.playClick(),te.current=!0)}J.current=!1,X.current=null,ie.current=null,W.current=null,N.current=null},[Qe]);m.useEffect(()=>{const t=n.current;if(t)return t.addEventListener("click",dt),()=>{t.removeEventListener("click",dt)}},[dt]),m.useEffect(()=>{const t=n.current;if(t)return t.addEventListener("pointerdown",ut),t.addEventListener("pointermove",ft),t.addEventListener("pointerup",Ze),t.addEventListener("pointerleave",Ze),t.addEventListener("pointercancel",Ze),()=>{t.removeEventListener("pointerdown",ut),t.removeEventListener("pointermove",ft),t.removeEventListener("pointerup",Ze),t.removeEventListener("pointerleave",Ze),t.removeEventListener("pointercancel",Ze)}},[ut,ft,Ze]);const ht=m.useCallback(t=>{if(e!=="game"||g.isPaused||g.isAnimating)return;const S=ce.gridRows||9,B=ce.gridCols||9;if(!A){ve({row:0,col:0});return}let P=A.row,u=A.col;switch(t.key){case"ArrowUp":t.preventDefault(),P=Math.max(0,A.row-1),ve({row:P,col:A.col});break;case"ArrowDown":t.preventDefault(),P=Math.min(S-1,A.row+1),ve({row:P,col:A.col});break;case"ArrowLeft":t.preventDefault(),u=Math.max(0,A.col-1),ve({row:A.row,col:u});break;case"ArrowRight":t.preventDefault(),u=Math.min(B-1,A.col+1),ve({row:A.row,col:u});break;case" ":case"Enter":t.preventDefault(),g.board[A.row]&&g.board[A.row][A.col]&&Ke(A.row,A.col);break;case"Escape":t.preventDefault(),st();break;case"h":case"H":if(t.preventDefault(),he)ue(!1),p.current=null;else{const K=wt(g.board);K&&(p.current=K,ue(!0),setTimeout(()=>{ue(!1),p.current=null},3e3))}break}},[e,g.isPaused,g.isAnimating,g.board,A,ce.gridRows,ce.gridCols,Ke,st,he]);return m.useEffect(()=>{const t=n.current;if(t)return t.addEventListener("keydown",ht),()=>{t.removeEventListener("keydown",ht)}},[ht]),m.useEffect(()=>{e!=="game"&&ve(null)},[e,g.board]),m.useEffect(()=>{typeof window!="undefined"&&Fe.remove("chipPuzzleGame_orientationPreference",{silent:!0})},[]),f.jsx("div",{className:"game-board",children:f.jsx(jo,{config:ce,onReady:to,onResize:oo})})},ir=({title:s,description:e,keywords:o,image:r,type:a="website",url:n="https://chipgames.github.io/ChipPuzzleGame/",noindex:l=!1})=>{const{language:c}=Je(),{t:i}=Je(),d=typeof window!="undefined"?window.location.pathname+window.location.search:"",h=d.includes("screen=guide")||n.includes("screen=guide"),b=d.includes("screen=help")||n.includes("screen=help"),p=d.includes("screen=about")||n.includes("screen=about");let y,T,D;h?(y=i("seo.guideTitle")||i("seo.title"),T=i("seo.guideDescription")||i("seo.description"),D=i("seo.guideKeywords")||i("seo.keywords")):b?(y=i("seo.helpTitle")||i("seo.title"),T=i("seo.helpDescription")||i("seo.description"),D=i("seo.helpKeywords")||i("seo.keywords")):p?(y=i("seo.aboutTitle")||i("seo.title"),T=i("seo.aboutDescription")||i("seo.description"),D=i("seo.aboutKeywords")||i("seo.keywords")):(y=i("seo.title")||"Îß§Ïπ≠ ÌçºÏ¶ê Í≤åÏûÑ - CHIP GAMES",T=i("seo.description")||"Î¨¥Î£å Ïò®ÎùºÏù∏ Îß§Ïπ≠ ÌçºÏ¶ê Í≤åÏûÑ. 1000Í∞úÏùò ÎèÑÏ†ÑÏ†ÅÏù∏ Ïä§ÌÖåÏù¥ÏßÄÎ•º ÌîåÎ†àÏù¥ÌïòÏÑ∏Ïöî! Îã§ÏñëÌïú ÏÉâÏÉÅÏùò Ï†¨ÏùÑ Îß§Ïπ≠ÌïòÏó¨ Î™©ÌëúÎ•º Îã¨ÏÑ±ÌïòÎäî Ïû¨ÎØ∏ÏûàÎäî ÌçºÏ¶ê Í≤åÏûÑÏûÖÎãàÎã§.",D=i("seo.keywords")||"Îß§Ïπ≠Í≤åÏûÑ, ÌçºÏ¶êÍ≤åÏûÑ, Î¨¥Î£åÍ≤åÏûÑ, Ïò®ÎùºÏù∏Í≤åÏûÑ, ÌçºÏ¶ê, Îß§Ïπ≠3, Ï∫îÎîîÌÅ¨Îü¨Ïãú, Í≤åÏûÑ, Î∏åÎùºÏö∞Ï†ÄÍ≤åÏûÑ, HTML5Í≤åÏûÑ");const E="https://chipgames.github.io/ChipPuzzleGame/",X=le=>`${E}${le}`,ie=X("ChipGames_Logo.png"),W=s||y,N=e||T,J=o||D,te=r||ie,fe=c!=="ko"?`?lang=${c}`:"",Ee={"@context":"https://schema.org","@type":"Organization",name:"CHIP GAMES",url:"https://chipgames.github.io",logo:X("ChipGames_Logo.png"),sameAs:[]},he={"@context":"https://schema.org","@type":"VideoGame",name:W,description:N,image:te,url:n,applicationCategory:"Game",operatingSystem:"Web Browser",gamePlatform:"Web Browser",offers:{"@type":"Offer",price:"0",priceCurrency:"KRW"},aggregateRating:{"@type":"AggregateRating",ratingValue:"4.5",ratingCount:"100",bestRating:"5",worstRating:"1"},publisher:{"@type":"Organization",name:"CHIP GAMES",url:"https://chipgames.github.io"},genre:"Puzzle Game",gameItem:{"@type":"Thing",name:"Match Puzzle Game",description:"Match colorful gems to complete challenging stages"},inLanguage:c||"ko",datePublished:"2025-01-01",dateModified:new Date().toISOString().split("T")[0]},ue=[{"@type":"ListItem",position:1,name:c==="ko"?"Ìôà":c==="en"?"Home":c==="ja"?"„Éõ„Éº„É†":"È¶ñÈ°µ",item:`${E}${fe}`}];h?ue.push({"@type":"ListItem",position:2,name:i("guide.title")||"Í≤åÏûÑ Í∞ÄÏù¥Îìú",item:`${E}?screen=guide${fe}`}):b?ue.push({"@type":"ListItem",position:2,name:i("help.title")||"ÎèÑÏõÄÎßê",item:`${E}?screen=help${fe}`}):p&&ue.push({"@type":"ListItem",position:2,name:i("about.title")||"Í≤åÏûÑ ÏÜåÍ∞ú",item:`${E}?screen=about${fe}`});const H={"@context":"https://schema.org","@type":"BreadcrumbList",itemListElement:ue},Ae=b?{"@context":"https://schema.org","@type":"FAQPage",mainEntity:[{"@type":"Question",name:i("help.section7Title")||"ÏûêÏ£º Î¨ªÎäî ÏßàÎ¨∏",acceptedAnswer:{"@type":"Answer",text:i("help.section7Content")||""}}]}:null,L=[Ee,{"@context":"https://schema.org","@type":"WebSite",name:"CHIP GAMES - Match Puzzle Game",url:E,publisher:{"@type":"Organization",name:"CHIP GAMES"},inLanguage:[c||"ko","en","ja","zh"]}];return!h&&!b&&!p&&L.push(he),L.push(H),Ae&&L.push(Ae),f.jsxs(co,{children:[f.jsx("title",{children:W}),f.jsx("meta",{name:"description",content:N}),f.jsx("meta",{name:"keywords",content:J}),f.jsx("meta",{name:"theme-color",content:"#667eea"}),f.jsx("meta",{name:"msapplication-TileColor",content:"#667eea"}),l&&f.jsx("meta",{name:"robots",content:"noindex, nofollow"}),f.jsx("link",{rel:"canonical",href:n}),f.jsx("meta",{property:"og:title",content:W}),f.jsx("meta",{property:"og:description",content:N}),f.jsx("meta",{property:"og:image",content:te}),f.jsx("meta",{property:"og:image:secure_url",content:te}),f.jsx("meta",{property:"og:image:width",content:"1200"}),f.jsx("meta",{property:"og:image:height",content:"630"}),f.jsx("meta",{property:"og:image:alt",content:W}),f.jsx("meta",{property:"og:image:type",content:"image/png"}),f.jsx("meta",{property:"og:type",content:a}),f.jsx("meta",{property:"og:url",content:n}),f.jsx("meta",{property:"og:site_name",content:"CHIP GAMES"}),f.jsx("meta",{property:"og:locale",content:c==="ko"?"ko_KR":c==="en"?"en_US":c==="ja"?"ja_JP":"zh_CN"}),f.jsx("meta",{property:"og:updated_time",content:new Date().toISOString()}),f.jsx("meta",{name:"twitter:card",content:"summary_large_image"}),f.jsx("meta",{name:"twitter:title",content:W}),f.jsx("meta",{name:"twitter:description",content:N}),f.jsx("meta",{name:"twitter:image",content:te}),f.jsx("meta",{name:"twitter:image:alt",content:W}),f.jsx("meta",{name:"twitter:site",content:"@CHIPGAMES"}),f.jsx("meta",{name:"twitter:creator",content:"@CHIPGAMES"}),f.jsx("link",{rel:"alternate",hrefLang:"ko",href:`${n}?lang=ko`}),f.jsx("link",{rel:"alternate",hrefLang:"en",href:`${n}?lang=en`}),f.jsx("link",{rel:"alternate",hrefLang:"ja",href:`${n}?lang=ja`}),f.jsx("link",{rel:"alternate",hrefLang:"zh",href:`${n}?lang=zh`}),f.jsx("link",{rel:"alternate",hrefLang:"x-default",href:n}),f.jsx("meta",{httpEquiv:"Content-Security-Policy",content:"default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://pagead2.googlesyndication.com https://fundingchoicesmessages.google.com https://*.googlesyndication.com https://*.google.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; img-src 'self' data: https:; font-src 'self' data: https://fonts.gstatic.com; connect-src 'self' https://pagead2.googlesyndication.com https://*.googlesyndication.com https://*.google.com https://ep1.adtrafficquality.google https://ep2.adtrafficquality.google https://googleads.g.doubleclick.net; frame-src 'self' https://googleads.g.doubleclick.net https://tpc.googlesyndication.com; object-src 'none'; base-uri 'self'; form-action 'self';"}),L.map((le,A)=>f.jsx("script",{type:"application/ld+json",children:JSON.stringify(le)},A))]})};function vt(){try{}catch(s){}return window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"||window.location.hostname.includes("localhost")}function Zt(){window.adsbygoogle&&Array.isArray(window.adsbygoogle)||(window.adsbygoogle=window.adsbygoogle||[])}function lr(){return!(window.adsbygoogle&&Array.isArray(window.adsbygoogle)&&window.adsbygoogle.some(s=>s.enable_page_level_ads))}function Dt(){document.querySelectorAll('iframe[src*="googlesyndication.com"], iframe[src*="doubleclick.net"]').forEach(e=>{try{const o=e;if(o.contentDocument){const r=o.contentDocument.body;r&&r.getAttribute("aria-hidden")==="true"&&r.removeAttribute("aria-hidden")}}catch(o){}})}let tt=!1;function cr(){if(!vt()&&!tt){if(Zt(),window.adsbygoogle&&Array.isArray(window.adsbygoogle)&&window.adsbygoogle.some(e=>e.enable_page_level_ads===!0)){tt=!0;return}if(!lr()){tt=!0;return}try{window.adsbygoogle&&Array.isArray(window.adsbygoogle)&&(window.adsbygoogle.some(e=>e.enable_page_level_ads===!0)||window.adsbygoogle.push({google_ad_client:"ca-pub-2533613198240039",enable_page_level_ads:!0}),tt=!0)}catch(s){vt(),tt=!0}}}function dr(){if(vt())return;setTimeout(Dt,2e3),new MutationObserver(e=>{e.forEach(o=>{o.type==="childList"&&o.addedNodes.forEach(r=>{r.nodeType===1&&r.tagName==="IFRAME"&&setTimeout(Dt,1e3)})})}).observe(document.body,{childList:!0,subtree:!0})}function rt(){try{}catch(s){}return window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"||window.location.hostname.includes("localhost")}function ur(s){if(!(typeof window=="undefined"||!("PerformanceObserver"in window)))try{const e=new PerformanceObserver(o=>{const r=o.getEntries(),a=r[r.length-1];if(a){const n=a.renderTime||a.loadTime||0,l=n<2500?"good":n<4e3?"needs-improvement":"poor";s({name:"LCP",value:n,id:`lcp-${Date.now()}`,delta:n,rating:l,timestamp:performance.now(),entries:[a]}),e.disconnect()}});e.observe({entryTypes:["largest-contentful-paint"]})}catch(e){rt()&&v.warn("LCP measurement failed",{error:e})}}function fr(s){if(!(typeof window=="undefined"||!("PerformanceObserver"in window)))try{const e=new PerformanceObserver(o=>{const a=o.getEntries()[0];if(a){const n=a.processingStart-a.startTime,l=n<100?"good":n<300?"needs-improvement":"poor";s({name:"FID",value:n,id:`fid-${Date.now()}`,delta:n,rating:l,timestamp:performance.now(),entries:[a]}),e.disconnect()}});e.observe({entryTypes:["first-input"]})}catch(e){rt()&&v.warn("FID measurement failed",{error:e})}}function hr(s){if(!(typeof window=="undefined"||!("PerformanceObserver"in window)))try{let e=0;new PerformanceObserver(a=>{const n=a.getEntries();for(const l of n)l.hadRecentInput||(e+=l.value);if(n.length>0){const l=e<.1?"good":e<.25?"needs-improvement":"poor";s({name:"CLS",value:e,id:`cls-${Date.now()}`,delta:e,rating:l,timestamp:performance.now(),entries:n})}}).observe({entryTypes:["layout-shift"]});const r=()=>{if(document.visibilityState==="hidden"){const a=e<.1?"good":e<.25?"needs-improvement":"poor";s({name:"CLS",value:e,id:`cls-final-${Date.now()}`,delta:e,rating:a,timestamp:performance.now()})}};document.addEventListener("visibilitychange",r)}catch(e){rt()&&v.warn("CLS measurement failed",{error:e})}}function gr(s){if(!(typeof window=="undefined"||!("PerformanceObserver"in window)))try{const e=new PerformanceObserver(o=>{const a=o.getEntries()[0];if(a){const n=a.startTime,l=n<1800?"good":n<3e3?"needs-improvement":"poor";s({name:"FCP",value:n,id:`fcp-${Date.now()}`,delta:n,rating:l,timestamp:performance.now(),entries:[a]}),e.disconnect()}});e.observe({entryTypes:["paint"]})}catch(e){rt()&&v.warn("FCP measurement failed",{error:e})}}function mr(s){if(!(typeof window=="undefined"||!("performance"in window)))try{const e=performance.getEntriesByType("navigation")[0];if(e){const o=e.responseStart-e.requestStart,r=o<800?"good":o<1800?"needs-improvement":"poor";s({name:"TTFB",value:o,id:`ttfb-${Date.now()}`,delta:o,rating:r,timestamp:performance.now(),entries:[e]})}}catch(e){rt()&&v.warn("TTFB measurement failed",{error:e})}}function pr(s){typeof window!="undefined"&&(ur(s),fr(s),hr(s),gr(s),mr(s))}function yr(s){Ct.addWebVital(s),rt()?v.info(`Web Vital: ${s.name}`,{value:s.value,rating:s.rating,id:s.id,timestamp:s.timestamp}):s.rating==="poor"&&v.warn(`Poor Web Vital: ${s.name}`,{value:s.value,rating:s.rating,id:s.id})}function br(){try{}catch(s){}return window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"||window.location.hostname.includes("localhost")}function wr(){if(typeof window=="undefined"||!("serviceWorker"in navigator)){br()&&v.warn("Service Worker is not supported in this browser");return}const s="sw_reloading";if(sessionStorage.getItem(s)==="true"){sessionStorage.removeItem(s);return}const o=()=>{sessionStorage.getItem(s)!=="true"&&(v.info("Service Worker controller changed"),sessionStorage.setItem(s,"true"),setTimeout(()=>{window.location.reload()},100))};navigator.serviceWorker.__controllerChangeListenerAdded||(navigator.serviceWorker.addEventListener("controllerchange",o),navigator.serviceWorker.__controllerChangeListenerAdded=!0),window.addEventListener("load",()=>{const r="/ChipPuzzleGame/sw.js";navigator.serviceWorker.register(r,{scope:"/ChipPuzzleGame/",updateViaCache:"none"}).then(a=>{v.info("Service Worker registered successfully",{scope:a.scope}),setInterval(()=>{a.update()},60*60*1e3),a.addEventListener("updatefound",()=>{const n=a.installing;n&&n.addEventListener("statechange",()=>{n.state==="installed"&&(navigator.serviceWorker.controller?(v.info("New Service Worker version available"),n.postMessage({type:"SKIP_WAITING"}),sessionStorage.getItem(s)!=="true"&&(sessionStorage.setItem(s,"true"),setTimeout(()=>{window.location.reload()},100))):v.info("Service Worker installed for the first time"))})}),navigator.serviceWorker.controller&&a.update()}).catch(a=>{v.error("Service Worker registration failed",{error:a})})})}const Sr=m.lazy(()=>He(()=>import("./GuideScreen-1.1.0-6d0d4ceb.js"),["assets/GuideScreen-1.1.0-6d0d4ceb.js","assets/vendor-1.1.0-1f763956.js","assets/helmet-1.1.0-341783ac.js","assets/GuideScreen-1.1.0-b085d6a8.css"])),vr=m.lazy(()=>He(()=>import("./HelpScreen-1.1.0-6a886a2e.js"),["assets/HelpScreen-1.1.0-6a886a2e.js","assets/vendor-1.1.0-1f763956.js","assets/helmet-1.1.0-341783ac.js","assets/HelpScreen-1.1.0-b668f973.css"])),Cr=m.lazy(()=>He(()=>import("./AboutScreen-1.1.0-8e6c6064.js"),["assets/AboutScreen-1.1.0-8e6c6064.js","assets/vendor-1.1.0-1f763956.js","assets/helmet-1.1.0-341783ac.js","assets/AboutScreen-1.1.0-d4e85bc6.css"])),Pr=()=>{const[s,e]=m.useState("stageSelect"),[o,r]=m.useState(null);Yt(),m.useEffect(()=>{let c=!1;try{c=!1}catch(i){}c||(c=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"||window.location.hostname.includes("localhost")),c||(Zt(),cr(),dr())},[]),m.useEffect(()=>{pr(yr);const c=()=>{He(()=>Promise.resolve().then(()=>sr),void 0).then(({performanceAnalytics:i})=>{i.logReport()})};return window.addEventListener("beforeunload",c),()=>{window.removeEventListener("beforeunload",c)}},[]),m.useEffect(()=>{wr()},[]);const a=c=>{e(c)},n=c=>{r(c),e("game")},l=()=>{const c="https://chipgames.github.io/ChipPuzzleGame/",i=new URLSearchParams(window.location.search).get("lang")||"ko",d=i!=="ko"?`?lang=${i}`:"";switch(s){case"guide":return{title:void 0,description:void 0,keywords:void 0,url:`${c}?screen=guide${d}`,type:"article"};case"help":return{title:void 0,description:void 0,keywords:void 0,url:`${c}?screen=help${d}`,type:"article"};case"about":return{title:void 0,description:void 0,keywords:void 0,url:`${c}?screen=about${d}`,type:"article"};default:return{title:void 0,description:void 0,keywords:void 0,url:`${c}${d}`,type:"website"}}};return f.jsxs(vo,{children:[f.jsx(ir,me({},l())),f.jsxs("div",{className:"app-container",children:[f.jsx(Jt,{onNavigate:a,currentScreen:s}),f.jsx(Go,{children:s==="guide"?f.jsx(m.Suspense,{fallback:f.jsx("div",{style:{padding:"20px",textAlign:"center"},children:"Î°úÎî© Ï§ë..."}),children:f.jsx(Sr,{onNavigate:a})}):s==="help"?f.jsx(m.Suspense,{fallback:f.jsx("div",{style:{padding:"20px",textAlign:"center"},children:"Î°úÎî© Ï§ë..."}),children:f.jsx(vr,{onNavigate:a})}):s==="about"?f.jsx(m.Suspense,{fallback:f.jsx("div",{style:{padding:"20px",textAlign:"center"},children:"Î°úÎî© Ï§ë..."}),children:f.jsx(Cr,{onNavigate:a})}):f.jsx(ar,{stageNumber:o||1,currentScreen:s,onNavigate:a,onStartStage:n})}),f.jsx(Kt,{})]})]})};St.createRoot(document.getElementById("root")).render(f.jsx(Ft.StrictMode,{children:f.jsx(uo,{children:f.jsx(Pr,{})})}));export{f as j,Je as u};
