var wt=Object.defineProperty,vt=Object.defineProperties;var Ct=Object.getOwnPropertyDescriptors;var Je=Object.getOwnPropertySymbols;var xt=Object.prototype.hasOwnProperty,jt=Object.prototype.propertyIsEnumerable;var We=(n,e,o)=>e in n?wt(n,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[e]=o,le=(n,e)=>{for(var o in e||(e={}))xt.call(e,o)&&We(n,o,e[o]);if(Je)for(var o of Je(e))jt.call(e,o)&&We(n,o,e[o]);return n},Me=(n,e)=>vt(n,Ct(e));var Mt=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports);var Y=(n,e,o)=>(We(n,typeof e!="symbol"?e+"":e,o),o);var Ke=(n,e,o)=>new Promise((s,a)=>{var i=l=>{try{c(o.next(l))}catch(h){a(h)}},d=l=>{try{c(o.throw(l))}catch(h){a(h)}},c=l=>l.done?s(l.value):Promise.resolve(l.value).then(i,d);c((o=o.apply(n,e)).next())});import{r as S,a as kt,R as Rt}from"./vendor-1.1.0-ffc9ac40.js";import{W as Tt,q as Pt}from"./helmet-1.1.0-cc225321.js";var No=Mt(mt=>{(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const d of i.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&s(d)}).observe(document,{childList:!0,subtree:!0});function o(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(a){if(a.ep)return;a.ep=!0;const i=o(a);fetch(a.href,i)}})();var dt={exports:{}},He={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Gt=S,Nt=Symbol.for("react.element"),Et=Symbol.for("react.fragment"),At=Object.prototype.hasOwnProperty,Lt=Gt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Bt={key:!0,ref:!0,__self:!0,__source:!0};function ht(n,e,o){var s,a={},i=null,d=null;o!==void 0&&(i=""+o),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(d=e.ref);for(s in e)At.call(e,s)&&!Bt.hasOwnProperty(s)&&(a[s]=e[s]);if(n&&n.defaultProps)for(s in e=n.defaultProps,e)a[s]===void 0&&(a[s]=e[s]);return{$$typeof:Nt,type:n,key:i,ref:d,props:a,_owner:Lt.current}}He.Fragment=Et;He.jsx=ht;He.jsxs=ht;dt.exports=He;var r=dt.exports,Ue={},Qe=kt;Ue.createRoot=Qe.createRoot,Ue.hydrateRoot=Qe.hydrateRoot;class zt{constructor(){Y(this,"isDevelopment",!1);Y(this,"logHistory",[]);Y(this,"maxHistorySize",100)}createLogEntry(e,o,s){return{level:e,message:o,data:s,timestamp:new Date().toISOString(),userAgent:typeof navigator!="undefined"?navigator.userAgent:void 0,url:typeof window!="undefined"?window.location.href:void 0}}addToHistory(e){this.logHistory.push(e),this.logHistory.length>this.maxHistorySize&&this.logHistory.shift()}log(e,o,s){const a=this.createLogEntry(e,o,s);if(this.addToHistory(a),this.isDevelopment){const i=console[e]||console.log;s?i(`[${e.toUpperCase()}] ${o}`,s):i(`[${e.toUpperCase()}] ${o}`)}else(e==="error"||e==="warn")&&(s?console[e](`[${e.toUpperCase()}] ${o}`,s):console[e](`[${e.toUpperCase()}] ${o}`));e==="error"&&this.handleError(a)}handleError(e){try{const o=JSON.parse(localStorage.getItem("chipPuzzleGame_errorLogs")||"[]");o.push(e),o.length>50&&o.shift(),localStorage.setItem("chipPuzzleGame_errorLogs",JSON.stringify(o))}catch(o){console.warn("Failed to save error log to localStorage",o)}}debug(e,o){this.log("debug",e,o)}info(e,o){this.log("info",e,o)}warn(e,o){this.log("warn",e,o)}error(e,o){this.log("error",e,o)}getHistory(){return[...this.logHistory]}clearHistory(){this.logHistory=[]}getErrorLogs(){try{return JSON.parse(localStorage.getItem("chipPuzzleGame_errorLogs")||"[]")}catch(e){return[]}}clearErrorLogs(){try{localStorage.removeItem("chipPuzzleGame_errorLogs")}catch(e){}}}const $=new zt;class Ot extends S.Component{constructor(){super(...arguments);Y(this,"state",{hasError:!1,error:null,errorInfo:null});Y(this,"handleReload",()=>{window.location.reload()});Y(this,"handleReset",()=>{this.setState({hasError:!1,error:null,errorInfo:null})})}static getDerivedStateFromError(o){return{hasError:!0,error:o}}componentDidCatch(o,s){$.error("ErrorBoundary caught an error",{error:{message:o.message,stack:o.stack,name:o.name},errorInfo:{componentStack:s.componentStack},timestamp:new Date().toISOString()}),this.setState({errorInfo:s})}render(){return this.state.hasError?this.props.fallback?this.props.fallback:r.jsx("div",{className:"error-boundary",role:"alert","aria-live":"assertive",children:r.jsxs("div",{className:"error-boundary-content",children:[r.jsx("div",{className:"error-boundary-icon",children:"âš ï¸"}),r.jsx("h2",{className:"error-boundary-title",children:this.getLocalizedText("error.title")}),r.jsx("p",{className:"error-boundary-message",children:this.getLocalizedText("error.message")}),!1,r.jsxs("div",{className:"error-boundary-actions",children:[r.jsx("button",{className:"error-boundary-button error-boundary-button-primary",onClick:this.handleReload,"aria-label":this.getLocalizedText("error.reload"),children:this.getLocalizedText("error.reload")}),!1]})]})}):this.props.children}getLocalizedText(o){var i;let s="ko";try{s=localStorage.getItem("language")||"ko"}catch(d){}const a={ko:{"error.title":"ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤","error.message":"ê²Œìž„ì„ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.","error.details":"ì—ëŸ¬ ìƒì„¸ ì •ë³´","error.reload":"ìƒˆë¡œê³ ì¹¨","error.reset":"ë‹¤ì‹œ ì‹œë„"},en:{"error.title":"An Error Occurred","error.message":"Please refresh the game.","error.details":"Error Details","error.reload":"Reload","error.reset":"Try Again"},zh:{"error.title":"å‘ç”Ÿé”™è¯¯","error.message":"è¯·åˆ·æ–°æ¸¸æˆã€‚","error.details":"é”™è¯¯è¯¦æƒ…","error.reload":"é‡æ–°åŠ è½½","error.reset":"é‡è¯•"},ja:{"error.title":"ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ","error.message":"ã‚²ãƒ¼ãƒ ã‚’ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã—ã¦ãã ã•ã„ã€‚","error.details":"ã‚¨ãƒ©ãƒ¼è©³ç´°","error.reload":"ãƒªãƒ­ãƒ¼ãƒ‰","error.reset":"å†è©¦è¡Œ"}};return((i=a[s])==null?void 0:i[o])||a.ko[o]||o}}const $t="modulepreload",_t=function(n){return"/ChipPuzzleGame/"+n},Ze={},$e=function(e,o,s){if(!o||o.length===0)return e();const a=document.getElementsByTagName("link");return Promise.all(o.map(i=>{if(i=_t(i),i in Ze)return;Ze[i]=!0;const d=i.endsWith(".css"),c=d?'[rel="stylesheet"]':"";if(!!s)for(let f=a.length-1;f>=0;f--){const m=a[f];if(m.href===i&&(!d||m.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${c}`))return;const h=document.createElement("link");if(h.rel=d?"stylesheet":$t,d||(h.as="script",h.crossOrigin=""),h.href=i,document.head.appendChild(h),d)return new Promise((f,m)=>{h.addEventListener("load",f),h.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>e()).catch(i=>{const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=i,window.dispatchEvent(d),!d.defaultPrevented)throw i})},Ht=(n,e)=>{const o=n[e];return o?typeof o=="function"?o():Promise.resolve(o):new Promise((s,a)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(a.bind(null,new Error("Unknown variable dynamic import: "+e)))})},ut=["en","ko","zh","ja"],It="en",Ft={en:"English",ko:"í•œêµ­ì–´",zh:"ä¸­æ–‡",ja:"æ—¥æœ¬èªž"};class et{constructor(){Y(this,"supportedLanguages",ut);Y(this,"defaultLanguage",It)}detectBrowserLanguage(){const e=navigator.language.split("-")[0];return this.supportedLanguages.includes(e)?e:this.defaultLanguage}getStoredLanguage(){try{return localStorage.getItem("language")}catch(e){return $.error("Failed to get stored language",{error:e}),null}}setLanguage(e){if(this.supportedLanguages.includes(e))try{localStorage.setItem("language",e),window.dispatchEvent(new CustomEvent("languageChanged",{detail:e})),$.debug("Language changed",{language:e})}catch(o){$.error("Failed to set language",{error:o,language:e})}}getCurrentLanguage(){const e=this.getStoredLanguage();return e&&this.supportedLanguages.includes(e)?e:this.detectBrowserLanguage()}}const Ye={},Re=()=>{const[n,e]=S.useState(()=>new et().getCurrentLanguage()),[o,s]=S.useState(null),[a,i]=S.useState(!0);return S.useEffect(()=>{(()=>Ke(mt,null,function*(){i(!0);try{if(Ye[n]){s(Ye[n]),i(!1);return}const f=yield Ht(Object.assign({"../locales/en.json":()=>$e(()=>import("./en-1.1.0-991e74d8.js"),[]),"../locales/ja.json":()=>$e(()=>import("./ja-1.1.0-d5e5a6ac.js"),[]),"../locales/ko.json":()=>$e(()=>import("./ko-1.1.0-f422ff4f.js"),[]),"../locales/zh.json":()=>$e(()=>import("./zh-1.1.0-1d50f136.js"),[])}),`../locales/${n}.json`);Ye[n]=f.default,s(f.default),$.debug("Translations loaded",{language:n})}catch(f){$.error("Failed to load translations",{language:n,error:f});try{const m=yield $e(()=>import("./en-1.1.0-991e74d8.js"),[]);s(m.default),$.info("Fallback translations loaded",{language:"en"})}catch(m){$.error("Failed to load fallback translations",{error:m})}}finally{i(!1)}}))();const h=f=>{e(f.detail)};return window.addEventListener("languageChanged",h),()=>{window.removeEventListener("languageChanged",h)}},[n]),{language:n,setLanguage:l=>{new et().setLanguage(l)},t:l=>{if(a||!o)return l;const h=l.split(".");let f=o;for(const m of h)if(f=f==null?void 0:f[m],f===void 0)break;return f||l},isLoading:a}},ft=()=>{const{language:n,setLanguage:e}=Re();return r.jsx("select",{value:n,onChange:o=>e(o.target.value),className:"language-selector","aria-label":"Language selector",children:ut.map(o=>r.jsx("option",{value:o,children:Ft[o]},o))})};class Dt{constructor(){Y(this,"audioCtx",null);Y(this,"enabled",!0)}getContext(){if(!this.enabled)return null;try{if(!this.audioCtx){const e=window.AudioContext||window.webkitAudioContext;if(!e)return $.warn("Web Audio API is not supported in this browser"),this.enabled=!1,null;try{this.audioCtx=new e,this.audioCtx.state==="suspended"&&this.audioCtx.resume().catch(o=>{$.warn("Failed to resume AudioContext",{error:o})})}catch(o){return $.warn("Failed to create AudioContext",{error:o}),this.enabled=!1,null}}return this.audioCtx}catch(e){return $.warn("Failed to initialize AudioContext",{error:e}),this.enabled=!1,null}}setEnabled(e){this.enabled=e}playTone(e,o,s="sine",a=.2){const i=this.getContext();if(!i)return;const d=i.createOscillator(),c=i.createGain();d.type=s,d.frequency.value=e,c.gain.value=a,d.connect(c),c.connect(i.destination);const l=i.currentTime;d.start(l),d.stop(l+o),c.gain.setValueAtTime(a,l),c.gain.linearRampToValueAtTime(0,l+o)}playClick(){this.playTone(440,.08,"square",.15)}playMatch(){this.playTone(660,.12,"triangle",.2)}playSpecial(){this.playTone(880,.16,"sawtooth",.22)}playStageClear(){this.getContext()&&(this.playTone(880,.15,"triangle",.22),setTimeout(()=>{this.playTone(1046.5,.18,"triangle",.22)},120))}playGameOver(){const e=this.getContext();if(!e)return;const o=440,s=220,a=.4,i=e.createOscillator(),d=e.createGain();i.type="sawtooth",i.frequency.setValueAtTime(o,e.currentTime),i.frequency.exponentialRampToValueAtTime(s,e.currentTime+a),d.gain.value=.22,d.gain.setValueAtTime(.22,e.currentTime),d.gain.linearRampToValueAtTime(0,e.currentTime+a),i.connect(d),d.connect(e.destination),i.start(e.currentTime),i.stop(e.currentTime+a)}}const ce=new Dt;class Wt{isAvailable(){try{const e="__storage_test__";return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return!1}}get(e,o={}){var s,a,i,d;if(!this.isAvailable())return o.silent||$.warn("LocalStorage is not available",{key:e}),(s=o.fallback)!=null?s:null;try{const c=localStorage.getItem(e);if(c===null)return(a=o.fallback)!=null?a:null;try{return JSON.parse(c)}catch(l){return typeof c=="string"&&c.startsWith('"')&&c.endsWith('"')?JSON.parse(c):typeof o.fallback=="string"?c:(localStorage.removeItem(e),o.silent||$.warn("Removed invalid storage data",{key:e,value:c}),(i=o.fallback)!=null?i:null)}}catch(c){return o.silent||$.error("Failed to get item from LocalStorage",{key:e,error:c}),(d=o.fallback)!=null?d:null}}set(e,o,s={}){if(!this.isAvailable())return s.silent||$.warn("LocalStorage is not available",{key:e}),!1;try{const a=JSON.stringify(o),i=5*1024*1024;return a.length>i?($.error("Storage size exceeds limit",{key:e,size:a.length,maxSize:i}),!1):(localStorage.setItem(e,a),!0)}catch(a){return $.error("Failed to set item to LocalStorage",{key:e,error:a}),!1}}remove(e,o={}){if(!this.isAvailable())return o.silent||$.warn("LocalStorage is not available",{key:e}),!1;try{return localStorage.removeItem(e),!0}catch(s){return $.error("Failed to remove item from LocalStorage",{key:e,error:s}),!1}}clearGameData(){if(!this.isAvailable())return!1;try{const o=Object.keys(localStorage).filter(s=>s.startsWith("chipPuzzleGame_"));return o.forEach(s=>localStorage.removeItem(s)),$.info("Game data cleared",{count:o.length}),!0}catch(e){return $.error("Failed to clear game data",{error:e}),!1}}available(){return this.isAvailable()}}const Be=new Wt,tt=n=>`/ChipPuzzleGame/${n}`,Yt=({onNavigate:n,currentScreen:e})=>{const{t:o}=Re(),[s,a]=S.useState(()=>{var m;return(m=Be.get("chipPuzzleGame_soundEnabled",{fallback:!0,silent:!0}))!=null?m:!0}),[i,d]=S.useState(!1);S.useEffect(()=>{ce.setEnabled(s),Be.set("chipPuzzleGame_soundEnabled",s,{silent:!0})},[s]),S.useEffect(()=>(i?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[i]),S.useEffect(()=>{const m=b=>{const y=b.target;i&&!y.closest(".header-nav")&&!y.closest(".header-hamburger")&&d(!1)};if(i)return document.addEventListener("click",m),()=>{document.removeEventListener("click",m)}},[i]);const c=m=>{n&&n(m),d(!1)},l=()=>{a(!s),s||ce.playClick()},h=()=>{d(!i),s&&ce.playClick()},f=!1;return r.jsx("header",{className:"header",children:r.jsxs("div",{className:"header-content",children:[r.jsxs("div",{className:"header-left",children:[f,r.jsxs("div",{className:"header-logo",onClick:()=>c("stageSelect"),style:{cursor:"pointer",display:"flex",alignItems:"center",gap:"12px"},children:[r.jsx("img",{src:tt("ChipGames_Logo.png"),onError:m=>{const b=m.target;b.src&&!b.src.includes(".svg")&&(b.src=tt("ChipGames_Logo.svg"))},alt:o("header.gameTitle")+" - CHIP GAMES ë¡œê³ ",style:{height:"40px",width:"auto"},loading:"eager",width:"120",height:"40"}),r.jsx("span",{className:"header-game-title",children:o("header.gameTitle")})]})]}),r.jsxs("nav",{className:`header-nav ${i?"mobile-open":""}`,children:[r.jsx("button",{className:"header-nav-button",onClick:()=>c("stageSelect"),children:o("header.playGame")}),r.jsx("button",{className:"header-nav-button",onClick:()=>c("guide"),children:o("header.guide")}),r.jsx("button",{className:"header-nav-button",onClick:()=>c("help"),children:o("header.help")}),r.jsx("button",{className:"header-nav-button",onClick:()=>c("about"),children:o("header.about")})]}),r.jsxs("div",{className:"header-right",children:[r.jsx("button",{className:"header-sound-button",onClick:l,title:o(s?"header.soundOff":"header.soundOn"),children:s?"ðŸ”Š":"ðŸ”‡"}),r.jsx(ft,{}),r.jsxs("button",{className:"header-hamburger",onClick:h,"aria-label":"ë©”ë‰´","aria-expanded":i,children:[r.jsx("span",{className:`hamburger-line ${i?"active":""}`}),r.jsx("span",{className:`hamburger-line ${i?"active":""}`}),r.jsx("span",{className:`hamburger-line ${i?"active":""}`})]})]})]})})},Ut="1.1.0",Xt=()=>{const{t:n}=Re(),[e,o]=S.useState(!1),[s,a]=S.useState(!1),i=l=>{l.preventDefault(),o(!0),ce.playClick(),$.info("Privacy policy modal opened")},d=l=>{l.preventDefault(),a(!0),ce.playClick(),$.info("Contact modal opened")},c=()=>{o(!1),a(!1),ce.playClick()};return S.useEffect(()=>{const l=h=>{h.key==="Escape"&&(e||s)&&c()};return(e||s)&&(document.addEventListener("keydown",l),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",l),document.body.style.overflow=""}},[e,s]),r.jsxs(r.Fragment,{children:[r.jsx("footer",{className:"footer",role:"contentinfo",children:r.jsxs("div",{className:"footer-content",children:[r.jsxs("nav",{className:"footer-links","aria-label":n("footer.navigation"),children:[r.jsx("a",{href:"#privacy",onClick:i,"aria-label":n("footer.privacyPolicy"),className:"footer-link",children:n("footer.privacyPolicy")}),r.jsx("a",{href:"#contact",onClick:d,"aria-label":n("footer.contactUs"),className:"footer-link",children:n("footer.contactUs")})]}),r.jsx("div",{className:"footer-center",children:r.jsx(ft,{})}),r.jsxs("div",{className:"footer-copyright","aria-label":n("footer.copyright"),children:[n("footer.copyright")," | v",Ut]})]})}),e&&r.jsx("div",{className:"footer-modal-overlay",onClick:c,role:"dialog","aria-modal":"true","aria-labelledby":"privacy-modal-title",children:r.jsxs("div",{className:"footer-modal",onClick:l=>l.stopPropagation(),children:[r.jsxs("div",{className:"footer-modal-header",children:[r.jsx("h2",{id:"privacy-modal-title",children:n("footer.privacyPolicy")}),r.jsx("button",{className:"footer-modal-close",onClick:c,"aria-label":n("common.close"),children:"Ã—"})]}),r.jsxs("div",{className:"footer-modal-content",children:[r.jsxs("div",{className:"footer-modal-section",children:[r.jsx("h3",{children:n("footer.privacySection1Title")}),r.jsx("p",{children:n("footer.privacySection1Content")})]}),r.jsxs("div",{className:"footer-modal-section",children:[r.jsx("h3",{children:n("footer.privacySection2Title")}),r.jsx("p",{children:n("footer.privacySection2Content")})]}),r.jsxs("div",{className:"footer-modal-section",children:[r.jsx("h3",{children:n("footer.privacySection3Title")}),r.jsx("p",{children:n("footer.privacySection3Content")})]}),r.jsxs("div",{className:"footer-modal-section",children:[r.jsx("h3",{children:n("footer.privacySection4Title")}),r.jsx("p",{children:n("footer.privacySection4Content")})]}),r.jsxs("div",{className:"footer-modal-section",children:[r.jsx("h3",{children:n("footer.privacySection5Title")}),r.jsx("p",{children:n("footer.privacySection5Content")})]}),r.jsxs("div",{className:"footer-modal-section",children:[r.jsx("h3",{children:n("footer.privacySection6Title")}),r.jsx("p",{children:n("footer.privacySection6Content")})]})]})]})}),s&&r.jsx("div",{className:"footer-modal-overlay",onClick:c,role:"dialog","aria-modal":"true","aria-labelledby":"contact-modal-title",children:r.jsxs("div",{className:"footer-modal",onClick:l=>l.stopPropagation(),children:[r.jsxs("div",{className:"footer-modal-header",children:[r.jsx("h2",{id:"contact-modal-title",children:n("footer.contactUs")}),r.jsx("button",{className:"footer-modal-close",onClick:c,"aria-label":n("common.close"),children:"Ã—"})]}),r.jsxs("div",{className:"footer-modal-content",children:[r.jsxs("div",{className:"footer-modal-section",children:[r.jsx("h3",{children:n("footer.contactSection1Title")}),r.jsx("p",{children:n("footer.contactSection1Content")})]}),r.jsxs("div",{className:"footer-modal-section",children:[r.jsx("h3",{children:n("footer.contactSection2Title")}),r.jsx("p",{children:n("footer.contactSection2Content")})]}),r.jsxs("div",{className:"footer-modal-section",children:[r.jsx("h3",{children:n("footer.contactSection3Title")}),r.jsx("p",{children:n("footer.contactSection3Content")})]}),r.jsxs("div",{className:"footer-modal-section",children:[r.jsx("h3",{children:n("footer.contactSection4Title")}),r.jsx("p",{children:n("footer.contactSection4Content")})]})]})]})})]})},qt=({children:n})=>r.jsx("div",{className:"game-container",children:n}),pt={aspectRatio:16/9,gridRows:9,gridCols:9,pixelRatio:window.devicePixelRatio||1},Vt=({config:n,onReady:e,onResize:o})=>{const s=S.useRef(null),a=S.useRef(null),i=S.useRef(e),d=S.useRef(o),c=S.useRef(!1),[l,h]=S.useState(null),{t:f}=Re();return S.useEffect(()=>{i.current=e},[e]),S.useEffect(()=>{d.current=o},[o]),S.useEffect(()=>{const m=s.current,b=a.current;if(!m||!b)return;const y=m.getContext("2d");if(!y){const N="Canvas 2D context is not supported";$.error(N),h(N);return}l&&h(null);const M=()=>{const N=window.devicePixelRatio||1,_=b.clientWidth,K=b.clientHeight,U=n.aspectRatio||pt.aspectRatio||16/9,L=1200,F=675;let V,pe;const ye=Math.min(_,L),Z=Math.min(K,F);ye/Z>U?(pe=Z,V=pe*U):(V=ye,pe=V/U),m.width=V*N,m.height=pe*N,y.scale(N,N),m.style.width=`${V}px`,m.style.height=`${pe}px`,m.style.display="block",m.style.maxWidth="100%",m.style.maxHeight="100%",!c.current&&i.current&&(c.current=!0,i.current(m,y)),c.current&&d.current&&setTimeout(()=>{d.current&&d.current(m,y)},0)};M();const I=new ResizeObserver(()=>{M()});return I.observe(b),()=>{I.disconnect(),c.current=!1}},[n]),l?r.jsx("div",{className:"game-canvas-error",role:"alert",children:r.jsxs("div",{className:"game-canvas-error-content",children:[r.jsx("div",{className:"game-canvas-error-icon",children:"âš ï¸"}),r.jsx("h3",{children:f("error.canvasNotSupported")}),r.jsx("p",{children:f("error.canvasFallbackMessage")}),r.jsx("button",{onClick:()=>{h(null),window.location.reload()},className:"game-canvas-error-button",children:f("error.reload")})]})}):r.jsx("div",{ref:a,className:"game-canvas-wrapper",children:r.jsx("canvas",{ref:s,className:"game-canvas"})})},ze=["red","yellow","blue","green","purple","orange"],_e={red:{light:"#e74c3c",dark:"#c0392b"},yellow:{light:"#f1c40f",dark:"#f39c12"},blue:{light:"#3498db",dark:"#2980b9"},green:{light:"#2ecc71",dark:"#27ae60"},purple:{light:"#9b59b6",dark:"#8e44ad"},orange:{light:"#e67e22",dark:"#d35400"}};class Jt{constructor(e,o){Y(this,"ctx");Y(this,"cellSize");this.ctx=e,this.cellSize=o}render(e,o=1){this.ctx.save();const s=e.x+this.cellSize/2,a=e.y+this.cellSize/2;switch(this.ctx.translate(s,a),this.ctx.scale(e.scale||1,e.scale||1),this.ctx.rotate(e.rotation||0),this.ctx.globalAlpha=o,e.type){case"normal":this.renderNormalGem(e);break;case"striped":this.renderStripedGem(e);break;case"wrapped":this.renderWrappedGem(e);break;case"colorBomb":this.renderColorBomb(e);break}this.ctx.restore()}renderNormalGem(e){const o=_e[e.color],s=this.cellSize*.85,a=-s/2;this.ctx.fillStyle="rgba(0, 0, 0, 0.2)",this.roundRect(a+2,a+2,s,s,s*.2),this.ctx.fill();const i=this.ctx.createLinearGradient(a,a,a+s,a+s);i.addColorStop(0,o.light),i.addColorStop(1,o.dark),this.ctx.fillStyle=i,this.roundRect(a,a,s,s,s*.2),this.ctx.fill(),this.renderColorPattern(e.color,a,s),this.ctx.fillStyle="rgba(255, 255, 255, 0.3)",this.roundRect(a,a,s,s*.4,s*.2),this.ctx.fill(),this.ctx.strokeStyle=this.getBorderColor(e.color),this.ctx.lineWidth=s*.06,this.roundRect(a,a,s,s,s*.2),this.ctx.stroke()}getBorderColor(e){return{red:"rgba(231, 76, 60, 0.9)",yellow:"rgba(241, 196, 15, 0.9)",blue:"rgba(52, 152, 219, 0.9)",green:"rgba(46, 204, 113, 0.9)",purple:"rgba(155, 89, 182, 0.9)",orange:"rgba(230, 126, 34, 0.9)"}[e]}renderColorPattern(e,o,s){switch(this.ctx.save(),this.ctx.globalAlpha=.5,e){case"red":this.ctx.fillStyle="rgba(255, 255, 255, 0.6)",this.ctx.beginPath(),this.ctx.arc(0,0,s*.18,0,Math.PI*2),this.ctx.fill(),this.ctx.fillStyle="rgba(192, 57, 43, 0.5)",this.ctx.beginPath(),this.ctx.arc(0,0,s*.1,0,Math.PI*2),this.ctx.fill();break;case"yellow":this.ctx.fillStyle="rgba(255, 255, 255, 0.7)",this.drawStar(0,0,s*.1,s*.18,5),this.ctx.fill();break;case"blue":this.ctx.fillStyle="rgba(255, 255, 255, 0.6)",this.ctx.beginPath(),this.ctx.moveTo(0,-s*.18),this.ctx.lineTo(s*.18,0),this.ctx.lineTo(0,s*.18),this.ctx.lineTo(-s*.18,0),this.ctx.closePath(),this.ctx.fill();break;case"green":this.ctx.fillStyle="rgba(255, 255, 255, 0.6)",this.ctx.beginPath(),this.ctx.moveTo(0,-s*.18),this.ctx.lineTo(-s*.15,s*.12),this.ctx.lineTo(s*.15,s*.12),this.ctx.closePath(),this.ctx.fill();break;case"purple":this.ctx.fillStyle="rgba(255, 255, 255, 0.6)",this.ctx.fillRect(-s*.12,-s*.12,s*.24,s*.24);break;case"orange":this.ctx.fillStyle="rgba(255, 255, 255, 0.6)",this.ctx.beginPath();for(let a=0;a<6;a++){const i=Math.PI/3*a,d=Math.cos(i)*s*.15,c=Math.sin(i)*s*.15;a===0?this.ctx.moveTo(d,c):this.ctx.lineTo(d,c)}this.ctx.closePath(),this.ctx.fill(),this.ctx.fillStyle="rgba(211, 84, 0, 0.5)",this.ctx.beginPath(),this.ctx.arc(0,0,s*.08,0,Math.PI*2),this.ctx.fill();break}this.ctx.restore()}renderStripedGem(e){const o=_e[e.color],s=this.cellSize*.85,a=-s/2,i=this.ctx.createLinearGradient(a,a,a+s,a+s);if(i.addColorStop(0,o.light),i.addColorStop(1,o.dark),this.ctx.fillStyle=i,this.roundRect(a,a,s,s,s*.2),this.ctx.fill(),this.ctx.strokeStyle="rgba(255, 255, 255, 0.6)",this.ctx.lineWidth=s*.1,this.ctx.lineCap="round",e.stripedDirection==="horizontal")for(let d=0;d<3;d++){const c=a+s/4*(d+1);this.ctx.beginPath(),this.ctx.moveTo(a,c),this.ctx.lineTo(a+s,c),this.ctx.stroke()}else for(let d=0;d<3;d++){const c=a+s/4*(d+1);this.ctx.beginPath(),this.ctx.moveTo(c,a),this.ctx.lineTo(c,a+s),this.ctx.stroke()}}renderWrappedGem(e){const o=_e[e.color],s=this.cellSize*.85,a=-s/2,i=this.ctx.createLinearGradient(a,a,a+s,a+s);i.addColorStop(0,o.light),i.addColorStop(1,o.dark),this.ctx.fillStyle=i,this.roundRect(a,a,s,s,s*.2),this.ctx.fill(),this.ctx.strokeStyle="rgba(255, 255, 255, 0.8)",this.ctx.lineWidth=s*.08,this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.moveTo(a,a),this.ctx.lineTo(a+s,a+s),this.ctx.moveTo(a+s,a),this.ctx.lineTo(a,a+s),this.ctx.stroke()}renderColorBomb(e){const o=this.cellSize*.85,s=-o/2,a=this.ctx.createLinearGradient(s,s,s+o,s+o);a.addColorStop(0,"#ff6b6b"),a.addColorStop(.2,"#ffd93d"),a.addColorStop(.4,"#4ecdc4"),a.addColorStop(.6,"#95e1d3"),a.addColorStop(.8,"#a29bfe"),a.addColorStop(1,"#fd79a8"),this.ctx.fillStyle=a,this.roundRect(s,s,o,o,o*.2),this.ctx.fill(),this.ctx.fillStyle="rgba(255, 255, 255, 0.9)",this.drawStar(0,0,o*.3,o*.6,5),this.ctx.fill()}roundRect(e,o,s,a,i){this.ctx.beginPath(),this.ctx.moveTo(e+i,o),this.ctx.lineTo(e+s-i,o),this.ctx.quadraticCurveTo(e+s,o,e+s,o+i),this.ctx.lineTo(e+s,o+a-i),this.ctx.quadraticCurveTo(e+s,o+a,e+s-i,o+a),this.ctx.lineTo(e+i,o+a),this.ctx.quadraticCurveTo(e,o+a,e,o+a-i),this.ctx.lineTo(e,o+i),this.ctx.quadraticCurveTo(e,o,e+i,o),this.ctx.closePath()}drawStar(e,o,s,a,i){this.ctx.beginPath();for(let d=0;d<i*2;d++){const c=Math.PI*d/i,l=d%2===0?a:s,h=e+Math.cos(c)*l,f=o+Math.sin(c)*l;d===0?this.ctx.moveTo(h,f):this.ctx.lineTo(h,f)}this.ctx.closePath()}}const ot={rows:9,cols:9};function Ge(n){var s,a;const e=[],o=new Set;for(let i=0;i<n.length;i++){let d=1,c=(s=n[i][0])==null?void 0:s.color,l=0;for(let h=1;h<=n[i].length;h++){const f=n[i][h];if(f&&f.color===c&&c)d++;else{if(d>=3&&c){const m=[];for(let b=0;b<d;b++){const y={row:i,col:l+b},M=`${y.row},${y.col}`;o.has(M)||(m.push(y),o.add(M))}m.length>0&&e.push({type:"horizontal",positions:m})}f?(d=1,c=f.color,l=h):(d=0,c=void 0)}}}if(n.length>0)for(let i=0;i<n[0].length;i++){let d=1,c=(a=n[0][i])==null?void 0:a.color,l=0;for(let h=1;h<=n.length;h++){const f=h<n.length?n[h][i]:null;if(f&&f.color===c&&c)d++;else{if(d>=3&&c){const m=[];for(let b=0;b<d;b++){const y={row:l+b,col:i},M=`${y.row},${y.col}`;o.has(M)||(m.push(y),o.add(M))}m.length>0&&e.push({type:"vertical",positions:m})}f?(d=1,c=f.color,l=h):(d=0,c=void 0)}}}return e}class Kt{constructor(e){Y(this,"seed");this.seed=e}next(){return this.seed=(this.seed*9301+49297)%233280,this.seed/233280}}function st(n){const e=new Kt(n),o=Qt(n),s=Zt(n),a=eo(n),i=to(o.rows,o.cols,e);return{stageNumber:n,gridSize:o,targetScore:s,maxMoves:a,goals:[{type:"score",target:s,current:0}],initialBoard:i}}function Qt(n){return n<=100?{rows:9,cols:9}:n<=300?{rows:8,cols:8}:n<=600?{rows:7,cols:7}:{rows:6,cols:6}}function Zt(n){const s=Math.floor(n/100)*500;return 1e3+n*50+s}function eo(n){const o=Math.floor(n/20),s=20;return n>500?Math.max(s,50-o-Math.floor((n-500)/10)):Math.max(s,50-o)}function to(n,e,o){const s=[];for(let a=0;a<n;a++){s[a]=[];for(let i=0;i<e;i++){const d=ze[Math.floor(o.next()*ze.length)];s[a][i]={id:`${a}-${i}-${Date.now()}`,color:d,type:"normal",position:{row:a,col:i},x:0,y:0,targetX:void 0,targetY:void 0,scale:1,rotation:0}}}return oo(s,o)}function oo(n,e){var i,d,c,l,h;let s=0;const a=e?()=>e.next():()=>Math.random();try{for(;s<100;){const f=Ge(n);if(f.length===0)return n;for(const m of f)for(const b of m.positions){const y=(i=n[b.row])==null?void 0:i[b.col];if(y){const M=ze.indexOf(y.color),I=ze.filter((K,U)=>U!==M);if(I.length===0)continue;let N=y.color,_=0;for(;_<10&&N===y.color;){const K=Math.floor(a()*I.length),U=I[K];[(d=n[b.row-1])==null?void 0:d[b.col],(c=n[b.row+1])==null?void 0:c[b.col],(l=n[b.row])==null?void 0:l[b.col-1],(h=n[b.row])==null?void 0:h[b.col+1]].filter(Boolean).some(V=>(V==null?void 0:V.color)===U)?_++:N=U}N===y.color&&I.length>0&&(N=I[0]),y.color=N}}s++}}catch(f){$.error("Error in ensureNoInitialMatches",{error:f})}return n}function rt(n,e=50){var i;const o=n.map(d=>[...d]),s=o.length,a=((i=o[0])==null?void 0:i.length)||0;for(let d=0;d<a;d++){let c=s-1;for(let l=s-1;l>=0;l--)if(o[l][d]!==null){if(c!==l){const h=o[l][d];o[c][d]=h,(h.y===void 0||h.y===0)&&(h.y=l*e),h.targetY=c,h.position.row=c,o[l][d]=null}c--}for(let l=c;l>=0;l--){const h=so(l,d);h.y=-e*(c-l+1),h.targetY=l,o[l][d]=h}}return o}function so(n,e){const o=ze[Math.floor(Math.random()*ze.length)];return{id:`${Date.now()}-${n}-${e}-${Math.random()}`,color:o,type:"normal",position:{row:n,col:e},x:0,y:0,targetX:void 0,targetY:void 0,scale:1,rotation:0}}function ro(n){const e=[];for(const o of n){const s=o.positions.length;if(s===4){const a=Math.floor(s/2),i=o.positions[a];e.push({position:i,type:"striped",stripedDirection:o.type==="horizontal"?"horizontal":"vertical"})}else if(s>=5){const a=Math.floor(s/2),i=o.positions[a];e.push({position:i,type:"colorBomb"})}}return e}function no(n){const e=[],o=n.filter(a=>a.type==="horizontal"),s=n.filter(a=>a.type==="vertical");for(const a of o)for(const i of s){const d=a.positions.find(c=>i.positions.some(l=>c.row===l.row&&c.col===l.col));d&&e.push({position:d,type:"wrapped"})}return e}function io(n){const e=no(n),o=n.filter(i=>!e.some(d=>{var c,l;return d.position.row===((c=i.positions[0])==null?void 0:c.row)&&d.position.col===((l=i.positions[0])==null?void 0:l.col)})),s=[];s.push(...e);const a=ro(o);for(const i of a)e.some(c=>c.position.row===i.position.row&&c.position.col===i.position.col)||s.push(i);return s}function ao(n,e,o){var d,c,l;const s=[],{row:a,col:i}=n.position;if(o==="horizontal")for(let h=0;h<((d=e[0])==null?void 0:d.length);h++)(c=e[a])!=null&&c[h]&&s.push({row:a,col:h});else for(let h=0;h<e.length;h++)(l=e[h])!=null&&l[i]&&s.push({row:h,col:i});return{positionsToRemove:s,score:s.length*20}}function lo(n,e){var i,d;const o=[],{row:s,col:a}=n.position;for(let c=s-1;c<=s+1;c++)for(let l=a-1;l<=a+1;l++)c>=0&&c<e.length&&l>=0&&l<(((i=e[0])==null?void 0:i.length)||0)&&((d=e[c])!=null&&d[l])&&o.push({row:c,col:l});return{positionsToRemove:o,score:o.length*30}}function co(n,e){var a,i;const o=[],s=n.color;for(let d=0;d<e.length;d++)for(let c=0;c<(((a=e[d])==null?void 0:a.length)||0);c++){const l=(i=e[d])==null?void 0:i[c];l&&l.color===s&&o.push({row:d,col:c})}return{positionsToRemove:o,score:o.length*50}}function ho(n,e,o){var c,l,h;const s=[],{row:a,col:i}=n.position;for(let f=0;f<((c=o[0])==null?void 0:c.length);f++)(l=o[a])!=null&&l[f]&&s.push({row:a,col:f});for(let f=0;f<o.length;f++)(h=o[f])!=null&&h[i]&&s.push({row:f,col:i});const d=Array.from(new Set(s.map(f=>`${f.row},${f.col}`))).map(f=>{const[m,b]=f.split(",").map(Number);return{row:m,col:b}});return{positionsToRemove:d,score:d.length*30}}function uo(n,e,o){var h,f,m,b;const s=[],a=n.type==="striped"?n:e,i=n.type==="wrapped"?n:e,d=a.stripedDirection||"horizontal",{row:c,col:l}=i.position;if(d==="horizontal"){for(let y=c-1;y<=c+1;y++)if(y>=0&&y<o.length)for(let M=0;M<((h=o[0])==null?void 0:h.length);M++)(f=o[y])!=null&&f[M]&&s.push({row:y,col:M})}else for(let y=l-1;y<=l+1;y++)if(y>=0&&y<(((m=o[0])==null?void 0:m.length)||0))for(let M=0;M<o.length;M++)(b=o[M])!=null&&b[y]&&s.push({row:M,col:y});return{positionsToRemove:s,score:s.length*40}}function fo(n,e,o){var c,l,h,f;const s=[],a=n.type==="striped"?n:e,i=a.color;if((a.stripedDirection||"horizontal")==="horizontal")for(let m=0;m<o.length;m++)for(let b=0;b<(((c=o[m])==null?void 0:c.length)||0);b++){const y=(l=o[m])==null?void 0:l[b];y&&y.color===i&&s.push({row:m,col:b})}else for(let m=0;m<(((h=o[0])==null?void 0:h.length)||0);m++)for(let b=0;b<o.length;b++){const y=(f=o[b])==null?void 0:f[m];y&&y.color===i&&s.push({row:b,col:m})}return{positionsToRemove:s,score:s.length*60}}function po(n,e,o){var d,c;const s=[],{row:a,col:i}=n.position;for(let l=a-2;l<=a+2;l++)for(let h=i-2;h<=i+2;h++)l>=0&&l<o.length&&h>=0&&h<(((d=o[0])==null?void 0:d.length)||0)&&((c=o[l])!=null&&c[h])&&s.push({row:l,col:h});return{positionsToRemove:s,score:s.length*50}}function go(n,e,o){var d,c;const s=[],i=(n.type==="wrapped"?n:e).color;for(let l=0;l<o.length;l++)for(let h=0;h<(((d=o[l])==null?void 0:d.length)||0);h++){const f=(c=o[l])==null?void 0:c[h];f&&f.color===i&&s.push({row:l,col:h})}return{positionsToRemove:s,score:s.length*70}}function mo(n,e,o){var a,i;const s=[];for(let d=0;d<o.length;d++)for(let c=0;c<(((a=o[d])==null?void 0:a.length)||0);c++)(i=o[d])!=null&&i[c]&&s.push({row:d,col:c});return{positionsToRemove:s,score:s.length*100}}function yo(n,e,o){switch([n.type,e.type].sort().join("+")){case"striped+striped":return ho(n,e,o);case"striped+wrapped":return uo(n,e,o);case"colorBomb+striped":return fo(n,e,o);case"wrapped+wrapped":return po(n,e,o);case"colorBomb+wrapped":return go(n,e,o);case"colorBomb+colorBomb":return mo(n,e,o);default:return null}}function bo(n,e){switch(n.type){case"striped":return ao(n,e,n.stripedDirection||"horizontal");case"wrapped":return lo(n,e);case"colorBomb":return co(n,e);default:return{positionsToRemove:[],score:0}}}const So=n=>{const[e,o]=S.useState(()=>{const l=st(n);return{board:l.initialBoard||[],score:0,moves:l.maxMoves,goals:l.goals,isGameOver:!1,isPaused:!1,currentStage:n,isAnimating:!1,selectedGem:null,comboCount:0}});S.useEffect(()=>{const l=st(n);o({board:l.initialBoard||[],score:0,moves:l.maxMoves,goals:l.goals,isGameOver:!1,isPaused:!1,currentStage:n,isAnimating:!1,selectedGem:null,comboCount:0})},[n]);const s=S.useRef(null),a=S.useCallback((l,h)=>{o(f=>{var b,y;if(f.isGameOver)return f;const m=((b=f.selectedGem)==null?void 0:b.row)===l&&((y=f.selectedGem)==null?void 0:y.col)===h?null:{row:l,col:h};return s.current=m,Me(le({},f),{selectedGem:m})})},[]),i=S.useCallback((l,h)=>{o(f=>{var U;if(f.isGameOver||f.moves<=0)return f;const m=Math.abs(l.row-h.row),b=Math.abs(l.col-h.col);if(!(m===1&&b===0||m===0&&b===1))return f;const y=f.board.map(L=>L.map(F=>F?le({},F):null)),M=y[l.row][l.col],I=y[h.row][h.col];if(M&&I&&M.type!=="normal"&&I.type!=="normal"){const L=yo(M,I,y);if(L){const F=new Set;for(const R of L.positionsToRemove)F.add(`${R.row},${R.col}`);for(const R of F){const[z,se]=R.split(","),p=Number(z),Ce=Number(se);!Number.isNaN(p)&&!Number.isNaN(Ce)&&y[p]&&(y[p][Ce]=null)}const V=rt(y,50),pe=f.score+L.score,ye=f.goals.map(R=>R.type==="score"?Me(le({},R),{current:Math.min(R.current+L.score,R.target)}):R),Se=Ge(V).length>0,D=ye.every(R=>R.current>=R.target),ve=f.moves<=0&&!D;return Me(le({},f),{board:V,score:pe,goals:ye,moves:f.moves-1,isAnimating:Se&&!D&&!ve,selectedGem:null,comboCount:0,isGameOver:ve||f.isGameOver})}}const N=y[l.row][l.col];y[l.row][l.col]=y[h.row][h.col],y[h.row][h.col]=N,y[l.row][l.col]&&(y[l.row][l.col].position=le({},l)),y[h.row][h.col]&&(y[h.row][h.col].position=le({},h));const _=Ge(y);if(_.length===0)return f;const K=io(_);for(const L of K){const F=(U=y[L.position.row])==null?void 0:U[L.position.col];F&&(F.type=L.type,L.stripedDirection&&(F.stripedDirection=L.stripedDirection))}return Me(le({},f),{board:y,moves:f.moves-1,isAnimating:!0,selectedGem:null,comboCount:0})})},[]),d=S.useCallback(()=>{o(l=>{var D,ve;if(!l.isAnimating)return l;const h=Ge(l.board);if(h.length===0)return Me(le({},l),{isAnimating:!1});const f=l.board.map(R=>R.map(z=>z?le({},z):null)),m=new Set;let b=0;const y=new Set;for(const R of h)for(const z of R.positions){const se=(D=f[z.row])==null?void 0:D[z.col];se&&se.type!=="normal"&&y.add(`${z.row},${z.col}`)}for(const R of y){const[z,se]=R.split(","),p=Number(z),Ce=Number(se);if(!Number.isNaN(p)&&!Number.isNaN(Ce)&&((ve=f[p])!=null&&ve[Ce])){const Ee=f[p][Ce],Ae=bo(Ee,f);for(const Le of Ae.positionsToRemove)m.add(`${Le.row},${Le.col}`);b+=Ae.score}}for(const R of h)for(const z of R.positions)m.add(`${z.row},${z.col}`);for(const R of m){const[z,se]=R.split(","),p=Number(z),Ce=Number(se);!Number.isNaN(p)&&!Number.isNaN(Ce)&&f[p]&&(f[p][Ce]=null)}const M=rt(f,50),N=Ge(M).length>0,_=N?l.comboCount+1:0,K=1+Math.min(_,5)*.15,U=h.reduce((R,z)=>{const se=z.positions.length;let p=10;return se>=6?p=80:se>=5?p=40:se>=4&&(p=20),R+se*p},0),L=U+b,F=Math.floor(L*(K-1)),V=l.score+L+F,pe=U+b+F,ye=l.goals.map(R=>R.type==="score"?Me(le({},R),{current:Math.min(R.current+pe,R.target)}):R),Z=ye.every(R=>R.current>=R.target),Se=l.moves<=0&&!Z;return Me(le({},l),{board:M,score:V,goals:ye,isGameOver:Se||l.isGameOver,isAnimating:N&&!Z&&!Se,comboCount:_})})},[]),c=S.useCallback(()=>{o(l=>Me(le({},l),{isPaused:!l.isPaused}))},[]);return{gameState:e,selectGem:a,swapGems:i,processMatches:d,togglePause:c}};function nt(n){const{score:e,goals:o,moves:s,currentStage:a}=n;if(o.length===0)return 0;const i=o[0];if(i.current<i.target)return 0;const d=i.current/i.target,c=Math.max(20,50-Math.floor(a/20)),l=s/c,h=Math.min(e/(i.target*1.5),1);let f=0;return d>=1&&(f=1,(d>=1.2||l>=.4)&&(f=2),d>=1.5&&l>=.5&&h>=.8&&(f=3)),Math.min(f,3)}class wo{constructor(e){Y(this,"particles",[]);Y(this,"ctx");this.ctx=e}emit(e,o,s,a=20){const i=_e[s];for(let d=0;d<a;d++){const c=Math.PI*2*d/a+Math.random()*.5,l=2+Math.random()*3;this.particles.push({x:e,y:o,vx:Math.cos(c)*l,vy:Math.sin(c)*l,life:1,maxLife:1,color:Math.random()>.5?i.light:i.dark,size:3+Math.random()*4,rotation:Math.random()*Math.PI*2,rotationSpeed:(Math.random()-.5)*.2})}}emitExplosion(e,o,s,a=50,i=30){const d=_e[s];for(let c=0;c<i;c++){const l=Math.random()*Math.PI*2,h=Math.random()*a,f=1+Math.random()*2;this.particles.push({x:e+Math.cos(l)*h*.3,y:o+Math.sin(l)*h*.3,vx:Math.cos(l)*f,vy:Math.sin(l)*f,life:1,maxLife:1,color:Math.random()>.5?d.light:d.dark,size:4+Math.random()*6,rotation:Math.random()*Math.PI*2,rotationSpeed:(Math.random()-.5)*.3})}}update(e=16){for(let o=this.particles.length-1;o>=0;o--){const s=this.particles[o];s.x+=s.vx,s.y+=s.vy,s.vy+=.1,s.vx*=.98,s.vy*=.98,s.rotation+=s.rotationSpeed,s.life-=e/1e3,s.life<=0&&this.particles.splice(o,1)}}render(){this.ctx.save();for(const e of this.particles){const o=e.life/e.maxLife,s=e.size*o;this.ctx.globalAlpha=o,this.ctx.fillStyle=e.color,this.ctx.translate(e.x,e.y),this.ctx.rotate(e.rotation),this.ctx.fillRect(-s/2,-s/2,s,s),this.ctx.setTransform(1,0,0,1,0,0)}this.ctx.globalAlpha=1,this.ctx.restore()}clear(){this.particles=[]}get count(){return this.particles.length}}function it(n){var i,d,c,l;const e=n.length,o=((i=n[0])==null?void 0:i.length)||0,s=[],a=[];for(let h=0;h<e;h++)for(let f=0;f<o;f++){const m=(d=n[h])==null?void 0:d[f];if(m){if(f<o-1){const b=(c=n[h])==null?void 0:c[f+1];if(b&&b.color!==m.color){const y=at(n,h,f,h,f+1),M=Ge(y);if(M.length>0){const I=M.some(_=>_.positions.length>=4),N={from:{row:h,col:f},to:{row:h,col:f+1}};I?s.push(N):a.push(N)}}}if(h<e-1){const b=(l=n[h+1])==null?void 0:l[f];if(b&&b.color!==m.color){const y=at(n,h,f,h+1,f),M=Ge(y);if(M.length>0){const I=M.some(_=>_.positions.length>=4),N={from:{row:h,col:f},to:{row:h+1,col:f}};I?s.push(N):a.push(N)}}}}}return s.length>0?s[0]:a.length>0?a[0]:null}function at(n,e,o,s,a){const i=n.map(c=>c.map(l=>l?le({},l):null)),d=i[e][o];return i[e][o]=i[s][a],i[s][a]=d,i}class vo{constructor(){Y(this,"fpsHistory",[]);Y(this,"frameTimeHistory",[]);Y(this,"lastFrameTime",performance.now());Y(this,"frameCount",0);Y(this,"fpsUpdateInterval",1e3);Y(this,"lastFpsUpdate",performance.now());Y(this,"currentFps",60);Y(this,"currentFrameTime",16.67);Y(this,"maxHistorySize",60);Y(this,"callbacks",new Set)}update(){const e=performance.now(),o=e-this.lastFrameTime;if(this.lastFrameTime=e,this.frameTimeHistory.push(o),this.frameTimeHistory.length>this.maxHistorySize&&this.frameTimeHistory.shift(),this.frameCount++,e-this.lastFpsUpdate>=this.fpsUpdateInterval){this.currentFps=this.frameCount,this.currentFrameTime=1e3/this.currentFps,this.fpsHistory.push(this.currentFps),this.fpsHistory.length>this.maxHistorySize&&this.fpsHistory.shift();const s=this.frameTimeHistory.reduce((i,d)=>i+d,0)/this.frameTimeHistory.length,a=this.getMetrics(s);this.callbacks.forEach(i=>i(a)),this.currentFps<30&&this.handlePerformanceDegradation(),this.frameCount=0,this.lastFpsUpdate=e}}getMetrics(e){const o={fps:this.currentFps,frameTime:e,timestamp:performance.now()};if(performance.memory&&typeof performance.memory=="object"){const s=performance.memory;o.memoryUsage={usedJSHeapSize:s.usedJSHeapSize,totalJSHeapSize:s.totalJSHeapSize,jsHeapSizeLimit:s.jsHeapSizeLimit}}return o}handlePerformanceDegradation(){console.warn(`Performance degradation detected: FPS = ${this.currentFps.toFixed(1)}`)}subscribe(e){return this.callbacks.add(e),()=>{this.callbacks.delete(e)}}getFPS(){return this.currentFps}getAverageFPS(){return this.fpsHistory.length===0?60:this.fpsHistory.reduce((o,s)=>o+s,0)/this.fpsHistory.length}getFrameTime(){return this.currentFrameTime}getFPSHistory(){return[...this.fpsHistory]}getMemoryUsage(){if(performance.memory&&typeof performance.memory=="object"){const e=performance.memory;return{usedJSHeapSize:e.usedJSHeapSize,totalJSHeapSize:e.totalJSHeapSize,jsHeapSizeLimit:e.jsHeapSizeLimit}}return null}reset(){this.fpsHistory=[],this.frameTimeHistory=[],this.frameCount=0,this.currentFps=60,this.currentFrameTime=16.67,this.lastFrameTime=performance.now(),this.lastFpsUpdate=performance.now()}}const lt=new vo,Co=({stageNumber:n=1,currentScreen:e="stageSelect",onNavigate:o,onStartStage:s})=>{const a=S.useRef(!1),i=S.useRef(null),d=S.useRef(null),c=S.useRef(null),l=S.useRef(null),h=S.useRef(null),f=S.useRef(null),m=S.useRef(new Map),b=S.useRef(null),y=S.useRef(!1),M=S.useRef(null),I=S.useRef(""),N=S.useRef(!1),_=S.useRef(null),K=S.useRef(null),U=S.useRef(null),L=S.useRef(null),F=S.useRef(!1),V=S.useRef(!1),pe=S.useRef(!1),ye=S.useRef(!1),[Z,Se]=S.useState(!1),{t:D}=Re(),[ve,R]=S.useState(1),[z,se]=S.useState(1),{gameState:p,selectGem:Ce,swapGems:Ee,processMatches:Ae,togglePause:Le}=So(n),[de,yt]=S.useState(()=>{const w=ot.cols,P=ot.rows;return{aspectRatio:pt.aspectRatio,cellSize:70,gridRows:P,gridCols:w,pixelRatio:window.devicePixelRatio||1,logicalWidth:0,logicalHeight:0}});S.useEffect(()=>{var t;if(e==="game"&&p.board.length>0){const w=p.board.length,P=((t=p.board[0])==null?void 0:t.length)||9;yt(k=>Me(le({},k),{gridRows:w,gridCols:P}))}},[e,p.board,n]),S.useEffect(()=>{const t=Be.get("chipPuzzleGame_progress",{fallback:null});t&&(R(Math.max(1,t.highestStage||1)),$.info("Game progress loaded",{highestStage:t.highestStage||1}))},[]);const qe=S.useCallback((t,w,P)=>{const u=w/1200;t.fillStyle="#1a1a1a",t.fillRect(0,0,w,P),t.fillStyle="#fff";const re=Math.max(16,32*u);t.font=`bold ${re}px Arial`,t.textAlign="center",t.fillText(D("stageSelect.title"),w/2,50*u);const v=8,be=60,ke=15,j=be*u,we=ke*u,Q=(w-(v*j+(v-1)*we))/2,J=100*u,ee=1e3,ne=50,he=Math.ceil(ee/ne),ie=(z-1)*ne+1,X=Math.min(ie+ne-1,ee);for(let C=0;C<ne&&ie+C<=X;C++){const E=ie+C,W=Math.floor(C/v),H=C%v,g=Q+H*(j+we),B=J+W*(j+we),T=E<=ve;if(T){const G=t.createLinearGradient(g,B,g+j,B+j);G.addColorStop(0,"#667eea"),G.addColorStop(1,"#764ba2"),t.fillStyle=G}else t.fillStyle="#1a1a1a";t.fillRect(g,B,j,j),t.strokeStyle=T?"#667eea":"#444",t.lineWidth=Math.max(1,2*u),t.strokeRect(g,B,j,j),t.fillStyle="#fff";const O=Math.max(12,20*u);if(t.font=`bold ${O}px Arial`,t.textAlign="center",t.textBaseline="middle",t.fillText(E.toString(),g+j/2,B+j/2),!T){t.fillStyle="#ffa500";const G=Math.max(16,24*u);t.font=`${G}px Arial`,t.fillText("ðŸ”’",g+j/2,B+j/2-10*u)}}const ue=P-60*u;t.fillStyle="#fff",t.font=`bold ${Math.max(12,18*u)}px Arial`,t.textAlign="center",t.fillText(`${D("stageSelect.page")} ${z} / ${he}`,w/2,ue);const te=30*u,ge=80*u,me=ue+20*u,Te=10*u;if(z>1){const C=w/2-ge-Te/2;t.fillStyle=z>1?"#667eea":"#444",t.fillRect(C,me,ge,te),t.strokeStyle="#fff",t.lineWidth=Math.max(1,2*u),t.strokeRect(C,me,ge,te),t.fillStyle="#fff",t.font=`bold ${Math.max(10,14*u)}px Arial`,t.fillText("Â«",C+ge/2,me+te/2+4*u)}if(z<he){const C=w/2+Te/2;t.fillStyle=z<he?"#667eea":"#444",t.fillRect(C,me,ge,te),t.strokeStyle="#fff",t.lineWidth=Math.max(1,2*u),t.strokeRect(C,me,ge,te),t.fillStyle="#fff",t.font=`bold ${Math.max(10,14*u)}px Arial`,t.fillText("Â»",C+ge/2,me+te/2+4*u)}},[ve,D,z]),Ve=S.useCallback((t,w,P)=>{const u=w/1200;t.fillStyle="#1a1a1a",t.fillRect(0,0,w,P);const v=(de.cellSize||70)*u,be=de.gridCols||9,ke=de.gridRows||9,j=v*be,we=v*ke,Q=(w-j)/2,J=(P-we)/2;(!c.current||l.current!==v)&&(c.current=new Jt(t,v),l.current=v),h.current||(h.current=new wo(t)),t.save(),t.globalAlpha=.9,t.fillStyle="rgba(22, 22, 46, 0.8)",t.beginPath(),t.roundRect(Q,J,j,we,8*u),t.fill(),t.restore(),t.strokeStyle="rgba(255, 255, 255, 0.08)",t.lineWidth=Math.max(.5,1*u);for(let C=0;C<=ke;C++){const E=J+C*v;t.beginPath(),t.moveTo(Q,E),t.lineTo(Q+j,E),t.stroke()}for(let C=0;C<=be;C++){const E=Q+C*v;t.beginPath(),t.moveTo(E,J),t.lineTo(E,J+we),t.stroke()}const ee=Math.max(10,20*u),ne=24*u,he=24*u,ie=ee+8*u,X=he,ue=16*u,te=16*u,ge=280*u,me=ie*4+ue*2;if(t.save(),t.globalAlpha=.9,t.fillStyle="rgba(15, 15, 30, 0.8)",t.beginPath(),t.roundRect(ne-ue,he-ue,ge,me,te),t.fill(),t.strokeStyle="rgba(102, 126, 234, 0.3)",t.lineWidth=1*u,t.stroke(),t.restore(),t.textAlign="left",t.textBaseline="top",t.shadowColor="rgba(0, 0, 0, 0.5)",t.shadowBlur=4*u,t.shadowOffsetX=0,t.shadowOffsetY=2*u,t.font=`600 ${ee}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,t.fillStyle="#ffffff",t.fillText(`${D("game.score")}: ${p.score.toLocaleString()}`,ne,X),t.fillStyle="rgba(255, 255, 255, 0.9)",t.fillText(`${D("game.moves")}: ${p.moves}`,ne,X+ie),p.goals.length>0){const C=p.goals[0],E=C.current/C.target;t.fillStyle=E>=1?"#4ecdc4":"rgba(255, 255, 255, 0.9)",t.fillText(`${D("game.goal")}: ${C.current.toLocaleString()}/${C.target.toLocaleString()}`,ne,X+ie*2)}if(p.comboCount>0&&(t.shadowColor="rgba(255, 217, 61, 0.6)",t.shadowBlur=12*u,t.font=`700 ${Math.max(14,24*u)}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,t.fillStyle="#ffd93d",t.textAlign="left",t.fillText(`${D("game.combo")} x${p.comboCount}!`,ne,X+ie*3),t.shadowColor="rgba(0, 0, 0, 0.5)",t.shadowBlur=4*u),t.shadowColor="transparent",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0,!p.isGameOver&&!p.isAnimating){const W=20*u,H=10*u,g=120*u,B=40*u,T=120*u,O=40*u,G=w-g-W,q=W,x=12*u,A=t.createLinearGradient(G,q,G,q+B);A.addColorStop(0,Z?"#4ecdc4":"#667eea"),A.addColorStop(1,Z?"#44a08d":"#764ba2"),t.save(),t.beginPath(),t.roundRect(G,q,g,B,x),t.fillStyle=A,t.fill(),t.strokeStyle="rgba(255, 255, 255, 0.3)",t.lineWidth=Math.max(1,1.5*u),t.stroke(),t.restore(),t.shadowColor=Z?"rgba(78, 205, 196, 0.4)":"rgba(102, 126, 234, 0.4)",t.shadowBlur=8*u,t.shadowOffsetX=0,t.shadowOffsetY=2*u,t.fillStyle="#ffffff";const ae=16*u;t.font=`600 ${ae}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,t.textAlign="center",t.textBaseline="middle",t.fillText(D("game.hint"),G+g/2,q+B/2),t.shadowColor="transparent",t.shadowBlur=0;const fe=G-T-H,xe=W,oe=t.createLinearGradient(fe,xe,fe,xe+O);p.isPaused?(oe.addColorStop(0,"#ff6b6b"),oe.addColorStop(1,"#ee5a6f")):(oe.addColorStop(0,"#667eea"),oe.addColorStop(1,"#764ba2")),t.save(),t.beginPath(),t.roundRect(fe,xe,T,O,x),t.fillStyle=oe,t.fill(),t.strokeStyle="rgba(255, 255, 255, 0.3)",t.lineWidth=Math.max(1,1.5*u),t.stroke(),t.restore(),t.shadowColor=p.isPaused?"rgba(255, 107, 107, 0.4)":"rgba(102, 126, 234, 0.4)",t.shadowBlur=8*u,t.shadowOffsetX=0,t.shadowOffsetY=2*u,t.fillStyle="#ffffff";const je=16*u;t.font=`600 ${je}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,t.textAlign="center",t.textBaseline="middle",t.fillText(p.isPaused?D("game.resume"):D("game.pause"),fe+T/2,xe+O/2),t.shadowColor="transparent",t.shadowBlur=0}if(p.isPaused&&!p.isGameOver){t.fillStyle="rgba(15, 15, 30, 0.85)",t.fillRect(0,0,w,P);const C=400*u,E=200*u,W=(w-C)/2,H=(P-E)/2,g=24*u;t.save(),t.globalAlpha=.95,t.fillStyle="rgba(26, 26, 46, 0.9)",t.beginPath(),t.roundRect(W,H,C,E,g),t.fill(),t.strokeStyle="rgba(102, 126, 234, 0.3)",t.lineWidth=2*u,t.stroke(),t.restore(),t.shadowColor="rgba(102, 126, 234, 0.5)",t.shadowBlur=12*u,t.shadowOffsetX=0,t.shadowOffsetY=0,t.fillStyle="#ffffff",t.font=`700 ${Math.max(28,56*u)}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,t.textAlign="center",t.textBaseline="middle",t.fillText(D("game.pause"),w/2,H+E/2-30*u),t.shadowColor="transparent",t.shadowBlur=0,t.fillStyle="rgba(255, 255, 255, 0.7)",t.font=`500 ${Math.max(14,20*u)}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,t.fillText(D("game.resume"),w/2,H+E/2+20*u)}if(p.isGameOver){t.fillStyle="rgba(15, 15, 30, 0.9)",t.fillRect(0,0,w,P);const C=450*u,E=300*u,W=(w-C)/2,H=(P-E)/2,g=24*u;t.save(),t.globalAlpha=.95,t.fillStyle="rgba(26, 26, 46, 0.9)",t.beginPath(),t.roundRect(W,H,C,E,g),t.fill(),t.strokeStyle="rgba(255, 107, 107, 0.3)",t.lineWidth=2*u,t.stroke(),t.restore(),t.shadowColor="rgba(255, 107, 107, 0.5)",t.shadowBlur=12*u,t.fillStyle="#ff6b6b",t.font=`700 ${Math.max(28,56*u)}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,t.textAlign="center",t.textBaseline="middle",t.fillText(D("game.gameOver"),w/2,H+60*u),t.shadowColor="transparent",t.shadowBlur=0,t.fillStyle="rgba(255, 255, 255, 0.9)",t.font=`600 ${Math.max(16,24*u)}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,t.fillText(`${D("game.finalScore")}: ${p.score.toLocaleString()}`,w/2,H+120*u);const B=w/2-110*u,T=H+180*u,O=220*u,G=56*u,q=14*u,x=t.createLinearGradient(B,T,B,T+G);x.addColorStop(0,"#ff6b6b"),x.addColorStop(1,"#ee5a6f"),t.save(),t.beginPath(),t.roundRect(B,T,O,G,q),t.fillStyle=x,t.fill(),t.strokeStyle="rgba(255, 255, 255, 0.3)",t.lineWidth=2*u,t.stroke(),t.restore(),t.shadowColor="rgba(255, 107, 107, 0.4)",t.shadowBlur=8*u,t.shadowOffsetX=0,t.shadowOffsetY=2*u,t.fillStyle="#ffffff",t.font=`600 ${Math.max(16,22*u)}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,t.textAlign="center",t.textBaseline="middle",t.fillText(D("game.retry"),w/2,T+G/2),t.shadowColor="transparent",t.shadowBlur=0}const Te=p.goals.every(C=>C.current>=C.target);if(p.isAnimating){const C=Ge(p.board),E=new Set;for(const W of C)for(const H of W.positions)E.add(`${H.row},${H.col}`);E.forEach(W=>{const[H,g]=W.split(","),B=Number(H),T=Number(g);if(!Number.isNaN(B)&&!Number.isNaN(T)&&B>=0&&B<ke&&T>=0&&T<be){const O=Q+T*v,G=J+B*v,q=Date.now()%1e3,x=.3+Math.sin(q/1e3*Math.PI*2)*.2;t.fillStyle=`rgba(255, 215, 61, ${x})`,t.strokeStyle="#ffd93d",t.lineWidth=Math.max(2,3*u),t.strokeRect(O,G,v,v),t.fillRect(O,G,v,v)}})}if(p.board&&p.board.length>0&&c.current){let C=!1;p.board.forEach((W,H)=>{W&&W.forEach((g,B)=>{if(g){const T=Q+B*v,O=J+H*v;if(F.current&&_.current&&U.current&&K.current){const x=_.current,A=U.current,ae=K.current;if(H===x.row&&B===x.col)if(L.current){const fe=L.current.x-ae.x,xe=L.current.y-ae.y,oe=v,je=Math.max(-oe,Math.min(oe,fe)),Oe=Math.max(-oe,Math.min(oe,xe));g.x=T+je,g.y=O+Oe}else g.x=T,g.y=O;else if(H===A.row&&B===A.col)if(L.current){const fe=L.current.x-ae.x,xe=L.current.y-ae.y,oe=v,je=Math.max(-oe,Math.min(oe,-fe)),Oe=Math.max(-oe,Math.min(oe,-xe));g.x=T+je,g.y=O+Oe}else g.x=T,g.y=O;else g.x=T,g.y=O}else if(g.targetY!==void 0){C=!0;let x;g.targetY<100?x=J+g.targetY*v:x=g.targetY,(g.y===void 0||g.y===0)&&(g.y=O);const A=x-g.y,ae=.15;Math.abs(A)>1?(g.y+=A*ae,A>0&&(g.y+=1)):(g.y=x,g.targetY=void 0),g.x=T}else if(g.targetX!==void 0){const x=g.targetX-g.x,A=.2;Math.abs(x)>.1?g.x+=x*A:(g.x=g.targetX,g.targetX=void 0),g.y=O}else(g.x===0&&g.y===0&&g.targetX===void 0&&g.targetY===void 0||g.x!==T||g.y!==O)&&(g.x=T,g.y=O);p.selectedGem&&p.selectedGem.row===H&&p.selectedGem.col===B&&(t.fillStyle="rgba(255, 255, 255, 0.3)",t.strokeStyle="rgba(255, 255, 255, 0.8)",t.lineWidth=Math.max(2,3*u),t.strokeRect(T,O,v,v),t.fillRect(T,O,v,v)),Z&&b.current&&(b.current.from.row===H&&b.current.from.col===B||b.current.to.row===H&&b.current.to.col===B)&&(t.fillStyle="rgba(255, 215, 61, 0.4)",t.strokeStyle="#ffd93d",t.lineWidth=Math.max(3,4*u),t.strokeRect(T,O,v,v),t.fillRect(T,O,v,v));let G=1,q=g.scale||1;if(g.isRemoving){let x=m.current.get(g.id);x||(x={alpha:1,scale:1},m.current.set(g.id,x)),x.alpha=Math.max(0,x.alpha-.08),x.scale=Math.max(0,x.scale-.08),G=x.alpha,q=x.scale,g.alpha=G,g.scale=q,m.current.set(g.id,x)}else g.alpha=1,g.scale=1;if(G>0){const x=Te&&!p.isAnimating?G*.3:G;c.current.render(g,x)}if(g.isRemoving&&G>.8&&G<.9&&h.current){const x=g.x+v/2,A=g.y+v/2;h.current.emit(x,A,g.color,15)}}})});const E=y.current;y.current=C,E&&!C&&p.isAnimating&&e==="game"&&!p.isGameOver&&!N.current&&setTimeout(()=>{p.isAnimating&&e==="game"&&!p.isGameOver&&!N.current&&(N.current=!0,Ae(),setTimeout(()=>{N.current=!1,I.current=""},200))},100)}if(h.current&&(h.current.update(16),h.current.render()),Te&&!p.isAnimating&&!p.isGameOver){const C=nt(p);t.fillStyle="rgba(15, 15, 30, 0.92)",t.fillRect(0,0,w,P);const E=500*u,W=400*u,H=(w-E)/2,g=(P-W)/2,B=28*u;t.save(),t.globalAlpha=.96,t.fillStyle="rgba(26, 26, 46, 0.9)",t.beginPath(),t.roundRect(H,g,E,W,B),t.fill(),t.strokeStyle="rgba(78, 205, 196, 0.4)",t.lineWidth=2*u,t.stroke(),t.restore(),t.shadowColor="rgba(78, 205, 196, 0.5)",t.shadowBlur=12*u,t.shadowOffsetX=0,t.shadowOffsetY=0,t.fillStyle="#4ecdc4",t.font=`700 ${Math.max(32,64*u)}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,t.textAlign="center",t.textBaseline="middle",t.fillText(D("game.stageCleared"),w/2,g+80*u);const T=Math.max(24,48*u),O=T*1.8,G=w/2-O,q=g+160*u;for(let je=0;je<3;je++){const Oe=G+je*O;t.shadowColor=je<C?"rgba(255, 217, 61, 0.6)":"transparent",t.shadowBlur=je<C?12*u:0,t.fillStyle=je<C?"#ffd93d":"rgba(102, 102, 102, 0.5)",t.font=`${T}px Arial`,t.textAlign="center",t.textBaseline="middle",t.fillText("â˜…",Oe,q)}t.shadowColor="transparent",t.shadowBlur=0,t.fillStyle="rgba(255, 255, 255, 0.9)",t.font=`600 ${Math.max(18,28*u)}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,t.fillText(`${D("game.score")}: ${p.score.toLocaleString()}`,w/2,g+220*u);const x=w/2-120*u,A=g+280*u,ae=240*u,fe=60*u,xe=16*u,oe=t.createLinearGradient(x,A,x,A+fe);oe.addColorStop(0,"#667eea"),oe.addColorStop(1,"#764ba2"),t.save(),t.beginPath(),t.roundRect(x,A,ae,fe,xe),t.fillStyle=oe,t.fill(),t.strokeStyle="rgba(255, 255, 255, 0.3)",t.lineWidth=2*u,t.stroke(),t.restore(),t.shadowColor="rgba(102, 126, 234, 0.4)",t.shadowBlur=8*u,t.shadowOffsetX=0,t.shadowOffsetY=2*u,t.fillStyle="#ffffff",t.font=`600 ${Math.max(16,22*u)}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,t.textAlign="center",t.textBaseline="middle",t.fillText(D("game.nextStage"),w/2,A+fe/2),t.shadowColor="transparent",t.shadowBlur=0}},[de,p,Z,D]),Pe=S.useCallback(()=>{const t=i.current,w=d.current;if(!t||!w)return;const P=window.devicePixelRatio||1,k=t.width/P,u=t.height/P;k===0||u===0||(e==="stageSelect"?qe(w,k,u):e==="game"?Ve(w,k,u):(w.fillStyle="#1a1a1a",w.fillRect(0,0,k,u)))},[e,qe,Ve]);S.useEffect(()=>{let t=0;const P=1e3/60,k=lt.subscribe(re=>{}),u=()=>{const re=v=>{v-t>=P&&(Pe(),lt.update(),t=v),f.current=requestAnimationFrame(re)};f.current=requestAnimationFrame(re)};return i.current&&d.current&&(u(),$.info("GameBoard render loop started",{stage:n,screen:e})),()=>{f.current!==null&&(cancelAnimationFrame(f.current),f.current=null),k(),$.debug("GameBoard render loop stopped")}},[Pe,n,e]);const bt=S.useCallback((t,w)=>{a.current||(a.current=!0,i.current=t,d.current=w,Pe())},[Pe]),St=S.useCallback((t,w)=>{i.current=t,d.current=w,Pe()},[Pe]);S.useEffect(()=>{if(i.current&&d.current){const t=setTimeout(()=>{Pe()},10);return()=>clearTimeout(t)}},[Pe,e,ve,n,p]),S.useEffect(()=>{if(p.isAnimating&&e==="game"&&!p.isGameOver&&!N.current){const t=JSON.stringify(p.board);if(t!==I.current)return N.current=!0,I.current=t,M.current&&clearTimeout(M.current),M.current=setTimeout(()=>{const P=()=>{y.current?setTimeout(P,50):(Ae(),setTimeout(()=>{N.current=!1,I.current=""},200))};P()},300),()=>{M.current&&(clearTimeout(M.current),M.current=null)}}else p.isAnimating||(I.current="",N.current=!1)},[p.isAnimating,p.board,Ae,e,p.isGameOver]),S.useEffect(()=>{if(e!=="game"){pe.current=!1,ye.current=!1;return}const t=p.goals.every(w=>w.current>=w.target);if(!pe.current&&p.isGameOver&&($.info("Game Over",{stage:p.currentStage,score:p.score,moves:p.moves}),ce.playGameOver()),!ye.current&&t&&!p.isGameOver){const w=nt(p);$.info("Stage Cleared",{stage:p.currentStage,score:p.score,moves:p.moves,stars:w}),ce.playStageClear();const k=Be.get("chipPuzzleGame_progress",{fallback:null})||{highestStage:1,stageRecords:{}},u=p.currentStage;u>=k.highestStage&&(k.highestStage=u+1),k.stageRecords||(k.stageRecords={});const re=u.toString(),v=k.stageRecords[re];!v||p.score>v.bestScore?k.stageRecords[re]={stageNumber:u,stars:Math.max((v==null?void 0:v.stars)||0,w),score:p.score,bestScore:p.score,completedAt:new Date().toISOString(),attempts:((v==null?void 0:v.attempts)||0)+1}:k.stageRecords[re]=Me(le({},v),{stars:Math.max(v.stars,w),attempts:v.attempts+1}),Be.set("chipPuzzleGame_progress",k)||$.error("Failed to save progress",{stage:p.currentStage})}pe.current=p.isGameOver,ye.current=t},[p.isGameOver,p.goals,p.score,p.currentStage,e]);const Ie=S.useCallback(t=>{if(V.current){V.current=!1;return}const w=i.current;if(!w)return;const P=w.getBoundingClientRect(),k=t.clientX-P.left,u=t.clientY-P.top,re=window.devicePixelRatio||1,v=w.width/re,be=w.height/re;if(e==="stageSelect"){if(!s)return;const j=v/1200,we=120,Q=40,J=20*j,ee=we*j,ne=Q*j,he=v-ee-J,ie=J;if(k>=he&&k<=he+ee&&u>=ie&&u<=ie+ne){if(Z)Se(!1),b.current=null;else{const A=it(p.board);A&&(b.current=A,Se(!0),setTimeout(()=>{Se(!1),b.current=null},3e3))}return}const X=50,ue=1e3,te=Math.ceil(ue/X),ge=30*j,me=80*j,C=be-60*j+20*j,E=10*j;if(z>1){const A=v/2-me-E/2;if(k>=A&&k<=A+me&&u>=C&&u<=C+ge){se(z-1),ce.playClick();return}}if(z<te){const A=v/2+E/2;if(k>=A&&k<=A+me&&u>=C&&u<=C+ge){se(z+1),ce.playClick();return}}const W=8,H=60,g=15,B=H*j,T=g*j,O=(v-(W*B+(W-1)*T))/2,G=100*j,q=Math.floor((k-O)/(B+T)),x=Math.floor((u-G)/(B+T));if(q>=0&&q<W&&x>=0){const ae=(z-1)*X+1+x*W+q;ae<=ve&&ae<=ue&&s(ae)}}else if(e==="game"){const j=v/1200;if(p.goals.every(x=>x.current>=x.target)&&!p.isAnimating&&!p.isGameOver){const x=v/2-100*j,A=be/2+80*j,ae=200*j,fe=50*j;if(k>=x&&k<=x+ae&&u>=A&&u<=A+fe){if(s){const xe=n+1;s(xe)}ce.playClick();return}return}if(p.isGameOver){const x=v/2-100*j,A=be/2+100*j,ae=200*j,fe=50*j;if(k>=x&&k<=x+ae&&u>=A&&u<=A+fe){s&&s(n),ce.playClick();return}return}if(p.isPaused){Le(),ce.playClick();return}const Q=120,J=40,ee=20*j,ne=10*j,he=Q*j,ie=J*j,X=Q*j,ue=J*j,te=v-he-ee,ge=ee,me=te-X-ne,Te=ee;if(k>=me&&k<=me+X&&u>=Te&&u<=Te+ue){Le(),ce.playClick();return}if(k>=te&&k<=te+he&&u>=ge&&u<=ge+ie){if(Z)Se(!1),b.current=null;else{const x=it(p.board);x&&(b.current=x,Se(!0),setTimeout(()=>{Se(!1),b.current=null},3e3))}ce.playClick();return}if(p.isPaused)return;const E=(de.cellSize||70)*j,W=de.gridCols||9,H=de.gridRows||9,g=E*W,B=E*H,T=(v-g)/2,O=(be-B)/2,G=Math.floor((k-T)/E),q=Math.floor((u-O)/E);G>=0&&G<W&&q>=0&&q<H&&p.board[q]&&p.board[q][G]&&(p.selectedGem?Ee(p.selectedGem,{row:q,col:G}):Ce(q,G),ce.playClick())}},[e,s,ve,de,p,Ce,Ee,Z,Le]),Fe=S.useCallback(t=>{const w=i.current;if(!w||e!=="game"||p.isPaused)return;const P=w.getBoundingClientRect(),k=t.clientX-P.left,u=t.clientY-P.top,re=window.devicePixelRatio||1,v=w.width/re,be=w.height/re,j=v/1200,Q=(de.cellSize||50)*j,J=de.gridCols||9,ee=de.gridRows||9,ne=Q*J,he=Q*ee,ie=(v-ne)/2,X=(be-he)/2,ue=Math.floor((k-ie)/Q),te=Math.floor((u-X)/Q);ue>=0&&ue<J&&te>=0&&te<ee&&p.board[te]&&p.board[te][ue]&&(_.current={row:te,col:ue},K.current={x:k,y:u},F.current=!0)},[e,de,p.board,p.isPaused]),De=S.useCallback(t=>{const w=i.current;if(!w||e!=="game"||p.isPaused||!F.current||!_.current||!K.current)return;const P=w.getBoundingClientRect(),k=t.clientX-P.left,u=t.clientY-P.top,re=window.devicePixelRatio||1,ke=w.width/re/1200,j=de.gridCols||9,we=de.gridRows||9,Q=K.current,J=k-Q.x,ee=u-Q.y,ne=Math.sqrt(J*J+ee*ee),he=10*ke;if(ne<he){L.current={x:k,y:u},U.current=null;return}const ie=_.current;let X={row:ie.row,col:ie.col};if(Math.abs(J)>Math.abs(ee)?J>0?X.col+=1:X.col-=1:ee>0?X.row+=1:X.row-=1,X.col<0||X.col>=j||X.row<0||X.row>=we){F.current=!1,_.current=null,K.current=null,U.current=null,L.current=null;return}L.current={x:k,y:u},U.current=X},[e,de,p.isPaused]),Ne=S.useCallback(()=>{if(F.current&&_.current&&U.current){const t=_.current,w=U.current,P=Math.abs(t.row-w.row),k=Math.abs(t.col-w.col);(P===1&&k===0||P===0&&k===1)&&(Ee(t,w),ce.playClick(),V.current=!0)}F.current=!1,_.current=null,K.current=null,U.current=null,L.current=null},[Ee]);return S.useEffect(()=>{const t=i.current;if(t)return t.addEventListener("click",Ie),()=>{t.removeEventListener("click",Ie)}},[Ie]),S.useEffect(()=>{const t=i.current;if(t)return t.addEventListener("pointerdown",Fe),t.addEventListener("pointermove",De),t.addEventListener("pointerup",Ne),t.addEventListener("pointerleave",Ne),t.addEventListener("pointercancel",Ne),()=>{t.removeEventListener("pointerdown",Fe),t.removeEventListener("pointermove",De),t.removeEventListener("pointerup",Ne),t.removeEventListener("pointerleave",Ne),t.removeEventListener("pointercancel",Ne)}},[Fe,De,Ne]),S.useEffect(()=>{typeof window!="undefined"&&Be.remove("chipPuzzleGame_orientationPreference",{silent:!0})},[]),r.jsx("div",{className:"game-board",children:r.jsx(Vt,{config:de,onReady:bt,onResize:St})})},xo=({onNavigate:n})=>{const{t:e}=Re();return r.jsx("div",{className:"guide-screen",children:r.jsxs("div",{className:"guide-content",children:[r.jsx("h1",{className:"guide-title",children:e("guide.title")}),r.jsxs("div",{className:"guide-text",children:[r.jsx("p",{children:e("guide.description")}),r.jsxs("section",{children:[r.jsx("h2",{children:e("guide.howToPlay")}),r.jsxs("ol",{children:[r.jsx("li",{children:e("guide.step1")}),r.jsx("li",{children:e("guide.step2")}),r.jsx("li",{children:e("guide.step3")}),r.jsx("li",{children:e("guide.step4")})]})]}),r.jsxs("section",{children:[r.jsx("h2",{children:e("guide.specialGemsTitle")}),r.jsx("p",{children:e("guide.specialGemsDescription")}),r.jsxs("ul",{children:[r.jsx("li",{children:e("guide.specialGem1")}),r.jsx("li",{children:e("guide.specialGem2")}),r.jsx("li",{children:e("guide.specialGem3")})]})]}),r.jsxs("section",{children:[r.jsx("h2",{children:e("guide.strategyTitle")}),r.jsxs("ul",{children:[r.jsx("li",{children:e("guide.strategy1")}),r.jsx("li",{children:e("guide.strategy2")}),r.jsx("li",{children:e("guide.strategy3")}),r.jsx("li",{children:e("guide.strategy4")})]})]}),r.jsxs("section",{children:[r.jsx("h2",{children:e("guide.tipsTitle")}),r.jsxs("ul",{children:[r.jsx("li",{children:e("guide.tip1")}),r.jsx("li",{children:e("guide.tip2")}),r.jsx("li",{children:e("guide.tip3")}),r.jsx("li",{children:e("guide.tip4")}),r.jsx("li",{children:e("guide.tip5")}),r.jsx("li",{children:e("guide.tip6")})]})]})]}),r.jsxs("div",{className:"guide-related-links",children:[r.jsx("h2",{children:e("common.relatedPages")||"ê´€ë ¨ íŽ˜ì´ì§€"}),r.jsxs("nav",{"aria-label":e("common.relatedPages")||"ê´€ë ¨ íŽ˜ì´ì§€",children:[r.jsx("a",{href:"?screen=help",onClick:o=>{o.preventDefault(),n("help")},className:"guide-link",children:e("header.help")}),r.jsx("a",{href:"?screen=about",onClick:o=>{o.preventDefault(),n("about")},className:"guide-link",children:e("header.about")})]})]})]})})},jo=({onNavigate:n})=>{const{t:e}=Re();return r.jsx("div",{className:"help-screen",children:r.jsxs("div",{className:"help-content",children:[r.jsx("h1",{className:"help-title",children:e("help.title")}),r.jsxs("div",{className:"help-text",children:[r.jsx("p",{children:e("help.description")}),r.jsxs("section",{className:"help-section",children:[r.jsx("h2",{children:e("help.section1Title")}),r.jsx("p",{children:e("help.section1Content")})]}),r.jsxs("section",{className:"help-section",children:[r.jsx("h2",{children:e("help.section2Title")}),r.jsx("p",{children:e("help.section2Content")})]}),r.jsxs("section",{className:"help-section",children:[r.jsx("h2",{children:e("help.section3Title")}),r.jsx("p",{children:e("help.section3Content")})]}),r.jsxs("section",{className:"help-section",children:[r.jsx("h2",{children:e("help.section4Title")}),r.jsx("p",{children:e("help.section4Content")})]}),r.jsxs("section",{className:"help-section",children:[r.jsx("h2",{children:e("help.section5Title")}),r.jsx("p",{children:e("help.section5Content")})]}),r.jsxs("section",{className:"help-section",children:[r.jsx("h2",{children:e("help.section6Title")}),r.jsx("p",{children:e("help.section6Content")})]}),r.jsxs("section",{className:"help-section",children:[r.jsx("h2",{children:e("help.section7Title")}),r.jsx("p",{children:e("help.section7Content")})]})]}),r.jsxs("div",{className:"help-related-links",children:[r.jsx("h2",{children:e("common.relatedPages")||"ê´€ë ¨ íŽ˜ì´ì§€"}),r.jsxs("nav",{"aria-label":e("common.relatedPages")||"ê´€ë ¨ íŽ˜ì´ì§€",children:[r.jsx("a",{href:"?screen=guide",onClick:o=>{o.preventDefault(),n("guide")},className:"help-link",children:e("header.guide")}),r.jsx("a",{href:"?screen=about",onClick:o=>{o.preventDefault(),n("about")},className:"help-link",children:e("header.about")})]})]})]})})},Mo=({onNavigate:n})=>{const{t:e}=Re();return r.jsx("div",{className:"about-screen",children:r.jsxs("div",{className:"about-content",children:[r.jsx("h1",{className:"about-title",children:e("about.title")}),r.jsxs("div",{className:"about-text",children:[r.jsx("p",{children:e("about.description")}),r.jsxs("section",{className:"about-section",children:[r.jsx("h2",{children:e("about.section1Title")}),r.jsx("p",{children:e("about.section1Content")})]}),r.jsxs("section",{className:"about-section",children:[r.jsx("h2",{children:e("about.section2Title")}),r.jsx("p",{children:e("about.section2Content")})]}),r.jsxs("section",{className:"about-section",children:[r.jsx("h2",{children:e("about.section3Title")}),r.jsx("p",{children:e("about.section3Content")})]}),r.jsxs("section",{className:"about-section",children:[r.jsx("h2",{children:e("about.section4Title")}),r.jsx("p",{children:e("about.section4Content")})]}),r.jsxs("section",{className:"about-section",children:[r.jsx("h2",{children:e("about.section5Title")}),r.jsx("p",{children:e("about.section5Content")})]}),r.jsxs("section",{className:"about-section",children:[r.jsx("h2",{children:e("about.section6Title")}),r.jsx("p",{children:e("about.section6Content")})]})]}),r.jsxs("div",{className:"about-related-links",children:[r.jsx("h2",{children:e("common.relatedPages")||"ê´€ë ¨ íŽ˜ì´ì§€"}),r.jsxs("nav",{"aria-label":e("common.relatedPages")||"ê´€ë ¨ íŽ˜ì´ì§€",children:[r.jsx("a",{href:"?screen=guide",onClick:o=>{o.preventDefault(),n("guide")},className:"about-link",children:e("header.guide")}),r.jsx("a",{href:"?screen=help",onClick:o=>{o.preventDefault(),n("help")},className:"about-link",children:e("header.help")})]})]})]})})},ko=({title:n,description:e,keywords:o,image:s,type:a="website",url:i="https://chipgames.github.io/ChipPuzzleGame/",noindex:d=!1})=>{const{language:c}=Re(),{t:l}=Re(),h=typeof window!="undefined"?window.location.pathname+window.location.search:"",f=h.includes("screen=guide")||i.includes("screen=guide"),m=h.includes("screen=help")||i.includes("screen=help"),b=h.includes("screen=about")||i.includes("screen=about");let y,M,I;f?(y=l("seo.guideTitle")||l("seo.title"),M=l("seo.guideDescription")||l("seo.description"),I=l("seo.guideKeywords")||l("seo.keywords")):m?(y=l("seo.helpTitle")||l("seo.title"),M=l("seo.helpDescription")||l("seo.description"),I=l("seo.helpKeywords")||l("seo.keywords")):b?(y=l("seo.aboutTitle")||l("seo.title"),M=l("seo.aboutDescription")||l("seo.description"),I=l("seo.aboutKeywords")||l("seo.keywords")):(y=l("seo.title")||"ë§¤ì¹­ í¼ì¦ ê²Œìž„ - CHIP GAMES",M=l("seo.description")||"ë¬´ë£Œ ì˜¨ë¼ì¸ ë§¤ì¹­ í¼ì¦ ê²Œìž„. 1000ê°œì˜ ë„ì „ì ì¸ ìŠ¤í…Œì´ì§€ë¥¼ í”Œë ˆì´í•˜ì„¸ìš”! ë‹¤ì–‘í•œ ìƒ‰ìƒì˜ ì ¬ì„ ë§¤ì¹­í•˜ì—¬ ëª©í‘œë¥¼ ë‹¬ì„±í•˜ëŠ” ìž¬ë¯¸ìžˆëŠ” í¼ì¦ ê²Œìž„ìž…ë‹ˆë‹¤.",I=l("seo.keywords")||"ë§¤ì¹­ê²Œìž„, í¼ì¦ê²Œìž„, ë¬´ë£Œê²Œìž„, ì˜¨ë¼ì¸ê²Œìž„, í¼ì¦, ë§¤ì¹­3, ìº”ë””í¬ëŸ¬ì‹œ, ê²Œìž„, ë¸Œë¼ìš°ì €ê²Œìž„, HTML5ê²Œìž„");const N="https://chipgames.github.io/ChipPuzzleGame/ChipGames_Logo.png",_=n||y,K=e||M,U=o||I,L=s||N,F="https://chipgames.github.io/ChipPuzzleGame/",V=c!=="ko"?`?lang=${c}`:"",pe={"@context":"https://schema.org","@type":"Organization",name:"CHIP GAMES",url:"https://chipgames.github.io",logo:"https://chipgames.github.io/ChipPuzzleGame/ChipGames_Logo.png",sameAs:[]},ye={"@context":"https://schema.org","@type":"VideoGame",name:_,description:K,image:L,url:i,applicationCategory:"Game",operatingSystem:"Web Browser",gamePlatform:"Web Browser",offers:{"@type":"Offer",price:"0",priceCurrency:"KRW"},aggregateRating:{"@type":"AggregateRating",ratingValue:"4.5",ratingCount:"100",bestRating:"5",worstRating:"1"},publisher:{"@type":"Organization",name:"CHIP GAMES",url:"https://chipgames.github.io"},genre:"Puzzle Game",gameItem:{"@type":"Thing",name:"Match Puzzle Game",description:"Match colorful gems to complete challenging stages"},inLanguage:c||"ko",datePublished:"2025-01-01",dateModified:new Date().toISOString().split("T")[0]},Z=[{"@type":"ListItem",position:1,name:c==="ko"?"í™ˆ":c==="en"?"Home":c==="ja"?"ãƒ›ãƒ¼ãƒ ":"é¦–é¡µ",item:`${F}${V}`}];f?Z.push({"@type":"ListItem",position:2,name:l("guide.title")||"ê²Œìž„ ê°€ì´ë“œ",item:`${F}?screen=guide${V}`}):m?Z.push({"@type":"ListItem",position:2,name:l("help.title")||"ë„ì›€ë§",item:`${F}?screen=help${V}`}):b&&Z.push({"@type":"ListItem",position:2,name:l("about.title")||"ê²Œìž„ ì†Œê°œ",item:`${F}?screen=about${V}`});const Se={"@context":"https://schema.org","@type":"BreadcrumbList",itemListElement:Z},D=m?{"@context":"https://schema.org","@type":"FAQPage",mainEntity:[{"@type":"Question",name:l("help.section7Title")||"ìžì£¼ ë¬»ëŠ” ì§ˆë¬¸",acceptedAnswer:{"@type":"Answer",text:l("help.section7Content")||""}}]}:null,R=[pe,{"@context":"https://schema.org","@type":"WebSite",name:"CHIP GAMES - Match Puzzle Game",url:F,publisher:{"@type":"Organization",name:"CHIP GAMES"},inLanguage:[c||"ko","en","ja","zh"]}];return!f&&!m&&!b&&R.push(ye),R.push(Se),D&&R.push(D),r.jsxs(Tt,{children:[r.jsx("title",{children:_}),r.jsx("meta",{name:"description",content:K}),r.jsx("meta",{name:"keywords",content:U}),r.jsx("meta",{name:"theme-color",content:"#667eea"}),r.jsx("meta",{name:"msapplication-TileColor",content:"#667eea"}),d&&r.jsx("meta",{name:"robots",content:"noindex, nofollow"}),r.jsx("link",{rel:"canonical",href:i}),r.jsx("meta",{property:"og:title",content:_}),r.jsx("meta",{property:"og:description",content:K}),r.jsx("meta",{property:"og:image",content:L}),r.jsx("meta",{property:"og:image:secure_url",content:L}),r.jsx("meta",{property:"og:image:width",content:"1200"}),r.jsx("meta",{property:"og:image:height",content:"630"}),r.jsx("meta",{property:"og:image:alt",content:_}),r.jsx("meta",{property:"og:image:type",content:"image/png"}),r.jsx("meta",{property:"og:type",content:a}),r.jsx("meta",{property:"og:url",content:i}),r.jsx("meta",{property:"og:site_name",content:"CHIP GAMES"}),r.jsx("meta",{property:"og:locale",content:c==="ko"?"ko_KR":c==="en"?"en_US":c==="ja"?"ja_JP":"zh_CN"}),r.jsx("meta",{property:"og:updated_time",content:new Date().toISOString()}),r.jsx("meta",{name:"twitter:card",content:"summary_large_image"}),r.jsx("meta",{name:"twitter:title",content:_}),r.jsx("meta",{name:"twitter:description",content:K}),r.jsx("meta",{name:"twitter:image",content:L}),r.jsx("meta",{name:"twitter:image:alt",content:_}),r.jsx("meta",{name:"twitter:site",content:"@CHIPGAMES"}),r.jsx("meta",{name:"twitter:creator",content:"@CHIPGAMES"}),r.jsx("link",{rel:"alternate",hrefLang:"ko",href:`${i}?lang=ko`}),r.jsx("link",{rel:"alternate",hrefLang:"en",href:`${i}?lang=en`}),r.jsx("link",{rel:"alternate",hrefLang:"ja",href:`${i}?lang=ja`}),r.jsx("link",{rel:"alternate",hrefLang:"zh",href:`${i}?lang=zh`}),r.jsx("link",{rel:"alternate",hrefLang:"x-default",href:i}),R.map((z,se)=>r.jsx("script",{type:"application/ld+json",children:JSON.stringify(z)},se))]})};function Xe(){try{}catch(n){}return window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"||window.location.hostname.includes("localhost")}function gt(){window.adsbygoogle&&Array.isArray(window.adsbygoogle)||(window.adsbygoogle=window.adsbygoogle||[])}function Ro(){return!(window.adsbygoogle&&Array.isArray(window.adsbygoogle)&&window.adsbygoogle.some(n=>n.enable_page_level_ads))}function ct(){document.querySelectorAll('iframe[src*="googlesyndication.com"], iframe[src*="doubleclick.net"]').forEach(e=>{try{const o=e;if(o.contentDocument){const s=o.contentDocument.body;s&&s.getAttribute("aria-hidden")==="true"&&s.removeAttribute("aria-hidden")}}catch(o){}})}function To(){if(!Xe()&&(gt(),!!Ro()))try{window.adsbygoogle&&Array.isArray(window.adsbygoogle)&&window.adsbygoogle.push({google_ad_client:"ca-pub-2533613198240039",enable_page_level_ads:!0})}catch(n){Xe()||console.warn("AdSense initialization error:",n)}}function Po(){if(Xe())return;setTimeout(ct,2e3),new MutationObserver(e=>{e.forEach(o=>{o.type==="childList"&&o.addedNodes.forEach(s=>{s.nodeType===1&&s.tagName==="IFRAME"&&setTimeout(ct,1e3)})})}).observe(document.body,{childList:!0,subtree:!0})}const Go=()=>{const[n,e]=S.useState("stageSelect"),[o,s]=S.useState(null);S.useEffect(()=>{let c=!1;try{c=!1}catch(l){}c||(c=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"||window.location.hostname.includes("localhost")),c||(gt(),To(),Po())},[]);const a=c=>{e(c)},i=c=>{s(c),e("game")},d=()=>{const c="https://chipgames.github.io/ChipPuzzleGame/",l=new URLSearchParams(window.location.search).get("lang")||"ko",h=l!=="ko"?`?lang=${l}`:"";switch(n){case"guide":return{title:void 0,description:void 0,keywords:void 0,url:`${c}?screen=guide${h}`,type:"article"};case"help":return{title:void 0,description:void 0,keywords:void 0,url:`${c}?screen=help${h}`,type:"article"};case"about":return{title:void 0,description:void 0,keywords:void 0,url:`${c}?screen=about${h}`,type:"article"};default:return{title:void 0,description:void 0,keywords:void 0,url:`${c}${h}`,type:"website"}}};return r.jsxs(Ot,{children:[r.jsx(ko,le({},d())),r.jsxs("div",{className:"app-container",children:[r.jsx(Yt,{onNavigate:a,currentScreen:n}),r.jsx(qt,{children:n==="guide"?r.jsx(xo,{onNavigate:a}):n==="help"?r.jsx(jo,{onNavigate:a}):n==="about"?r.jsx(Mo,{onNavigate:a}):r.jsx(Co,{stageNumber:o||1,currentScreen:n,onNavigate:a,onStartStage:i})}),r.jsx(Xt,{})]})]})};Ue.createRoot(document.getElementById("root")).render(r.jsx(Rt.StrictMode,{children:r.jsx(Pt,{children:r.jsx(Go,{})})}))});export default No();
