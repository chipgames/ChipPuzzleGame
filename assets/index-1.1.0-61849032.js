var Bt=Object.defineProperty;var Nt=(s,e,r)=>e in s?Bt(s,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[e]=r;var V=(s,e,r)=>(Nt(s,typeof e!="symbol"?e+"":e,r),r);import{r as v,a as _t,g as zt,R as Fe}from"./vendor-1.1.0-57209f9c.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const n of a)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function r(a){const n={};return a.integrity&&(n.integrity=a.integrity),a.referrerPolicy&&(n.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?n.credentials="include":a.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(a){if(a.ep)return;a.ep=!0;const n=r(a);fetch(a.href,n)}})();var wt={exports:{}},qe={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $t=v,It=Symbol.for("react.element"),Ht=Symbol.for("react.fragment"),Ft=Object.prototype.hasOwnProperty,Dt=$t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Yt={key:!0,ref:!0,__self:!0,__source:!0};function Ct(s,e,r){var o,a={},n=null,i=null;r!==void 0&&(n=""+r),e.key!==void 0&&(n=""+e.key),e.ref!==void 0&&(i=e.ref);for(o in e)Ft.call(e,o)&&!Yt.hasOwnProperty(o)&&(a[o]=e[o]);if(s&&s.defaultProps)for(o in e=s.defaultProps,e)a[o]===void 0&&(a[o]=e[o]);return{$$typeof:It,type:s,key:n,ref:i,props:a,_owner:Dt.current}}qe.Fragment=Ht;qe.jsx=Ct;qe.jsxs=Ct;wt.exports=qe;var p=wt.exports,rt={},it=_t;rt.createRoot=it.createRoot,rt.hydrateRoot=it.hydrateRoot;var Tt={exports:{}},Wt="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",Xt=Wt,Ut=Xt;function Mt(){}function Rt(){}Rt.resetWarningCache=Mt;var qt=function(){function s(o,a,n,i,u,l){if(l!==Ut){var f=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw f.name="Invariant Violation",f}}s.isRequired=s;function e(){return s}var r={array:s,bigint:s,bool:s,func:s,number:s,object:s,string:s,symbol:s,any:s,arrayOf:e,element:s,elementType:s,instanceOf:e,node:s,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:Rt,resetWarningCache:Mt};return r.PropTypes=r,r};Tt.exports=qt();var Jt=Tt.exports;const O=zt(Jt);function Vt(s,e){s.prototype=Object.create(e.prototype),s.prototype.constructor=s,st(s,e)}function st(s,e){return st=Object.setPrototypeOf||function(r,o){return r.__proto__=o,r},st(s,e)}var le={BASE:"base",BODY:"body",HEAD:"head",HTML:"html",LINK:"link",META:"meta",NOSCRIPT:"noscript",SCRIPT:"script",STYLE:"style",TITLE:"title",FRAGMENT:"Symbol(react.fragment)"},Kt={rel:["amphtml","canonical","alternate"]},Zt={type:["application/ld+json"]},Qt={charset:"",name:["robots","description"],property:["og:type","og:title","og:url","og:image","og:image:alt","og:description","twitter:url","twitter:title","twitter:description","twitter:image","twitter:image:alt","twitter:card","twitter:site"]};Object.keys(le).map(function(s){return le[s]});var Ue={accesskey:"accessKey",charset:"charSet",class:"className",contenteditable:"contentEditable",contextmenu:"contextMenu","http-equiv":"httpEquiv",itemprop:"itemProp",tabindex:"tabIndex"};Object.keys(Ue).reduce(function(s,e){return s[Ue[e]]=e,s},{});var eo=function(s){return Array.isArray(s)?s.join(""):s},et=function(s,e){return Array.isArray(s)?s.reduce(function(r,o){return function(a,n){for(var i=Object.keys(a),u=0;u<i.length;u+=1)if(n[i[u]]&&n[i[u]].includes(a[i[u]]))return!0;return!1}(o,e)?r.priority.push(o):r.default.push(o),r},{priority:[],default:[]}):{default:s}},to=[le.NOSCRIPT,le.SCRIPT,le.STYLE],tt=function(s,e){return e===void 0&&(e=!0),e===!1?String(s):String(s).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;")},lt=function(s){return Object.keys(s).reduce(function(e,r){var o=s[r]!==void 0?r+'="'+s[r]+'"':""+r;return e?e+" "+o:o},"")},ct=function(s,e){return e===void 0&&(e={}),Object.keys(s).reduce(function(r,o){return r[Ue[o]||o]=s[o],r},e)},Xe=function(s,e){return e.map(function(r,o){var a,n=((a={key:o})["data-rh"]=!0,a);return Object.keys(r).forEach(function(i){var u=Ue[i]||i;u==="innerHTML"||u==="cssText"?n.dangerouslySetInnerHTML={__html:r.innerHTML||r.cssText}:n[u]=r[i]}),Fe.createElement(s,n)})},ke=function(s,e,r){switch(s){case le.TITLE:return{toComponent:function(){return a=e.titleAttributes,(n={key:o=e.title})["data-rh"]=!0,i=ct(a,n),[Fe.createElement(le.TITLE,i,o)];var o,a,n,i},toString:function(){return function(o,a,n,i){var u=lt(n),l=eo(a);return u?"<"+o+' data-rh="true" '+u+">"+tt(l,i)+"</"+o+">":"<"+o+' data-rh="true">'+tt(l,i)+"</"+o+">"}(s,e.title,e.titleAttributes,r)}};case"bodyAttributes":case"htmlAttributes":return{toComponent:function(){return ct(e)},toString:function(){return lt(e)}};default:return{toComponent:function(){return Xe(s,e)},toString:function(){return function(o,a,n){return a.reduce(function(i,u){var l=Object.keys(u).filter(function(y){return!(y==="innerHTML"||y==="cssText")}).reduce(function(y,b){var S=u[b]===void 0?b:b+'="'+tt(u[b],n)+'"';return y?y+" "+S:S},""),f=u.innerHTML||u.cssText||"",d=to.indexOf(o)===-1;return i+"<"+o+' data-rh="true" '+l+(d?"/>":">"+f+"</"+o+">")},"")}(s,e,r)}}}},oo=function(s){var e=s.baseTag,r=s.bodyAttributes,o=s.encode,a=s.htmlAttributes,n=s.noscriptTags,i=s.styleTags,u=s.title,l=u===void 0?"":u,f=s.titleAttributes,d=s.linkTags,y=s.metaTags,b=s.scriptTags,S={toComponent:function(){},toString:function(){return""}};if(s.prioritizeSeoTags){var k=function(F){var A=F.linkTags,X=F.scriptTags,ae=F.encode,D=et(F.metaTags,Qt),B=et(A,Kt),U=et(X,Zt);return{priorityMethods:{toComponent:function(){return[].concat(Xe(le.META,D.priority),Xe(le.LINK,B.priority),Xe(le.SCRIPT,U.priority))},toString:function(){return ke(le.META,D.priority,ae)+" "+ke(le.LINK,B.priority,ae)+" "+ke(le.SCRIPT,U.priority,ae)}},metaTags:D.default,linkTags:B.default,scriptTags:U.default}}(s);S=k.priorityMethods,d=k.linkTags,y=k.metaTags,b=k.scriptTags}return{priority:S,base:ke(le.BASE,e,o),bodyAttributes:ke("bodyAttributes",r,o),htmlAttributes:ke("htmlAttributes",a,o),link:ke(le.LINK,d,o),meta:ke(le.META,y,o),noscript:ke(le.NOSCRIPT,n,o),script:ke(le.SCRIPT,b,o),style:ke(le.STYLE,i,o),title:ke(le.TITLE,{title:l,titleAttributes:f},o)}},We=[],ro=function(s,e){var r=this;e===void 0&&(e=typeof document<"u"),this.instances=[],this.value={setHelmet:function(o){r.context.helmet=o},helmetInstances:{get:function(){return r.canUseDOM?We:r.instances},add:function(o){(r.canUseDOM?We:r.instances).push(o)},remove:function(o){var a=(r.canUseDOM?We:r.instances).indexOf(o);(r.canUseDOM?We:r.instances).splice(a,1)}}},this.context=s,this.canUseDOM=e,e||(s.helmet=oo({baseTag:[],bodyAttributes:{},encodeSpecialCharacters:!0,htmlAttributes:{},linkTags:[],metaTags:[],noscriptTags:[],scriptTags:[],styleTags:[],title:"",titleAttributes:{}}))},so=Fe.createContext({}),no=O.shape({setHelmet:O.func,helmetInstances:O.shape({get:O.func,add:O.func,remove:O.func})}),ao=typeof document<"u",Ie=function(s){function e(r){var o;return(o=s.call(this,r)||this).helmetData=new ro(o.props.context,e.canUseDOM),o}return Vt(e,s),e.prototype.render=function(){return Fe.createElement(so.Provider,{value:this.helmetData.value},this.props.children)},e}(v.Component);Ie.canUseDOM=ao,Ie.propTypes={context:O.shape({helmet:O.shape()}),children:O.node.isRequired},Ie.defaultProps={context:{}},Ie.displayName="HelmetProvider";no.isRequired;O.object,O.object,O.oneOfType([O.arrayOf(O.node),O.node]),O.string,O.bool,O.bool,O.object,O.arrayOf(O.object),O.arrayOf(O.object),O.arrayOf(O.object),O.func,O.arrayOf(O.object),O.arrayOf(O.object),O.string,O.object,O.string,O.bool,O.object;class io{constructor(){V(this,"isDevelopment",!1);V(this,"logHistory",[]);V(this,"maxHistorySize",100)}createLogEntry(e,r,o){return{level:e,message:r,data:o,timestamp:new Date().toISOString(),userAgent:typeof navigator<"u"?navigator.userAgent:void 0,url:typeof window<"u"?window.location.href:void 0}}addToHistory(e){this.logHistory.push(e),this.logHistory.length>this.maxHistorySize&&this.logHistory.shift()}log(e,r,o){const a=this.createLogEntry(e,r,o);if(this.addToHistory(a),this.isDevelopment){const n=console[e]||console.log;o?n(`[${e.toUpperCase()}] ${r}`,o):n(`[${e.toUpperCase()}] ${r}`)}else(e==="error"||e==="warn")&&(o?console[e](`[${e.toUpperCase()}] ${r}`,o):console[e](`[${e.toUpperCase()}] ${r}`));e==="error"&&this.handleError(a)}handleError(e){try{const r=JSON.parse(localStorage.getItem("chipPuzzleGame_errorLogs")||"[]");r.push(e),r.length>50&&r.shift(),localStorage.setItem("chipPuzzleGame_errorLogs",JSON.stringify(r))}catch(r){console.warn("Failed to save error log to localStorage",r)}}debug(e,r){this.log("debug",e,r)}info(e,r){this.log("info",e,r)}warn(e,r){this.log("warn",e,r)}error(e,r){this.log("error",e,r)}getHistory(){return[...this.logHistory]}clearHistory(){this.logHistory=[]}getErrorLogs(){try{return JSON.parse(localStorage.getItem("chipPuzzleGame_errorLogs")||"[]")}catch{return[]}}clearErrorLogs(){try{localStorage.removeItem("chipPuzzleGame_errorLogs")}catch{}}}const I=new io;class lo extends v.Component{constructor(){super(...arguments);V(this,"state",{hasError:!1,error:null,errorInfo:null});V(this,"handleReload",()=>{window.location.reload()});V(this,"handleReset",()=>{this.setState({hasError:!1,error:null,errorInfo:null})})}static getDerivedStateFromError(r){return{hasError:!0,error:r}}componentDidCatch(r,o){I.error("ErrorBoundary caught an error",{error:{message:r.message,stack:r.stack,name:r.name},errorInfo:{componentStack:o.componentStack},timestamp:new Date().toISOString()}),this.setState({errorInfo:o})}render(){return this.state.hasError?this.props.fallback?this.props.fallback:p.jsx("div",{className:"error-boundary",role:"alert","aria-live":"assertive",children:p.jsxs("div",{className:"error-boundary-content",children:[p.jsx("div",{className:"error-boundary-icon",children:"âš ï¸"}),p.jsx("h2",{className:"error-boundary-title",children:this.getLocalizedText("error.title")}),p.jsx("p",{className:"error-boundary-message",children:this.getLocalizedText("error.message")}),!1,p.jsxs("div",{className:"error-boundary-actions",children:[p.jsx("button",{className:"error-boundary-button error-boundary-button-primary",onClick:this.handleReload,"aria-label":this.getLocalizedText("error.reload"),children:this.getLocalizedText("error.reload")}),!1]})]})}):this.props.children}getLocalizedText(r){var n;let o="ko";try{o=localStorage.getItem("language")||"ko"}catch{}const a={ko:{"error.title":"ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤","error.message":"ê²Œìž„ì„ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.","error.details":"ì—ëŸ¬ ìƒì„¸ ì •ë³´","error.reload":"ìƒˆë¡œê³ ì¹¨","error.reset":"ë‹¤ì‹œ ì‹œë„"},en:{"error.title":"An Error Occurred","error.message":"Please refresh the game.","error.details":"Error Details","error.reload":"Reload","error.reset":"Try Again"},zh:{"error.title":"å‘ç”Ÿé”™è¯¯","error.message":"è¯·åˆ·æ–°æ¸¸æˆã€‚","error.details":"é”™è¯¯è¯¦æƒ…","error.reload":"é‡æ–°åŠ è½½","error.reset":"é‡è¯•"},ja:{"error.title":"ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ","error.message":"ã‚²ãƒ¼ãƒ ã‚’ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã—ã¦ãã ã•ã„ã€‚","error.details":"ã‚¨ãƒ©ãƒ¼è©³ç´°","error.reload":"ãƒªãƒ­ãƒ¼ãƒ‰","error.reset":"å†è©¦è¡Œ"}};return((n=a[o])==null?void 0:n[r])||a.ko[r]||r}}const co="modulepreload",uo=function(s){return"/ChipPuzzleGame/"+s},ut={},$e=function(e,r,o){if(!r||r.length===0)return e();const a=document.getElementsByTagName("link");return Promise.all(r.map(n=>{if(n=uo(n),n in ut)return;ut[n]=!0;const i=n.endsWith(".css"),u=i?'[rel="stylesheet"]':"";if(!!o)for(let d=a.length-1;d>=0;d--){const y=a[d];if(y.href===n&&(!i||y.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${n}"]${u}`))return;const f=document.createElement("link");if(f.rel=i?"stylesheet":co,i||(f.as="script",f.crossOrigin=""),f.href=n,document.head.appendChild(f),i)return new Promise((d,y)=>{f.addEventListener("load",d),f.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${n}`)))})})).then(()=>e()).catch(n=>{const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=n,window.dispatchEvent(i),!i.defaultPrevented)throw n})},fo=(s,e)=>{const r=s[e];return r?typeof r=="function"?r():Promise.resolve(r):new Promise((o,a)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(a.bind(null,new Error("Unknown variable dynamic import: "+e)))})},kt=["en","ko","zh","ja"],ho="en",po={en:"English",ko:"í•œêµ­ì–´",zh:"ä¸­æ–‡",ja:"æ—¥æœ¬èªž"};class ft{constructor(){V(this,"supportedLanguages",kt);V(this,"defaultLanguage",ho)}detectBrowserLanguage(){const e=navigator.language.split("-")[0];return this.supportedLanguages.includes(e)?e:this.defaultLanguage}getStoredLanguage(){try{return localStorage.getItem("language")}catch(e){return I.error("Failed to get stored language",{error:e}),null}}setLanguage(e){if(this.supportedLanguages.includes(e))try{localStorage.setItem("language",e),window.dispatchEvent(new CustomEvent("languageChanged",{detail:e})),I.debug("Language changed",{language:e})}catch(r){I.error("Failed to set language",{error:r,language:e})}}getCurrentLanguage(){const e=this.getStoredLanguage();return e&&this.supportedLanguages.includes(e)?e:this.detectBrowserLanguage()}}const ot={},De=()=>{const[s,e]=v.useState(()=>new ft().getCurrentLanguage()),[r,o]=v.useState(null),[a,n]=v.useState(!0);return v.useEffect(()=>{(async()=>{n(!0);try{if(ot[s]){o(ot[s]),n(!1);return}const d=await fo(Object.assign({"../locales/en.json":()=>$e(()=>import("./en-1.1.0-e7db67a3.js"),[]),"../locales/ja.json":()=>$e(()=>import("./ja-1.1.0-bab27d3d.js"),[]),"../locales/ko.json":()=>$e(()=>import("./ko-1.1.0-4db41d21.js"),[]),"../locales/zh.json":()=>$e(()=>import("./zh-1.1.0-5a298355.js"),[])}),`../locales/${s}.json`);ot[s]=d.default,o(d.default),I.debug("Translations loaded",{language:s})}catch(d){I.error("Failed to load translations",{language:s,error:d});try{const y=await $e(()=>import("./en-1.1.0-e7db67a3.js"),[]);o(y.default),I.info("Fallback translations loaded",{language:"en"})}catch(y){I.error("Failed to load fallback translations",{error:y})}}finally{n(!1)}})();const f=d=>{e(d.detail)};return window.addEventListener("languageChanged",f),()=>{window.removeEventListener("languageChanged",f)}},[s]),{language:s,setLanguage:l=>{new ft().setLanguage(l)},t:l=>{if(a||!r)return l;const f=l.split(".");let d=r;for(const y of f)if(d=d==null?void 0:d[y],d===void 0)break;return d||l},isLoading:a}},Pt=()=>{const{language:s,setLanguage:e}=De();return p.jsx("select",{value:s,onChange:r=>e(r.target.value),className:"language-selector","aria-label":"Language selector",children:kt.map(r=>p.jsx("option",{value:r,children:po[r]},r))})};class go{constructor(){V(this,"audioCtx",null);V(this,"enabled",!0)}getContext(){if(!this.enabled)return null;try{if(!this.audioCtx){const e=window.AudioContext||window.webkitAudioContext;if(!e)return I.warn("Web Audio API is not supported in this browser"),this.enabled=!1,null;try{this.audioCtx=new e,this.audioCtx.state==="suspended"&&this.audioCtx.resume().catch(r=>{I.warn("Failed to resume AudioContext",{error:r})})}catch(r){return I.warn("Failed to create AudioContext",{error:r}),this.enabled=!1,null}}return this.audioCtx}catch(e){return I.warn("Failed to initialize AudioContext",{error:e}),this.enabled=!1,null}}setEnabled(e){this.enabled=e}playTone(e,r,o="sine",a=.2){const n=this.getContext();if(!n)return;const i=n.createOscillator(),u=n.createGain();i.type=o,i.frequency.value=e,u.gain.value=a,i.connect(u),u.connect(n.destination);const l=n.currentTime;i.start(l),i.stop(l+r),u.gain.setValueAtTime(a,l),u.gain.linearRampToValueAtTime(0,l+r)}playClick(){this.playTone(440,.08,"square",.15)}playMatch(){this.playTone(660,.12,"triangle",.2)}playSpecial(){this.playTone(880,.16,"sawtooth",.22)}playStageClear(){this.getContext()&&(this.playTone(880,.15,"triangle",.22),setTimeout(()=>{this.playTone(1046.5,.18,"triangle",.22)},120))}playGameOver(){const e=this.getContext();if(!e)return;const r=440,o=220,a=.4,n=e.createOscillator(),i=e.createGain();n.type="sawtooth",n.frequency.setValueAtTime(r,e.currentTime),n.frequency.exponentialRampToValueAtTime(o,e.currentTime+a),i.gain.value=.22,i.gain.setValueAtTime(.22,e.currentTime),i.gain.linearRampToValueAtTime(0,e.currentTime+a),n.connect(i),i.connect(e.destination),n.start(e.currentTime),n.stop(e.currentTime+a)}}const de=new go;class mo{isAvailable(){try{const e="__storage_test__";return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch{return!1}}get(e,r={}){if(!this.isAvailable())return r.silent||I.warn("LocalStorage is not available",{key:e}),r.fallback??null;try{const o=localStorage.getItem(e);return o===null?r.fallback??null:JSON.parse(o)}catch(o){return I.error("Failed to get item from LocalStorage",{key:e,error:o}),r.fallback??null}}set(e,r,o={}){if(!this.isAvailable())return o.silent||I.warn("LocalStorage is not available",{key:e}),!1;try{const a=JSON.stringify(r),n=5*1024*1024;return a.length>n?(I.error("Storage size exceeds limit",{key:e,size:a.length,maxSize:n}),!1):(localStorage.setItem(e,a),!0)}catch(a){return I.error("Failed to set item to LocalStorage",{key:e,error:a}),!1}}remove(e,r={}){if(!this.isAvailable())return r.silent||I.warn("LocalStorage is not available",{key:e}),!1;try{return localStorage.removeItem(e),!0}catch(o){return I.error("Failed to remove item from LocalStorage",{key:e,error:o}),!1}}clearGameData(){if(!this.isAvailable())return!1;try{const r=Object.keys(localStorage).filter(o=>o.startsWith("chipPuzzleGame_"));return r.forEach(o=>localStorage.removeItem(o)),I.info("Game data cleared",{count:r.length}),!0}catch(e){return I.error("Failed to clear game data",{error:e}),!1}}available(){return this.isAvailable()}}const Be=new mo;const dt=s=>`/ChipPuzzleGame/${s}`,yo=({onNavigate:s,currentScreen:e})=>{const{t:r}=De(),[o,a]=v.useState(()=>Be.get("chipPuzzleGame_soundEnabled",{fallback:!0,silent:!0})??!0),[n,i]=v.useState(!1);v.useEffect(()=>{de.setEnabled(o),Be.set("chipPuzzleGame_soundEnabled",o,{silent:!0})},[o]),v.useEffect(()=>(n?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[n]),v.useEffect(()=>{const y=b=>{const S=b.target;n&&!S.closest(".header-nav")&&!S.closest(".header-hamburger")&&i(!1)};if(n)return document.addEventListener("click",y),()=>{document.removeEventListener("click",y)}},[n]);const u=y=>{s&&s(y),i(!1)},l=()=>{a(!o),o||de.playClick()},f=()=>{i(!n),o&&de.playClick()},d=!1;return p.jsx("header",{className:"header",children:p.jsxs("div",{className:"header-content",children:[p.jsxs("div",{className:"header-left",children:[d,p.jsxs("div",{className:"header-logo",onClick:()=>u("stageSelect"),style:{cursor:"pointer",display:"flex",alignItems:"center",gap:"12px"},children:[p.jsx("img",{src:dt("ChipGames_Logo.png"),onError:y=>{const b=y.target;b.src&&!b.src.includes(".svg")&&(b.src=dt("ChipGames_Logo.svg"))},alt:"CHIP GAMES",style:{height:"40px",width:"auto"}}),p.jsx("span",{className:"header-game-title",children:r("header.gameTitle")})]})]}),p.jsxs("nav",{className:`header-nav ${n?"mobile-open":""}`,children:[p.jsx("button",{className:"header-nav-button",onClick:()=>u("stageSelect"),children:r("header.playGame")}),p.jsx("button",{className:"header-nav-button",onClick:()=>u("guide"),children:r("header.guide")}),p.jsx("button",{className:"header-nav-button",onClick:()=>u("help"),children:r("header.help")})]}),p.jsxs("div",{className:"header-right",children:[p.jsx("button",{className:"header-sound-button",onClick:l,title:r(o?"header.soundOff":"header.soundOn"),children:o?"ðŸ”Š":"ðŸ”‡"}),p.jsx(Pt,{}),p.jsxs("button",{className:"header-hamburger",onClick:f,"aria-label":"ë©”ë‰´","aria-expanded":n,children:[p.jsx("span",{className:`hamburger-line ${n?"active":""}`}),p.jsx("span",{className:`hamburger-line ${n?"active":""}`}),p.jsx("span",{className:`hamburger-line ${n?"active":""}`})]})]})]})})};const bo="1.1.0",So=()=>{const{t:s}=De(),[e,r]=v.useState(!1),[o,a]=v.useState(!1),n=l=>{l.preventDefault(),r(!0),de.playClick(),I.info("Privacy policy modal opened")},i=l=>{l.preventDefault(),a(!0),de.playClick(),I.info("Contact modal opened")},u=()=>{r(!1),a(!1),de.playClick()};return v.useEffect(()=>{const l=f=>{f.key==="Escape"&&(e||o)&&u()};return(e||o)&&(document.addEventListener("keydown",l),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",l),document.body.style.overflow=""}},[e,o]),p.jsxs(p.Fragment,{children:[p.jsx("footer",{className:"footer",role:"contentinfo",children:p.jsxs("div",{className:"footer-content",children:[p.jsxs("nav",{className:"footer-links","aria-label":s("footer.navigation"),children:[p.jsx("a",{href:"#privacy",onClick:n,"aria-label":s("footer.privacyPolicy"),className:"footer-link",children:s("footer.privacyPolicy")}),p.jsx("a",{href:"#contact",onClick:i,"aria-label":s("footer.contactUs"),className:"footer-link",children:s("footer.contactUs")})]}),p.jsx("div",{className:"footer-center",children:p.jsx(Pt,{})}),p.jsxs("div",{className:"footer-copyright","aria-label":s("footer.copyright"),children:[s("footer.copyright")," | v",bo]})]})}),e&&p.jsx("div",{className:"footer-modal-overlay",onClick:u,role:"dialog","aria-modal":"true","aria-labelledby":"privacy-modal-title",children:p.jsxs("div",{className:"footer-modal",onClick:l=>l.stopPropagation(),children:[p.jsxs("div",{className:"footer-modal-header",children:[p.jsx("h2",{id:"privacy-modal-title",children:s("footer.privacyPolicy")}),p.jsx("button",{className:"footer-modal-close",onClick:u,"aria-label":s("common.close"),children:"Ã—"})]}),p.jsxs("div",{className:"footer-modal-content",children:[p.jsxs("div",{className:"footer-modal-section",children:[p.jsx("h3",{children:s("footer.privacySection1Title")}),p.jsx("p",{children:s("footer.privacySection1Content")})]}),p.jsxs("div",{className:"footer-modal-section",children:[p.jsx("h3",{children:s("footer.privacySection2Title")}),p.jsx("p",{children:s("footer.privacySection2Content")})]}),p.jsxs("div",{className:"footer-modal-section",children:[p.jsx("h3",{children:s("footer.privacySection3Title")}),p.jsx("p",{children:s("footer.privacySection3Content")})]}),p.jsxs("div",{className:"footer-modal-section",children:[p.jsx("h3",{children:s("footer.privacySection4Title")}),p.jsx("p",{children:s("footer.privacySection4Content")})]})]})]})}),o&&p.jsx("div",{className:"footer-modal-overlay",onClick:u,role:"dialog","aria-modal":"true","aria-labelledby":"contact-modal-title",children:p.jsxs("div",{className:"footer-modal",onClick:l=>l.stopPropagation(),children:[p.jsxs("div",{className:"footer-modal-header",children:[p.jsx("h2",{id:"contact-modal-title",children:s("footer.contactUs")}),p.jsx("button",{className:"footer-modal-close",onClick:u,"aria-label":s("common.close"),children:"Ã—"})]}),p.jsxs("div",{className:"footer-modal-content",children:[p.jsxs("div",{className:"footer-modal-section",children:[p.jsx("h3",{children:s("footer.contactSection1Title")}),p.jsx("p",{children:s("footer.contactSection1Content")})]}),p.jsxs("div",{className:"footer-modal-section",children:[p.jsx("h3",{children:s("footer.contactSection2Title")}),p.jsx("p",{children:s("footer.contactSection2Content")})]}),p.jsxs("div",{className:"footer-modal-section",children:[p.jsx("h3",{children:s("footer.contactSection3Title")}),p.jsx("p",{children:s("footer.contactSection3Content")})]})]})]})})]})};const vo=({children:s})=>p.jsx("div",{className:"game-container",children:s}),xt={aspectRatio:16/9,gridRows:9,gridCols:9,pixelRatio:window.devicePixelRatio||1};const wo=({config:s,onReady:e,onResize:r})=>{const o=v.useRef(null),a=v.useRef(null),n=v.useRef(e),i=v.useRef(r),u=v.useRef(!1),[l,f]=v.useState(null),{t:d}=De();return v.useEffect(()=>{n.current=e},[e]),v.useEffect(()=>{i.current=r},[r]),v.useEffect(()=>{const y=o.current,b=a.current;if(!y||!b)return;const S=y.getContext("2d");if(!S){const A="Canvas 2D context is not supported";I.error(A),f(A);return}l&&f(null);const k=()=>{const A=window.devicePixelRatio||1,X=b.clientWidth,ae=b.clientHeight,D=s.aspectRatio||xt.aspectRatio||16/9,B=1200,U=675;let ce,Ce;const Te=Math.min(X,B),ye=Math.min(ae,U);Te/ye>D?(Ce=ye,ce=Ce*D):(ce=Te,Ce=ce/D),y.width=ce*A,y.height=Ce*A,S.scale(A,A),y.style.width=`${ce}px`,y.style.height=`${Ce}px`,y.style.display="block",y.style.maxWidth="100%",y.style.maxHeight="100%",!u.current&&n.current&&(u.current=!0,n.current(y,S)),u.current&&i.current&&setTimeout(()=>{i.current&&i.current(y,S)},0)};k();const F=new ResizeObserver(()=>{k()});return F.observe(b),()=>{F.disconnect(),u.current=!1}},[s]),l?p.jsx("div",{className:"game-canvas-error",role:"alert",children:p.jsxs("div",{className:"game-canvas-error-content",children:[p.jsx("div",{className:"game-canvas-error-icon",children:"âš ï¸"}),p.jsx("h3",{children:d("error.canvasNotSupported")}),p.jsx("p",{children:d("error.canvasFallbackMessage")}),p.jsx("button",{onClick:()=>{f(null),window.location.reload()},className:"game-canvas-error-button",children:d("error.reload")})]})}):p.jsx("div",{ref:a,className:"game-canvas-wrapper",children:p.jsx("canvas",{ref:o,className:"game-canvas"})})},Ne=["red","yellow","blue","green","purple","orange"],He={red:{light:"#e74c3c",dark:"#c0392b"},yellow:{light:"#f1c40f",dark:"#f39c12"},blue:{light:"#3498db",dark:"#2980b9"},green:{light:"#2ecc71",dark:"#27ae60"},purple:{light:"#9b59b6",dark:"#8e44ad"},orange:{light:"#e67e22",dark:"#d35400"}};class Co{constructor(e,r){V(this,"ctx");V(this,"cellSize");this.ctx=e,this.cellSize=r}render(e,r=1){this.ctx.save();const o=e.x+this.cellSize/2,a=e.y+this.cellSize/2;switch(this.ctx.translate(o,a),this.ctx.scale(e.scale||1,e.scale||1),this.ctx.rotate(e.rotation||0),this.ctx.globalAlpha=r,e.type){case"normal":this.renderNormalGem(e);break;case"striped":this.renderStripedGem(e);break;case"wrapped":this.renderWrappedGem(e);break;case"colorBomb":this.renderColorBomb(e);break}this.ctx.restore()}renderNormalGem(e){const r=He[e.color],o=this.cellSize*.85,a=-o/2;this.ctx.fillStyle="rgba(0, 0, 0, 0.2)",this.roundRect(a+2,a+2,o,o,o*.2),this.ctx.fill();const n=this.ctx.createLinearGradient(a,a,a+o,a+o);n.addColorStop(0,r.light),n.addColorStop(1,r.dark),this.ctx.fillStyle=n,this.roundRect(a,a,o,o,o*.2),this.ctx.fill(),this.renderColorPattern(e.color,a,o),this.ctx.fillStyle="rgba(255, 255, 255, 0.3)",this.roundRect(a,a,o,o*.4,o*.2),this.ctx.fill(),this.ctx.strokeStyle=this.getBorderColor(e.color),this.ctx.lineWidth=o*.06,this.roundRect(a,a,o,o,o*.2),this.ctx.stroke()}getBorderColor(e){return{red:"rgba(231, 76, 60, 0.9)",yellow:"rgba(241, 196, 15, 0.9)",blue:"rgba(52, 152, 219, 0.9)",green:"rgba(46, 204, 113, 0.9)",purple:"rgba(155, 89, 182, 0.9)",orange:"rgba(230, 126, 34, 0.9)"}[e]}renderColorPattern(e,r,o){switch(this.ctx.save(),this.ctx.globalAlpha=.5,e){case"red":this.ctx.fillStyle="rgba(255, 255, 255, 0.6)",this.ctx.beginPath(),this.ctx.arc(0,0,o*.18,0,Math.PI*2),this.ctx.fill(),this.ctx.fillStyle="rgba(192, 57, 43, 0.5)",this.ctx.beginPath(),this.ctx.arc(0,0,o*.1,0,Math.PI*2),this.ctx.fill();break;case"yellow":this.ctx.fillStyle="rgba(255, 255, 255, 0.7)",this.drawStar(0,0,o*.1,o*.18,5),this.ctx.fill();break;case"blue":this.ctx.fillStyle="rgba(255, 255, 255, 0.6)",this.ctx.beginPath(),this.ctx.moveTo(0,-o*.18),this.ctx.lineTo(o*.18,0),this.ctx.lineTo(0,o*.18),this.ctx.lineTo(-o*.18,0),this.ctx.closePath(),this.ctx.fill();break;case"green":this.ctx.fillStyle="rgba(255, 255, 255, 0.6)",this.ctx.beginPath(),this.ctx.moveTo(0,-o*.18),this.ctx.lineTo(-o*.15,o*.12),this.ctx.lineTo(o*.15,o*.12),this.ctx.closePath(),this.ctx.fill();break;case"purple":this.ctx.fillStyle="rgba(255, 255, 255, 0.6)",this.ctx.fillRect(-o*.12,-o*.12,o*.24,o*.24);break;case"orange":this.ctx.fillStyle="rgba(255, 255, 255, 0.6)",this.ctx.beginPath();for(let a=0;a<6;a++){const n=Math.PI/3*a,i=Math.cos(n)*o*.15,u=Math.sin(n)*o*.15;a===0?this.ctx.moveTo(i,u):this.ctx.lineTo(i,u)}this.ctx.closePath(),this.ctx.fill(),this.ctx.fillStyle="rgba(211, 84, 0, 0.5)",this.ctx.beginPath(),this.ctx.arc(0,0,o*.08,0,Math.PI*2),this.ctx.fill();break}this.ctx.restore()}renderStripedGem(e){const r=He[e.color],o=this.cellSize*.85,a=-o/2,n=this.ctx.createLinearGradient(a,a,a+o,a+o);if(n.addColorStop(0,r.light),n.addColorStop(1,r.dark),this.ctx.fillStyle=n,this.roundRect(a,a,o,o,o*.2),this.ctx.fill(),this.ctx.strokeStyle="rgba(255, 255, 255, 0.6)",this.ctx.lineWidth=o*.1,this.ctx.lineCap="round",e.stripedDirection==="horizontal")for(let i=0;i<3;i++){const u=a+o/4*(i+1);this.ctx.beginPath(),this.ctx.moveTo(a,u),this.ctx.lineTo(a+o,u),this.ctx.stroke()}else for(let i=0;i<3;i++){const u=a+o/4*(i+1);this.ctx.beginPath(),this.ctx.moveTo(u,a),this.ctx.lineTo(u,a+o),this.ctx.stroke()}}renderWrappedGem(e){const r=He[e.color],o=this.cellSize*.85,a=-o/2,n=this.ctx.createLinearGradient(a,a,a+o,a+o);n.addColorStop(0,r.light),n.addColorStop(1,r.dark),this.ctx.fillStyle=n,this.roundRect(a,a,o,o,o*.2),this.ctx.fill(),this.ctx.strokeStyle="rgba(255, 255, 255, 0.8)",this.ctx.lineWidth=o*.08,this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.moveTo(a,a),this.ctx.lineTo(a+o,a+o),this.ctx.moveTo(a+o,a),this.ctx.lineTo(a,a+o),this.ctx.stroke()}renderColorBomb(e){const r=this.cellSize*.85,o=-r/2,a=this.ctx.createLinearGradient(o,o,o+r,o+r);a.addColorStop(0,"#ff6b6b"),a.addColorStop(.2,"#ffd93d"),a.addColorStop(.4,"#4ecdc4"),a.addColorStop(.6,"#95e1d3"),a.addColorStop(.8,"#a29bfe"),a.addColorStop(1,"#fd79a8"),this.ctx.fillStyle=a,this.roundRect(o,o,r,r,r*.2),this.ctx.fill(),this.ctx.fillStyle="rgba(255, 255, 255, 0.9)",this.drawStar(0,0,r*.3,r*.6,5),this.ctx.fill()}roundRect(e,r,o,a,n){this.ctx.beginPath(),this.ctx.moveTo(e+n,r),this.ctx.lineTo(e+o-n,r),this.ctx.quadraticCurveTo(e+o,r,e+o,r+n),this.ctx.lineTo(e+o,r+a-n),this.ctx.quadraticCurveTo(e+o,r+a,e+o-n,r+a),this.ctx.lineTo(e+n,r+a),this.ctx.quadraticCurveTo(e,r+a,e,r+a-n),this.ctx.lineTo(e,r+n),this.ctx.quadraticCurveTo(e,r,e+n,r),this.ctx.closePath()}drawStar(e,r,o,a,n){this.ctx.beginPath();for(let i=0;i<n*2;i++){const u=Math.PI*i/n,l=i%2===0?a:o,f=e+Math.cos(u)*l,d=r+Math.sin(u)*l;i===0?this.ctx.moveTo(f,d):this.ctx.lineTo(f,d)}this.ctx.closePath()}}const ht={rows:9,cols:9};function Oe(s){var o,a;const e=[],r=new Set;for(let n=0;n<s.length;n++){let i=1,u=(o=s[n][0])==null?void 0:o.color,l=0;for(let f=1;f<=s[n].length;f++){const d=s[n][f];if(d&&d.color===u&&u)i++;else{if(i>=3&&u){const y=[];for(let b=0;b<i;b++){const S={row:n,col:l+b},k=`${S.row},${S.col}`;r.has(k)||(y.push(S),r.add(k))}y.length>0&&e.push({type:"horizontal",positions:y})}d?(i=1,u=d.color,l=f):(i=0,u=void 0)}}}if(s.length>0)for(let n=0;n<s[0].length;n++){let i=1,u=(a=s[0][n])==null?void 0:a.color,l=0;for(let f=1;f<=s.length;f++){const d=f<s.length?s[f][n]:null;if(d&&d.color===u&&u)i++;else{if(i>=3&&u){const y=[];for(let b=0;b<i;b++){const S={row:l+b,col:n},k=`${S.row},${S.col}`;r.has(k)||(y.push(S),r.add(k))}y.length>0&&e.push({type:"vertical",positions:y})}d?(i=1,u=d.color,l=f):(i=0,u=void 0)}}}return e}class To{constructor(e){V(this,"seed");this.seed=e}next(){return this.seed=(this.seed*9301+49297)%233280,this.seed/233280}}function pt(s){const e=new To(s),r=Mo(s),o=Ro(s),a=ko(s),n=Po(r.rows,r.cols,e);return{stageNumber:s,gridSize:r,targetScore:o,maxMoves:a,goals:[{type:"score",target:o,current:0}],initialBoard:n}}function Mo(s){return s<=100?{rows:9,cols:9}:s<=300?{rows:8,cols:8}:s<=600?{rows:7,cols:7}:{rows:6,cols:6}}function Ro(s){const o=Math.floor(s/100)*500;return 1e3+s*50+o}function ko(s){const r=Math.floor(s/20),o=20;return s>500?Math.max(o,50-r-Math.floor((s-500)/10)):Math.max(o,50-r)}function Po(s,e,r){const o=[];for(let a=0;a<s;a++){o[a]=[];for(let n=0;n<e;n++){const i=Ne[Math.floor(r.next()*Ne.length)];o[a][n]={id:`${a}-${n}-${Date.now()}`,color:i,type:"normal",position:{row:a,col:n},x:0,y:0,targetX:void 0,targetY:void 0,scale:1,rotation:0}}}return xo(o,r)}function xo(s,e){var n,i,u,l,f;let o=0;const a=e?()=>e.next():()=>Math.random();try{for(;o<100;){const d=Oe(s);if(d.length===0)return s;for(const y of d)for(const b of y.positions){const S=(n=s[b.row])==null?void 0:n[b.col];if(S){const k=Ne.indexOf(S.color),F=Ne.filter((ae,D)=>D!==k);if(F.length===0)continue;let A=S.color,X=0;for(;X<10&&A===S.color;){const ae=Math.floor(a()*F.length),D=F[ae];[(i=s[b.row-1])==null?void 0:i[b.col],(u=s[b.row+1])==null?void 0:u[b.col],(l=s[b.row])==null?void 0:l[b.col-1],(f=s[b.row])==null?void 0:f[b.col+1]].filter(Boolean).some(ce=>(ce==null?void 0:ce.color)===D)?X++:A=D}A===S.color&&F.length>0&&(A=F[0]),S.color=A}}o++}}catch(d){I.error("Error in ensureNoInitialMatches",{error:d})}return s}function gt(s,e=50){var n;const r=s.map(i=>[...i]),o=r.length,a=((n=r[0])==null?void 0:n.length)||0;for(let i=0;i<a;i++){let u=o-1;for(let l=o-1;l>=0;l--)if(r[l][i]!==null){if(u!==l){const f=r[l][i];r[u][i]=f,(f.y===void 0||f.y===0)&&(f.y=l*e),f.targetY=u,f.position.row=u,r[l][i]=null}u--}for(let l=u;l>=0;l--){const f=Eo(l,i);f.y=-e*(u-l+1),f.targetY=l,r[l][i]=f}}return r}function Eo(s,e){const r=Ne[Math.floor(Math.random()*Ne.length)];return{id:`${Date.now()}-${s}-${e}-${Math.random()}`,color:r,type:"normal",position:{row:s,col:e},x:0,y:0,targetX:void 0,targetY:void 0,scale:1,rotation:0}}function Ao(s){const e=[];for(const r of s){const o=r.positions.length;if(o===4){const a=Math.floor(o/2),n=r.positions[a];e.push({position:n,type:"striped",stripedDirection:r.type==="horizontal"?"horizontal":"vertical"})}else if(o>=5){const a=Math.floor(o/2),n=r.positions[a];e.push({position:n,type:"colorBomb"})}}return e}function Oo(s){const e=[],r=s.filter(a=>a.type==="horizontal"),o=s.filter(a=>a.type==="vertical");for(const a of r)for(const n of o){const i=a.positions.find(u=>n.positions.some(l=>u.row===l.row&&u.col===l.col));i&&e.push({position:i,type:"wrapped"})}return e}function Go(s){const e=Oo(s),r=s.filter(n=>!e.some(i=>{var u,l;return i.position.row===((u=n.positions[0])==null?void 0:u.row)&&i.position.col===((l=n.positions[0])==null?void 0:l.col)})),o=[];o.push(...e);const a=Ao(r);for(const n of a)e.some(u=>u.position.row===n.position.row&&u.position.col===n.position.col)||o.push(n);return o}function Lo(s,e,r){var i,u,l;const o=[],{row:a,col:n}=s.position;if(r==="horizontal")for(let f=0;f<((i=e[0])==null?void 0:i.length);f++)(u=e[a])!=null&&u[f]&&o.push({row:a,col:f});else for(let f=0;f<e.length;f++)(l=e[f])!=null&&l[n]&&o.push({row:f,col:n});return{positionsToRemove:o,score:o.length*20}}function jo(s,e){var n,i;const r=[],{row:o,col:a}=s.position;for(let u=o-1;u<=o+1;u++)for(let l=a-1;l<=a+1;l++)u>=0&&u<e.length&&l>=0&&l<(((n=e[0])==null?void 0:n.length)||0)&&((i=e[u])!=null&&i[l])&&r.push({row:u,col:l});return{positionsToRemove:r,score:r.length*30}}function Bo(s,e){var a,n;const r=[],o=s.color;for(let i=0;i<e.length;i++)for(let u=0;u<(((a=e[i])==null?void 0:a.length)||0);u++){const l=(n=e[i])==null?void 0:n[u];l&&l.color===o&&r.push({row:i,col:u})}return{positionsToRemove:r,score:r.length*50}}function No(s,e,r){var u,l,f;const o=[],{row:a,col:n}=s.position;for(let d=0;d<((u=r[0])==null?void 0:u.length);d++)(l=r[a])!=null&&l[d]&&o.push({row:a,col:d});for(let d=0;d<r.length;d++)(f=r[d])!=null&&f[n]&&o.push({row:d,col:n});const i=Array.from(new Set(o.map(d=>`${d.row},${d.col}`))).map(d=>{const[y,b]=d.split(",").map(Number);return{row:y,col:b}});return{positionsToRemove:i,score:i.length*30}}function _o(s,e,r){var f,d,y,b;const o=[],a=s.type==="striped"?s:e,n=s.type==="wrapped"?s:e,i=a.stripedDirection||"horizontal",{row:u,col:l}=n.position;if(i==="horizontal"){for(let S=u-1;S<=u+1;S++)if(S>=0&&S<r.length)for(let k=0;k<((f=r[0])==null?void 0:f.length);k++)(d=r[S])!=null&&d[k]&&o.push({row:S,col:k})}else for(let S=l-1;S<=l+1;S++)if(S>=0&&S<(((y=r[0])==null?void 0:y.length)||0))for(let k=0;k<r.length;k++)(b=r[k])!=null&&b[S]&&o.push({row:k,col:S});return{positionsToRemove:o,score:o.length*40}}function zo(s,e,r){var u,l,f,d;const o=[],a=s.type==="striped"?s:e,n=a.color;if((a.stripedDirection||"horizontal")==="horizontal")for(let y=0;y<r.length;y++)for(let b=0;b<(((u=r[y])==null?void 0:u.length)||0);b++){const S=(l=r[y])==null?void 0:l[b];S&&S.color===n&&o.push({row:y,col:b})}else for(let y=0;y<(((f=r[0])==null?void 0:f.length)||0);y++)for(let b=0;b<r.length;b++){const S=(d=r[b])==null?void 0:d[y];S&&S.color===n&&o.push({row:b,col:y})}return{positionsToRemove:o,score:o.length*60}}function $o(s,e,r){var i,u;const o=[],{row:a,col:n}=s.position;for(let l=a-2;l<=a+2;l++)for(let f=n-2;f<=n+2;f++)l>=0&&l<r.length&&f>=0&&f<(((i=r[0])==null?void 0:i.length)||0)&&((u=r[l])!=null&&u[f])&&o.push({row:l,col:f});return{positionsToRemove:o,score:o.length*50}}function Io(s,e,r){var i,u;const o=[],n=(s.type==="wrapped"?s:e).color;for(let l=0;l<r.length;l++)for(let f=0;f<(((i=r[l])==null?void 0:i.length)||0);f++){const d=(u=r[l])==null?void 0:u[f];d&&d.color===n&&o.push({row:l,col:f})}return{positionsToRemove:o,score:o.length*70}}function Ho(s,e,r){var a,n;const o=[];for(let i=0;i<r.length;i++)for(let u=0;u<(((a=r[i])==null?void 0:a.length)||0);u++)(n=r[i])!=null&&n[u]&&o.push({row:i,col:u});return{positionsToRemove:o,score:o.length*100}}function Fo(s,e,r){switch([s.type,e.type].sort().join("+")){case"striped+striped":return No(s,e,r);case"striped+wrapped":return _o(s,e,r);case"colorBomb+striped":return zo(s,e,r);case"wrapped+wrapped":return $o(s,e,r);case"colorBomb+wrapped":return Io(s,e,r);case"colorBomb+colorBomb":return Ho(s,e,r);default:return null}}function Do(s,e){switch(s.type){case"striped":return Lo(s,e,s.stripedDirection||"horizontal");case"wrapped":return jo(s,e);case"colorBomb":return Bo(s,e);default:return{positionsToRemove:[],score:0}}}const Yo=s=>{const[e,r]=v.useState(()=>{const l=pt(s);return{board:l.initialBoard||[],score:0,moves:l.maxMoves,goals:l.goals,isGameOver:!1,isPaused:!1,currentStage:s,isAnimating:!1,selectedGem:null,comboCount:0}});v.useEffect(()=>{const l=pt(s);r({board:l.initialBoard||[],score:0,moves:l.maxMoves,goals:l.goals,isGameOver:!1,isPaused:!1,currentStage:s,isAnimating:!1,selectedGem:null,comboCount:0})},[s]);const o=v.useRef(null),a=v.useCallback((l,f)=>{r(d=>{var b,S;if(d.isGameOver)return d;const y=((b=d.selectedGem)==null?void 0:b.row)===l&&((S=d.selectedGem)==null?void 0:S.col)===f?null:{row:l,col:f};return o.current=y,{...d,selectedGem:y}})},[]),n=v.useCallback((l,f)=>{r(d=>{var D;if(d.isGameOver||d.moves<=0)return d;const y=Math.abs(l.row-f.row),b=Math.abs(l.col-f.col);if(!(y===1&&b===0||y===0&&b===1))return d;const S=d.board.map(B=>B.map(U=>U?{...U}:null)),k=S[l.row][l.col],F=S[f.row][f.col];if(k&&F&&k.type!=="normal"&&F.type!=="normal"){const B=Fo(k,F,S);if(B){const U=new Set;for(const E of B.positionsToRemove)U.add(`${E.row},${E.col}`);for(const E of U){const[$,he]=E.split(","),q=Number($),Ee=Number(he);!Number.isNaN(q)&&!Number.isNaN(Ee)&&S[q]&&(S[q][Ee]=null)}const ce=gt(S,50),Ce=d.score+B.score,Te=d.goals.map(E=>E.type==="score"?{...E,current:Math.min(E.current+B.score,E.target)}:E),Pe=Oe(ce).length>0,H=Te.every(E=>E.current>=E.target),xe=d.moves<=0&&!H;return{...d,board:ce,score:Ce,goals:Te,moves:d.moves-1,isAnimating:Pe&&!H&&!xe,selectedGem:null,comboCount:0,isGameOver:xe||d.isGameOver}}}const A=S[l.row][l.col];S[l.row][l.col]=S[f.row][f.col],S[f.row][f.col]=A,S[l.row][l.col]&&(S[l.row][l.col].position={...l}),S[f.row][f.col]&&(S[f.row][f.col].position={...f});const X=Oe(S);if(X.length===0)return d;const ae=Go(X);for(const B of ae){const U=(D=S[B.position.row])==null?void 0:D[B.position.col];U&&(U.type=B.type,B.stripedDirection&&(U.stripedDirection=B.stripedDirection))}return{...d,board:S,moves:d.moves-1,isAnimating:!0,selectedGem:null,comboCount:0}})},[]),i=v.useCallback(()=>{r(l=>{var H,xe;if(!l.isAnimating)return l;const f=Oe(l.board);if(f.length===0)return{...l,isAnimating:!1};const d=l.board.map(E=>E.map($=>$?{...$}:null)),y=new Set;let b=0;const S=new Set;for(const E of f)for(const $ of E.positions){const he=(H=d[$.row])==null?void 0:H[$.col];he&&he.type!=="normal"&&S.add(`${$.row},${$.col}`)}for(const E of S){const[$,he]=E.split(","),q=Number($),Ee=Number(he);if(!Number.isNaN(q)&&!Number.isNaN(Ee)&&((xe=d[q])!=null&&xe[Ee])){const g=d[q][Ee],_e=Do(g,d);for(const Ge of _e.positionsToRemove)y.add(`${Ge.row},${Ge.col}`);b+=_e.score}}for(const E of f)for(const $ of E.positions)y.add(`${$.row},${$.col}`);for(const E of y){const[$,he]=E.split(","),q=Number($),Ee=Number(he);!Number.isNaN(q)&&!Number.isNaN(Ee)&&d[q]&&(d[q][Ee]=null)}const k=gt(d,50),A=Oe(k).length>0,X=A?l.comboCount+1:0,ae=1+Math.min(X,5)*.15,D=f.reduce((E,$)=>{const he=$.positions.length;let q=10;return he>=6?q=80:he>=5?q=40:he>=4&&(q=20),E+he*q},0),B=D+b,U=Math.floor(B*(ae-1)),ce=l.score+B+U,Ce=D+b+U,Te=l.goals.map(E=>E.type==="score"?{...E,current:Math.min(E.current+Ce,E.target)}:E),ye=Te.every(E=>E.current>=E.target),Pe=l.moves<=0&&!ye;return{...l,board:k,score:ce,goals:Te,isGameOver:Pe||l.isGameOver,isAnimating:A&&!ye&&!Pe,comboCount:X}})},[]),u=v.useCallback(()=>{r(l=>({...l,isPaused:!l.isPaused}))},[]);return{gameState:e,selectGem:a,swapGems:n,processMatches:i,togglePause:u}};function mt(s){const{score:e,goals:r,moves:o,currentStage:a}=s;if(r.length===0)return 0;const n=r[0];if(n.current<n.target)return 0;const i=n.current/n.target,u=Math.max(20,50-Math.floor(a/20)),l=o/u,f=Math.min(e/(n.target*1.5),1);let d=0;return i>=1&&(d=1,(i>=1.2||l>=.4)&&(d=2),i>=1.5&&l>=.5&&f>=.8&&(d=3)),Math.min(d,3)}class Wo{constructor(e){V(this,"particles",[]);V(this,"ctx");this.ctx=e}emit(e,r,o,a=20){const n=He[o];for(let i=0;i<a;i++){const u=Math.PI*2*i/a+Math.random()*.5,l=2+Math.random()*3;this.particles.push({x:e,y:r,vx:Math.cos(u)*l,vy:Math.sin(u)*l,life:1,maxLife:1,color:Math.random()>.5?n.light:n.dark,size:3+Math.random()*4,rotation:Math.random()*Math.PI*2,rotationSpeed:(Math.random()-.5)*.2})}}emitExplosion(e,r,o,a=50,n=30){const i=He[o];for(let u=0;u<n;u++){const l=Math.random()*Math.PI*2,f=Math.random()*a,d=1+Math.random()*2;this.particles.push({x:e+Math.cos(l)*f*.3,y:r+Math.sin(l)*f*.3,vx:Math.cos(l)*d,vy:Math.sin(l)*d,life:1,maxLife:1,color:Math.random()>.5?i.light:i.dark,size:4+Math.random()*6,rotation:Math.random()*Math.PI*2,rotationSpeed:(Math.random()-.5)*.3})}}update(e=16){for(let r=this.particles.length-1;r>=0;r--){const o=this.particles[r];o.x+=o.vx,o.y+=o.vy,o.vy+=.1,o.vx*=.98,o.vy*=.98,o.rotation+=o.rotationSpeed,o.life-=e/1e3,o.life<=0&&this.particles.splice(r,1)}}render(){this.ctx.save();for(const e of this.particles){const r=e.life/e.maxLife,o=e.size*r;this.ctx.globalAlpha=r,this.ctx.fillStyle=e.color,this.ctx.translate(e.x,e.y),this.ctx.rotate(e.rotation),this.ctx.fillRect(-o/2,-o/2,o,o),this.ctx.setTransform(1,0,0,1,0,0)}this.ctx.globalAlpha=1,this.ctx.restore()}clear(){this.particles=[]}get count(){return this.particles.length}}function yt(s){var n,i,u,l;const e=s.length,r=((n=s[0])==null?void 0:n.length)||0,o=[],a=[];for(let f=0;f<e;f++)for(let d=0;d<r;d++){const y=(i=s[f])==null?void 0:i[d];if(y){if(d<r-1){const b=(u=s[f])==null?void 0:u[d+1];if(b&&b.color!==y.color){const S=bt(s,f,d,f,d+1),k=Oe(S);if(k.length>0){const F=k.some(X=>X.positions.length>=4),A={from:{row:f,col:d},to:{row:f,col:d+1}};F?o.push(A):a.push(A)}}}if(f<e-1){const b=(l=s[f+1])==null?void 0:l[d];if(b&&b.color!==y.color){const S=bt(s,f,d,f+1,d),k=Oe(S);if(k.length>0){const F=k.some(X=>X.positions.length>=4),A={from:{row:f,col:d},to:{row:f+1,col:d}};F?o.push(A):a.push(A)}}}}}return o.length>0?o[0]:a.length>0?a[0]:null}function bt(s,e,r,o,a){const n=s.map(u=>u.map(l=>l?{...l}:null)),i=n[e][r];return n[e][r]=n[o][a],n[o][a]=i,n}class Xo{constructor(){V(this,"fpsHistory",[]);V(this,"frameTimeHistory",[]);V(this,"lastFrameTime",performance.now());V(this,"frameCount",0);V(this,"fpsUpdateInterval",1e3);V(this,"lastFpsUpdate",performance.now());V(this,"currentFps",60);V(this,"currentFrameTime",16.67);V(this,"maxHistorySize",60);V(this,"callbacks",new Set)}update(){const e=performance.now(),r=e-this.lastFrameTime;if(this.lastFrameTime=e,this.frameTimeHistory.push(r),this.frameTimeHistory.length>this.maxHistorySize&&this.frameTimeHistory.shift(),this.frameCount++,e-this.lastFpsUpdate>=this.fpsUpdateInterval){this.currentFps=this.frameCount,this.currentFrameTime=1e3/this.currentFps,this.fpsHistory.push(this.currentFps),this.fpsHistory.length>this.maxHistorySize&&this.fpsHistory.shift();const o=this.frameTimeHistory.reduce((n,i)=>n+i,0)/this.frameTimeHistory.length,a=this.getMetrics(o);this.callbacks.forEach(n=>n(a)),this.currentFps<30&&this.handlePerformanceDegradation(),this.frameCount=0,this.lastFpsUpdate=e}}getMetrics(e){const r={fps:this.currentFps,frameTime:e,timestamp:performance.now()};if(performance.memory&&typeof performance.memory=="object"){const o=performance.memory;r.memoryUsage={usedJSHeapSize:o.usedJSHeapSize,totalJSHeapSize:o.totalJSHeapSize,jsHeapSizeLimit:o.jsHeapSizeLimit}}return r}handlePerformanceDegradation(){console.warn(`Performance degradation detected: FPS = ${this.currentFps.toFixed(1)}`)}subscribe(e){return this.callbacks.add(e),()=>{this.callbacks.delete(e)}}getFPS(){return this.currentFps}getAverageFPS(){return this.fpsHistory.length===0?60:this.fpsHistory.reduce((r,o)=>r+o,0)/this.fpsHistory.length}getFrameTime(){return this.currentFrameTime}getFPSHistory(){return[...this.fpsHistory]}getMemoryUsage(){if(performance.memory&&typeof performance.memory=="object"){const e=performance.memory;return{usedJSHeapSize:e.usedJSHeapSize,totalJSHeapSize:e.totalJSHeapSize,jsHeapSizeLimit:e.jsHeapSizeLimit}}return null}reset(){this.fpsHistory=[],this.frameTimeHistory=[],this.frameCount=0,this.currentFps=60,this.currentFrameTime=16.67,this.lastFrameTime=performance.now(),this.lastFpsUpdate=performance.now()}}const St=new Xo;const Uo=({stageNumber:s=1,currentScreen:e="stageSelect",onNavigate:r,onStartStage:o})=>{const a=v.useRef(!1),n=v.useRef(null),i=v.useRef(null),u=v.useRef(null),l=v.useRef(null),f=v.useRef(null),d=v.useRef(null),y=v.useRef(new Map),b=v.useRef(null),S=v.useRef(!1),k=v.useRef(null),F=v.useRef(""),A=v.useRef(!1),X=v.useRef(null),ae=v.useRef(null),D=v.useRef(null),B=v.useRef(null),U=v.useRef(!1),ce=v.useRef(!1),Ce=v.useRef(!1),Te=v.useRef(!1),[ye,Pe]=v.useState(!1),{t:H}=De(),[xe,E]=v.useState(1),[$,he]=v.useState(1),[q,Ee]=v.useState(()=>typeof window<"u"?Be.get("chipPuzzleGame_orientationPreference",{silent:!0}):null),{gameState:g,selectGem:_e,swapGems:Ge,processMatches:Je,togglePause:Ve}=Yo(s),[pe,At]=v.useState(()=>{const h=ht.cols,T=ht.rows;return{aspectRatio:xt.aspectRatio,cellSize:70,gridRows:T,gridCols:h,pixelRatio:window.devicePixelRatio||1,logicalWidth:0,logicalHeight:0}});v.useEffect(()=>{var t;if(e==="game"&&g.board.length>0){const h=g.board.length,T=((t=g.board[0])==null?void 0:t.length)||9;At(C=>({...C,gridRows:h,gridCols:T}))}},[e,g.board,s]),v.useEffect(()=>{const t=Be.get("chipPuzzleGame_progress",{fallback:null});t&&(E(Math.max(1,t.highestStage||1)),I.info("Game progress loaded",{highestStage:t.highestStage||1}))},[]);const nt=v.useCallback((t,h,T)=>{const c=h/1200;t.fillStyle="#1a1a1a",t.fillRect(0,0,h,T),t.fillStyle="#fff";const te=Math.max(16,32*c);t.font=`bold ${te}px Arial`,t.textAlign="center",t.fillText(H("stageSelect.title"),h/2,50*c);const w=8,ee=60,be=15,K=ee*c,P=be*c,ge=(h-(w*K+(w-1)*P))/2,Z=100*c,oe=1e3,Y=50,Se=Math.ceil(oe/Y),ue=($-1)*Y+1,me=Math.min(ue+Y-1,oe);for(let M=0;M<Y&&ue+M<=me;M++){const N=ue+M,W=Math.floor(M/w),G=M%w,m=ge+G*(K+P),_=Z+W*(K+P),x=N<=xe;if(x){const z=t.createLinearGradient(m,_,m+K,_+K);z.addColorStop(0,"#667eea"),z.addColorStop(1,"#764ba2"),t.fillStyle=z}else t.fillStyle="#1a1a1a";t.fillRect(m,_,K,K),t.strokeStyle=x?"#667eea":"#444",t.lineWidth=Math.max(1,2*c),t.strokeRect(m,_,K,K),t.fillStyle="#fff";const L=Math.max(12,20*c);if(t.font=`bold ${L}px Arial`,t.textAlign="center",t.textBaseline="middle",t.fillText(N.toString(),m+K/2,_+K/2),!x){t.fillStyle="#ffa500";const z=Math.max(16,24*c);t.font=`${z}px Arial`,t.fillText("ðŸ”’",m+K/2,_+K/2-10*c)}}const Q=T-60*c;t.fillStyle="#fff",t.font=`bold ${Math.max(12,18*c)}px Arial`,t.textAlign="center",t.fillText(`${H("stageSelect.page")} ${$} / ${Se}`,h/2,Q);const fe=30*c,re=80*c,ve=Q+20*c,Me=10*c;if($>1){const M=h/2-re-Me/2;t.fillStyle=$>1?"#667eea":"#444",t.fillRect(M,ve,re,fe),t.strokeStyle="#fff",t.lineWidth=Math.max(1,2*c),t.strokeRect(M,ve,re,fe),t.fillStyle="#fff",t.font=`bold ${Math.max(10,14*c)}px Arial`,t.fillText("Â«",M+re/2,ve+fe/2+4*c)}if($<Se){const M=h/2+Me/2;t.fillStyle=$<Se?"#667eea":"#444",t.fillRect(M,ve,re,fe),t.strokeStyle="#fff",t.lineWidth=Math.max(1,2*c),t.strokeRect(M,ve,re,fe),t.fillStyle="#fff",t.font=`bold ${Math.max(10,14*c)}px Arial`,t.fillText("Â»",M+re/2,ve+fe/2+4*c)}},[xe,H,$]),at=v.useCallback((t,h,T)=>{const c=h/1200;t.fillStyle="#1a1a1a",t.fillRect(0,0,h,T);const w=(pe.cellSize||70)*c,ee=pe.gridCols||9,be=pe.gridRows||9,K=w*ee,P=w*be,ge=(h-K)/2,Z=(T-P)/2;(!u.current||l.current!==w)&&(u.current=new Co(t,w),l.current=w),f.current||(f.current=new Wo(t)),t.save(),t.globalAlpha=.9,t.fillStyle="rgba(22, 22, 46, 0.8)",t.beginPath(),t.roundRect(ge,Z,K,P,8*c),t.fill(),t.restore(),t.strokeStyle="rgba(255, 255, 255, 0.08)",t.lineWidth=Math.max(.5,1*c);for(let M=0;M<=be;M++){const N=Z+M*w;t.beginPath(),t.moveTo(ge,N),t.lineTo(ge+K,N),t.stroke()}for(let M=0;M<=ee;M++){const N=ge+M*w;t.beginPath(),t.moveTo(N,Z),t.lineTo(N,Z+P),t.stroke()}const oe=Math.max(10,20*c),Y=24*c,Se=24*c,ue=oe+8*c,me=Se,Q=16*c,fe=16*c,re=280*c,ve=ue*4+Q*2;if(t.save(),t.globalAlpha=.9,t.fillStyle="rgba(15, 15, 30, 0.8)",t.beginPath(),t.roundRect(Y-Q,Se-Q,re,ve,fe),t.fill(),t.strokeStyle="rgba(102, 126, 234, 0.3)",t.lineWidth=1*c,t.stroke(),t.restore(),t.textAlign="left",t.textBaseline="top",t.shadowColor="rgba(0, 0, 0, 0.5)",t.shadowBlur=4*c,t.shadowOffsetX=0,t.shadowOffsetY=2*c,t.font=`600 ${oe}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,t.fillStyle="#ffffff",t.fillText(`${H("game.score")}: ${g.score.toLocaleString()}`,Y,me),t.fillStyle="rgba(255, 255, 255, 0.9)",t.fillText(`${H("game.moves")}: ${g.moves}`,Y,me+ue),g.goals.length>0){const M=g.goals[0],N=M.current/M.target;t.fillStyle=N>=1?"#4ecdc4":"rgba(255, 255, 255, 0.9)",t.fillText(`${H("game.goal")}: ${M.current.toLocaleString()}/${M.target.toLocaleString()}`,Y,me+ue*2)}if(g.comboCount>0&&(t.shadowColor="rgba(255, 217, 61, 0.6)",t.shadowBlur=12*c,t.font=`700 ${Math.max(14,24*c)}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,t.fillStyle="#ffd93d",t.textAlign="left",t.fillText(`${H("game.combo")} x${g.comboCount}!`,Y,me+ue*3),t.shadowColor="rgba(0, 0, 0, 0.5)",t.shadowBlur=4*c),t.shadowColor="transparent",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0,!g.isGameOver&&!g.isAnimating){const W=20*c,G=10*c,m=120*c,_=40*c,x=120*c,L=40*c,z=h-m-W,se=W,R=12*c,j=t.createLinearGradient(z,se,z,se+_);j.addColorStop(0,ye?"#4ecdc4":"#667eea"),j.addColorStop(1,ye?"#44a08d":"#764ba2"),t.save(),t.beginPath(),t.roundRect(z,se,m,_,R),t.fillStyle=j,t.fill(),t.strokeStyle="rgba(255, 255, 255, 0.3)",t.lineWidth=Math.max(1,1.5*c),t.stroke(),t.restore(),t.shadowColor=ye?"rgba(78, 205, 196, 0.4)":"rgba(102, 126, 234, 0.4)",t.shadowBlur=8*c,t.shadowOffsetX=0,t.shadowOffsetY=2*c,t.fillStyle="#ffffff";const J=16*c;t.font=`600 ${J}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,t.textAlign="center",t.textBaseline="middle",t.fillText(H("game.hint"),z+m/2,se+_/2),t.shadowColor="transparent",t.shadowBlur=0;const ie=z-x-G,we=W,ne=t.createLinearGradient(ie,we,ie,we+L);g.isPaused?(ne.addColorStop(0,"#ff6b6b"),ne.addColorStop(1,"#ee5a6f")):(ne.addColorStop(0,"#667eea"),ne.addColorStop(1,"#764ba2")),t.save(),t.beginPath(),t.roundRect(ie,we,x,L,R),t.fillStyle=ne,t.fill(),t.strokeStyle="rgba(255, 255, 255, 0.3)",t.lineWidth=Math.max(1,1.5*c),t.stroke(),t.restore(),t.shadowColor=g.isPaused?"rgba(255, 107, 107, 0.4)":"rgba(102, 126, 234, 0.4)",t.shadowBlur=8*c,t.shadowOffsetX=0,t.shadowOffsetY=2*c,t.fillStyle="#ffffff";const Re=16*c;t.font=`600 ${Re}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,t.textAlign="center",t.textBaseline="middle",t.fillText(g.isPaused?H("game.resume"):H("game.pause"),ie+x/2,we+L/2),t.shadowColor="transparent",t.shadowBlur=0}if(g.isPaused&&!g.isGameOver){t.fillStyle="rgba(15, 15, 30, 0.85)",t.fillRect(0,0,h,T);const M=400*c,N=200*c,W=(h-M)/2,G=(T-N)/2,m=24*c;t.save(),t.globalAlpha=.95,t.fillStyle="rgba(26, 26, 46, 0.9)",t.beginPath(),t.roundRect(W,G,M,N,m),t.fill(),t.strokeStyle="rgba(102, 126, 234, 0.3)",t.lineWidth=2*c,t.stroke(),t.restore(),t.shadowColor="rgba(102, 126, 234, 0.5)",t.shadowBlur=12*c,t.shadowOffsetX=0,t.shadowOffsetY=0,t.fillStyle="#ffffff",t.font=`700 ${Math.max(28,56*c)}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,t.textAlign="center",t.textBaseline="middle",t.fillText(H("game.pause"),h/2,G+N/2-30*c),t.shadowColor="transparent",t.shadowBlur=0,t.fillStyle="rgba(255, 255, 255, 0.7)",t.font=`500 ${Math.max(14,20*c)}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,t.fillText(H("game.resume"),h/2,G+N/2+20*c)}if(g.isGameOver){t.fillStyle="rgba(15, 15, 30, 0.9)",t.fillRect(0,0,h,T);const M=450*c,N=300*c,W=(h-M)/2,G=(T-N)/2,m=24*c;t.save(),t.globalAlpha=.95,t.fillStyle="rgba(26, 26, 46, 0.9)",t.beginPath(),t.roundRect(W,G,M,N,m),t.fill(),t.strokeStyle="rgba(255, 107, 107, 0.3)",t.lineWidth=2*c,t.stroke(),t.restore(),t.shadowColor="rgba(255, 107, 107, 0.5)",t.shadowBlur=12*c,t.fillStyle="#ff6b6b",t.font=`700 ${Math.max(28,56*c)}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,t.textAlign="center",t.textBaseline="middle",t.fillText(H("game.gameOver"),h/2,G+60*c),t.shadowColor="transparent",t.shadowBlur=0,t.fillStyle="rgba(255, 255, 255, 0.9)",t.font=`600 ${Math.max(16,24*c)}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,t.fillText(`${H("game.finalScore")}: ${g.score.toLocaleString()}`,h/2,G+120*c);const _=h/2-110*c,x=G+180*c,L=220*c,z=56*c,se=14*c,R=t.createLinearGradient(_,x,_,x+z);R.addColorStop(0,"#ff6b6b"),R.addColorStop(1,"#ee5a6f"),t.save(),t.beginPath(),t.roundRect(_,x,L,z,se),t.fillStyle=R,t.fill(),t.strokeStyle="rgba(255, 255, 255, 0.3)",t.lineWidth=2*c,t.stroke(),t.restore(),t.shadowColor="rgba(255, 107, 107, 0.4)",t.shadowBlur=8*c,t.shadowOffsetX=0,t.shadowOffsetY=2*c,t.fillStyle="#ffffff",t.font=`600 ${Math.max(16,22*c)}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,t.textAlign="center",t.textBaseline="middle",t.fillText(H("game.retry"),h/2,x+z/2),t.shadowColor="transparent",t.shadowBlur=0}const Me=g.goals.every(M=>M.current>=M.target);if(g.isAnimating){const M=Oe(g.board),N=new Set;for(const W of M)for(const G of W.positions)N.add(`${G.row},${G.col}`);N.forEach(W=>{const[G,m]=W.split(","),_=Number(G),x=Number(m);if(!Number.isNaN(_)&&!Number.isNaN(x)&&_>=0&&_<be&&x>=0&&x<ee){const L=ge+x*w,z=Z+_*w,se=Date.now()%1e3,R=.3+Math.sin(se/1e3*Math.PI*2)*.2;t.fillStyle=`rgba(255, 215, 61, ${R})`,t.strokeStyle="#ffd93d",t.lineWidth=Math.max(2,3*c),t.strokeRect(L,z,w,w),t.fillRect(L,z,w,w)}})}if(g.board&&g.board.length>0&&u.current){let M=!1;g.board.forEach((W,G)=>{W&&W.forEach((m,_)=>{if(m){const x=ge+_*w,L=Z+G*w;if(U.current&&X.current&&D.current&&ae.current){const R=X.current,j=D.current,J=ae.current;if(G===R.row&&_===R.col)if(B.current){const ie=B.current.x-J.x,we=B.current.y-J.y,ne=w,Re=Math.max(-ne,Math.min(ne,ie)),ze=Math.max(-ne,Math.min(ne,we));m.x=x+Re,m.y=L+ze}else m.x=x,m.y=L;else if(G===j.row&&_===j.col)if(B.current){const ie=B.current.x-J.x,we=B.current.y-J.y,ne=w,Re=Math.max(-ne,Math.min(ne,-ie)),ze=Math.max(-ne,Math.min(ne,-we));m.x=x+Re,m.y=L+ze}else m.x=x,m.y=L;else m.x=x,m.y=L}else if(m.targetY!==void 0){M=!0;let R;m.targetY<100?R=Z+m.targetY*w:R=m.targetY,(m.y===void 0||m.y===0)&&(m.y=L);const j=R-m.y,J=.15;Math.abs(j)>1?(m.y+=j*J,j>0&&(m.y+=1)):(m.y=R,m.targetY=void 0),m.x=x}else if(m.targetX!==void 0){const R=m.targetX-m.x,j=.2;Math.abs(R)>.1?m.x+=R*j:(m.x=m.targetX,m.targetX=void 0),m.y=L}else(m.x===0&&m.y===0&&m.targetX===void 0&&m.targetY===void 0||m.x!==x||m.y!==L)&&(m.x=x,m.y=L);g.selectedGem&&g.selectedGem.row===G&&g.selectedGem.col===_&&(t.fillStyle="rgba(255, 255, 255, 0.3)",t.strokeStyle="rgba(255, 255, 255, 0.8)",t.lineWidth=Math.max(2,3*c),t.strokeRect(x,L,w,w),t.fillRect(x,L,w,w)),ye&&b.current&&(b.current.from.row===G&&b.current.from.col===_||b.current.to.row===G&&b.current.to.col===_)&&(t.fillStyle="rgba(255, 215, 61, 0.4)",t.strokeStyle="#ffd93d",t.lineWidth=Math.max(3,4*c),t.strokeRect(x,L,w,w),t.fillRect(x,L,w,w));let z=1,se=m.scale||1;if(m.isRemoving){let R=y.current.get(m.id);R||(R={alpha:1,scale:1},y.current.set(m.id,R)),R.alpha=Math.max(0,R.alpha-.08),R.scale=Math.max(0,R.scale-.08),z=R.alpha,se=R.scale,m.alpha=z,m.scale=se,y.current.set(m.id,R)}else m.alpha=1,m.scale=1;if(z>0){const R=Me&&!g.isAnimating?z*.3:z;u.current.render(m,R)}if(m.isRemoving&&z>.8&&z<.9&&f.current){const R=m.x+w/2,j=m.y+w/2;f.current.emit(R,j,m.color,15)}}})});const N=S.current;S.current=M,N&&!M&&g.isAnimating&&e==="game"&&!g.isGameOver&&!A.current&&setTimeout(()=>{g.isAnimating&&e==="game"&&!g.isGameOver&&!A.current&&(A.current=!0,Je(),setTimeout(()=>{A.current=!1,F.current=""},200))},100)}if(f.current&&(f.current.update(16),f.current.render()),Me&&!g.isAnimating&&!g.isGameOver){const M=mt(g);t.fillStyle="rgba(15, 15, 30, 0.92)",t.fillRect(0,0,h,T);const N=500*c,W=400*c,G=(h-N)/2,m=(T-W)/2,_=28*c;t.save(),t.globalAlpha=.96,t.fillStyle="rgba(26, 26, 46, 0.9)",t.beginPath(),t.roundRect(G,m,N,W,_),t.fill(),t.strokeStyle="rgba(78, 205, 196, 0.4)",t.lineWidth=2*c,t.stroke(),t.restore(),t.shadowColor="rgba(78, 205, 196, 0.5)",t.shadowBlur=12*c,t.shadowOffsetX=0,t.shadowOffsetY=0,t.fillStyle="#4ecdc4",t.font=`700 ${Math.max(32,64*c)}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,t.textAlign="center",t.textBaseline="middle",t.fillText(H("game.stageCleared"),h/2,m+80*c);const x=Math.max(24,48*c),L=x*1.8,z=h/2-L,se=m+160*c;for(let Re=0;Re<3;Re++){const ze=z+Re*L;t.shadowColor=Re<M?"rgba(255, 217, 61, 0.6)":"transparent",t.shadowBlur=Re<M?12*c:0,t.fillStyle=Re<M?"#ffd93d":"rgba(102, 102, 102, 0.5)",t.font=`${x}px Arial`,t.textAlign="center",t.textBaseline="middle",t.fillText("â˜…",ze,se)}t.shadowColor="transparent",t.shadowBlur=0,t.fillStyle="rgba(255, 255, 255, 0.9)",t.font=`600 ${Math.max(18,28*c)}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,t.fillText(`${H("game.score")}: ${g.score.toLocaleString()}`,h/2,m+220*c);const R=h/2-120*c,j=m+280*c,J=240*c,ie=60*c,we=16*c,ne=t.createLinearGradient(R,j,R,j+ie);ne.addColorStop(0,"#667eea"),ne.addColorStop(1,"#764ba2"),t.save(),t.beginPath(),t.roundRect(R,j,J,ie,we),t.fillStyle=ne,t.fill(),t.strokeStyle="rgba(255, 255, 255, 0.3)",t.lineWidth=2*c,t.stroke(),t.restore(),t.shadowColor="rgba(102, 126, 234, 0.4)",t.shadowBlur=8*c,t.shadowOffsetX=0,t.shadowOffsetY=2*c,t.fillStyle="#ffffff",t.font=`600 ${Math.max(16,22*c)}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,t.textAlign="center",t.textBaseline="middle",t.fillText(H("game.nextStage"),h/2,j+ie/2),t.shadowColor="transparent",t.shadowBlur=0}},[pe,g,ye,H]),Ae=v.useCallback(()=>{const t=n.current,h=i.current;if(!t||!h)return;const T=window.devicePixelRatio||1,C=t.width/T,c=t.height/T;C===0||c===0||(e==="stageSelect"?nt(h,C,c):e==="game"?at(h,C,c):(h.fillStyle="#1a1a1a",h.fillRect(0,0,C,c)))},[e,nt,at]);v.useEffect(()=>{let t=0;const T=1e3/60,C=St.subscribe(te=>{}),c=()=>{const te=w=>{w-t>=T&&(Ae(),St.update(),t=w),d.current=requestAnimationFrame(te)};d.current=requestAnimationFrame(te)};return n.current&&i.current&&(c(),I.info("GameBoard render loop started",{stage:s,screen:e})),()=>{d.current!==null&&(cancelAnimationFrame(d.current),d.current=null),C(),I.debug("GameBoard render loop stopped")}},[Ae,s,e]);const Ot=v.useCallback((t,h)=>{a.current||(a.current=!0,n.current=t,i.current=h,Ae())},[Ae]),Gt=v.useCallback((t,h)=>{n.current=t,i.current=h,Ae()},[Ae]);v.useEffect(()=>{if(n.current&&i.current){const t=setTimeout(()=>{Ae()},10);return()=>clearTimeout(t)}},[Ae,e,xe,s,g]),v.useEffect(()=>{if(g.isAnimating&&e==="game"&&!g.isGameOver&&!A.current){const t=JSON.stringify(g.board);if(t!==F.current)return A.current=!0,F.current=t,k.current&&clearTimeout(k.current),k.current=setTimeout(()=>{const T=()=>{S.current?setTimeout(T,50):(Je(),setTimeout(()=>{A.current=!1,F.current=""},200))};T()},300),()=>{k.current&&(clearTimeout(k.current),k.current=null)}}else g.isAnimating||(F.current="",A.current=!1)},[g.isAnimating,g.board,Je,e,g.isGameOver]),v.useEffect(()=>{if(e!=="game"){Ce.current=!1,Te.current=!1;return}const t=g.goals.every(h=>h.current>=h.target);if(!Ce.current&&g.isGameOver&&(I.info("Game Over",{stage:g.currentStage,score:g.score,moves:g.moves}),de.playGameOver()),!Te.current&&t&&!g.isGameOver){const h=mt(g);I.info("Stage Cleared",{stage:g.currentStage,score:g.score,moves:g.moves,stars:h}),de.playStageClear();const C=Be.get("chipPuzzleGame_progress",{fallback:null})||{highestStage:1,stageRecords:{}},c=g.currentStage;c>=C.highestStage&&(C.highestStage=c+1),C.stageRecords||(C.stageRecords={});const te=c.toString(),w=C.stageRecords[te];!w||g.score>w.bestScore?C.stageRecords[te]={stageNumber:c,stars:Math.max((w==null?void 0:w.stars)||0,h),score:g.score,bestScore:g.score,completedAt:new Date().toISOString(),attempts:((w==null?void 0:w.attempts)||0)+1}:C.stageRecords[te]={...w,stars:Math.max(w.stars,h),attempts:w.attempts+1},Be.set("chipPuzzleGame_progress",C)||I.error("Failed to save progress",{stage:g.currentStage})}Ce.current=g.isGameOver,Te.current=t},[g.isGameOver,g.goals,g.score,g.currentStage,e]);const Ke=v.useCallback(t=>{if(ce.current){ce.current=!1;return}const h=n.current;if(!h)return;const T=h.getBoundingClientRect();let C=t.clientX-T.left,c=t.clientY-T.top;const te=Ye(C,c,T);C=te.x,c=te.y;const w=window.devicePixelRatio||1,ee=h.width/w,be=h.height/w;if(e==="stageSelect"){if(!o)return;const P=ee/1200,ge=120,Z=40,oe=20*P,Y=ge*P,Se=Z*P,ue=ee-Y-oe,me=oe;if(C>=ue&&C<=ue+Y&&c>=me&&c<=me+Se){if(ye)Pe(!1),b.current=null;else{const J=yt(g.board);J&&(b.current=J,Pe(!0),setTimeout(()=>{Pe(!1),b.current=null},3e3))}return}const Q=50,fe=1e3,re=Math.ceil(fe/Q),ve=30*P,Me=80*P,N=be-60*P+20*P,W=10*P;if($>1){const J=ee/2-Me-W/2;if(C>=J&&C<=J+Me&&c>=N&&c<=N+ve){he($-1),de.playClick();return}}if($<re){const J=ee/2+W/2;if(C>=J&&C<=J+Me&&c>=N&&c<=N+ve){he($+1),de.playClick();return}}const G=8,m=60,_=15,x=m*P,L=_*P,z=(ee-(G*x+(G-1)*L))/2,se=100*P,R=Math.floor((C-z)/(x+L)),j=Math.floor((c-se)/(x+L));if(R>=0&&R<G&&j>=0){const ie=($-1)*Q+1+j*G+R;ie<=xe&&ie<=fe&&o(ie)}}else if(e==="game"){const P=ee/1200;if(g.goals.every(j=>j.current>=j.target)&&!g.isAnimating&&!g.isGameOver){const j=ee/2-100*P,J=be/2+80*P,ie=200*P,we=50*P;if(C>=j&&C<=j+ie&&c>=J&&c<=J+we){if(o){const ne=s+1;o(ne)}de.playClick();return}return}if(g.isGameOver){const j=ee/2-100*P,J=be/2+100*P,ie=200*P,we=50*P;if(C>=j&&C<=j+ie&&c>=J&&c<=J+we){o&&o(s),de.playClick();return}return}if(g.isPaused){Ve(),de.playClick();return}const Z=120,oe=40,Y=20*P,Se=10*P,ue=Z*P,me=oe*P,Q=Z*P,fe=oe*P,re=ee-ue-Y,ve=Y,Me=re-Q-Se,M=Y;if(C>=Me&&C<=Me+Q&&c>=M&&c<=M+fe){Ve(),de.playClick();return}if(C>=re&&C<=re+ue&&c>=ve&&c<=ve+me){if(ye)Pe(!1),b.current=null;else{const j=yt(g.board);j&&(b.current=j,Pe(!0),setTimeout(()=>{Pe(!1),b.current=null},3e3))}de.playClick();return}if(g.isPaused)return;const W=(pe.cellSize||70)*P,G=pe.gridCols||9,m=pe.gridRows||9,_=W*G,x=W*m,L=(ee-_)/2,z=(be-x)/2,se=Math.floor((C-L)/W),R=Math.floor((c-z)/W);se>=0&&se<G&&R>=0&&R<m&&g.board[R]&&g.board[R][se]&&(g.selectedGem?Ge(g.selectedGem,{row:R,col:se}):_e(R,se),de.playClick())}},[e,o,xe,pe,g,_e,Ge,ye,Ve]),Ye=v.useCallback((t,h,T)=>{if(q==="landscape"){const C=window.innerWidth,c=window.innerHeight,te=C/2,w=c/2,ee=t+T.left,be=h+T.top,K=ee-te,ge=-(be-w),Z=K,oe=ge+te,Y=Z+w;return{x:oe-T.left,y:Y-T.top}}return{x:t,y:h}},[q]),Ze=v.useCallback(t=>{const h=n.current;if(!h||e!=="game"||g.isPaused)return;const T=h.getBoundingClientRect();let C=t.clientX-T.left,c=t.clientY-T.top;const te=Ye(C,c,T);C=te.x,c=te.y;const w=window.devicePixelRatio||1,ee=h.width/w,be=h.height/w,P=ee/1200,Z=(pe.cellSize||50)*P,oe=pe.gridCols||9,Y=pe.gridRows||9,Se=Z*oe,ue=Z*Y,me=(ee-Se)/2,Q=(be-ue)/2,fe=Math.floor((C-me)/Z),re=Math.floor((c-Q)/Z);fe>=0&&fe<oe&&re>=0&&re<Y&&g.board[re]&&g.board[re][fe]&&(X.current={row:re,col:fe},ae.current={x:C,y:c},U.current=!0)},[e,pe,g.board,g.isPaused,Ye]),Qe=v.useCallback(t=>{const h=n.current;if(!h||e!=="game"||g.isPaused||!U.current||!X.current||!ae.current)return;const T=h.getBoundingClientRect();let C=t.clientX-T.left,c=t.clientY-T.top;const te=Ye(C,c,T);C=te.x,c=te.y;const w=window.devicePixelRatio||1,K=h.width/w/1200,P=pe.gridCols||9,ge=pe.gridRows||9,Z=ae.current,oe=C-Z.x,Y=c-Z.y,Se=Math.sqrt(oe*oe+Y*Y),ue=10*K;if(Se<ue){B.current={x:C,y:c},D.current=null;return}const me=X.current;let Q={row:me.row,col:me.col};if(Math.abs(oe)>Math.abs(Y)?oe>0?Q.col+=1:Q.col-=1:Y>0?Q.row+=1:Q.row-=1,Q.col<0||Q.col>=P||Q.row<0||Q.row>=ge){U.current=!1,X.current=null,ae.current=null,D.current=null,B.current=null;return}B.current={x:C,y:c},D.current=Q},[e,pe,g.isPaused]),Le=v.useCallback(()=>{if(U.current&&X.current&&D.current){const t=X.current,h=D.current,T=Math.abs(t.row-h.row),C=Math.abs(t.col-h.col);(T===1&&C===0||T===0&&C===1)&&(Ge(t,h),de.playClick(),ce.current=!0)}U.current=!1,X.current=null,ae.current=null,D.current=null,B.current=null},[Ge]);v.useEffect(()=>{const t=n.current;if(t)return t.addEventListener("click",Ke),()=>{t.removeEventListener("click",Ke)}},[Ke]),v.useEffect(()=>{const t=n.current;if(t)return t.addEventListener("pointerdown",Ze),t.addEventListener("pointermove",Qe),t.addEventListener("pointerup",Le),t.addEventListener("pointerleave",Le),t.addEventListener("pointercancel",Le),()=>{t.removeEventListener("pointerdown",Ze),t.removeEventListener("pointermove",Qe),t.removeEventListener("pointerup",Le),t.removeEventListener("pointerleave",Le),t.removeEventListener("pointercancel",Le)}},[Ze,Qe,Le]);const je=v.useCallback(t=>{const h=document.querySelector(".game-container");if(h)if(t==="landscape"){const T=window.innerWidth,C=window.innerHeight;h.style.transform="rotate(90deg)",h.style.transformOrigin="center center",h.style.width=`${C}px`,h.style.height=`${T}px`,h.style.position="fixed",h.style.top="50%",h.style.left="50%",h.style.marginTop=`-${T/2}px`,h.style.marginLeft=`-${C/2}px`}else h.style.transform="",h.style.transformOrigin="",h.style.width="",h.style.height="",h.style.position="",h.style.top="",h.style.left="",h.style.marginTop="",h.style.marginLeft=""},[]),Lt=()=>{const t=q==="landscape"?"portrait":"landscape";Ee(t),Be.set("chipPuzzleGame_orientationPreference",t,{silent:!0});const h=screen.orientation;if(h&&typeof h.lock=="function")if(t==="landscape"){const T=h.lock("landscape");T&&typeof T.catch=="function"?T.catch(()=>{je(t)}):je(t)}else{const T=h.unlock();T&&typeof T.catch=="function"?T.catch(()=>{je(t)}):je(t)}else je(t)},jt=(e==="game"||e==="stageSelect")&&window.innerWidth<=768;return v.useEffect(()=>{(e==="game"||e==="stageSelect")&&q&&setTimeout(()=>{je(q)},100)},[e,q,je]),p.jsxs("div",{className:"game-board",children:[p.jsx(wo,{config:pe,onReady:Ot,onResize:Gt}),jt&&p.jsxs("button",{className:"orientation-toggle-button",onClick:Lt,title:H(q==="landscape"?"game.switchToPortrait":"game.switchToLandscape"),children:[p.jsx("span",{className:"orientation-icon",children:q==="landscape"?"ðŸ”„":"ðŸ“±"}),p.jsx("span",{className:"orientation-text",children:H(q==="landscape"?"game.portraitMode":"game.landscapeMode")})]})]})};function Et(){window.adsbygoogle&&Array.isArray(window.adsbygoogle)||(window.adsbygoogle=window.adsbygoogle||[])}function qo(){return!(window.adsbygoogle&&Array.isArray(window.adsbygoogle)&&window.adsbygoogle.some(s=>s.enable_page_level_ads))}function vt(){document.querySelectorAll('iframe[src*="googlesyndication.com"], iframe[src*="doubleclick.net"]').forEach(e=>{try{const r=e;if(r.contentDocument){const o=r.contentDocument.body;o&&o.getAttribute("aria-hidden")==="true"&&o.removeAttribute("aria-hidden")}}catch{}})}function Jo(){if(Et(),!!qo())try{window.adsbygoogle&&Array.isArray(window.adsbygoogle)&&window.adsbygoogle.push({google_ad_client:"ca-pub-2533613198240039",enable_page_level_ads:!0})}catch(s){console.warn("AdSense initialization error:",s)}}function Vo(){setTimeout(vt,2e3),new MutationObserver(e=>{e.forEach(r=>{r.type==="childList"&&r.addedNodes.forEach(o=>{o.nodeType===1&&o.tagName==="IFRAME"&&setTimeout(vt,1e3)})})}).observe(document.body,{childList:!0,subtree:!0})}const Ko=()=>{const[s,e]=v.useState("stageSelect"),[r,o]=v.useState(null);v.useEffect(()=>{Et(),Jo(),Vo()},[]);const a=i=>{e(i)},n=i=>{o(i),e("game")};return p.jsx(lo,{children:p.jsxs("div",{className:"app-container",children:[p.jsx(yo,{onNavigate:a,currentScreen:s}),p.jsx(vo,{children:p.jsx(Uo,{stageNumber:r||1,currentScreen:s,onNavigate:a,onStartStage:n})}),p.jsx(So,{})]})})};rt.createRoot(document.getElementById("root")).render(p.jsx(Fe.StrictMode,{children:p.jsx(Ie,{children:p.jsx(Ko,{})})}));
