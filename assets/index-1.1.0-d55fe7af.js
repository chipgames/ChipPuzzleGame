var oo=Object.defineProperty,ro=Object.defineProperties;var so=Object.getOwnPropertyDescriptors;var nt=Object.getOwnPropertySymbols;var Tt=Object.prototype.hasOwnProperty,Pt=Object.prototype.propertyIsEnumerable;var mt=(s,e,o)=>e in s?oo(s,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):s[e]=o,ge=(s,e)=>{for(var o in e||(e={}))Tt.call(e,o)&&mt(s,o,e[o]);if(nt)for(var o of nt(e))Pt.call(e,o)&&mt(s,o,e[o]);return s},De=(s,e)=>ro(s,so(e));var Mt=(s,e)=>{var o={};for(var r in s)Tt.call(s,r)&&e.indexOf(r)<0&&(o[r]=s[r]);if(s!=null&&nt)for(var r of nt(s))e.indexOf(r)<0&&Pt.call(s,r)&&(o[r]=s[r]);return o};var U=(s,e,o)=>(mt(s,typeof e!="symbol"?e+"":e,o),o);var Rt=(s,e,o)=>new Promise((r,a)=>{var n=i=>{try{c(o.next(i))}catch(d){a(d)}},l=i=>{try{c(o.throw(i))}catch(d){a(d)}},c=i=>i.done?r(i.value):Promise.resolve(i.value).then(n,l);c((o=o.apply(s,e)).next())});import{r as g,a as no,R as Nt}from"./vendor-1.1.0-1f763956.js";import{W as ao,q as io}from"./helmet-1.1.0-341783ac.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const n of a)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function o(a){const n={};return a.integrity&&(n.integrity=a.integrity),a.referrerPolicy&&(n.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?n.credentials="include":a.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(a){if(a.ep)return;a.ep=!0;const n=o(a);fetch(a.href,n)}})();var Dt={exports:{}},it={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var lo=g,co=Symbol.for("react.element"),uo=Symbol.for("react.fragment"),fo=Object.prototype.hasOwnProperty,ho=lo.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,mo={key:!0,ref:!0,__self:!0,__source:!0};function Ft(s,e,o){var r,a={},n=null,l=null;o!==void 0&&(n=""+o),e.key!==void 0&&(n=""+e.key),e.ref!==void 0&&(l=e.ref);for(r in e)fo.call(e,r)&&!mo.hasOwnProperty(r)&&(a[r]=e[r]);if(s&&s.defaultProps)for(r in e=s.defaultProps,e)a[r]===void 0&&(a[r]=e[r]);return{$$typeof:co,type:s,key:n,ref:l,props:a,_owner:ho.current}}it.Fragment=uo;it.jsx=Ft;it.jsxs=Ft;Dt.exports=it;var f=Dt.exports,St={},kt=no;St.createRoot=kt.createRoot,St.hydrateRoot=kt.hydrateRoot;const go="modulepreload",po=function(s){return"/ChipPuzzleGame/"+s},xt={},He=function(e,o,r){if(!o||o.length===0)return e();const a=document.getElementsByTagName("link");return Promise.all(o.map(n=>{if(n=po(n),n in xt)return;xt[n]=!0;const l=n.endsWith(".css"),c=l?'[rel="stylesheet"]':"";if(!!r)for(let h=a.length-1;h>=0;h--){const b=a[h];if(b.href===n&&(!l||b.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${n}"]${c}`))return;const d=document.createElement("link");if(d.rel=l?"stylesheet":go,l||(d.as="script",d.crossOrigin=""),d.href=n,document.head.appendChild(d),l)return new Promise((h,b)=>{d.addEventListener("load",h),d.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${n}`)))})})).then(()=>e()).catch(n=>{const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=n,window.dispatchEvent(l),!l.defaultPrevented)throw n})};class yo{constructor(){U(this,"isDevelopment",!1);U(this,"logHistory",[]);U(this,"maxHistorySize",100)}createLogEntry(e,o,r){return{level:e,message:o,data:r,timestamp:new Date().toISOString(),userAgent:typeof navigator!="undefined"?navigator.userAgent:void 0,url:typeof window!="undefined"?window.location.href:void 0}}addToHistory(e){this.logHistory.push(e),this.logHistory.length>this.maxHistorySize&&this.logHistory.shift()}log(e,o,r){const a=this.createLogEntry(e,o,r);if(this.addToHistory(a),this.isDevelopment){const n=console[e]||console.log;r?n(`[${e.toUpperCase()}] ${o}`,r):n(`[${e.toUpperCase()}] ${o}`)}e==="error"&&this.handleError(a)}handleError(e){try{const o=JSON.parse(localStorage.getItem("chipPuzzleGame_errorLogs")||"[]");o.push(e),o.length>50&&o.shift(),localStorage.setItem("chipPuzzleGame_errorLogs",JSON.stringify(o))}catch(o){this.isDevelopment}}debug(e,o){this.log("debug",e,o)}info(e,o){this.log("info",e,o)}warn(e,o){this.log("warn",e,o)}error(e,o){this.log("error",e,o)}getHistory(){return[...this.logHistory]}clearHistory(){this.logHistory=[]}getErrorLogs(){try{return JSON.parse(localStorage.getItem("chipPuzzleGame_errorLogs")||"[]")}catch(e){return[]}}clearErrorLogs(){try{localStorage.removeItem("chipPuzzleGame_errorLogs")}catch(e){}}}const v=new yo;class bo extends g.Component{constructor(){super(...arguments);U(this,"state",{hasError:!1,error:null,errorInfo:null});U(this,"handleReload",()=>{window.location.reload()});U(this,"handleReset",()=>{this.setState({hasError:!1,error:null,errorInfo:null})})}static getDerivedStateFromError(o){return{hasError:!0,error:o}}componentDidCatch(o,r){v.error("ErrorBoundary caught an error",{error:{message:o.message,stack:o.stack,name:o.name},errorInfo:{componentStack:r.componentStack},timestamp:new Date().toISOString()}),this.setState({errorInfo:r})}render(){return this.state.hasError?this.props.fallback?this.props.fallback:f.jsx("div",{className:"error-boundary",role:"alert","aria-live":"assertive",children:f.jsxs("div",{className:"error-boundary-content",children:[f.jsx("div",{className:"error-boundary-icon",children:"‚ö†Ô∏è"}),f.jsx("h2",{className:"error-boundary-title",children:this.getLocalizedText("error.title")}),f.jsx("p",{className:"error-boundary-message",children:this.state.error?this.getLocalizedText("error.messageWithDetails",{error:this.state.error.message||this.state.error.name||"Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò"}):this.getLocalizedText("error.message")}),!1,f.jsxs("div",{className:"error-boundary-actions",children:[f.jsx("button",{className:"error-boundary-button error-boundary-button-primary",onClick:this.handleReload,"aria-label":this.getLocalizedText("error.reload"),children:this.getLocalizedText("error.reload")}),!1]})]})}):this.props.children}getLocalizedText(o,r){var c;let a="ko";try{a=localStorage.getItem("language")||"ko"}catch(i){}const n={ko:{"error.title":"Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§","error.message":"Í≤åÏûÑÏùÑ ÏÉàÎ°úÍ≥†Ïπ®Ìï¥Ï£ºÏÑ∏Ïöî.","error.messageWithDetails":"Îã§Ïùå Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: {error}. Í≤åÏûÑÏùÑ ÏÉàÎ°úÍ≥†Ïπ®Ìï¥Ï£ºÏÑ∏Ïöî.","error.details":"ÏóêÎü¨ ÏÉÅÏÑ∏ Ï†ïÎ≥¥","error.reload":"ÏÉàÎ°úÍ≥†Ïπ®","error.reset":"Îã§Ïãú ÏãúÎèÑ"},en:{"error.title":"An Error Occurred","error.message":"Please refresh the game.","error.details":"Error Details","error.reload":"Reload","error.reset":"Try Again"},zh:{"error.title":"ÂèëÁîüÈîôËØØ","error.message":"ËØ∑Âà∑Êñ∞Ê∏∏Êàè„ÄÇ","error.details":"ÈîôËØØËØ¶ÊÉÖ","error.reload":"ÈáçÊñ∞Âä†ËΩΩ","error.reset":"ÈáçËØï"},ja:{"error.title":"„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü","error.message":"„Ç≤„Éº„É†„Çí„É™„Éï„É¨„ÉÉ„Ç∑„É•„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ","error.details":"„Ç®„É©„ÉºË©≥Á¥∞","error.reload":"„É™„É≠„Éº„Éâ","error.reset":"ÂÜçË©¶Ë°å"}};let l=((c=n[a])==null?void 0:c[o])||n.ko[o]||o;if(r)for(const[i,d]of Object.entries(r))l=l.replace(`{${i}}`,d);return l}}const So=(s,e)=>{const o=s[e];return o?typeof o=="function"?o():Promise.resolve(o):new Promise((r,a)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(a.bind(null,new Error("Unknown variable dynamic import: "+e)))})},Wt=["en","ko","zh","ja"],wo="en",vo={en:"English",ko:"ÌïúÍµ≠Ïñ¥",zh:"‰∏≠Êñá",ja:"Êó•Êú¨Ë™û"};class Et{constructor(){U(this,"supportedLanguages",Wt);U(this,"defaultLanguage",wo)}detectBrowserLanguage(){const e=navigator.language.split("-")[0];return this.supportedLanguages.includes(e)?e:this.defaultLanguage}getStoredLanguage(){try{return localStorage.getItem("language")}catch(e){return v.error("Failed to get stored language",{error:e}),null}}setLanguage(e){if(this.supportedLanguages.includes(e))try{localStorage.setItem("language",e),window.dispatchEvent(new CustomEvent("languageChanged",{detail:e})),v.debug("Language changed",{language:e})}catch(o){v.error("Failed to set language",{error:o,language:e})}}getCurrentLanguage(){const e=this.getStoredLanguage();return e&&this.supportedLanguages.includes(e)?e:this.detectBrowserLanguage()}}const gt={},Je=()=>{const[s,e]=g.useState(()=>new Et().getCurrentLanguage()),[o,r]=g.useState(null),[a,n]=g.useState(!0);return g.useEffect(()=>{(()=>Rt(void 0,null,function*(){n(!0);try{if(gt[s]){r(gt[s]),n(!1);return}const h=yield So(Object.assign({"../locales/en.json":()=>He(()=>import("./en-1.1.0-aedb5f40.js"),[]),"../locales/ja.json":()=>He(()=>import("./ja-1.1.0-d5cad617.js"),[]),"../locales/ko.json":()=>He(()=>import("./ko-1.1.0-711aeae3.js"),[]),"../locales/zh.json":()=>He(()=>import("./zh-1.1.0-f769481c.js"),[])}),`../locales/${s}.json`);gt[s]=h.default,r(h.default),v.debug("Translations loaded",{language:s})}catch(h){v.error("Failed to load translations",{language:s,error:h});try{const b=yield He(()=>import("./en-1.1.0-aedb5f40.js"),[]);r(b.default),v.info("Fallback translations loaded",{language:"en"})}catch(b){v.error("Failed to load fallback translations",{error:b})}}finally{n(!1)}}))();const d=h=>{e(h.detail)};return window.addEventListener("languageChanged",d),()=>{window.removeEventListener("languageChanged",d)}},[s]),{language:s,setLanguage:i=>{new Et().setLanguage(i)},t:i=>{if(a||!o)return i;const d=i.split(".");let h=o;for(const b of d)if(h=h==null?void 0:h[b],h===void 0)break;return h||i},isLoading:a}};function pt(s){const e="/ChipPuzzleGame/",o=e.endsWith("/")?e:`${e}/`,r=s.startsWith("/")?s.slice(1):s;return`${o}${r}`}const Ht=Nt.memo(h=>{var b=h,{src:s,alt:e,width:o,height:r,loading:a="lazy",className:n,style:l,onClick:c,onError:i}=b,d=Mt(b,["src","alt","width","height","loading","className","style","onClick","onError"]);const[p,y]=g.useState(()=>pt(s)),[P,D]=g.useState(!0),E=g.useCallback(X=>{if(p.includes(".webp")&&!P){D(!0),y(pt(s));return}if(!p.includes(".svg")&&s.includes(".png")&&P){const ie=s.replace(/\.png$/i,".svg");y(pt(ie));return}i&&i(X)},[p,s,i,P]);return f.jsx("img",ge({src:p,alt:e,width:o,height:r,loading:a,className:n,style:l,onClick:c,onError:E},d))});Ht.displayName="OptimizedImage";const Vt=()=>{const{language:s,setLanguage:e}=Je();return f.jsx("select",{value:s,onChange:o=>e(o.target.value),className:"language-selector","aria-label":"Language selector",children:Wt.map(o=>f.jsx("option",{value:o,children:vo[o]},o))})};class Co{constructor(){U(this,"storage",new Map)}get(e){try{const o=this.storage.get(e);return o===void 0?null:JSON.parse(o)}catch(o){return v.warn("Failed to parse memory storage",{key:e,error:o}),null}}set(e,o){try{const r=JSON.stringify(o);return this.storage.set(e,r),!0}catch(r){return v.error("Failed to set item to memory storage",{key:e,error:r}),!1}}remove(e){return this.storage.delete(e)}clear(){this.storage.clear()}keys(){return Array.from(this.storage.keys())}}const Gt=new Co;function jt(s){if(!s||typeof s!="object")return!1;const e=s;if(typeof e.version!="string"||!e.version||!e.progress||typeof e.progress!="object")return!1;const o=e.progress;if(typeof o.highestStage!="number"||o.highestStage<1||!o.stageRecords||typeof o.stageRecords!="object")return!1;const r=o.stageRecords;for(const a in r){const n=r[a];if(!n||typeof n!="object")return!1;const l=n;if(typeof l.stageNumber!="number"||l.stageNumber<1)return!1}if(e.settings!==void 0){if(typeof e.settings!="object"||e.settings===null)return!1;const a=e.settings;if(a.language!==void 0&&typeof a.language!="string"||a.soundEnabled!==void 0&&typeof a.soundEnabled!="boolean")return!1}return!0}function At(s){if(!s||typeof s!="object")return!1;const e=s;return!(typeof e.highestStage!="number"||e.highestStage<1||e.highestStage>1e3||!e.stageRecords||typeof e.stageRecords!="object")}function To(s){if(typeof s!="string")return null;const e=[/<script[^>]*>.*?<\/script>/gi,/javascript:/gi,/on\w+\s*=/gi,/<iframe[^>]*>/gi,/<object[^>]*>/gi,/<embed[^>]*>/gi];let o=s;for(const r of e)o=o.replace(r,"");return o.length>10*1024?null:o}class Po{constructor(){U(this,"useMemoryStorage",!1)}isAvailable(){try{const e="__storage_test__";return localStorage.setItem(e,e),localStorage.removeItem(e),this.useMemoryStorage=!1,!0}catch(e){return this.useMemoryStorage=!0,v.warn("LocalStorage is not available, using memory storage"),!1}}get(e,o={}){var a,n,l,c,i,d,h,b;const r=this.isAvailable();if(!r&&this.useMemoryStorage){const p=Gt.get(e);return p!==null?p:(a=o.fallback)!=null?a:null}if(!r)return o.silent||v.warn("LocalStorage is not available",{key:e}),(n=o.fallback)!=null?n:null;try{const p=localStorage.getItem(e);if(p===null)return(l=o.fallback)!=null?l:null;let y;try{y=JSON.parse(p)}catch(P){if(typeof p=="string"&&p.startsWith('"')&&p.endsWith('"'))y=JSON.parse(p);else return typeof o.fallback=="string"?p:(localStorage.removeItem(e),o.silent||v.warn("Removed invalid storage data",{key:e,value:p}),(c=o.fallback)!=null?c:null)}if(e.startsWith("chipPuzzleGame_")){if(e==="chipPuzzleGame_progress"){if(!At(y))return v.warn("Invalid game progress data, removing",{key:e}),localStorage.removeItem(e),(i=o.fallback)!=null?i:null}else if(e==="chipPuzzleGame_data"&&!jt(y))return v.warn("Invalid storage data, removing",{key:e}),localStorage.removeItem(e),(d=o.fallback)!=null?d:null}return y}catch(p){return p instanceof SyntaxError&&o.silent?(h=o.fallback)!=null?h:null:(o.silent||v.error("Failed to get item from LocalStorage",{key:e,error:p}),(b=o.fallback)!=null?b:null)}}set(e,o,r={}){const a=this.isAvailable();if(!a&&this.useMemoryStorage){const n=Gt.set(e,o);return!n&&!r.silent&&v.warn("Failed to save to memory storage",{key:e}),n}if(!a)return r.silent||v.warn("LocalStorage is not available",{key:e}),!1;try{if(e.startsWith("chipPuzzleGame_")){if(e==="chipPuzzleGame_progress"){if(!At(o))return v.error("Invalid game progress data, not saving",{key:e,value:o}),!1}else if(e==="chipPuzzleGame_data"&&!jt(o))return v.error("Invalid storage data, not saving",{key:e,value:o}),!1}if(typeof o=="string"){const c=To(o);if(c===null)return v.error("String value failed sanitization",{key:e}),!1;o=c}const n=JSON.stringify(o),l=5*1024*1024;return n.length>l?(v.error("Storage size exceeds limit",{key:e,size:n.length,maxSize:l}),!1):(localStorage.setItem(e,n),!0)}catch(n){return v.error("Failed to set item to LocalStorage",{key:e,error:n}),!1}}remove(e,o={}){if(!this.isAvailable())return o.silent||v.warn("LocalStorage is not available",{key:e}),!1;try{return localStorage.removeItem(e),!0}catch(r){return v.error("Failed to remove item from LocalStorage",{key:e,error:r}),!1}}clearGameData(){if(!this.isAvailable())return!1;try{const o=Object.keys(localStorage).filter(r=>r.startsWith("chipPuzzleGame_"));return o.forEach(r=>localStorage.removeItem(r)),v.info("Game data cleared",{count:o.length}),!0}catch(e){return v.error("Failed to clear game data",{error:e}),!1}}available(){return this.isAvailable()}}const Fe=new Po,at="chipPuzzleGame_theme",Mo=()=>{if(typeof window=="undefined")return"dark";try{return window.matchMedia("(prefers-color-scheme: light)").matches?"light":"dark"}catch(s){return"dark"}},yt=s=>{if(typeof document=="undefined")return;document.documentElement.setAttribute("data-theme",s);const o=document.querySelector('meta[name="theme-color"]');o&&o.setAttribute("content",s==="light"?"#f5f5f5":"#0f0f1e")},Ut=()=>{const[s,e]=g.useState(()=>{const a=Fe.get(at,{fallback:null,silent:!0});return a==="light"||a==="dark"?a:Mo()}),o=g.useCallback(()=>{e(a=>{const n=a==="light"?"dark":"light";return Fe.set(at,n,{silent:!0}),yt(n),v.debug("Theme changed",{theme:n}),n})},[]),r=g.useCallback(a=>{e(a),Fe.set(at,a,{silent:!0}),yt(a),v.debug("Theme set",{theme:a})},[]);return g.useEffect(()=>{yt(s)},[s]),g.useEffect(()=>{if(typeof window=="undefined")return;const a=window.matchMedia("(prefers-color-scheme: light)");if(!Fe.get(at,{fallback:null,silent:!0})){const l=c=>{const i=c.matches?"light":"dark";r(i)};return a.addEventListener?(a.addEventListener("change",l),()=>{a.removeEventListener("change",l)}):(a.addListener(l),()=>{a.removeListener(l)})}},[r]),{theme:s,toggleTheme:o,setTheme:r,isLight:s==="light",isDark:s==="dark"}};const Xt=g.memo(()=>{const{toggleTheme:s,isLight:e}=Ut(),{t:o}=Je();return f.jsx("button",{className:"theme-toggle",onClick:s,title:o(e?"header.darkMode":"header.lightMode"),"aria-label":o(e?"header.darkMode":"header.lightMode"),children:e?"üåô":"‚òÄÔ∏è"})});Xt.displayName="ThemeToggle";class Ro{constructor(){U(this,"audioCtx",null);U(this,"enabled",!0)}getContext(){if(!this.enabled)return null;try{if(!this.audioCtx){const e=window.AudioContext||window.webkitAudioContext;if(!e)return v.warn("Web Audio API is not supported in this browser"),this.enabled=!1,null;try{this.audioCtx=new e,this.audioCtx.state==="suspended"&&this.audioCtx.resume().catch(o=>{v.warn("Failed to resume AudioContext",{error:o})})}catch(o){return v.warn("Failed to create AudioContext",{error:o}),this.enabled=!1,null}}return this.audioCtx}catch(e){return v.warn("Failed to initialize AudioContext",{error:e}),this.enabled=!1,null}}setEnabled(e){this.enabled=e}playTone(e,o,r="sine",a=.2){const n=this.getContext();if(!n)return;const l=n.createOscillator(),c=n.createGain();l.type=r,l.frequency.value=e,c.gain.value=a,l.connect(c),c.connect(n.destination);const i=n.currentTime;l.start(i),l.stop(i+o),c.gain.setValueAtTime(a,i),c.gain.linearRampToValueAtTime(0,i+o)}playClick(){this.playTone(440,.08,"square",.15)}playMatch(){this.playTone(660,.12,"triangle",.2)}playSpecial(){this.playTone(880,.16,"sawtooth",.22)}playStageClear(){this.getContext()&&(this.playTone(880,.15,"triangle",.22),setTimeout(()=>{this.playTone(1046.5,.18,"triangle",.22)},120))}playGameOver(){const e=this.getContext();if(!e)return;const o=440,r=220,a=.4,n=e.createOscillator(),l=e.createGain();n.type="sawtooth",n.frequency.setValueAtTime(o,e.currentTime),n.frequency.exponentialRampToValueAtTime(r,e.currentTime+a),l.gain.value=.22,l.gain.setValueAtTime(.22,e.currentTime),l.gain.linearRampToValueAtTime(0,e.currentTime+a),n.connect(l),l.connect(e.destination),n.start(e.currentTime),n.stop(e.currentTime+a)}}const we=new Ro;const Yt=g.memo(({onNavigate:s,currentScreen:e})=>{const{t:o}=Je(),[r,a]=g.useState(()=>{var b;return(b=Fe.get("chipPuzzleGame_soundEnabled",{fallback:!0,silent:!0}))!=null?b:!0}),[n,l]=g.useState(!1);g.useEffect(()=>{we.setEnabled(r),Fe.set("chipPuzzleGame_soundEnabled",r,{silent:!0})},[r]),g.useEffect(()=>(n?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[n]),g.useEffect(()=>{const b=p=>{const y=p.target;n&&!y.closest(".header-nav")&&!y.closest(".header-hamburger")&&l(!1)};if(n)return document.addEventListener("click",b),()=>{document.removeEventListener("click",b)}},[n]);const c=b=>{s&&s(b),l(!1)},i=()=>{a(!r),r||we.playClick()},d=()=>{l(!n),r&&we.playClick()},h=!1;return f.jsx("header",{className:"header",children:f.jsxs("div",{className:"header-content",children:[f.jsxs("div",{className:"header-left",children:[h,f.jsxs("div",{className:"header-logo",onClick:()=>c("stageSelect"),style:{cursor:"pointer",display:"flex",alignItems:"center",gap:"12px"},children:[f.jsx(Ht,{src:"ChipGames_Logo.png",alt:o("header.gameTitle")+" - CHIP GAMES Î°úÍ≥†",style:{height:"40px",width:"auto"},loading:"eager",width:"120",height:"40"}),f.jsx("span",{className:"header-game-title",children:o("header.gameTitle")})]})]}),f.jsxs("nav",{className:`header-nav ${n?"mobile-open":""}`,children:[f.jsx("button",{className:"header-nav-button",onClick:()=>c("stageSelect"),children:o("header.playGame")}),f.jsx("button",{className:"header-nav-button",onClick:()=>c("guide"),children:o("header.guide")}),f.jsx("button",{className:"header-nav-button",onClick:()=>c("help"),children:o("header.help")}),f.jsx("button",{className:"header-nav-button",onClick:()=>c("about"),children:o("header.about")})]}),f.jsxs("div",{className:"header-right",children:[f.jsx(Xt,{}),f.jsx("button",{className:"header-sound-button",onClick:i,title:o(r?"header.soundOff":"header.soundOn"),children:r?"üîä":"üîá"}),f.jsx(Vt,{}),f.jsxs("button",{className:"header-hamburger",onClick:d,"aria-label":"Î©îÎâ¥","aria-expanded":n,children:[f.jsx("span",{className:`hamburger-line ${n?"active":""}`}),f.jsx("span",{className:`hamburger-line ${n?"active":""}`}),f.jsx("span",{className:`hamburger-line ${n?"active":""}`})]})]})]})})});Yt.displayName="Header";const ko="1.1.0",qt=g.memo(()=>{const{t:s}=Je(),[e,o]=g.useState(!1),[r,a]=g.useState(!1),n=i=>{i.preventDefault(),o(!0),we.playClick(),v.info("Privacy policy modal opened")},l=i=>{i.preventDefault(),a(!0),we.playClick(),v.info("Contact modal opened")},c=()=>{o(!1),a(!1),we.playClick()};return g.useEffect(()=>{const i=d=>{d.key==="Escape"&&(e||r)&&c()};return(e||r)&&(document.addEventListener("keydown",i),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",i),document.body.style.overflow=""}},[e,r]),f.jsxs(f.Fragment,{children:[f.jsx("footer",{className:"footer",role:"contentinfo",children:f.jsxs("div",{className:"footer-content",children:[f.jsxs("nav",{className:"footer-links","aria-label":s("footer.navigation"),children:[f.jsx("a",{href:"#privacy",onClick:n,"aria-label":s("footer.privacyPolicy"),className:"footer-link",children:s("footer.privacyPolicy")}),f.jsx("a",{href:"#contact",onClick:l,"aria-label":s("footer.contactUs"),className:"footer-link",children:s("footer.contactUs")})]}),f.jsx("div",{className:"footer-center",children:f.jsx(Vt,{})}),f.jsxs("div",{className:"footer-copyright","aria-label":s("footer.copyright"),children:[s("footer.copyright")," | v",ko]})]})}),e&&f.jsx("div",{className:"footer-modal-overlay",onClick:c,role:"dialog","aria-modal":"true","aria-labelledby":"privacy-modal-title",children:f.jsxs("div",{className:"footer-modal",onClick:i=>i.stopPropagation(),children:[f.jsxs("div",{className:"footer-modal-header",children:[f.jsx("h2",{id:"privacy-modal-title",children:s("footer.privacyPolicy")}),f.jsx("button",{className:"footer-modal-close",onClick:c,"aria-label":s("common.close"),children:"√ó"})]}),f.jsxs("div",{className:"footer-modal-content",children:[f.jsxs("div",{className:"footer-modal-section",children:[f.jsx("h3",{children:s("footer.privacySection1Title")}),f.jsx("p",{children:s("footer.privacySection1Content")})]}),f.jsxs("div",{className:"footer-modal-section",children:[f.jsx("h3",{children:s("footer.privacySection2Title")}),f.jsx("p",{children:s("footer.privacySection2Content")})]}),f.jsxs("div",{className:"footer-modal-section",children:[f.jsx("h3",{children:s("footer.privacySection3Title")}),f.jsx("p",{children:s("footer.privacySection3Content")})]}),f.jsxs("div",{className:"footer-modal-section",children:[f.jsx("h3",{children:s("footer.privacySection4Title")}),f.jsx("p",{children:s("footer.privacySection4Content")})]}),f.jsxs("div",{className:"footer-modal-section",children:[f.jsx("h3",{children:s("footer.privacySection5Title")}),f.jsx("p",{children:s("footer.privacySection5Content")})]}),f.jsxs("div",{className:"footer-modal-section",children:[f.jsx("h3",{children:s("footer.privacySection6Title")}),f.jsx("p",{children:s("footer.privacySection6Content")})]})]})]})}),r&&f.jsx("div",{className:"footer-modal-overlay",onClick:c,role:"dialog","aria-modal":"true","aria-labelledby":"contact-modal-title",children:f.jsxs("div",{className:"footer-modal",onClick:i=>i.stopPropagation(),children:[f.jsxs("div",{className:"footer-modal-header",children:[f.jsx("h2",{id:"contact-modal-title",children:s("footer.contactUs")}),f.jsx("button",{className:"footer-modal-close",onClick:c,"aria-label":s("common.close"),children:"√ó"})]}),f.jsxs("div",{className:"footer-modal-content",children:[f.jsxs("div",{className:"footer-modal-section",children:[f.jsx("h3",{children:s("footer.contactSection1Title")}),f.jsx("p",{children:s("footer.contactSection1Content")})]}),f.jsxs("div",{className:"footer-modal-section",children:[f.jsx("h3",{children:s("footer.contactSection2Title")}),f.jsx("p",{children:s("footer.contactSection2Content")})]}),f.jsxs("div",{className:"footer-modal-section",children:[f.jsx("h3",{children:s("footer.contactSection3Title")}),f.jsx("p",{children:s("footer.contactSection3Content")})]}),f.jsxs("div",{className:"footer-modal-section",children:[f.jsx("h3",{children:s("footer.contactSection4Title")}),f.jsx("p",{children:s("footer.contactSection4Content")})]})]})]})})]})});qt.displayName="Footer";const xo=({children:s})=>f.jsx("div",{className:"game-container",children:s}),Jt={aspectRatio:16/9,gridRows:9,gridCols:9,pixelRatio:window.devicePixelRatio||1};const Eo=({config:s,onReady:e,onResize:o})=>{const r=g.useRef(null),a=g.useRef(null),n=g.useRef(e),l=g.useRef(o),c=g.useRef(!1),[i,d]=g.useState(null),{t:h}=Je();return g.useEffect(()=>{n.current=e},[e]),g.useEffect(()=>{l.current=o},[o]),g.useEffect(()=>{const b=r.current,p=a.current;if(!b||!p)return;const y=b.getContext("2d");if(!y){const E="Canvas 2D context is not supported";v.error(E),d(E);return}i&&d(null);const P=()=>{const E=window.devicePixelRatio||1,X=p.clientWidth,ie=p.clientHeight,W=s.aspectRatio||Jt.aspectRatio||16/9,N=1200,J=675;let te,fe;const Ee=Math.min(X,N),he=Math.min(ie,J);Ee/he>W?(fe=he,te=fe*W):(te=Ee,fe=te/W),b.width=te*E,b.height=fe*E,y.scale(E,E),b.style.width=`${te}px`,b.style.height=`${fe}px`,b.style.display="block",b.style.maxWidth="100%",b.style.maxHeight="100%",!c.current&&n.current&&(c.current=!0,n.current(b,y)),c.current&&l.current&&setTimeout(()=>{l.current&&l.current(b,y)},0)};P();const D=new ResizeObserver(()=>{P()});return D.observe(p),()=>{D.disconnect(),c.current=!1}},[s]),i?f.jsx("div",{className:"game-canvas-error",role:"alert",children:f.jsxs("div",{className:"game-canvas-error-content",children:[f.jsx("div",{className:"game-canvas-error-icon",children:"‚ö†Ô∏è"}),f.jsx("h3",{children:h("error.canvasNotSupported")}),f.jsx("p",{children:h("error.canvasFallbackMessage")}),f.jsx("button",{onClick:()=>{d(null),window.location.reload()},className:"game-canvas-error-button",children:h("error.reload")})]})}):f.jsx("div",{ref:a,className:"game-canvas-wrapper",children:f.jsx("canvas",{ref:r,className:"game-canvas",tabIndex:0,role:"application","aria-label":"Îß§Ïπ≠ ÌçºÏ¶ê Í≤åÏûÑ Î≥¥Îìú","aria-live":"polite","aria-atomic":"true"})})},tt=["red","yellow","blue","green","purple","orange"],st={red:{light:"#e74c3c",dark:"#c0392b"},yellow:{light:"#f1c40f",dark:"#f39c12"},blue:{light:"#3498db",dark:"#2980b9"},green:{light:"#2ecc71",dark:"#27ae60"},purple:{light:"#9b59b6",dark:"#8e44ad"},orange:{light:"#e67e22",dark:"#d35400"}};class Go{constructor(e,o){U(this,"ctx");U(this,"cellSize");this.ctx=e,this.cellSize=o}render(e,o=1){this.ctx.save();const r=e.x+this.cellSize/2,a=e.y+this.cellSize/2,n=e.scale||1,l=e.rotation||0;switch(n===1&&l===0?this.ctx.translate(r,a):(this.ctx.translate(r,a),this.ctx.scale(n,n),this.ctx.rotate(l)),o<1&&(this.ctx.globalAlpha=o),e.type){case"normal":this.renderNormalGem(e);break;case"striped":this.renderStripedGem(e);break;case"wrapped":this.renderWrappedGem(e);break;case"colorBomb":this.renderColorBomb(e);break}this.ctx.restore()}renderNormalGem(e){const o=st[e.color],r=this.cellSize*.85,a=-r/2;this.ctx.fillStyle="rgba(0, 0, 0, 0.2)",this.roundRect(a+2,a+2,r,r,r*.2),this.ctx.fill();const n=this.ctx.createLinearGradient(a,a,a+r,a+r);n.addColorStop(0,o.light),n.addColorStop(1,o.dark),this.ctx.fillStyle=n,this.roundRect(a,a,r,r,r*.2),this.ctx.fill(),this.renderColorPattern(e.color,a,r),this.ctx.fillStyle="rgba(255, 255, 255, 0.3)",this.roundRect(a,a,r,r*.4,r*.2),this.ctx.fill(),this.ctx.strokeStyle=this.getBorderColor(e.color),this.ctx.lineWidth=r*.06,this.roundRect(a,a,r,r,r*.2),this.ctx.stroke()}getBorderColor(e){return{red:"rgba(231, 76, 60, 0.9)",yellow:"rgba(241, 196, 15, 0.9)",blue:"rgba(52, 152, 219, 0.9)",green:"rgba(46, 204, 113, 0.9)",purple:"rgba(155, 89, 182, 0.9)",orange:"rgba(230, 126, 34, 0.9)"}[e]}renderColorPattern(e,o,r){switch(this.ctx.save(),this.ctx.globalAlpha=.5,e){case"red":this.ctx.fillStyle="rgba(255, 255, 255, 0.6)",this.ctx.beginPath(),this.ctx.arc(0,0,r*.18,0,Math.PI*2),this.ctx.fill(),this.ctx.fillStyle="rgba(192, 57, 43, 0.5)",this.ctx.beginPath(),this.ctx.arc(0,0,r*.1,0,Math.PI*2),this.ctx.fill();break;case"yellow":this.ctx.fillStyle="rgba(255, 255, 255, 0.7)",this.drawStar(0,0,r*.1,r*.18,5),this.ctx.fill();break;case"blue":this.ctx.fillStyle="rgba(255, 255, 255, 0.6)",this.ctx.beginPath(),this.ctx.moveTo(0,-r*.18),this.ctx.lineTo(r*.18,0),this.ctx.lineTo(0,r*.18),this.ctx.lineTo(-r*.18,0),this.ctx.closePath(),this.ctx.fill();break;case"green":this.ctx.fillStyle="rgba(255, 255, 255, 0.6)",this.ctx.beginPath(),this.ctx.moveTo(0,-r*.18),this.ctx.lineTo(-r*.15,r*.12),this.ctx.lineTo(r*.15,r*.12),this.ctx.closePath(),this.ctx.fill();break;case"purple":this.ctx.fillStyle="rgba(255, 255, 255, 0.6)",this.ctx.fillRect(-r*.12,-r*.12,r*.24,r*.24);break;case"orange":this.ctx.fillStyle="rgba(255, 255, 255, 0.6)",this.ctx.beginPath();for(let a=0;a<6;a++){const n=Math.PI/3*a,l=Math.cos(n)*r*.15,c=Math.sin(n)*r*.15;a===0?this.ctx.moveTo(l,c):this.ctx.lineTo(l,c)}this.ctx.closePath(),this.ctx.fill(),this.ctx.fillStyle="rgba(211, 84, 0, 0.5)",this.ctx.beginPath(),this.ctx.arc(0,0,r*.08,0,Math.PI*2),this.ctx.fill();break}this.ctx.restore()}renderStripedGem(e){const o=st[e.color],r=this.cellSize*.85,a=-r/2,n=this.ctx.createLinearGradient(a,a,a+r,a+r);if(n.addColorStop(0,o.light),n.addColorStop(1,o.dark),this.ctx.fillStyle=n,this.roundRect(a,a,r,r,r*.2),this.ctx.fill(),this.ctx.strokeStyle="rgba(255, 255, 255, 0.6)",this.ctx.lineWidth=r*.1,this.ctx.lineCap="round",e.stripedDirection==="horizontal")for(let l=0;l<3;l++){const c=a+r/4*(l+1);this.ctx.beginPath(),this.ctx.moveTo(a,c),this.ctx.lineTo(a+r,c),this.ctx.stroke()}else for(let l=0;l<3;l++){const c=a+r/4*(l+1);this.ctx.beginPath(),this.ctx.moveTo(c,a),this.ctx.lineTo(c,a+r),this.ctx.stroke()}}renderWrappedGem(e){const o=st[e.color],r=this.cellSize*.85,a=-r/2,n=this.ctx.createLinearGradient(a,a,a+r,a+r);n.addColorStop(0,o.light),n.addColorStop(1,o.dark),this.ctx.fillStyle=n,this.roundRect(a,a,r,r,r*.2),this.ctx.fill(),this.ctx.strokeStyle="rgba(255, 255, 255, 0.8)",this.ctx.lineWidth=r*.08,this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.moveTo(a,a),this.ctx.lineTo(a+r,a+r),this.ctx.moveTo(a+r,a),this.ctx.lineTo(a,a+r),this.ctx.stroke()}renderColorBomb(e){const o=this.cellSize*.85,r=-o/2,a=this.ctx.createLinearGradient(r,r,r+o,r+o);a.addColorStop(0,"#ff6b6b"),a.addColorStop(.2,"#ffd93d"),a.addColorStop(.4,"#4ecdc4"),a.addColorStop(.6,"#95e1d3"),a.addColorStop(.8,"#a29bfe"),a.addColorStop(1,"#fd79a8"),this.ctx.fillStyle=a,this.roundRect(r,r,o,o,o*.2),this.ctx.fill(),this.ctx.fillStyle="rgba(255, 255, 255, 0.9)",this.drawStar(0,0,o*.3,o*.6,5),this.ctx.fill()}roundRect(e,o,r,a,n){this.ctx.beginPath(),this.ctx.moveTo(e+n,o),this.ctx.lineTo(e+r-n,o),this.ctx.quadraticCurveTo(e+r,o,e+r,o+n),this.ctx.lineTo(e+r,o+a-n),this.ctx.quadraticCurveTo(e+r,o+a,e+r-n,o+a),this.ctx.lineTo(e+n,o+a),this.ctx.quadraticCurveTo(e,o+a,e,o+a-n),this.ctx.lineTo(e,o+n),this.ctx.quadraticCurveTo(e,o,e+n,o),this.ctx.closePath()}drawStar(e,o,r,a,n){this.ctx.beginPath();for(let l=0;l<n*2;l++){const c=Math.PI*l/n,i=l%2===0?a:r,d=e+Math.cos(c)*i,h=o+Math.sin(c)*i;l===0?this.ctx.moveTo(d,h):this.ctx.lineTo(d,h)}this.ctx.closePath()}}const Lt={rows:9,cols:9};function qe(s){var r,a;const e=[],o=new Set;for(let n=0;n<s.length;n++){let l=1,c=(r=s[n][0])==null?void 0:r.color,i=0;for(let d=1;d<=s[n].length;d++){const h=s[n][d];if(h&&h.color===c&&c)l++;else{if(l>=3&&c){const b=[];for(let p=0;p<l;p++){const y={row:n,col:i+p},P=`${y.row},${y.col}`;o.has(P)||(b.push(y),o.add(P))}b.length>0&&e.push({type:"horizontal",positions:b})}h?(l=1,c=h.color,i=d):(l=0,c=void 0)}}}if(s.length>0)for(let n=0;n<s[0].length;n++){let l=1,c=(a=s[0][n])==null?void 0:a.color,i=0;for(let d=1;d<=s.length;d++){const h=d<s.length?s[d][n]:null;if(h&&h.color===c&&c)l++;else{if(l>=3&&c){const b=[];for(let p=0;p<l;p++){const y={row:i+p,col:n},P=`${y.row},${y.col}`;o.has(P)||(b.push(y),o.add(P))}b.length>0&&e.push({type:"vertical",positions:b})}h?(l=1,c=h.color,i=d):(l=0,c=void 0)}}}return e}class jo{constructor(e){U(this,"seed");this.seed=e}next(){return this.seed=(this.seed*9301+49297)%233280,this.seed/233280}}function Bt(s){const e=new jo(s),o=Ao(s),r=Lo(s),a=Bo(s),n=zo(o.rows,o.cols,e);return{stageNumber:s,gridSize:o,targetScore:r,maxMoves:a,goals:[{type:"score",target:r,current:0}],initialBoard:n}}function Ao(s){return s<=100?{rows:9,cols:9}:s<=300?{rows:8,cols:8}:s<=600?{rows:7,cols:7}:{rows:6,cols:6}}function Lo(s){const r=Math.floor(s/100)*500;return 1e3+s*50+r}function Bo(s){const o=Math.floor(s/20),r=20;return s>500?Math.max(r,50-o-Math.floor((s-500)/10)):Math.max(r,50-o)}function zo(s,e,o){const r=[];for(let a=0;a<s;a++){r[a]=[];for(let n=0;n<e;n++){const l=tt[Math.floor(o.next()*tt.length)];r[a][n]={id:`${a}-${n}-${Date.now()}`,color:l,type:"normal",position:{row:a,col:n},x:0,y:0,targetX:void 0,targetY:void 0,scale:1,rotation:0}}}return Oo(r,o)}function Oo(s,e){var n,l,c,i,d;let r=0;const a=e?()=>e.next():()=>Math.random();try{for(;r<100;){const h=qe(s);if(h.length===0)return s;for(const b of h)for(const p of b.positions){const y=(n=s[p.row])==null?void 0:n[p.col];if(y){const P=tt.indexOf(y.color),D=tt.filter((ie,W)=>W!==P);if(D.length===0)continue;let E=y.color,X=0;for(;X<10&&E===y.color;){const ie=Math.floor(a()*D.length),W=D[ie];[(l=s[p.row-1])==null?void 0:l[p.col],(c=s[p.row+1])==null?void 0:c[p.col],(i=s[p.row])==null?void 0:i[p.col-1],(d=s[p.row])==null?void 0:d[p.col+1]].filter(Boolean).some(te=>(te==null?void 0:te.color)===W)?X++:E=W}E===y.color&&D.length>0&&(E=D[0]),y.color=E}}r++}}catch(h){v.error("Error in ensureNoInitialMatches",{error:h})}return s}function zt(s,e=50){var n;const o=s.map(l=>[...l]),r=o.length,a=((n=o[0])==null?void 0:n.length)||0;for(let l=0;l<a;l++){let c=r-1;for(let i=r-1;i>=0;i--)if(o[i][l]!==null){if(c!==i){const d=o[i][l];o[c][l]=d,(d.y===void 0||d.y===0)&&(d.y=i*e),d.targetY=c,d.position.row=c,o[i][l]=null}c--}for(let i=c;i>=0;i--){const d=Io(i,l);d.y=-e*(c-i+1),d.targetY=i,o[i][l]=d}}return o}function Io(s,e){const o=tt[Math.floor(Math.random()*tt.length)];return{id:`${Date.now()}-${s}-${e}-${Math.random()}`,color:o,type:"normal",position:{row:s,col:e},x:0,y:0,targetX:void 0,targetY:void 0,scale:1,rotation:0}}function _o(s){const e=[];for(const o of s){const r=o.positions.length;if(r===4){const a=Math.floor(r/2),n=o.positions[a];e.push({position:n,type:"striped",stripedDirection:o.type==="horizontal"?"horizontal":"vertical"})}else if(r>=5){const a=Math.floor(r/2),n=o.positions[a];e.push({position:n,type:"colorBomb"})}}return e}function $o(s){const e=[],o=s.filter(a=>a.type==="horizontal"),r=s.filter(a=>a.type==="vertical");for(const a of o)for(const n of r){const l=a.positions.find(c=>n.positions.some(i=>c.row===i.row&&c.col===i.col));l&&e.push({position:l,type:"wrapped"})}return e}function No(s){const e=$o(s),o=s.filter(n=>!e.some(l=>{var c,i;return l.position.row===((c=n.positions[0])==null?void 0:c.row)&&l.position.col===((i=n.positions[0])==null?void 0:i.col)})),r=[];r.push(...e);const a=_o(o);for(const n of a)e.some(c=>c.position.row===n.position.row&&c.position.col===n.position.col)||r.push(n);return r}function Do(s,e,o){var l,c,i;const r=[],{row:a,col:n}=s.position;if(o==="horizontal")for(let d=0;d<((l=e[0])==null?void 0:l.length);d++)(c=e[a])!=null&&c[d]&&r.push({row:a,col:d});else for(let d=0;d<e.length;d++)(i=e[d])!=null&&i[n]&&r.push({row:d,col:n});return{positionsToRemove:r,score:r.length*20}}function Fo(s,e){var n,l;const o=[],{row:r,col:a}=s.position;for(let c=r-1;c<=r+1;c++)for(let i=a-1;i<=a+1;i++)c>=0&&c<e.length&&i>=0&&i<(((n=e[0])==null?void 0:n.length)||0)&&((l=e[c])!=null&&l[i])&&o.push({row:c,col:i});return{positionsToRemove:o,score:o.length*30}}function Wo(s,e){var a,n;const o=[],r=s.color;for(let l=0;l<e.length;l++)for(let c=0;c<(((a=e[l])==null?void 0:a.length)||0);c++){const i=(n=e[l])==null?void 0:n[c];i&&i.color===r&&o.push({row:l,col:c})}return{positionsToRemove:o,score:o.length*50}}function Ho(s,e,o){var c,i,d;const r=[],{row:a,col:n}=s.position;for(let h=0;h<((c=o[0])==null?void 0:c.length);h++)(i=o[a])!=null&&i[h]&&r.push({row:a,col:h});for(let h=0;h<o.length;h++)(d=o[h])!=null&&d[n]&&r.push({row:h,col:n});const l=Array.from(new Set(r.map(h=>`${h.row},${h.col}`))).map(h=>{const[b,p]=h.split(",").map(Number);return{row:b,col:p}});return{positionsToRemove:l,score:l.length*30}}function Vo(s,e,o){var d,h,b,p;const r=[],a=s.type==="striped"?s:e,n=s.type==="wrapped"?s:e,l=a.stripedDirection||"horizontal",{row:c,col:i}=n.position;if(l==="horizontal"){for(let y=c-1;y<=c+1;y++)if(y>=0&&y<o.length)for(let P=0;P<((d=o[0])==null?void 0:d.length);P++)(h=o[y])!=null&&h[P]&&r.push({row:y,col:P})}else for(let y=i-1;y<=i+1;y++)if(y>=0&&y<(((b=o[0])==null?void 0:b.length)||0))for(let P=0;P<o.length;P++)(p=o[P])!=null&&p[y]&&r.push({row:P,col:y});return{positionsToRemove:r,score:r.length*40}}function Uo(s,e,o){var c,i,d,h;const r=[],a=s.type==="striped"?s:e,n=a.color;if((a.stripedDirection||"horizontal")==="horizontal")for(let b=0;b<o.length;b++)for(let p=0;p<(((c=o[b])==null?void 0:c.length)||0);p++){const y=(i=o[b])==null?void 0:i[p];y&&y.color===n&&r.push({row:b,col:p})}else for(let b=0;b<(((d=o[0])==null?void 0:d.length)||0);b++)for(let p=0;p<o.length;p++){const y=(h=o[p])==null?void 0:h[b];y&&y.color===n&&r.push({row:p,col:b})}return{positionsToRemove:r,score:r.length*60}}function Xo(s,e,o){var l,c;const r=[],{row:a,col:n}=s.position;for(let i=a-2;i<=a+2;i++)for(let d=n-2;d<=n+2;d++)i>=0&&i<o.length&&d>=0&&d<(((l=o[0])==null?void 0:l.length)||0)&&((c=o[i])!=null&&c[d])&&r.push({row:i,col:d});return{positionsToRemove:r,score:r.length*50}}function Yo(s,e,o){var l,c;const r=[],n=(s.type==="wrapped"?s:e).color;for(let i=0;i<o.length;i++)for(let d=0;d<(((l=o[i])==null?void 0:l.length)||0);d++){const h=(c=o[i])==null?void 0:c[d];h&&h.color===n&&r.push({row:i,col:d})}return{positionsToRemove:r,score:r.length*70}}function qo(s,e,o){var a,n;const r=[];for(let l=0;l<o.length;l++)for(let c=0;c<(((a=o[l])==null?void 0:a.length)||0);c++)(n=o[l])!=null&&n[c]&&r.push({row:l,col:c});return{positionsToRemove:r,score:r.length*100}}function Jo(s,e,o){switch([s.type,e.type].sort().join("+")){case"striped+striped":return Ho(s,e,o);case"striped+wrapped":return Vo(s,e,o);case"colorBomb+striped":return Uo(s,e,o);case"wrapped+wrapped":return Xo(s,e,o);case"colorBomb+wrapped":return Yo(s,e,o);case"colorBomb+colorBomb":return qo(s,e,o);default:return null}}function Ko(s,e){switch(s.type){case"striped":return Do(s,e,s.stripedDirection||"horizontal");case"wrapped":return Fo(s,e);case"colorBomb":return Wo(s,e);default:return{positionsToRemove:[],score:0}}}const Qo=s=>{const[e,o]=g.useState(()=>{const i=Bt(s);return{board:i.initialBoard||[],score:0,moves:i.maxMoves,goals:i.goals,isGameOver:!1,isPaused:!1,currentStage:s,isAnimating:!1,selectedGem:null,comboCount:0}});g.useEffect(()=>{const i=Bt(s);o({board:i.initialBoard||[],score:0,moves:i.maxMoves,goals:i.goals,isGameOver:!1,isPaused:!1,currentStage:s,isAnimating:!1,selectedGem:null,comboCount:0})},[s]);const r=g.useRef(null),a=g.useCallback((i,d)=>{o(h=>{var p,y;if(h.isGameOver)return h;const b=((p=h.selectedGem)==null?void 0:p.row)===i&&((y=h.selectedGem)==null?void 0:y.col)===d?null:{row:i,col:d};return r.current=b,De(ge({},h),{selectedGem:b})})},[]),n=g.useCallback((i,d)=>{o(h=>{var W;if(h.isGameOver||h.moves<=0)return h;const b=Math.abs(i.row-d.row),p=Math.abs(i.col-d.col);if(!(b===1&&p===0||b===0&&p===1))return h;const y=h.board.map(N=>N.map(J=>J?ge({},J):null)),P=y[i.row][i.col],D=y[d.row][d.col];if(P&&D&&P.type!=="normal"&&D.type!=="normal"){const N=Jo(P,D,y);if(N){const J=new Set;for(const A of N.positionsToRemove)J.add(`${A.row},${A.col}`);for(const A of J){const[L,le]=A.split(","),G=Number(L),ve=Number(le);!Number.isNaN(G)&&!Number.isNaN(ve)&&y[G]&&(y[G][ve]=null)}const te=zt(y,50),fe=h.score+N.score,Ee=h.goals.map(A=>A.type==="score"?De(ge({},A),{current:Math.min(A.current+N.score,A.target)}):A),ue=qe(te).length>0,H=Ee.every(A=>A.current>=A.target),Ge=h.moves<=0&&!H;return De(ge({},h),{board:te,score:fe,goals:Ee,moves:h.moves-1,isAnimating:ue&&!H&&!Ge,selectedGem:null,comboCount:0,isGameOver:Ge||h.isGameOver})}}const E=y[i.row][i.col];y[i.row][i.col]=y[d.row][d.col],y[d.row][d.col]=E,y[i.row][i.col]&&(y[i.row][i.col].position=ge({},i)),y[d.row][d.col]&&(y[d.row][d.col].position=ge({},d));const X=qe(y);if(X.length===0)return h;const ie=No(X);for(const N of ie){const J=(W=y[N.position.row])==null?void 0:W[N.position.col];J&&(J.type=N.type,N.stripedDirection&&(J.stripedDirection=N.stripedDirection))}return De(ge({},h),{board:y,moves:h.moves-1,isAnimating:!0,selectedGem:null,comboCount:0})})},[]),l=g.useCallback(()=>{o(i=>{var H,Ge;if(!i.isAnimating)return i;const d=qe(i.board);if(d.length===0)return De(ge({},i),{isAnimating:!1});const h=i.board.map(A=>A.map(L=>L?ge({},L):null)),b=new Set;let p=0;const y=new Set;for(const A of d)for(const L of A.positions){const le=(H=h[L.row])==null?void 0:H[L.col];le&&le.type!=="normal"&&y.add(`${L.row},${L.col}`)}for(const A of y){const[L,le]=A.split(","),G=Number(L),ve=Number(le);if(!Number.isNaN(G)&&!Number.isNaN(ve)&&((Ge=h[G])!=null&&Ge[ve])){const m=h[G][ve],Ke=Ko(m,h);for(const Qe of Ke.positionsToRemove)b.add(`${Qe.row},${Qe.col}`);p+=Ke.score}}for(const A of d)for(const L of A.positions)b.add(`${L.row},${L.col}`);for(const A of b){const[L,le]=A.split(","),G=Number(L),ve=Number(le);!Number.isNaN(G)&&!Number.isNaN(ve)&&h[G]&&(h[G][ve]=null)}const P=zt(h,50),E=qe(P).length>0,X=E?i.comboCount+1:0,ie=1+Math.min(X,5)*.15,W=d.reduce((A,L)=>{const le=L.positions.length;let G=10;return le>=6?G=80:le>=5?G=40:le>=4&&(G=20),A+le*G},0),N=W+p,J=Math.floor(N*(ie-1)),te=i.score+N+J,fe=W+p+J,Ee=i.goals.map(A=>A.type==="score"?De(ge({},A),{current:Math.min(A.current+fe,A.target)}):A),he=Ee.every(A=>A.current>=A.target),ue=i.moves<=0&&!he;return De(ge({},i),{board:P,score:te,goals:Ee,isGameOver:ue||i.isGameOver,isAnimating:E&&!he&&!ue,comboCount:X})})},[]),c=g.useCallback(()=>{o(i=>De(ge({},i),{isPaused:!i.isPaused}))},[]);return{gameState:e,selectGem:a,swapGems:n,processMatches:l,togglePause:c}};function Ot(s){const{score:e,goals:o,moves:r,currentStage:a}=s;if(o.length===0)return 0;const n=o[0];if(n.current<n.target)return 0;const l=n.current/n.target,c=Math.max(20,50-Math.floor(a/20)),i=r/c,d=Math.min(e/(n.target*1.5),1);let h=0;return l>=1&&(h=1,(l>=1.2||i>=.4)&&(h=2),l>=1.5&&i>=.5&&d>=.8&&(h=3)),Math.min(h,3)}class Zo{constructor(e){U(this,"particles",[]);U(this,"ctx");this.ctx=e}emit(e,o,r,a=20){const n=st[r];for(let l=0;l<a;l++){const c=Math.PI*2*l/a+Math.random()*.5,i=2+Math.random()*3;this.particles.push({x:e,y:o,vx:Math.cos(c)*i,vy:Math.sin(c)*i,life:1,maxLife:1,color:Math.random()>.5?n.light:n.dark,size:3+Math.random()*4,rotation:Math.random()*Math.PI*2,rotationSpeed:(Math.random()-.5)*.2})}}emitExplosion(e,o,r,a=50,n=30){const l=st[r];for(let c=0;c<n;c++){const i=Math.random()*Math.PI*2,d=Math.random()*a,h=1+Math.random()*2;this.particles.push({x:e+Math.cos(i)*d*.3,y:o+Math.sin(i)*d*.3,vx:Math.cos(i)*h,vy:Math.sin(i)*h,life:1,maxLife:1,color:Math.random()>.5?l.light:l.dark,size:4+Math.random()*6,rotation:Math.random()*Math.PI*2,rotationSpeed:(Math.random()-.5)*.3})}}update(e=16){for(let o=this.particles.length-1;o>=0;o--){const r=this.particles[o];r.x+=r.vx,r.y+=r.vy,r.vy+=.1,r.vx*=.98,r.vy*=.98,r.rotation+=r.rotationSpeed,r.life-=e/1e3,r.life<=0&&this.particles.splice(o,1)}}render(){this.ctx.save();for(const e of this.particles){const o=e.life/e.maxLife,r=e.size*o;this.ctx.globalAlpha=o,this.ctx.fillStyle=e.color,this.ctx.translate(e.x,e.y),this.ctx.rotate(e.rotation),this.ctx.fillRect(-r/2,-r/2,r,r),this.ctx.setTransform(1,0,0,1,0,0)}this.ctx.globalAlpha=1,this.ctx.restore()}clear(){this.particles=[]}get count(){return this.particles.length}}function bt(s){var n,l,c,i;const e=s.length,o=((n=s[0])==null?void 0:n.length)||0,r=[],a=[];for(let d=0;d<e;d++)for(let h=0;h<o;h++){const b=(l=s[d])==null?void 0:l[h];if(b){if(h<o-1){const p=(c=s[d])==null?void 0:c[h+1];if(p&&p.color!==b.color){const y=It(s,d,h,d,h+1),P=qe(y);if(P.length>0){const D=P.some(X=>X.positions.length>=4),E={from:{row:d,col:h},to:{row:d,col:h+1}};D?r.push(E):a.push(E)}}}if(d<e-1){const p=(i=s[d+1])==null?void 0:i[h];if(p&&p.color!==b.color){const y=It(s,d,h,d+1,h),P=qe(y);if(P.length>0){const D=P.some(X=>X.positions.length>=4),E={from:{row:d,col:h},to:{row:d+1,col:h}};D?r.push(E):a.push(E)}}}}}return r.length>0?r[0]:a.length>0?a[0]:null}function It(s,e,o,r,a){const n=s.map(c=>c.map(i=>i?ge({},i):null)),l=n[e][o];return n[e][o]=n[r][a],n[r][a]=l,n}class er{constructor(){U(this,"data",{webVitals:[],gamePerformance:[],startTime:performance.now(),lastUpdate:performance.now()});U(this,"maxDataSize",100)}addWebVital(e){this.data.webVitals.push(e),this.data.webVitals.length>this.maxDataSize&&this.data.webVitals.shift(),this.data.lastUpdate=performance.now(),e.rating==="poor"&&v.warn(`Poor Web Vital detected: ${e.name}`,{value:e.value,rating:e.rating,threshold:this.getThreshold(e.name)})}addGamePerformance(e){this.data.gamePerformance.push(e),this.data.gamePerformance.length>this.maxDataSize&&this.data.gamePerformance.shift(),this.data.lastUpdate=performance.now()}getWebVitals(e){return e?this.data.webVitals.filter(o=>o.name===e):[...this.data.webVitals]}getGamePerformance(){return[...this.data.gamePerformance]}getAverageWebVital(e){const o=this.getWebVitals(e);return o.length===0?null:o.reduce((a,n)=>a+n.value,0)/o.length}getLatestWebVital(e){const o=this.getWebVitals(e);return o.length===0?null:o[o.length-1]}generateReport(){var a,n;const e={webVitals:{},gamePerformance:{averageFPS:0,averageFrameTime:0,minFPS:1/0,maxFPS:0,sampleCount:0},sessionDuration:performance.now()-this.data.startTime},o=["LCP","FID","CLS","FCP","TTFB"];for(const l of o){const c=this.getLatestWebVital(l),i=this.getAverageWebVital(l),d=this.getWebVitals(l);e.webVitals[l]={latest:(a=c==null?void 0:c.value)!=null?a:null,average:i,rating:(n=c==null?void 0:c.rating)!=null?n:"unknown",count:d.length}}const r=this.getGamePerformance();if(r.length>0){const l=r.map(i=>i.fps),c=r.map(i=>i.frameTime);e.gamePerformance={averageFPS:l.reduce((i,d)=>i+d,0)/l.length,averageFrameTime:c.reduce((i,d)=>i+d,0)/c.length,minFPS:Math.min(...l),maxFPS:Math.max(...l),sampleCount:r.length}}return e}logReport(){const e=this.generateReport();v.info("Performance Report",e)}getThreshold(e){var r;return(r={LCP:{good:2500,needsImprovement:4e3},FID:{good:100,needsImprovement:300},CLS:{good:.1,needsImprovement:.25},FCP:{good:1800,needsImprovement:3e3},TTFB:{good:800,needsImprovement:1800}}[e])!=null?r:{good:0,needsImprovement:0}}reset(){this.data={webVitals:[],gamePerformance:[],startTime:performance.now(),lastUpdate:performance.now()}}getAllData(){return{webVitals:[...this.data.webVitals],gamePerformance:[...this.data.gamePerformance],startTime:this.data.startTime,lastUpdate:this.data.lastUpdate}}}const wt=new er,tr=Object.freeze(Object.defineProperty({__proto__:null,performanceAnalytics:wt},Symbol.toStringTag,{value:"Module"}));class or{constructor(){U(this,"fpsHistory",[]);U(this,"frameTimeHistory",[]);U(this,"lastFrameTime",performance.now());U(this,"frameCount",0);U(this,"fpsUpdateInterval",1e3);U(this,"lastFpsUpdate",performance.now());U(this,"currentFps",60);U(this,"currentFrameTime",16.67);U(this,"maxHistorySize",60);U(this,"callbacks",new Set)}update(){const e=performance.now(),o=e-this.lastFrameTime;if(this.lastFrameTime=e,this.frameTimeHistory.push(o),this.frameTimeHistory.length>this.maxHistorySize&&this.frameTimeHistory.shift(),this.frameCount++,e-this.lastFpsUpdate>=this.fpsUpdateInterval){this.currentFps=this.frameCount,this.currentFrameTime=1e3/this.currentFps,this.fpsHistory.push(this.currentFps),this.fpsHistory.length>this.maxHistorySize&&this.fpsHistory.shift();const r=this.frameTimeHistory.reduce((n,l)=>n+l,0)/this.frameTimeHistory.length,a=this.getMetrics(r);this.callbacks.forEach(n=>n(a));try{wt.addGamePerformance(a)}catch(n){}this.currentFps<30&&this.handlePerformanceDegradation(),this.frameCount=0,this.lastFpsUpdate=e}}getMetrics(e){const o={fps:this.currentFps,frameTime:e,timestamp:performance.now()};if(performance.memory&&typeof performance.memory=="object"){const r=performance.memory;o.memoryUsage={usedJSHeapSize:r.usedJSHeapSize,totalJSHeapSize:r.totalJSHeapSize,jsHeapSizeLimit:r.jsHeapSizeLimit}}return o}handlePerformanceDegradation(){}subscribe(e){return this.callbacks.add(e),()=>{this.callbacks.delete(e)}}getFPS(){return this.currentFps}getAverageFPS(){return this.fpsHistory.length===0?60:this.fpsHistory.reduce((o,r)=>o+r,0)/this.fpsHistory.length}getFrameTime(){return this.currentFrameTime}getFPSHistory(){return[...this.fpsHistory]}getMemoryUsage(){if(performance.memory&&typeof performance.memory=="object"){const e=performance.memory;return{usedJSHeapSize:e.usedJSHeapSize,totalJSHeapSize:e.totalJSHeapSize,jsHeapSizeLimit:e.jsHeapSizeLimit}}return null}reset(){this.fpsHistory=[],this.frameTimeHistory=[],this.frameCount=0,this.currentFps=60,this.currentFrameTime=16.67,this.lastFrameTime=performance.now(),this.lastFpsUpdate=performance.now()}}const _t=new or,ke=(s,e="")=>{if(typeof window=="undefined"||typeof document=="undefined")return e;const o=document.documentElement;return getComputedStyle(o).getPropertyValue(s).trim()||e},xe=()=>({bgPrimary:ke("--bg-primary","#1a1a2e"),bgSecondary:ke("--bg-secondary","#2a2a3e"),bgTertiary:ke("--bg-tertiary","#3a3a4e"),bgCard:ke("--bg-card","rgba(42, 42, 62, 0.9)"),bgOverlayDark:ke("--bg-overlay-dark","rgba(26, 26, 46, 0.9)"),textPrimary:ke("--text-primary","#ffffff"),textSecondary:ke("--text-secondary","rgba(255, 255, 255, 0.85)"),textTertiary:ke("--text-tertiary","rgba(255, 255, 255, 0.65)"),accentPrimary:ke("--accent-primary","#a8b5ff"),accentSecondary:ke("--accent-secondary","#c5a3ff"),accentSuccess:ke("--accent-success","#7fdfd4"),accentWarning:ke("--accent-warning","#ffd89b"),accentDanger:ke("--accent-danger","#ff9f9f"),borderColor:ke("--border-color","rgba(255, 255, 255, 0.15)"),canvasBg:ke("--canvas-bg","#1a1a1a")}),Se=(s,e=1)=>{const o=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(s);if(!o)return`rgba(255, 255, 255, ${e})`;const r=parseInt(o[1],16),a=parseInt(o[2],16),n=parseInt(o[3],16);return`rgba(${r}, ${a}, ${n}, ${e})`};const rr=({stageNumber:s=1,currentScreen:e="stageSelect",onNavigate:o,onStartStage:r})=>{const a=g.useRef(!1),n=g.useRef(null),l=g.useRef(null),c=g.useRef(null),i=g.useRef(null),d=g.useRef(null),h=g.useRef(null),b=g.useRef(new Map),p=g.useRef(null),y=g.useRef(!1),P=g.useRef(null),D=g.useRef(""),E=g.useRef(!1),X=g.useRef(null),ie=g.useRef(null),W=g.useRef(null),N=g.useRef(null),J=g.useRef(!1),te=g.useRef(!1),fe=g.useRef(!1),Ee=g.useRef(!1),[he,ue]=g.useState(!1),{t:H}=Je(),[Ge,A]=g.useState(1),[L,le]=g.useState(1),[G,ve]=g.useState(null),{gameState:m,selectGem:Ke,swapGems:Qe,processMatches:lt,togglePause:rt}=Qo(s),[ce,Kt]=g.useState(()=>{const w=Lt.cols,B=Lt.rows;return{aspectRatio:Jt.aspectRatio,cellSize:70,gridRows:B,gridCols:w,pixelRatio:window.devicePixelRatio||1,logicalWidth:0,logicalHeight:0}});g.useEffect(()=>{var t;if(e==="game"&&m.board.length>0){const w=m.board.length,B=((t=m.board[0])==null?void 0:t.length)||9;Kt(T=>De(ge({},T),{gridRows:w,gridCols:B}))}},[e,m.board,s]),g.useEffect(()=>{try{const t=Fe.get("chipPuzzleGame_progress",{fallback:null,silent:!0});t&&(A(Math.max(1,t.highestStage||1)),v.info("Game progress loaded",{highestStage:t.highestStage||1}))}catch(t){v.warn("Failed to recover game state",{error:t}),A(1)}},[]);const vt=g.useCallback((t,w,B)=>{const u=w/1200,{canvasBg:K,textPrimary:x,accentPrimary:oe,accentSecondary:je,bgTertiary:Ie}=xe(),C=document.documentElement.getAttribute("data-theme")==="light";t.fillStyle=K,t.fillRect(0,0,w,B),t.fillStyle=x;const Pe=Math.max(16,32*u);t.font=`bold ${Pe}px Arial`,t.textAlign="center",t.fillText(H("stageSelect.title"),w/2,50*u);const M=75,me=20,Y=M*u,Ce=me*u,pe=1e3,q=50,re=Math.ceil(pe/q),ye=(L-1)*q+1,Ae=Math.min(ye+q-1,pe);let Te=Ae-ye+1===50?10:8;const _e=(w-(Te*Y+(Te-1)*Ce))/2,Me=100*u;for(let se=0;se<q&&ye+se<=Ae;se++){const Q=ye+se,ze=Math.floor(se/Te),Z=se%Te,ne=_e+Z*(Y+Ce),ee=Me+ze*(Y+Ce),be=Q<=Ge;if(be){const Ne=t.createLinearGradient(ne,ee,ne+Y,ee+Y);Ne.addColorStop(0,oe),Ne.addColorStop(1,je),t.fillStyle=Ne}else t.fillStyle=Ie||(C?"#e0e0e5":"#1a1a1a");if(t.fillRect(ne,ee,Y,Y),t.strokeStyle=be?oe:C?"#cccccc":"#444",t.lineWidth=Math.max(1,2*u),t.strokeRect(ne,ee,Y,Y),be){t.fillStyle=x;const Ne=Math.max(12,20*u);t.font=`bold ${Ne}px Arial`,t.textAlign="center",t.textBaseline="middle",t.fillText(Q.toString(),ne+Y/2,ee+Y/2)}else{t.fillStyle="#ffa500";const Ne=Math.max(16,24*u);t.font=`${Ne}px Arial`,t.textAlign="center",t.textBaseline="middle",t.fillText("üîí",ne+Y/2,ee+Y/2-8*u),t.fillStyle=x;const Ye=Math.max(10,14*u);t.font=`bold ${Ye}px Arial`,t.textAlign="center",t.textBaseline="middle",t.fillText(Q.toString(),ne+Y/2,ee+Y/2+12*u)}}const ae=40*u,Le=90*u,Re=B-60*u,We=15*u,$e=10*u,Xe=C?"rgba(255, 255, 255, 0.5)":"rgba(255, 255, 255, 0.3)",Be=C?.2:.4,{textTertiary:R}=xe(),z=`${H("stageSelect.page")} ${L} / ${re}`;t.font=`bold ${Math.max(12,18*u)}px Arial`;const j=t.measureText(z).width,F=Le+We+j+We+Le,_=(w-F)/2,I=L<=1,O=L>=re,$=t.createLinearGradient(_,Re,_,Re+ae);I?($.addColorStop(0,C?"#cccccc":"#444"),$.addColorStop(1,C?"#bbbbbb":"#333")):($.addColorStop(0,oe),$.addColorStop(1,je)),t.save(),t.globalAlpha=I?.4:1,t.beginPath(),t.roundRect(_,Re,Le,ae,$e),t.fillStyle=$,t.fill(),t.strokeStyle=I?C?"#aaaaaa":"#555":Xe,t.lineWidth=Math.max(1,1.5*u),t.stroke(),t.restore(),I?(t.shadowColor="transparent",t.shadowBlur=0):(t.shadowColor=Se(oe,Be),t.shadowBlur=6*u,t.shadowOffsetX=0,t.shadowOffsetY=2*u),t.fillStyle=I?R:x,t.font=`600 ${Math.max(12,16*u)}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,t.textAlign="center",t.textBaseline="middle",t.fillText("¬´",_+Le/2,Re+ae/2),t.shadowColor="transparent",t.shadowBlur=0;const de=_+Le+We;t.fillStyle=x,t.font=`bold ${Math.max(12,18*u)}px Arial`,t.textAlign="left",t.fillText(z,de,Re+ae/2+4*u);const k=de+j+We,V=t.createLinearGradient(k,Re,k,Re+ae);O?(V.addColorStop(0,C?"#cccccc":"#444"),V.addColorStop(1,C?"#bbbbbb":"#333")):(V.addColorStop(0,oe),V.addColorStop(1,je)),t.save(),t.globalAlpha=O?.4:1,t.beginPath(),t.roundRect(k,Re,Le,ae,$e),t.fillStyle=V,t.fill(),t.strokeStyle=O?C?"#aaaaaa":"#555":Xe,t.lineWidth=Math.max(1,1.5*u),t.stroke(),t.restore(),O?(t.shadowColor="transparent",t.shadowBlur=0):(t.shadowColor=Se(oe,Be),t.shadowBlur=6*u,t.shadowOffsetX=0,t.shadowOffsetY=2*u),t.fillStyle=O?R:x,t.font=`600 ${Math.max(12,16*u)}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,t.textAlign="center",t.textBaseline="middle",t.fillText("¬ª",k+Le/2,Re+ae/2),t.shadowColor="transparent",t.shadowBlur=0},[Ge,H,L]),Ct=g.useCallback((t,w,B)=>{const u=w/1200,{canvasBg:K,textPrimary:x,accentPrimary:oe,accentSecondary:je,accentSuccess:Ie}=xe(),C=document.documentElement.getAttribute("data-theme")==="light";t.fillStyle=K,t.fillRect(0,0,w,B);const M=(ce.cellSize||70)*u,me=ce.gridCols||9,Y=ce.gridRows||9,Ce=M*me,pe=M*Y,q=(w-Ce)/2,re=(B-pe)/2;(!c.current||i.current!==M)&&(c.current=new Go(t,M),i.current=M),d.current||(d.current=new Zo(t));const{bgTertiary:ye}=xe();t.save(),t.globalAlpha=.9,t.fillStyle=C?Se(ye,.6):"rgba(22, 22, 46, 0.8)",t.beginPath(),t.roundRect(q,re,Ce,pe,8*u),t.fill(),t.restore(),t.strokeStyle=C?"rgba(0, 0, 0, 0.08)":"rgba(255, 255, 255, 0.08)",t.lineWidth=Math.max(.5,1*u);for(let R=0;R<=Y;R++){const z=re+R*M;t.beginPath(),t.moveTo(q,z),t.lineTo(q+Ce,z),t.stroke()}for(let R=0;R<=me;R++){const z=q+R*M;t.beginPath(),t.moveTo(z,re),t.lineTo(z,re+pe),t.stroke()}const Ae=Math.max(10,20*u),Oe=24*u,Te=24*u,_e=Ae+8*u,Me=Te,ae=16*u,Le=16*u,{bgCard:Ue,borderColor:Re}=xe(),We=280*u,$e=_e*4+ae*2;t.save(),t.globalAlpha=.9,t.fillStyle=Ue,t.beginPath(),t.roundRect(Oe-ae,Te-ae,We,$e,Le),t.fill(),t.strokeStyle=Re,t.lineWidth=1*u,t.stroke(),t.restore(),t.textAlign="left",t.textBaseline="top",t.shadowColor=C?"rgba(0, 0, 0, 0.1)":"rgba(0, 0, 0, 0.5)",t.shadowBlur=4*u,t.shadowOffsetX=0,t.shadowOffsetY=2*u,t.font=`700 ${Math.max(14,Ae*1.1)}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,t.fillStyle=oe,t.fillText(`${H("game.stage")} ${s}`,Oe,Me),t.font=`600 ${Ae}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,t.fillStyle=x,t.fillText(`${H("game.score")}: ${m.score.toLocaleString()}`,Oe,Me+_e);const{textSecondary:Xe}=xe();if(t.fillStyle=Xe,t.fillText(`${H("game.moves")}: ${m.moves}`,Oe,Me+_e*2),m.goals.length>0){const R=m.goals[0],z=R.current/R.target,{accentSuccess:j}=xe();t.fillStyle=z>=1?j:x,t.fillText(`${H("game.goal")}: ${R.current.toLocaleString()}/${R.target.toLocaleString()}`,Oe,Me+_e*3)}if(m.comboCount>0){const{accentWarning:R}=xe();t.shadowColor=Se(R,C?.4:.6),t.shadowBlur=12*u,t.font=`700 ${Math.max(14,24*u)}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,t.fillStyle=R,t.textAlign="left",t.fillText(`${H("game.combo")} x${m.comboCount}!`,Oe,Me+_e*4),t.shadowColor=C?"rgba(0, 0, 0, 0.1)":"rgba(0, 0, 0, 0.5)",t.shadowBlur=4*u}if(t.shadowColor="transparent",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0,!m.isGameOver&&!m.isAnimating){const j=20*u,F=10*u,S=120*u,_=40*u,I=120*u,O=40*u,$=w-S-j,de=j,k=12*u,V=t.createLinearGradient($,de,$,de+_);he?(V.addColorStop(0,Ie),V.addColorStop(1,Ie)):(V.addColorStop(0,oe),V.addColorStop(1,je)),t.save(),t.beginPath(),t.roundRect($,de,S,_,k),t.fillStyle=V,t.fill();const se=C?"rgba(255, 255, 255, 0.5)":"rgba(255, 255, 255, 0.3)";t.strokeStyle=se,t.lineWidth=Math.max(1,1.5*u),t.stroke(),t.restore();const Q=C?.2:.4;t.shadowColor=Se(he?Ie:oe,Q),t.shadowBlur=8*u,t.shadowOffsetX=0,t.shadowOffsetY=2*u,t.fillStyle=x;const ze=16*u;t.font=`600 ${ze}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,t.textAlign="center",t.textBaseline="middle",t.fillText(H("game.hint"),$+S/2,de+_/2),t.shadowColor="transparent",t.shadowBlur=0;const Z=$-I-F,ne=j,ee=t.createLinearGradient(Z,ne,Z,ne+O);if(m.isPaused){const{accentDanger:Ye}=xe();ee.addColorStop(0,Ye),ee.addColorStop(1,Ye)}else ee.addColorStop(0,oe),ee.addColorStop(1,je);t.save(),t.beginPath(),t.roundRect(Z,ne,I,O,k),t.fillStyle=ee,t.fill(),t.strokeStyle=se,t.lineWidth=Math.max(1,1.5*u),t.stroke(),t.restore();const{accentDanger:be}=xe();t.shadowColor=m.isPaused?Se(be,Q):Se(oe,Q),t.shadowBlur=8*u,t.shadowOffsetX=0,t.shadowOffsetY=2*u,t.fillStyle=x;const Ne=16*u;t.font=`600 ${Ne}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,t.textAlign="center",t.textBaseline="middle",t.fillText(m.isPaused?H("game.resume"):H("game.pause"),Z+I/2,ne+O/2),t.shadowColor="transparent",t.shadowBlur=0}if(m.isGameOver){const{bgOverlayDark:R,bgCard:z,accentDanger:j}=xe(),F=C?"rgba(255, 255, 255, 0.5)":"rgba(255, 255, 255, 0.3)",S=C?.2:.4;t.fillStyle=R,t.fillRect(0,0,w,B);const _=450*u,I=300*u,O=(w-_)/2,$=(B-I)/2,de=24*u;t.save(),t.globalAlpha=.95,t.fillStyle=z,t.beginPath(),t.roundRect(O,$,_,I,de),t.fill(),t.strokeStyle=Se(j,.3),t.lineWidth=2*u,t.stroke(),t.restore(),t.shadowColor=Se(j,C?.3:.5),t.shadowBlur=12*u,t.fillStyle=j,t.font=`700 ${Math.max(28,56*u)}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,t.textAlign="center",t.textBaseline="middle",t.fillText(H("game.gameOver"),w/2,$+60*u),t.shadowColor="transparent",t.shadowBlur=0,t.fillStyle=x,t.font=`600 ${Math.max(16,24*u)}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,t.fillText(`${H("game.finalScore")}: ${m.score.toLocaleString()}`,w/2,$+120*u);const k=w/2-110*u,V=$+180*u,se=220*u,Q=56*u,ze=14*u,Z=t.createLinearGradient(k,V,k,V+Q);Z.addColorStop(0,j),Z.addColorStop(1,j),t.save(),t.beginPath(),t.roundRect(k,V,se,Q,ze),t.fillStyle=Z,t.fill(),t.strokeStyle=F,t.lineWidth=2*u,t.stroke(),t.restore(),t.shadowColor=Se(j,S),t.shadowBlur=8*u,t.shadowOffsetX=0,t.shadowOffsetY=2*u,t.fillStyle=x,t.font=`600 ${Math.max(16,22*u)}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,t.textAlign="center",t.textBaseline="middle",t.fillText(H("game.retry"),w/2,V+Q/2),t.shadowColor="transparent",t.shadowBlur=0}const Be=m.goals.every(R=>R.current>=R.target);if(G&&!m.isPaused&&!m.isGameOver){const R=q+G.col*M,z=re+G.row*M,j=Date.now()%1e3,F=.4+Math.sin(j/1e3*Math.PI*2)*.3;t.save(),t.strokeStyle="#667eea",t.lineWidth=Math.max(3,4*u),t.setLineDash([5*u,5*u]),t.strokeRect(R,z,M,M),t.fillStyle=`rgba(102, 126, 234, ${F*.3})`,t.fillRect(R,z,M,M),t.restore()}if(m.isAnimating){const R=qe(m.board),z=new Set;for(const j of R)for(const F of j.positions)z.add(`${F.row},${F.col}`);z.forEach(j=>{const[F,S]=j.split(","),_=Number(F),I=Number(S);if(!Number.isNaN(_)&&!Number.isNaN(I)&&_>=0&&_<Y&&I>=0&&I<me){const O=q+I*M,$=re+_*M,de=Date.now()%1e3,k=.3+Math.sin(de/1e3*Math.PI*2)*.2;t.fillStyle=`rgba(255, 215, 61, ${k})`,t.strokeStyle="#ffd93d",t.lineWidth=Math.max(2,3*u),t.strokeRect(O,$,M,M),t.fillRect(O,$,M,M)}})}if(m.board&&m.board.length>0&&c.current){let R=!1;m.board.forEach((j,F)=>{j&&j.forEach((S,_)=>{if(S){const I=q+_*M,O=re+F*M;if(J.current&&X.current&&W.current&&ie.current){const k=X.current,V=W.current,se=ie.current;if(F===k.row&&_===k.col)if(N.current){const Q=N.current.x-se.x,ze=N.current.y-se.y,Z=M,ne=Math.max(-Z,Math.min(Z,Q)),ee=Math.max(-Z,Math.min(Z,ze));S.x=I+ne,S.y=O+ee}else S.x=I,S.y=O;else if(F===V.row&&_===V.col)if(N.current){const Q=N.current.x-se.x,ze=N.current.y-se.y,Z=M,ne=Math.max(-Z,Math.min(Z,-Q)),ee=Math.max(-Z,Math.min(Z,-ze));S.x=I+ne,S.y=O+ee}else S.x=I,S.y=O;else S.x=I,S.y=O}else if(S.targetY!==void 0){R=!0;let k;S.targetY<100?k=re+S.targetY*M:k=S.targetY,(S.y===void 0||S.y===0)&&(S.y=O);const V=k-S.y,se=.15;Math.abs(V)>1?(S.y+=V*se,V>0&&(S.y+=1)):(S.y=k,S.targetY=void 0),S.x=I}else if(S.targetX!==void 0){const k=S.targetX-S.x,V=.2;Math.abs(k)>.1?S.x+=k*V:(S.x=S.targetX,S.targetX=void 0),S.y=O}else(S.x===0&&S.y===0&&S.targetX===void 0&&S.targetY===void 0||S.x!==I||S.y!==O)&&(S.x=I,S.y=O);m.selectedGem&&m.selectedGem.row===F&&m.selectedGem.col===_&&(t.fillStyle="rgba(255, 255, 255, 0.3)",t.strokeStyle="rgba(255, 255, 255, 0.8)",t.lineWidth=Math.max(2,3*u),t.strokeRect(I,O,M,M),t.fillRect(I,O,M,M)),he&&p.current&&(p.current.from.row===F&&p.current.from.col===_||p.current.to.row===F&&p.current.to.col===_)&&(t.fillStyle="rgba(255, 215, 61, 0.4)",t.strokeStyle="#ffd93d",t.lineWidth=Math.max(3,4*u),t.strokeRect(I,O,M,M),t.fillRect(I,O,M,M));let $=1,de=S.scale||1;if(S.isRemoving){let k=b.current.get(S.id);k||(k={alpha:1,scale:1},b.current.set(S.id,k)),k.alpha=Math.max(0,k.alpha-.08),k.scale=Math.max(0,k.scale-.08),$=k.alpha,de=k.scale,S.alpha=$,S.scale=de,b.current.set(S.id,k)}else S.alpha=1,S.scale=1;if($>0){const k=Be&&!m.isAnimating?$*.3:$;c.current.render(S,k)}if(S.isRemoving&&$>.8&&$<.9&&d.current){const k=S.x+M/2,V=S.y+M/2;d.current.emit(k,V,S.color,15)}}})});const z=y.current;y.current=R,z&&!R&&m.isAnimating&&e==="game"&&!m.isGameOver&&!E.current&&setTimeout(()=>{m.isAnimating&&e==="game"&&!m.isGameOver&&!E.current&&(E.current=!0,lt(),setTimeout(()=>{E.current=!1,D.current=""},200))},100)}if(d.current&&(d.current.update(16),d.current.render()),m.isPaused&&!m.isGameOver){const{bgOverlayDark:R,bgCard:z,accentPrimary:j,textSecondary:F}=xe();t.fillStyle=R,t.fillRect(0,0,w,B);const S=400*u,_=200*u,I=(w-S)/2,O=(B-_)/2,$=24*u;t.save(),t.globalAlpha=.95,t.fillStyle=z,t.beginPath(),t.roundRect(I,O,S,_,$),t.fill(),t.strokeStyle=Se(j,C?.2:.3),t.lineWidth=2*u,t.stroke(),t.restore(),t.shadowColor=Se(j,C?.3:.5),t.shadowBlur=12*u,t.shadowOffsetX=0,t.shadowOffsetY=0,t.fillStyle=x,t.font=`700 ${Math.max(28,56*u)}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,t.textAlign="center",t.textBaseline="middle",t.fillText(H("game.pause"),w/2,O+_/2-30*u),t.shadowColor="transparent",t.shadowBlur=0,t.fillStyle=F,t.font=`500 ${Math.max(14,20*u)}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,t.fillText(H("game.resume"),w/2,O+_/2+20*u)}if(Be&&!m.isAnimating&&!m.isGameOver){const R=Ot(m),{bgOverlayDark:z,bgCard:j,accentSuccess:F,textTertiary:S}=xe(),_=C?"rgba(255, 255, 255, 0.5)":"rgba(255, 255, 255, 0.3)",I=C?.2:.4;t.fillStyle=z,t.fillRect(0,0,w,B);const O=500*u,$=400*u,de=(w-O)/2,k=(B-$)/2,V=28*u;t.save(),t.globalAlpha=.96,t.fillStyle=j,t.beginPath(),t.roundRect(de,k,O,$,V),t.fill(),t.strokeStyle=Se(F,C?.3:.4),t.lineWidth=2*u,t.stroke(),t.restore(),t.shadowColor=Se(F,C?.3:.5),t.shadowBlur=12*u,t.shadowOffsetX=0,t.shadowOffsetY=0,t.fillStyle=F,t.font=`700 ${Math.max(32,64*u)}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,t.textAlign="center",t.textBaseline="middle",t.fillText(H("game.stageCleared"),w/2,k+80*u);const{accentWarning:se}=xe(),Q=Math.max(24,48*u),ze=Q*1.8,Z=w/2-ze,ne=k+160*u;for(let et=0;et<3;et++){const to=Z+et*ze;t.shadowColor=et<R?Se(se,C?.4:.6):"transparent",t.shadowBlur=et<R?12*u:0,t.fillStyle=et<R?se:S,t.font=`${Q}px Arial`,t.textAlign="center",t.textBaseline="middle",t.fillText("‚òÖ",to,ne)}t.shadowColor="transparent",t.shadowBlur=0,t.fillStyle=x,t.font=`600 ${Math.max(18,28*u)}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,t.fillText(`${H("game.score")}: ${m.score.toLocaleString()}`,w/2,k+220*u);const ee=w/2-120*u,be=k+280*u,Ne=240*u,Ye=60*u,eo=16*u,ht=t.createLinearGradient(ee,be,ee,be+Ye);ht.addColorStop(0,oe),ht.addColorStop(1,je),t.save(),t.beginPath(),t.roundRect(ee,be,Ne,Ye,eo),t.fillStyle=ht,t.fill(),t.strokeStyle=_,t.lineWidth=2*u,t.stroke(),t.restore(),t.shadowColor=Se(oe,I),t.shadowBlur=8*u,t.shadowOffsetX=0,t.shadowOffsetY=2*u,t.fillStyle=x,t.font=`600 ${Math.max(16,22*u)}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`,t.textAlign="center",t.textBaseline="middle",t.fillText(H("game.nextStage"),w/2,be+Ye/2),t.shadowColor="transparent",t.shadowBlur=0}},[ce,m,he,H]),Ve=g.useCallback(()=>{const t=n.current,w=l.current;if(!t||!w)return;const B=window.devicePixelRatio||1,T=t.width/B,u=t.height/B;if(!(T===0||u===0))if(e==="stageSelect")vt(w,T,u);else if(e==="game")Ct(w,T,u);else{const{canvasBg:K}=xe();w.fillStyle=K,w.fillRect(0,0,T,u)}},[e,vt,Ct,s]);g.useEffect(()=>{let t=0;const B=1e3/60,T=_t.subscribe(K=>{}),u=()=>{const K=x=>{x-t>=B&&(Ve(),_t.update(),t=x),h.current=requestAnimationFrame(K)};h.current=requestAnimationFrame(K)};return n.current&&l.current&&(u(),v.info("GameBoard render loop started",{stage:s,screen:e})),()=>{h.current!==null&&(cancelAnimationFrame(h.current),h.current=null),T(),v.debug("GameBoard render loop stopped")}},[Ve,s,e]);const Qt=g.useCallback((t,w)=>{a.current||(a.current=!0,n.current=t,l.current=w,Ve())},[Ve]),Zt=g.useCallback((t,w)=>{n.current=t,l.current=w,Ve()},[Ve]);g.useEffect(()=>{if(n.current&&l.current){const t=setTimeout(()=>{Ve()},10);return()=>clearTimeout(t)}},[Ve,e,Ge,s,m]),g.useEffect(()=>{if(m.isAnimating&&e==="game"&&!m.isGameOver&&!E.current){const t=JSON.stringify(m.board);if(t!==D.current)return E.current=!0,D.current=t,P.current&&clearTimeout(P.current),P.current=setTimeout(()=>{const B=()=>{y.current?setTimeout(B,50):(lt(),setTimeout(()=>{E.current=!1,D.current=""},200))};B()},300),()=>{P.current&&(clearTimeout(P.current),P.current=null)}}else m.isAnimating||(D.current="",E.current=!1)},[m.isAnimating,m.board,lt,e,m.isGameOver]),g.useEffect(()=>{if(e!=="game"){fe.current=!1,Ee.current=!1;return}const t=m.goals.every(w=>w.current>=w.target);if(!fe.current&&m.isGameOver&&(v.info("Game Over",{stage:m.currentStage,score:m.score,moves:m.moves}),we.playGameOver()),!Ee.current&&t&&!m.isGameOver){const w=Ot(m);v.info("Stage Cleared",{stage:m.currentStage,score:m.score,moves:m.moves,stars:w}),we.playStageClear();const T=Fe.get("chipPuzzleGame_progress",{fallback:null})||{highestStage:1,stageRecords:{}},u=m.currentStage;u>=T.highestStage&&(T.highestStage=u+1),T.stageRecords||(T.stageRecords={});const K=u.toString(),x=T.stageRecords[K];!x||m.score>x.bestScore?T.stageRecords[K]={stageNumber:u,stars:Math.max((x==null?void 0:x.stars)||0,w),score:m.score,bestScore:m.score,completedAt:new Date().toISOString(),attempts:((x==null?void 0:x.attempts)||0)+1}:T.stageRecords[K]=De(ge({},x),{stars:Math.max(x.stars,w),attempts:x.attempts+1}),Fe.set("chipPuzzleGame_progress",T)||v.error("Failed to save progress",{stage:m.currentStage})}fe.current=m.isGameOver,Ee.current=t},[m.isGameOver,m.goals,m.score,m.currentStage,e]);const ct=g.useCallback(t=>{if(te.current){te.current=!1;return}const w=n.current;if(!w)return;const B=w.getBoundingClientRect(),T=t.clientX-B.left,u=t.clientY-B.top,K=window.devicePixelRatio||1,x=w.width/K,oe=w.height/K,je=w.getContext("2d");if(je){if(e==="stageSelect"){if(!r)return;const C=x/1200,Pe=1e3,M=50,me=120,Y=40,Ce=20*C,pe=me*C,q=Y*C,re=x-pe-Ce,ye=Ce;if(T>=re&&T<=re+pe&&u>=ye&&u<=ye+q){if(he)ue(!1),p.current=null;else{const be=bt(m.board);be&&(p.current=be,ue(!0),setTimeout(()=>{ue(!1),p.current=null},3e3))}return}const Ae=Math.ceil(Pe/M),Oe=40*C,Te=90*C,Me=oe-60*C,ae=15*C,Le=`${H("stageSelect.page")} ${L} / ${Ae}`;je.font=`bold ${Math.max(12,18*C)}px Arial`;const Ue=je.measureText(Le).width,Re=Te+ae+Ue+ae+Te,$e=(x-Re)/2,Xe=L<=1,Be=$e+Te,R=Me+Oe;if(!Xe&&T>=$e&&T<=Be&&u>=Me&&u<=R){v.debug("Ïù¥Ï†Ñ ÌéòÏù¥ÏßÄ Î≤ÑÌäº ÌÅ¥Î¶≠",{x:T,y:u,prevButtonX:$e,prevButtonRight:Be,buttonY:Me,prevButtonBottom:R,currentPage:L}),le(L-1),we.playClick();return}const j=$e+Te+ae+Ue+ae,F=L>=Ae,S=j+Te,_=Me+Oe;if(!F&&T>=j&&T<=S&&u>=Me&&u<=_){v.debug("Îã§Ïùå ÌéòÏù¥ÏßÄ Î≤ÑÌäº ÌÅ¥Î¶≠",{x:T,y:u,nextButtonX:j,nextButtonRight:S,buttonY:Me,nextButtonBottom:_,currentPage:L,totalPages:Ae}),le(L+1),we.playClick();return}const I=75,O=20,$=I*C,de=O*C,k=(L-1)*M+1,Q=Math.min(k+M-1,Pe)-k+1===50?10:8,ze=(x-(Q*$+(Q-1)*de))/2,Z=100*C,ne=Math.floor((T-ze)/($+de)),ee=Math.floor((u-Z)/($+de));if(ne>=0&&ne<Q&&ee>=0){const be=k+ee*Q+ne;be<=Ge&&be<=Pe&&r(be)}}else if(e==="game"){const C=x/1200;if(m.goals.every(z=>z.current>=z.target)&&!m.isAnimating&&!m.isGameOver){const z=x/2-100*C,j=oe/2+80*C,F=200*C,S=50*C;if(T>=z&&T<=z+F&&u>=j&&u<=j+S){if(r){const _=s+1;r(_)}we.playClick();return}return}if(m.isGameOver){const z=x/2-100*C,j=oe/2+100*C,F=200*C,S=50*C;if(T>=z&&T<=z+F&&u>=j&&u<=j+S){r&&r(s),we.playClick();return}return}if(m.isPaused){rt(),we.playClick();return}const M=120,me=40,Y=20*C,Ce=10*C,pe=M*C,q=me*C,re=M*C,ye=me*C,Ae=x-pe-Y,Oe=Y,Te=Ae-re-Ce,_e=Y;if(T>=Te&&T<=Te+re&&u>=_e&&u<=_e+ye){rt(),we.playClick();return}if(T>=Ae&&T<=Ae+pe&&u>=Oe&&u<=Oe+q){if(he)ue(!1),p.current=null;else{const z=bt(m.board);z&&(p.current=z,ue(!0),setTimeout(()=>{ue(!1),p.current=null},3e3))}we.playClick();return}if(m.isPaused)return;const ae=(ce.cellSize||70)*C,Le=ce.gridCols||9,Ue=ce.gridRows||9,Re=ae*Le,We=ae*Ue,$e=(x-Re)/2,Xe=(oe-We)/2,Be=Math.floor((T-$e)/ae),R=Math.floor((u-Xe)/ae);Be>=0&&Be<Le&&R>=0&&R<Ue&&m.board[R]&&m.board[R][Be]&&(m.selectedGem?Qe(m.selectedGem,{row:R,col:Be}):Ke(R,Be),we.playClick())}}},[e,r,Ge,ce,m,Ke,Qe,he,rt,L,H]),dt=g.useCallback(t=>{const w=n.current;if(!w||e!=="game"||m.isPaused)return;const B=w.getBoundingClientRect(),T=t.clientX-B.left,u=t.clientY-B.top,K=window.devicePixelRatio||1,x=w.width/K,oe=w.height/K,Ie=x/1200,Pe=(ce.cellSize||50)*Ie,M=ce.gridCols||9,me=ce.gridRows||9,Y=Pe*M,Ce=Pe*me,pe=(x-Y)/2,q=(oe-Ce)/2,re=Math.floor((T-pe)/Pe),ye=Math.floor((u-q)/Pe);re>=0&&re<M&&ye>=0&&ye<me&&m.board[ye]&&m.board[ye][re]&&(X.current={row:ye,col:re},ie.current={x:T,y:u},J.current=!0)},[e,ce,m.board,m.isPaused]),ut=g.useCallback(t=>{const w=n.current;if(!w||e!=="game"||m.isPaused||!J.current||!X.current||!ie.current)return;const B=w.getBoundingClientRect(),T=t.clientX-B.left,u=t.clientY-B.top,K=window.devicePixelRatio||1,je=w.width/K/1200,Ie=ce.gridCols||9,C=ce.gridRows||9,Pe=ie.current,M=T-Pe.x,me=u-Pe.y,Y=Math.sqrt(M*M+me*me),Ce=10*je;if(Y<Ce){N.current={x:T,y:u},W.current=null;return}const pe=X.current;let q={row:pe.row,col:pe.col};if(Math.abs(M)>Math.abs(me)?M>0?q.col+=1:q.col-=1:me>0?q.row+=1:q.row-=1,q.col<0||q.col>=Ie||q.row<0||q.row>=C){J.current=!1,X.current=null,ie.current=null,W.current=null,N.current=null;return}N.current={x:T,y:u},W.current=q},[e,ce,m.isPaused]),Ze=g.useCallback(()=>{if(J.current&&X.current&&W.current){const t=X.current,w=W.current,B=Math.abs(t.row-w.row),T=Math.abs(t.col-w.col);(B===1&&T===0||B===0&&T===1)&&(Qe(t,w),we.playClick(),te.current=!0)}J.current=!1,X.current=null,ie.current=null,W.current=null,N.current=null},[Qe]);g.useEffect(()=>{const t=n.current;if(t)return t.addEventListener("click",ct),()=>{t.removeEventListener("click",ct)}},[ct]),g.useEffect(()=>{const t=n.current;if(t)return t.addEventListener("pointerdown",dt),t.addEventListener("pointermove",ut),t.addEventListener("pointerup",Ze),t.addEventListener("pointerleave",Ze),t.addEventListener("pointercancel",Ze),()=>{t.removeEventListener("pointerdown",dt),t.removeEventListener("pointermove",ut),t.removeEventListener("pointerup",Ze),t.removeEventListener("pointerleave",Ze),t.removeEventListener("pointercancel",Ze)}},[dt,ut,Ze]);const ft=g.useCallback(t=>{if(e!=="game"||m.isPaused||m.isAnimating)return;const w=ce.gridRows||9,B=ce.gridCols||9;if(!G){ve({row:0,col:0});return}let T=G.row,u=G.col;switch(t.key){case"ArrowUp":t.preventDefault(),T=Math.max(0,G.row-1),ve({row:T,col:G.col});break;case"ArrowDown":t.preventDefault(),T=Math.min(w-1,G.row+1),ve({row:T,col:G.col});break;case"ArrowLeft":t.preventDefault(),u=Math.max(0,G.col-1),ve({row:G.row,col:u});break;case"ArrowRight":t.preventDefault(),u=Math.min(B-1,G.col+1),ve({row:G.row,col:u});break;case" ":case"Enter":t.preventDefault(),m.board[G.row]&&m.board[G.row][G.col]&&Ke(G.row,G.col);break;case"Escape":t.preventDefault(),rt();break;case"h":case"H":if(t.preventDefault(),he)ue(!1),p.current=null;else{const K=bt(m.board);K&&(p.current=K,ue(!0),setTimeout(()=>{ue(!1),p.current=null},3e3))}break}},[e,m.isPaused,m.isAnimating,m.board,G,ce.gridRows,ce.gridCols,Ke,rt,he]);return g.useEffect(()=>{const t=n.current;if(t)return t.addEventListener("keydown",ft),()=>{t.removeEventListener("keydown",ft)}},[ft]),g.useEffect(()=>{e!=="game"&&ve(null)},[e,m.board]),g.useEffect(()=>{typeof window!="undefined"&&Fe.remove("chipPuzzleGame_orientationPreference",{silent:!0})},[]),f.jsx("div",{className:"game-board",children:f.jsx(Eo,{config:ce,onReady:Qt,onResize:Zt})})},sr=({title:s,description:e,keywords:o,image:r,type:a="website",url:n="https://chipgames.github.io/ChipPuzzleGame/",noindex:l=!1})=>{const{language:c}=Je(),{t:i}=Je(),d=typeof window!="undefined"?window.location.pathname+window.location.search:"",h=d.includes("screen=guide")||n.includes("screen=guide"),b=d.includes("screen=help")||n.includes("screen=help"),p=d.includes("screen=about")||n.includes("screen=about");let y,P,D;h?(y=i("seo.guideTitle")||i("seo.title"),P=i("seo.guideDescription")||i("seo.description"),D=i("seo.guideKeywords")||i("seo.keywords")):b?(y=i("seo.helpTitle")||i("seo.title"),P=i("seo.helpDescription")||i("seo.description"),D=i("seo.helpKeywords")||i("seo.keywords")):p?(y=i("seo.aboutTitle")||i("seo.title"),P=i("seo.aboutDescription")||i("seo.description"),D=i("seo.aboutKeywords")||i("seo.keywords")):(y=i("seo.title")||"Îß§Ïπ≠ ÌçºÏ¶ê Í≤åÏûÑ - CHIP GAMES",P=i("seo.description")||"Î¨¥Î£å Ïò®ÎùºÏù∏ Îß§Ïπ≠ ÌçºÏ¶ê Í≤åÏûÑ. 1000Í∞úÏùò ÎèÑÏ†ÑÏ†ÅÏù∏ Ïä§ÌÖåÏù¥ÏßÄÎ•º ÌîåÎ†àÏù¥ÌïòÏÑ∏Ïöî! Îã§ÏñëÌïú ÏÉâÏÉÅÏùò Ï†¨ÏùÑ Îß§Ïπ≠ÌïòÏó¨ Î™©ÌëúÎ•º Îã¨ÏÑ±ÌïòÎäî Ïû¨ÎØ∏ÏûàÎäî ÌçºÏ¶ê Í≤åÏûÑÏûÖÎãàÎã§.",D=i("seo.keywords")||"Îß§Ïπ≠Í≤åÏûÑ, ÌçºÏ¶êÍ≤åÏûÑ, Î¨¥Î£åÍ≤åÏûÑ, Ïò®ÎùºÏù∏Í≤åÏûÑ, ÌçºÏ¶ê, Îß§Ïπ≠3, Ï∫îÎîîÌÅ¨Îü¨Ïãú, Í≤åÏûÑ, Î∏åÎùºÏö∞Ï†ÄÍ≤åÏûÑ, HTML5Í≤åÏûÑ");const E="https://chipgames.github.io/ChipPuzzleGame/",X=le=>`${E}${le}`,ie=X("ChipGames_Logo.png"),W=s||y,N=e||P,J=o||D,te=r||ie,fe=c!=="ko"?`?lang=${c}`:"",Ee={"@context":"https://schema.org","@type":"Organization",name:"CHIP GAMES",url:"https://chipgames.github.io",logo:X("ChipGames_Logo.png"),sameAs:[]},he={"@context":"https://schema.org","@type":"VideoGame",name:W,description:N,image:te,url:n,applicationCategory:"Game",operatingSystem:"Web Browser",gamePlatform:"Web Browser",offers:{"@type":"Offer",price:"0",priceCurrency:"KRW"},aggregateRating:{"@type":"AggregateRating",ratingValue:"4.5",ratingCount:"100",bestRating:"5",worstRating:"1"},publisher:{"@type":"Organization",name:"CHIP GAMES",url:"https://chipgames.github.io"},genre:"Puzzle Game",gameItem:{"@type":"Thing",name:"Match Puzzle Game",description:"Match colorful gems to complete challenging stages"},inLanguage:c||"ko",datePublished:"2025-01-01",dateModified:new Date().toISOString().split("T")[0]},ue=[{"@type":"ListItem",position:1,name:c==="ko"?"Ìôà":c==="en"?"Home":c==="ja"?"„Éõ„Éº„É†":"È¶ñÈ°µ",item:`${E}${fe}`}];h?ue.push({"@type":"ListItem",position:2,name:i("guide.title")||"Í≤åÏûÑ Í∞ÄÏù¥Îìú",item:`${E}?screen=guide${fe}`}):b?ue.push({"@type":"ListItem",position:2,name:i("help.title")||"ÎèÑÏõÄÎßê",item:`${E}?screen=help${fe}`}):p&&ue.push({"@type":"ListItem",position:2,name:i("about.title")||"Í≤åÏûÑ ÏÜåÍ∞ú",item:`${E}?screen=about${fe}`});const H={"@context":"https://schema.org","@type":"BreadcrumbList",itemListElement:ue},Ge=b?{"@context":"https://schema.org","@type":"FAQPage",mainEntity:[{"@type":"Question",name:i("help.section7Title")||"ÏûêÏ£º Î¨ªÎäî ÏßàÎ¨∏",acceptedAnswer:{"@type":"Answer",text:i("help.section7Content")||""}}]}:null,L=[Ee,{"@context":"https://schema.org","@type":"WebSite",name:"CHIP GAMES - Match Puzzle Game",url:E,publisher:{"@type":"Organization",name:"CHIP GAMES"},inLanguage:[c||"ko","en","ja","zh"]}];return!h&&!b&&!p&&L.push(he),L.push(H),Ge&&L.push(Ge),f.jsxs(ao,{children:[f.jsx("title",{children:W}),f.jsx("meta",{name:"description",content:N}),f.jsx("meta",{name:"keywords",content:J}),f.jsx("meta",{name:"theme-color",content:"#667eea"}),f.jsx("meta",{name:"msapplication-TileColor",content:"#667eea"}),l&&f.jsx("meta",{name:"robots",content:"noindex, nofollow"}),f.jsx("link",{rel:"canonical",href:n}),f.jsx("meta",{property:"og:title",content:W}),f.jsx("meta",{property:"og:description",content:N}),f.jsx("meta",{property:"og:image",content:te}),f.jsx("meta",{property:"og:image:secure_url",content:te}),f.jsx("meta",{property:"og:image:width",content:"1200"}),f.jsx("meta",{property:"og:image:height",content:"630"}),f.jsx("meta",{property:"og:image:alt",content:W}),f.jsx("meta",{property:"og:image:type",content:"image/png"}),f.jsx("meta",{property:"og:type",content:a}),f.jsx("meta",{property:"og:url",content:n}),f.jsx("meta",{property:"og:site_name",content:"CHIP GAMES"}),f.jsx("meta",{property:"og:locale",content:c==="ko"?"ko_KR":c==="en"?"en_US":c==="ja"?"ja_JP":"zh_CN"}),f.jsx("meta",{property:"og:updated_time",content:new Date().toISOString()}),f.jsx("meta",{name:"twitter:card",content:"summary_large_image"}),f.jsx("meta",{name:"twitter:title",content:W}),f.jsx("meta",{name:"twitter:description",content:N}),f.jsx("meta",{name:"twitter:image",content:te}),f.jsx("meta",{name:"twitter:image:alt",content:W}),f.jsx("meta",{name:"twitter:site",content:"@CHIPGAMES"}),f.jsx("meta",{name:"twitter:creator",content:"@CHIPGAMES"}),f.jsx("link",{rel:"alternate",hrefLang:"ko",href:`${n}?lang=ko`}),f.jsx("link",{rel:"alternate",hrefLang:"en",href:`${n}?lang=en`}),f.jsx("link",{rel:"alternate",hrefLang:"ja",href:`${n}?lang=ja`}),f.jsx("link",{rel:"alternate",hrefLang:"zh",href:`${n}?lang=zh`}),f.jsx("link",{rel:"alternate",hrefLang:"x-default",href:n}),f.jsx("meta",{httpEquiv:"Content-Security-Policy",content:"default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://pagead2.googlesyndication.com https://fundingchoicesmessages.google.com https://*.googlesyndication.com https://*.google.com https://*.adtrafficquality.google; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; img-src 'self' data: https:; font-src 'self' data: https://fonts.gstatic.com; connect-src 'self' https://pagead2.googlesyndication.com https://*.googlesyndication.com https://*.google.com https://*.adtrafficquality.google https://googleads.g.doubleclick.net; frame-src 'self' https://googleads.g.doubleclick.net https://tpc.googlesyndication.com; object-src 'none'; base-uri 'self'; form-action 'self';"}),L.map((le,G)=>f.jsx("script",{type:"application/ld+json",children:JSON.stringify(le)},G))]})};function nr(){try{}catch(s){}return window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"||window.location.hostname.includes("localhost")}function ar(){window.adsbygoogle&&Array.isArray(window.adsbygoogle)||(window.adsbygoogle=window.adsbygoogle||[])}function $t(){document.querySelectorAll('iframe[src*="googlesyndication.com"], iframe[src*="doubleclick.net"]').forEach(e=>{try{const o=e;if(o.contentDocument){const r=o.contentDocument.body;r&&r.getAttribute("aria-hidden")==="true"&&r.removeAttribute("aria-hidden")}}catch(o){}})}function ir(){if(nr())return;setTimeout($t,2e3),new MutationObserver(e=>{e.forEach(o=>{o.type==="childList"&&o.addedNodes.forEach(r=>{r.nodeType===1&&r.tagName==="IFRAME"&&setTimeout($t,1e3)})})}).observe(document.body,{childList:!0,subtree:!0})}function ot(){try{}catch(s){}return window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"||window.location.hostname.includes("localhost")}function lr(s){if(!(typeof window=="undefined"||!("PerformanceObserver"in window)))try{const e=new PerformanceObserver(o=>{const r=o.getEntries(),a=r[r.length-1];if(a){const n=a.renderTime||a.loadTime||0,l=n<2500?"good":n<4e3?"needs-improvement":"poor";s({name:"LCP",value:n,id:`lcp-${Date.now()}`,delta:n,rating:l,timestamp:performance.now(),entries:[a]}),e.disconnect()}});e.observe({entryTypes:["largest-contentful-paint"]})}catch(e){ot()&&v.warn("LCP measurement failed",{error:e})}}function cr(s){if(!(typeof window=="undefined"||!("PerformanceObserver"in window)))try{const e=new PerformanceObserver(o=>{const a=o.getEntries()[0];if(a){const n=a.processingStart-a.startTime,l=n<100?"good":n<300?"needs-improvement":"poor";s({name:"FID",value:n,id:`fid-${Date.now()}`,delta:n,rating:l,timestamp:performance.now(),entries:[a]}),e.disconnect()}});e.observe({entryTypes:["first-input"]})}catch(e){ot()&&v.warn("FID measurement failed",{error:e})}}function dr(s){if(!(typeof window=="undefined"||!("PerformanceObserver"in window)))try{let e=0;new PerformanceObserver(a=>{const n=a.getEntries();for(const l of n)l.hadRecentInput||(e+=l.value);if(n.length>0){const l=e<.1?"good":e<.25?"needs-improvement":"poor";s({name:"CLS",value:e,id:`cls-${Date.now()}`,delta:e,rating:l,timestamp:performance.now(),entries:n})}}).observe({entryTypes:["layout-shift"]});const r=()=>{if(document.visibilityState==="hidden"){const a=e<.1?"good":e<.25?"needs-improvement":"poor";s({name:"CLS",value:e,id:`cls-final-${Date.now()}`,delta:e,rating:a,timestamp:performance.now()})}};document.addEventListener("visibilitychange",r)}catch(e){ot()&&v.warn("CLS measurement failed",{error:e})}}function ur(s){if(!(typeof window=="undefined"||!("PerformanceObserver"in window)))try{const e=new PerformanceObserver(o=>{const a=o.getEntries()[0];if(a){const n=a.startTime,l=n<1800?"good":n<3e3?"needs-improvement":"poor";s({name:"FCP",value:n,id:`fcp-${Date.now()}`,delta:n,rating:l,timestamp:performance.now(),entries:[a]}),e.disconnect()}});e.observe({entryTypes:["paint"]})}catch(e){ot()&&v.warn("FCP measurement failed",{error:e})}}function fr(s){if(!(typeof window=="undefined"||!("performance"in window)))try{const e=performance.getEntriesByType("navigation")[0];if(e){const o=e.responseStart-e.requestStart,r=o<800?"good":o<1800?"needs-improvement":"poor";s({name:"TTFB",value:o,id:`ttfb-${Date.now()}`,delta:o,rating:r,timestamp:performance.now(),entries:[e]})}}catch(e){ot()&&v.warn("TTFB measurement failed",{error:e})}}function hr(s){typeof window!="undefined"&&(lr(s),cr(s),dr(s),ur(s),fr(s))}function mr(s){wt.addWebVital(s),ot()?v.info(`Web Vital: ${s.name}`,{value:s.value,rating:s.rating,id:s.id,timestamp:s.timestamp}):s.rating==="poor"&&v.warn(`Poor Web Vital: ${s.name}`,{value:s.value,rating:s.rating,id:s.id})}function gr(){try{}catch(s){}return window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"||window.location.hostname.includes("localhost")}function pr(){if(typeof window=="undefined"||!("serviceWorker"in navigator)){gr()&&v.warn("Service Worker is not supported in this browser");return}const s="sw_reloading";if(sessionStorage.getItem(s)==="true"){sessionStorage.removeItem(s);return}const o=()=>{sessionStorage.getItem(s)!=="true"&&(v.info("Service Worker controller changed"),sessionStorage.setItem(s,"true"),setTimeout(()=>{window.location.reload()},100))};navigator.serviceWorker.__controllerChangeListenerAdded||(navigator.serviceWorker.addEventListener("controllerchange",o),navigator.serviceWorker.__controllerChangeListenerAdded=!0),window.addEventListener("load",()=>{const r="/ChipPuzzleGame/sw.js";navigator.serviceWorker.register(r,{scope:"/ChipPuzzleGame/",updateViaCache:"none"}).then(a=>{v.info("Service Worker registered successfully",{scope:a.scope}),setInterval(()=>{a.update()},60*60*1e3),a.addEventListener("updatefound",()=>{const n=a.installing;n&&n.addEventListener("statechange",()=>{n.state==="installed"&&(navigator.serviceWorker.controller?(v.info("New Service Worker version available"),n.postMessage({type:"SKIP_WAITING"}),sessionStorage.getItem(s)!=="true"&&(sessionStorage.setItem(s,"true"),setTimeout(()=>{window.location.reload()},100))):v.info("Service Worker installed for the first time"))})}),navigator.serviceWorker.controller&&a.update()}).catch(a=>{v.error("Service Worker registration failed",{error:a})})})}const yr=g.lazy(()=>He(()=>import("./GuideScreen-1.1.0-ee753188.js"),["assets/GuideScreen-1.1.0-ee753188.js","assets/vendor-1.1.0-1f763956.js","assets/helmet-1.1.0-341783ac.js","assets/GuideScreen-1.1.0-b085d6a8.css"])),br=g.lazy(()=>He(()=>import("./HelpScreen-1.1.0-624d4370.js"),["assets/HelpScreen-1.1.0-624d4370.js","assets/vendor-1.1.0-1f763956.js","assets/helmet-1.1.0-341783ac.js","assets/HelpScreen-1.1.0-b668f973.css"])),Sr=g.lazy(()=>He(()=>import("./AboutScreen-1.1.0-21d8c3e5.js"),["assets/AboutScreen-1.1.0-21d8c3e5.js","assets/vendor-1.1.0-1f763956.js","assets/helmet-1.1.0-341783ac.js","assets/AboutScreen-1.1.0-d4e85bc6.css"])),wr=()=>{const[s,e]=g.useState("stageSelect"),[o,r]=g.useState(null);Ut(),g.useEffect(()=>{let c=!1;try{c=!1}catch(i){}c||(c=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"||window.location.hostname.includes("localhost")),c||(ar(),ir())},[]),g.useEffect(()=>{hr(mr);const c=()=>{He(()=>Promise.resolve().then(()=>tr),void 0).then(({performanceAnalytics:i})=>{i.logReport()})};return window.addEventListener("beforeunload",c),()=>{window.removeEventListener("beforeunload",c)}},[]),g.useEffect(()=>{pr()},[]);const a=c=>{e(c)},n=c=>{r(c),e("game")},l=()=>{const c="https://chipgames.github.io/ChipPuzzleGame/",i=new URLSearchParams(window.location.search).get("lang")||"ko",d=i!=="ko"?`?lang=${i}`:"";switch(s){case"guide":return{title:void 0,description:void 0,keywords:void 0,url:`${c}?screen=guide${d}`,type:"article"};case"help":return{title:void 0,description:void 0,keywords:void 0,url:`${c}?screen=help${d}`,type:"article"};case"about":return{title:void 0,description:void 0,keywords:void 0,url:`${c}?screen=about${d}`,type:"article"};default:return{title:void 0,description:void 0,keywords:void 0,url:`${c}${d}`,type:"website"}}};return f.jsxs(bo,{children:[f.jsx(sr,ge({},l())),f.jsxs("div",{className:"app-container",children:[f.jsx(Yt,{onNavigate:a,currentScreen:s}),f.jsx(xo,{children:s==="guide"?f.jsx(g.Suspense,{fallback:f.jsx("div",{style:{padding:"20px",textAlign:"center"},children:"Î°úÎî© Ï§ë..."}),children:f.jsx(yr,{onNavigate:a})}):s==="help"?f.jsx(g.Suspense,{fallback:f.jsx("div",{style:{padding:"20px",textAlign:"center"},children:"Î°úÎî© Ï§ë..."}),children:f.jsx(br,{onNavigate:a})}):s==="about"?f.jsx(g.Suspense,{fallback:f.jsx("div",{style:{padding:"20px",textAlign:"center"},children:"Î°úÎî© Ï§ë..."}),children:f.jsx(Sr,{onNavigate:a})}):f.jsx(rr,{stageNumber:o||1,currentScreen:s,onNavigate:a,onStartStage:n})}),f.jsx(qt,{})]})]})};St.createRoot(document.getElementById("root")).render(f.jsx(Nt.StrictMode,{children:f.jsx(io,{children:f.jsx(wr,{})})}));export{f as j,Je as u};
